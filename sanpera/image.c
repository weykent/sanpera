/* Generated by Cython 0.20 on Tue Feb  4 12:36:00 2014 */

#define PY_SSIZE_T_CLEAN
#ifndef CYTHON_USE_PYLONG_INTERNALS
#ifdef PYLONG_BITS_IN_DIGIT
#define CYTHON_USE_PYLONG_INTERNALS 0
#else
#include "pyconfig.h"
#ifdef PYLONG_BITS_IN_DIGIT
#define CYTHON_USE_PYLONG_INTERNALS 1
#else
#define CYTHON_USE_PYLONG_INTERNALS 0
#endif
#endif
#endif
#include "Python.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#elif PY_VERSION_HEX < 0x02040000
    #error Cython requires Python 2.4+.
#else
#define CYTHON_ABI "0_20"
#include <stddef.h> /* For offsetof */
#ifndef offsetof
#define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#endif
#ifndef DL_IMPORT
  #define DL_IMPORT(t) t
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef Py_HUGE_VAL
  #define Py_HUGE_VAL HUGE_VAL
#endif
#ifdef PYPY_VERSION
#define CYTHON_COMPILING_IN_PYPY 1
#define CYTHON_COMPILING_IN_CPYTHON 0
#else
#define CYTHON_COMPILING_IN_PYPY 0
#define CYTHON_COMPILING_IN_CPYTHON 1
#endif
#if CYTHON_COMPILING_IN_PYPY
#define Py_OptimizeFlag 0
#endif
#if PY_VERSION_HEX < 0x02050000
  typedef int Py_ssize_t;
  #define PY_SSIZE_T_MAX INT_MAX
  #define PY_SSIZE_T_MIN INT_MIN
  #define PY_FORMAT_SIZE_T ""
  #define CYTHON_FORMAT_SSIZE_T ""
  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
  #define PyInt_AsSsize_t(o)   __Pyx_PyInt_As_int(o)
  #define PyNumber_Index(o)    ((PyNumber_Check(o) && !PyFloat_Check(o)) ? PyNumber_Int(o) : \
                                (PyErr_Format(PyExc_TypeError, \
                                              "expected index value, got %.200s", Py_TYPE(o)->tp_name), \
                                 (PyObject*)0))
  #define __Pyx_PyIndex_Check(o) (PyNumber_Check(o) && !PyFloat_Check(o) && \
                                  !PyComplex_Check(o))
  #define PyIndex_Check __Pyx_PyIndex_Check
  #define PyErr_WarnEx(category, message, stacklevel) PyErr_Warn(category, message)
  #define __PYX_BUILD_PY_SSIZE_T "i"
#else
  #define __PYX_BUILD_PY_SSIZE_T "n"
  #define CYTHON_FORMAT_SSIZE_T "z"
  #define __Pyx_PyIndex_Check PyIndex_Check
#endif
#if PY_VERSION_HEX < 0x02060000
  #define Py_REFCNT(ob) (((PyObject*)(ob))->ob_refcnt)
  #define Py_TYPE(ob)   (((PyObject*)(ob))->ob_type)
  #define Py_SIZE(ob)   (((PyVarObject*)(ob))->ob_size)
  #define PyVarObject_HEAD_INIT(type, size) \
          PyObject_HEAD_INIT(type) size,
  #define PyType_Modified(t)
  typedef struct {
     void *buf;
     PyObject *obj;
     Py_ssize_t len;
     Py_ssize_t itemsize;
     int readonly;
     int ndim;
     char *format;
     Py_ssize_t *shape;
     Py_ssize_t *strides;
     Py_ssize_t *suboffsets;
     void *internal;
  } Py_buffer;
  #define PyBUF_SIMPLE 0
  #define PyBUF_WRITABLE 0x0001
  #define PyBUF_FORMAT 0x0004
  #define PyBUF_ND 0x0008
  #define PyBUF_STRIDES (0x0010 | PyBUF_ND)
  #define PyBUF_C_CONTIGUOUS (0x0020 | PyBUF_STRIDES)
  #define PyBUF_F_CONTIGUOUS (0x0040 | PyBUF_STRIDES)
  #define PyBUF_ANY_CONTIGUOUS (0x0080 | PyBUF_STRIDES)
  #define PyBUF_INDIRECT (0x0100 | PyBUF_STRIDES)
  #define PyBUF_RECORDS (PyBUF_STRIDES | PyBUF_FORMAT | PyBUF_WRITABLE)
  #define PyBUF_FULL (PyBUF_INDIRECT | PyBUF_FORMAT | PyBUF_WRITABLE)
  typedef int (*getbufferproc)(PyObject *, Py_buffer *, int);
  typedef void (*releasebufferproc)(PyObject *, Py_buffer *);
#endif
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos) \
          PyCode_New(a, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
  #define __Pyx_DefaultClassType PyClass_Type
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos) \
          PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
  #define __Pyx_DefaultClassType PyType_Type
#endif
#if PY_VERSION_HEX < 0x02060000
  #define PyUnicode_FromString(s) PyUnicode_Decode(s, strlen(s), "UTF-8", "strict")
#endif
#if PY_MAJOR_VERSION >= 3
  #define Py_TPFLAGS_CHECKTYPES 0
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#if (PY_VERSION_HEX < 0x02060000) || (PY_MAJOR_VERSION >= 3)
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif
#if PY_VERSION_HEX < 0x02060000
  #define Py_TPFLAGS_HAVE_VERSION_TAG 0
#endif
#if PY_VERSION_HEX < 0x02060000 && !defined(Py_TPFLAGS_IS_ABSTRACT)
  #define Py_TPFLAGS_IS_ABSTRACT 0
#endif
#if PY_VERSION_HEX < 0x030400a1 && !defined(Py_TPFLAGS_HAVE_FINALIZE)
  #define Py_TPFLAGS_HAVE_FINALIZE 0
#endif
#if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
  #define CYTHON_PEP393_ENABLED 1
  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ? \
                                              0 : _PyUnicode_Ready((PyObject *)(op)))
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
  #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
  #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
  #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
#else
  #define CYTHON_PEP393_ENABLED 0
  #define __Pyx_PyUnicode_READY(op)       (0)
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_SIZE(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) ((Py_UCS4)(PyUnicode_AS_UNICODE(u)[i]))
  #define __Pyx_PyUnicode_KIND(u)         (sizeof(Py_UNICODE))
  #define __Pyx_PyUnicode_DATA(u)         ((void*)PyUnicode_AS_UNICODE(u))
  #define __Pyx_PyUnicode_READ(k, d, i)   ((void)(k), (Py_UCS4)(((Py_UNICODE*)d)[i]))
#endif
#define __Pyx_PyString_FormatSafe(a, b)  ((unlikely((a) == Py_None)) ? PyNumber_Remainder(a, b) : __Pyx_PyString_Format(a, b))
#define __Pyx_PyUnicode_FormatSafe(a, b)  ((unlikely((a) == Py_None)) ? PyNumber_Remainder(a, b) : PyUnicode_Format(a, b))
#define __Pyx_PyUnicode_Concat(a, b)  ((unlikely((a) == Py_None) || unlikely((b) == Py_None)) ? \
    PyNumber_Add(a, b) : PyUnicode_Concat(a, b))
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyString_Format(a, b)  PyUnicode_Format(a, b)
#else
  #define __Pyx_PyString_Format(a, b)  PyString_Format(a, b)
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyStringObject               PyUnicodeObject
  #define PyString_Type                PyUnicode_Type
  #define PyString_Check               PyUnicode_Check
  #define PyString_CheckExact          PyUnicode_CheckExact
#endif
#if PY_VERSION_HEX < 0x02060000
  #define PyBytesObject                PyStringObject
  #define PyBytes_Type                 PyString_Type
  #define PyBytes_Check                PyString_Check
  #define PyBytes_CheckExact           PyString_CheckExact
  #define PyBytes_FromString           PyString_FromString
  #define PyBytes_FromStringAndSize    PyString_FromStringAndSize
  #define PyBytes_FromFormat           PyString_FromFormat
  #define PyBytes_DecodeEscape         PyString_DecodeEscape
  #define PyBytes_AsString             PyString_AsString
  #define PyBytes_AsStringAndSize      PyString_AsStringAndSize
  #define PyBytes_Size                 PyString_Size
  #define PyBytes_AS_STRING            PyString_AS_STRING
  #define PyBytes_GET_SIZE             PyString_GET_SIZE
  #define PyBytes_Repr                 PyString_Repr
  #define PyBytes_Concat               PyString_Concat
  #define PyBytes_ConcatAndDel         PyString_ConcatAndDel
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyBaseString_Check(obj) PyUnicode_Check(obj)
  #define __Pyx_PyBaseString_CheckExact(obj) PyUnicode_CheckExact(obj)
#else
  #define __Pyx_PyBaseString_Check(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj) || \
                                         PyString_Check(obj) || PyUnicode_Check(obj))
  #define __Pyx_PyBaseString_CheckExact(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj))
#endif
#if PY_VERSION_HEX < 0x02060000
  #define PySet_Check(obj)             PyObject_TypeCheck(obj, &PySet_Type)
  #define PyFrozenSet_Check(obj)       PyObject_TypeCheck(obj, &PyFrozenSet_Type)
#endif
#ifndef PySet_CheckExact
  #define PySet_CheckExact(obj)        (Py_TYPE(obj) == &PySet_Type)
#endif
#define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
#if PY_MAJOR_VERSION >= 3
  #define PyIntObject                  PyLongObject
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define PyNumber_Int                 PyNumber_Long
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBoolObject                 PyLongObject
#endif
#if PY_VERSION_HEX < 0x03020000
  typedef long Py_hash_t;
  #define __Pyx_PyInt_FromHash_t PyInt_FromLong
  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
#else
  #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
#endif
#if (PY_MAJOR_VERSION < 3) || (PY_VERSION_HEX >= 0x03010300)
  #define __Pyx_PySequence_GetSlice(obj, a, b) PySequence_GetSlice(obj, a, b)
  #define __Pyx_PySequence_SetSlice(obj, a, b, value) PySequence_SetSlice(obj, a, b, value)
  #define __Pyx_PySequence_DelSlice(obj, a, b) PySequence_DelSlice(obj, a, b)
#else
  #define __Pyx_PySequence_GetSlice(obj, a, b) (unlikely(!(obj)) ? \
        (PyErr_SetString(PyExc_SystemError, "null argument to internal routine"), (PyObject*)0) : \
        (likely((obj)->ob_type->tp_as_mapping) ? (PySequence_GetSlice(obj, a, b)) : \
            (PyErr_Format(PyExc_TypeError, "'%.200s' object is unsliceable", (obj)->ob_type->tp_name), (PyObject*)0)))
  #define __Pyx_PySequence_SetSlice(obj, a, b, value) (unlikely(!(obj)) ? \
        (PyErr_SetString(PyExc_SystemError, "null argument to internal routine"), -1) : \
        (likely((obj)->ob_type->tp_as_mapping) ? (PySequence_SetSlice(obj, a, b, value)) : \
            (PyErr_Format(PyExc_TypeError, "'%.200s' object doesn't support slice assignment", (obj)->ob_type->tp_name), -1)))
  #define __Pyx_PySequence_DelSlice(obj, a, b) (unlikely(!(obj)) ? \
        (PyErr_SetString(PyExc_SystemError, "null argument to internal routine"), -1) : \
        (likely((obj)->ob_type->tp_as_mapping) ? (PySequence_DelSlice(obj, a, b)) : \
            (PyErr_Format(PyExc_TypeError, "'%.200s' object doesn't support slice deletion", (obj)->ob_type->tp_name), -1)))
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyMethod_New(func, self, klass) ((self) ? PyMethod_New(func, self) : PyInstanceMethod_New(func))
#endif
#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),((char *)(n)))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),((char *)(n)),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),((char *)(n)))
#else
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),(n))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),(n),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),(n))
#endif
#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_NAMESTR(n) ((char *)(n))
  #define __Pyx_DOCSTR(n)  ((char *)(n))
#else
  #define __Pyx_NAMESTR(n) (n)
  #define __Pyx_DOCSTR(n)  (n)
#endif
#ifndef CYTHON_INLINE
  #if defined(__GNUC__)
    #define CYTHON_INLINE __inline__
  #elif defined(_MSC_VER)
    #define CYTHON_INLINE __inline
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_INLINE inline
  #else
    #define CYTHON_INLINE
  #endif
#endif
#ifndef CYTHON_RESTRICT
  #if defined(__GNUC__)
    #define CYTHON_RESTRICT __restrict__
  #elif defined(_MSC_VER) && _MSC_VER >= 1400
    #define CYTHON_RESTRICT __restrict
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_RESTRICT restrict
  #else
    #define CYTHON_RESTRICT
  #endif
#endif
#ifdef NAN
#define __PYX_NAN() ((float) NAN)
#else
static CYTHON_INLINE float __PYX_NAN() {
  /* Initialize NaN. The sign is irrelevant, an exponent with all bits 1 and
   a nonzero mantissa means NaN. If the first bit in the mantissa is 1, it is
   a quiet NaN. */
  float value;
  memset(&value, 0xFF, sizeof(value));
  return value;
}
#endif


#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
#endif

#ifndef __PYX_EXTERN_C
  #ifdef __cplusplus
    #define __PYX_EXTERN_C extern "C"
  #else
    #define __PYX_EXTERN_C extern
  #endif
#endif

#if defined(WIN32) || defined(MS_WINDOWS)
#define _USE_MATH_DEFINES
#endif
#include <math.h>
#define __PYX_HAVE__sanpera__image
#define __PYX_HAVE_API__sanpera__image
#include "magick/magick-config.h"
#include "magick/magick-type.h"
#include "magick/MagickCore.h"
#include "magick/log.h"
#include "magick/timer.h"
#include "magick/memory_.h"
#include "magick/exception.h"
#include "magick/colorspace.h"
#include "magick/quantum.h"
#include "magick/pixel.h"
#include "magick/color.h"
#include "magick/image.h"
#include "magick/list.h"
#include "magick/magick.h"
#include "magick/blob.h"
#include "magick/constitute.h"
#include "magick/property.h"
#include "magick/composite.h"
#include "magick/resize.h"
#include "magick/transform.h"
#include "magick/paint.h"
#include "magick/cache.h"
#include "magick/cache-view.h"
#include "magick/layer.h"
#include "string.h"
#include "stdio.h"
#include "pythread.h"
#ifdef _OPENMP
#include <omp.h>
#endif /* _OPENMP */

#ifdef PYREX_WITHOUT_ASSERTIONS
#define CYTHON_WITHOUT_ASSERTIONS
#endif

#ifndef CYTHON_UNUSED
# if defined(__GNUC__)
#   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
#     define CYTHON_UNUSED __attribute__ ((__unused__))
#   else
#     define CYTHON_UNUSED
#   endif
# elif defined(__ICC) || (defined(__INTEL_COMPILER) && !defined(_MSC_VER))
#   define CYTHON_UNUSED __attribute__ ((__unused__))
# else
#   define CYTHON_UNUSED
# endif
#endif
typedef struct {PyObject **p; char *s; const Py_ssize_t n; const char* encoding;
                const char is_unicode; const char is_str; const char intern; } __Pyx_StringTabEntry; /*proto*/

#define __PYX_DEFAULT_STRING_ENCODING_IS_ASCII 0
#define __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT 0
#define __PYX_DEFAULT_STRING_ENCODING ""
#define __Pyx_PyObject_FromString __Pyx_PyBytes_FromString
#define __Pyx_PyObject_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#define __Pyx_fits_Py_ssize_t(v, type, is_signed)  (    \
    (sizeof(type) < sizeof(Py_ssize_t))  ||             \
    (sizeof(type) > sizeof(Py_ssize_t) &&               \
          likely(v < (type)PY_SSIZE_T_MAX ||            \
                 v == (type)PY_SSIZE_T_MAX)  &&         \
          (!is_signed || likely(v > (type)PY_SSIZE_T_MIN ||       \
                                v == (type)PY_SSIZE_T_MIN)))  ||  \
    (sizeof(type) == sizeof(Py_ssize_t) &&              \
          (is_signed || likely(v < (type)PY_SSIZE_T_MAX ||        \
                               v == (type)PY_SSIZE_T_MAX)))  )
static CYTHON_INLINE char* __Pyx_PyObject_AsString(PyObject*);
static CYTHON_INLINE char* __Pyx_PyObject_AsStringAndSize(PyObject*, Py_ssize_t* length);
#define __Pyx_PyByteArray_FromString(s) PyByteArray_FromStringAndSize((const char*)s, strlen((const char*)s))
#define __Pyx_PyByteArray_FromStringAndSize(s, l) PyByteArray_FromStringAndSize((const char*)s, l)
#define __Pyx_PyBytes_FromString        PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize PyBytes_FromStringAndSize
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(char*);
#if PY_MAJOR_VERSION < 3
    #define __Pyx_PyStr_FromString        __Pyx_PyBytes_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#else
    #define __Pyx_PyStr_FromString        __Pyx_PyUnicode_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyUnicode_FromStringAndSize
#endif
#define __Pyx_PyObject_AsSString(s)    ((signed char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsUString(s)    ((unsigned char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_FromUString(s)  __Pyx_PyObject_FromString((char*)s)
#define __Pyx_PyBytes_FromUString(s)   __Pyx_PyBytes_FromString((char*)s)
#define __Pyx_PyByteArray_FromUString(s)   __Pyx_PyByteArray_FromString((char*)s)
#define __Pyx_PyStr_FromUString(s)     __Pyx_PyStr_FromString((char*)s)
#define __Pyx_PyUnicode_FromUString(s) __Pyx_PyUnicode_FromString((char*)s)
#if PY_MAJOR_VERSION < 3
static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u)
{
    const Py_UNICODE *u_end = u;
    while (*u_end++) ;
    return u_end - u - 1;
}
#else
#define __Pyx_Py_UNICODE_strlen Py_UNICODE_strlen
#endif
#define __Pyx_PyUnicode_FromUnicode(u)       PyUnicode_FromUnicode(u, __Pyx_Py_UNICODE_strlen(u))
#define __Pyx_PyUnicode_FromUnicodeAndLength PyUnicode_FromUnicode
#define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
#define __Pyx_Owned_Py_None(b) (Py_INCREF(Py_None), Py_None)
#define __Pyx_PyBool_FromLong(b) ((b) ? (Py_INCREF(Py_True), Py_True) : (Py_INCREF(Py_False), Py_False))
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static CYTHON_INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x);
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
#if CYTHON_COMPILING_IN_CPYTHON
#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
#else
#define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
#endif
#define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
static int __Pyx_sys_getdefaultencoding_not_ascii;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys = NULL;
    PyObject* default_encoding = NULL;
    PyObject* ascii_chars_u = NULL;
    PyObject* ascii_chars_b = NULL;
    sys = PyImport_ImportModule("sys");
    if (sys == NULL) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) (const char*) "getdefaultencoding", NULL);
    if (default_encoding == NULL) goto bad;
    if (strcmp(PyBytes_AsString(default_encoding), "ascii") == 0) {
        __Pyx_sys_getdefaultencoding_not_ascii = 0;
    } else {
        const char* default_encoding_c = PyBytes_AS_STRING(default_encoding);
        char ascii_chars[128];
        int c;
        for (c = 0; c < 128; c++) {
            ascii_chars[c] = c;
        }
        __Pyx_sys_getdefaultencoding_not_ascii = 1;
        ascii_chars_u = PyUnicode_DecodeASCII(ascii_chars, 128, NULL);
        if (ascii_chars_u == NULL) goto bad;
        ascii_chars_b = PyUnicode_AsEncodedString(ascii_chars_u, default_encoding_c, NULL);
        if (ascii_chars_b == NULL || strncmp(ascii_chars, PyBytes_AS_STRING(ascii_chars_b), 128) != 0) {
            PyErr_Format(
                PyExc_ValueError,
                "This module compiled with c_string_encoding=ascii, but default encoding '%.200s' is not a superset of ascii.",
                default_encoding_c);
            goto bad;
        }
    }
    Py_XDECREF(sys);
    Py_XDECREF(default_encoding);
    Py_XDECREF(ascii_chars_u);
    Py_XDECREF(ascii_chars_b);
    return 0;
bad:
    Py_XDECREF(sys);
    Py_XDECREF(default_encoding);
    Py_XDECREF(ascii_chars_u);
    Py_XDECREF(ascii_chars_b);
    return -1;
}
#endif
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT && PY_MAJOR_VERSION >= 3
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_DecodeUTF8(c_str, size, NULL)
#else
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_Decode(c_str, size, __PYX_DEFAULT_STRING_ENCODING, NULL)
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
static char* __PYX_DEFAULT_STRING_ENCODING;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys = NULL;
    PyObject* default_encoding = NULL;
    char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (sys == NULL) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) (const char*) "getdefaultencoding", NULL);
    if (default_encoding == NULL) goto bad;
    default_encoding_c = PyBytes_AS_STRING(default_encoding);
    __PYX_DEFAULT_STRING_ENCODING = (char*) malloc(strlen(default_encoding_c));
    strcpy(__PYX_DEFAULT_STRING_ENCODING, default_encoding_c);
    Py_DECREF(sys);
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(sys);
    Py_XDECREF(default_encoding);
    return -1;
}
#endif
#endif


#ifdef __GNUC__
  /* Test for GCC > 2.95 */
  #if __GNUC__ > 2 || (__GNUC__ == 2 && (__GNUC_MINOR__ > 95))
    #define likely(x)   __builtin_expect(!!(x), 1)
    #define unlikely(x) __builtin_expect(!!(x), 0)
  #else /* __GNUC__ > 2 ... */
    #define likely(x)   (x)
    #define unlikely(x) (x)
  #endif /* __GNUC__ > 2 ... */
#else /* __GNUC__ */
  #define likely(x)   (x)
  #define unlikely(x) (x)
#endif /* __GNUC__ */

static PyObject *__pyx_m;
static PyObject *__pyx_d;
static PyObject *__pyx_b;
static PyObject *__pyx_empty_tuple;
static PyObject *__pyx_empty_bytes;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;


static const char *__pyx_f[] = {
  "image.pyx",
  "type.pxd",
  "bool.pxd",
  "complex.pxd",
  "color.pxd",
  "geometry.pxd",
  "exception.pxd",
};

/*--- Type declarations ---*/
struct __pyx_obj_7sanpera_8geometry_Vector;
struct __pyx_obj_7sanpera_8geometry_Size;
struct __pyx_obj_7sanpera_5image_ImageFrame;
struct __pyx_obj_7sanpera_5image_Image;
struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__;
struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create;
struct __pyx_obj_7sanpera_9exception_MagickException;
struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr;
struct __pyx_obj_7sanpera_5color_BaseColor;
struct __pyx_obj_7sanpera_5color_HSLColor;
struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__;
struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__;
struct __pyx_obj_7sanpera_5image_PixelViewPixel;
struct __pyx_obj_7sanpera_5color_RGBColor;
struct __pyx_obj_7sanpera_5image_PixelView;
struct __pyx_obj_7sanpera_8geometry_Rectangle;
struct __pyx_opt_args_7sanpera_9exception_check_magick_exception;

/* "sanpera/exception.pxd":6
 *     cdef c_api.ExceptionInfo* ptr
 * 
 * cdef check_magick_exception(c_api.ExceptionInfo*, int force=*)             # <<<<<<<<<<<<<<
 */
struct __pyx_opt_args_7sanpera_9exception_check_magick_exception {
  int __pyx_n;
  int force;
};
struct __pyx_opt_args_7sanpera_5image_5Image__setup_frames;

/* "sanpera/image.pxd":15
 * 
 *     cdef _post_init(self)
 *     cdef _setup_frames(self, c_api.Image* start=*)             # <<<<<<<<<<<<<<
 *     cdef _fix_page(self)
 */
struct __pyx_opt_args_7sanpera_5image_5Image__setup_frames {
  int __pyx_n;
  Image *start;
};

/* "sanpera/geometry.pxd":5
 * from sanpera cimport c_api
 * 
 * cdef class Vector:             # <<<<<<<<<<<<<<
 *     cdef int _x
 *     cdef int _y
 */
struct __pyx_obj_7sanpera_8geometry_Vector {
  PyObject_HEAD
  int _x;
  int _y;
};


/* "sanpera/geometry.pxd":9
 *     cdef int _y
 * 
 * cdef class Size(Vector):             # <<<<<<<<<<<<<<
 *     cdef _fit(self, other, minmax, bool upscale, bool downscale)
 * 
 */
struct __pyx_obj_7sanpera_8geometry_Size {
  struct __pyx_obj_7sanpera_8geometry_Vector __pyx_base;
  struct __pyx_vtabstruct_7sanpera_8geometry_Size *__pyx_vtab;
};


/* "sanpera/image.pxd":3
 * from sanpera cimport c_api
 * 
 * cdef class ImageFrame:             # <<<<<<<<<<<<<<
 *     cdef c_api.Image* _frame
 * 
 */
struct __pyx_obj_7sanpera_5image_ImageFrame {
  PyObject_HEAD
  struct __pyx_vtabstruct_7sanpera_5image_ImageFrame *__pyx_vtab;
  Image *_frame;
};


/* "sanpera/image.pxd":10
 * cdef ImageFrame _ImageFrame_factory(c_api.Image*)
 * 
 * cdef class Image:             # <<<<<<<<<<<<<<
 *     cdef c_api.Image* _stack
 *     cdef list _frames
 */
struct __pyx_obj_7sanpera_5image_Image {
  PyObject_HEAD
  struct __pyx_vtabstruct_7sanpera_5image_Image *__pyx_vtab;
  Image *_stack;
  PyObject *_frames;
};


/* "sanpera/image.pyx":635
 *     property has_canvas:
 *         """Returns `True` iff any frame has a canvas."""
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return any(f.has_canvas for f in self)
 * 
 */
struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ {
  PyObject_HEAD
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self;
};


/* "sanpera/image.pyx":812
 * 
 *     @classmethod
 *     def create(cls, *names):             # <<<<<<<<<<<<<<
 *         def decorator(f):
 *             obj = cls(f, names)
 */
struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create {
  PyObject_HEAD
  PyObject *__pyx_v_cls;
  PyObject *__pyx_v_names;
};


/* "sanpera/exception.pxd":3
 * from sanpera cimport c_api
 * 
 * cdef class MagickException:             # <<<<<<<<<<<<<<
 *     cdef c_api.ExceptionInfo* ptr
 * 
 */
struct __pyx_obj_7sanpera_9exception_MagickException {
  PyObject_HEAD
  ExceptionInfo *ptr;
};


/* "sanpera/image.pyx":636
 *         """Returns `True` iff any frame has a canvas."""
 *         def __get__(self):
 *             return any(f.has_canvas for f in self)             # <<<<<<<<<<<<<<
 * 
 *     property bit_depth:
 */
struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr {
  PyObject_HEAD
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *__pyx_outer_scope;
  PyObject *__pyx_v_f;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
  PyObject *(*__pyx_t_2)(PyObject *);
};


/* "sanpera/color.pxd":8
 * cdef c_api.MagickRealType _double_to_real_quantum(double value)
 * 
 * cdef class BaseColor:             # <<<<<<<<<<<<<<
 *     cdef double _opacity
 *     cdef tuple _extra_channels
 */
struct __pyx_obj_7sanpera_5color_BaseColor {
  PyObject_HEAD
  struct __pyx_vtabstruct_7sanpera_5color_BaseColor *__pyx_vtab;
  double _opacity;
  PyObject *_extra_channels;
};


/* "sanpera/color.pxd":25
 *     cdef double _blue
 * 
 * cdef class HSLColor(BaseColor):             # <<<<<<<<<<<<<<
 *     cdef double _hue
 *     cdef double _saturation
 */
struct __pyx_obj_7sanpera_5color_HSLColor {
  struct __pyx_obj_7sanpera_5color_BaseColor __pyx_base;
  double _hue;
  double _saturation;
  double _lightness;
};


/* "sanpera/image.pyx":554
 *         return self._stack != NULL
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         cdef ImageFrame frame
 *         for frame in self._frames:
 */
struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ {
  PyObject_HEAD
  struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_frame;
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
};


/* "sanpera/image.pyx":116
 * 
 *     #def iter(self, Rectangle rect = None):
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         rect = self._frame.canvas
 * 
 */
struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ {
  PyObject_HEAD
  int __pyx_v_columns;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc;
  struct __pyx_obj_7sanpera_5image_PixelViewPixel *__pyx_v_pixel;
  PixelPacket *__pyx_v_q;
  PyObject *__pyx_v_rect;
  int __pyx_v_rows;
  struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self;
  int __pyx_v_x;
  int __pyx_v_y;
  long __pyx_t_0;
  long __pyx_t_1;
  int __pyx_t_2;
  long __pyx_t_3;
  long __pyx_t_4;
  int __pyx_t_5;
};


/* "sanpera/image.pyx":32
 * ### Frame
 * 
 * cdef class PixelViewPixel:             # <<<<<<<<<<<<<<
 *     """Transient pixel access object.  Can be used to examine and set a single
 *     pixel's color.
 */
struct __pyx_obj_7sanpera_5image_PixelViewPixel {
  PyObject_HEAD
  PixelPacket *_pixel;
  struct __pyx_obj_7sanpera_5image_PixelView *owner;
  int _x;
  int _y;
};


/* "sanpera/color.pxd":20
 * cdef BaseColor _color_from_pixel(c_api.PixelPacket* pixel)
 * 
 * cdef class RGBColor(BaseColor):             # <<<<<<<<<<<<<<
 *     cdef double _red
 *     cdef double _green
 */
struct __pyx_obj_7sanpera_5color_RGBColor {
  struct __pyx_obj_7sanpera_5color_BaseColor __pyx_base;
  double _red;
  double _green;
  double _blue;
};


/* "sanpera/image.pyx":70
 *             return Vector(self._x, self._y)
 * 
 * cdef class PixelView:             # <<<<<<<<<<<<<<
 *     """Can view and manipulate individual pixels of a frame."""
 * 
 */
struct __pyx_obj_7sanpera_5image_PixelView {
  PyObject_HEAD
  CacheView *_ptr;
  struct __pyx_obj_7sanpera_5image_ImageFrame *_frame;
};


/* "sanpera/geometry.pxd":12
 *     cdef _fit(self, other, minmax, bool upscale, bool downscale)
 * 
 * cdef class Rectangle:             # <<<<<<<<<<<<<<
 *     cdef int _x1
 *     cdef int _x2
 */
struct __pyx_obj_7sanpera_8geometry_Rectangle {
  PyObject_HEAD
  struct __pyx_vtabstruct_7sanpera_8geometry_Rectangle *__pyx_vtab;
  int _x1;
  int _x2;
  int _y1;
  int _y2;
};



/* "sanpera/color.pxd":8
 * cdef c_api.MagickRealType _double_to_real_quantum(double value)
 * 
 * cdef class BaseColor:             # <<<<<<<<<<<<<<
 *     cdef double _opacity
 *     cdef tuple _extra_channels
 */

struct __pyx_vtabstruct_7sanpera_5color_BaseColor {
  struct __pyx_obj_7sanpera_5color_RGBColor *(*rgb)(struct __pyx_obj_7sanpera_5color_BaseColor *, int __pyx_skip_dispatch);
  struct __pyx_obj_7sanpera_5color_HSLColor *(*hsl)(struct __pyx_obj_7sanpera_5color_BaseColor *, int __pyx_skip_dispatch);
  PyObject *(*_populate_pixel)(struct __pyx_obj_7sanpera_5color_BaseColor *, PixelPacket *);
  PyObject *(*_populate_magick_pixel)(struct __pyx_obj_7sanpera_5color_BaseColor *, MagickPixelPacket *);
};
static struct __pyx_vtabstruct_7sanpera_5color_BaseColor *__pyx_vtabptr_7sanpera_5color_BaseColor;


/* "sanpera/geometry.pxd":9
 *     cdef int _y
 * 
 * cdef class Size(Vector):             # <<<<<<<<<<<<<<
 *     cdef _fit(self, other, minmax, bool upscale, bool downscale)
 * 
 */

struct __pyx_vtabstruct_7sanpera_8geometry_Size {
  PyObject *(*_fit)(struct __pyx_obj_7sanpera_8geometry_Size *, PyObject *, PyObject *, PyBoolObject *, PyBoolObject *);
};
static struct __pyx_vtabstruct_7sanpera_8geometry_Size *__pyx_vtabptr_7sanpera_8geometry_Size;


/* "sanpera/image.pyx":169
 * 
 * 
 * cdef class ImageFrame:             # <<<<<<<<<<<<<<
 *     """Represents a single frame, and knows how to perform most operations on
 *     it.
 */

struct __pyx_vtabstruct_7sanpera_5image_ImageFrame {
  PyObject *(*_set_frame)(struct __pyx_obj_7sanpera_5image_ImageFrame *, Image *);
};
static struct __pyx_vtabstruct_7sanpera_5image_ImageFrame *__pyx_vtabptr_7sanpera_5image_ImageFrame;


/* "sanpera/color.pxd":25
 *     cdef double _blue
 * 
 * cdef class HSLColor(BaseColor):             # <<<<<<<<<<<<<<
 *     cdef double _hue
 *     cdef double _saturation
 */

struct __pyx_vtabstruct_7sanpera_5color_HSLColor {
  struct __pyx_vtabstruct_7sanpera_5color_BaseColor __pyx_base;
};
static struct __pyx_vtabstruct_7sanpera_5color_HSLColor *__pyx_vtabptr_7sanpera_5color_HSLColor;


/* "sanpera/geometry.pxd":12
 *     cdef _fit(self, other, minmax, bool upscale, bool downscale)
 * 
 * cdef class Rectangle:             # <<<<<<<<<<<<<<
 *     cdef int _x1
 *     cdef int _x2
 */

struct __pyx_vtabstruct_7sanpera_8geometry_Rectangle {
  RectangleInfo (*to_rect_info)(struct __pyx_obj_7sanpera_8geometry_Rectangle *);
};
static struct __pyx_vtabstruct_7sanpera_8geometry_Rectangle *__pyx_vtabptr_7sanpera_8geometry_Rectangle;


/* "sanpera/color.pxd":20
 * cdef BaseColor _color_from_pixel(c_api.PixelPacket* pixel)
 * 
 * cdef class RGBColor(BaseColor):             # <<<<<<<<<<<<<<
 *     cdef double _red
 *     cdef double _green
 */

struct __pyx_vtabstruct_7sanpera_5color_RGBColor {
  struct __pyx_vtabstruct_7sanpera_5color_BaseColor __pyx_base;
};
static struct __pyx_vtabstruct_7sanpera_5color_RGBColor *__pyx_vtabptr_7sanpera_5color_RGBColor;


/* "sanpera/image.pyx":298
 * ### Image
 * 
 * cdef class Image:             # <<<<<<<<<<<<<<
 *     """An image.  If you don't know what this is, you may be using the wrong
 *     library.
 */

struct __pyx_vtabstruct_7sanpera_5image_Image {
  PyObject *(*_post_init)(struct __pyx_obj_7sanpera_5image_Image *);
  PyObject *(*_setup_frames)(struct __pyx_obj_7sanpera_5image_Image *, struct __pyx_opt_args_7sanpera_5image_5Image__setup_frames *__pyx_optional_args);
  PyObject *(*_fix_page)(struct __pyx_obj_7sanpera_5image_Image *);
};
static struct __pyx_vtabstruct_7sanpera_5image_Image *__pyx_vtabptr_7sanpera_5image_Image;
#ifndef CYTHON_REFNANNY
  #define CYTHON_REFNANNY 0
#endif
#if CYTHON_REFNANNY
  typedef struct {
    void (*INCREF)(void*, PyObject*, int);
    void (*DECREF)(void*, PyObject*, int);
    void (*GOTREF)(void*, PyObject*, int);
    void (*GIVEREF)(void*, PyObject*, int);
    void* (*SetupContext)(const char*, int, const char*);
    void (*FinishContext)(void**);
  } __Pyx_RefNannyAPIStruct;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname); /*proto*/
  #define __Pyx_RefNannyDeclarations void *__pyx_refnanny = NULL;
#ifdef WITH_THREAD
  #define __Pyx_RefNannySetupContext(name, acquire_gil) \
          if (acquire_gil) { \
              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure(); \
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__); \
              PyGILState_Release(__pyx_gilstate_save); \
          } else { \
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__); \
          }
#else
  #define __Pyx_RefNannySetupContext(name, acquire_gil) \
          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
#endif
  #define __Pyx_RefNannyFinishContext() \
          __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_XINCREF(r)  do { if((r) != NULL) {__Pyx_INCREF(r); }} while(0)
  #define __Pyx_XDECREF(r)  do { if((r) != NULL) {__Pyx_DECREF(r); }} while(0)
  #define __Pyx_XGOTREF(r)  do { if((r) != NULL) {__Pyx_GOTREF(r); }} while(0)
  #define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);}} while(0)
#else
  #define __Pyx_RefNannyDeclarations
  #define __Pyx_RefNannySetupContext(name, acquire_gil)
  #define __Pyx_RefNannyFinishContext()
  #define __Pyx_INCREF(r) Py_INCREF(r)
  #define __Pyx_DECREF(r) Py_DECREF(r)
  #define __Pyx_GOTREF(r)
  #define __Pyx_GIVEREF(r)
  #define __Pyx_XINCREF(r) Py_XINCREF(r)
  #define __Pyx_XDECREF(r) Py_XDECREF(r)
  #define __Pyx_XGOTREF(r)
  #define __Pyx_XGIVEREF(r)
#endif /* CYTHON_REFNANNY */
#define __Pyx_XDECREF_SET(r, v) do {                            \
        PyObject *tmp = (PyObject *) r;                         \
        r = v; __Pyx_XDECREF(tmp);                              \
    } while (0)
#define __Pyx_DECREF_SET(r, v) do {                             \
        PyObject *tmp = (PyObject *) r;                         \
        r = v; __Pyx_DECREF(tmp);                               \
    } while (0)
#define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
#define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_getattro))
        return tp->tp_getattro(obj, attr_name);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_getattr))
        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
#endif
    return PyObject_GetAttr(obj, attr_name);
}
#else
#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
#endif

static PyObject *__Pyx_GetBuiltinName(PyObject *name); /*proto*/

static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found); /*proto*/

static CYTHON_INLINE int __Pyx_CheckKeywordStrings(PyObject *kwdict, const char* function_name, int kw_allowed); /*proto*/

static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause); /*proto*/

static CYTHON_INLINE int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact); /*proto*/

static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name); /*proto*/

static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[], \
    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args, \
    const char* function_name); /*proto*/

static void __Pyx_WriteUnraisable(const char *name, int clineno,
                                  int lineno, const char *filename,
                                  int full_traceback); /*proto*/

static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type); /*proto*/

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static CYTHON_INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static CYTHON_INLINE PyObject *__Pyx_GetModuleGlobalName(PyObject *name); /*proto*/

#include <string.h>

static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals); /*proto*/

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE int __Pyx_PyList_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len) & likely(len > (L->allocated >> 1))) {
        Py_INCREF(x);
        PyList_SET_ITEM(list, len, x);
        Py_SIZE(list) = len+1;
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_PyList_Append(L,x) PyList_Append(L,x)
#endif

static CYTHON_INLINE int __Pyx_PyList_Extend(PyObject* L, PyObject* v) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject* none = _PyList_Extend((PyListObject*)L, v);
    if (unlikely(!none))
        return -1;
    Py_DECREF(none);
    return 0;
#else
    return PyList_SetSlice(L, PY_SSIZE_T_MAX, PY_SSIZE_T_MAX, v);
#endif
}

static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname);

static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals); /*proto*/

#if PY_MAJOR_VERSION >= 3
#define __Pyx_PyString_Equals __Pyx_PyUnicode_Equals
#else
#define __Pyx_PyString_Equals __Pyx_PyBytes_Equals
#endif

#ifndef __PYX_FORCE_INIT_THREADS
  #define __PYX_FORCE_INIT_THREADS 0
#endif

#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_PyObject_DelAttrStr(o,n) __Pyx_PyObject_SetAttrStr(o,n,NULL)
static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_setattro))
        return tp->tp_setattro(obj, attr_name, value);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_setattr))
        return tp->tp_setattr(obj, PyString_AS_STRING(attr_name), value);
#endif
    return PyObject_SetAttr(obj, attr_name, value);
}
#else
#define __Pyx_PyObject_DelAttrStr(o,n)   PyObject_DelAttr(o,n)
#define __Pyx_PyObject_SetAttrStr(o,n,v) PyObject_SetAttr(o,n,v)
#endif

static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);

#define __Pyx_CyFunction_USED 1
#include <structmember.h>
#define __Pyx_CYFUNCTION_STATICMETHOD  0x01
#define __Pyx_CYFUNCTION_CLASSMETHOD   0x02
#define __Pyx_CYFUNCTION_CCLASS        0x04
#define __Pyx_CyFunction_GetClosure(f) \
    (((__pyx_CyFunctionObject *) (f))->func_closure)
#define __Pyx_CyFunction_GetClassObj(f) \
    (((__pyx_CyFunctionObject *) (f))->func_classobj)
#define __Pyx_CyFunction_Defaults(type, f) \
    ((type *)(((__pyx_CyFunctionObject *) (f))->defaults))
#define __Pyx_CyFunction_SetDefaultsGetter(f, g) \
    ((__pyx_CyFunctionObject *) (f))->defaults_getter = (g)
typedef struct {
    PyCFunctionObject func;
    int flags;
    PyObject *func_dict;
    PyObject *func_weakreflist;
    PyObject *func_name;
    PyObject *func_qualname;
    PyObject *func_doc;
    PyObject *func_globals;
    PyObject *func_code;
    PyObject *func_closure;
    PyObject *func_classobj; /* No-args super() class cell */
    void *defaults;
    int defaults_pyobjects;
    PyObject *defaults_tuple;   /* Const defaults tuple */
    PyObject *defaults_kwdict;  /* Const kwonly defaults dict */
    PyObject *(*defaults_getter)(PyObject *);
    PyObject *func_annotations; /* function annotations dict */
} __pyx_CyFunctionObject;
static PyTypeObject *__pyx_CyFunctionType = 0;
#define __Pyx_CyFunction_NewEx(ml, flags, qualname, self, module, globals, code) \
    __Pyx_CyFunction_New(__pyx_CyFunctionType, ml, flags, qualname, self, module, globals, code)
static PyObject *__Pyx_CyFunction_New(PyTypeObject *, PyMethodDef *ml,
                                      int flags, PyObject* qualname,
                                      PyObject *self,
                                      PyObject *module, PyObject *globals,
                                      PyObject* code);
static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *m,
                                                         size_t size,
                                                         int pyobjects);
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *m,
                                                            PyObject *tuple);
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *m,
                                                             PyObject *dict);
static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *m,
                                                              PyObject *dict);
static int __Pyx_CyFunction_init(void);

#if PY_VERSION_HEX < 0x02050000
#ifndef PyAnySet_CheckExact
#define PyAnySet_CheckExact(ob) \
    ((ob)->ob_type == &PySet_Type || \
     (ob)->ob_type == &PyFrozenSet_Type)
#define PySet_New(iterable) \
    PyObject_CallFunctionObjArgs((PyObject *)&PySet_Type, (iterable), NULL)
#define Pyx_PyFrozenSet_New(iterable) \
    PyObject_CallFunctionObjArgs((PyObject *)&PyFrozenSet_Type, (iterable), NULL)
#define PySet_Size(anyset) \
    PyObject_Size((anyset))
#define PySet_Contains(anyset, key) \
    PySequence_Contains((anyset), (key))
#define PySet_Pop(set) \
    PyObject_CallMethod((set), (char*)"pop", NULL)
static CYTHON_INLINE int PySet_Clear(PyObject *set) {
    PyObject *ret = PyObject_CallMethod(set, (char*)"clear", NULL);
    if (!ret) return -1;
    Py_DECREF(ret); return 0;
}
static CYTHON_INLINE int PySet_Discard(PyObject *set, PyObject *key) {
    PyObject *ret = PyObject_CallMethod(set, (char*)"discard", (char*)"(O)", key);
    if (!ret) return -1;
    Py_DECREF(ret); return 0;
}
static CYTHON_INLINE int PySet_Add(PyObject *set, PyObject *key) {
    PyObject *ret = PyObject_CallMethod(set, (char*)"add", (char*)"(O)", key);
    if (!ret) return -1;
    Py_DECREF(ret); return 0;
}
#endif /* PyAnySet_CheckExact (<= Py2.4) */
#endif /* < Py2.5  */

static CYTHON_INLINE int __Pyx_PySequence_Contains(PyObject* item, PyObject* seq, int eq) {
    int result = PySequence_Contains(seq, item);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

static int __Pyx_SetVtable(PyObject *dict, void *vtable); /*proto*/

static void* __Pyx_GetVtable(PyObject *dict); /*proto*/

static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name); /*proto*/

static PyObject *__Pyx_GetNameInClass(PyObject *nmspace, PyObject *name); /*proto*/

static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases);

static PyObject *__Pyx_Py3MetaclassPrepare(PyObject *metaclass, PyObject *bases, PyObject *name, PyObject *qualname,
                                           PyObject *mkw, PyObject *modname, PyObject *doc); /*proto*/
static PyObject *__Pyx_Py3ClassCreate(PyObject *metaclass, PyObject *name, PyObject *bases, PyObject *dict,
                                      PyObject *mkw, int calculate_metaclass, int allow_py2_metaclass); /*proto*/

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level); /*proto*/

static CYTHON_INLINE unsigned long __Pyx_PyInt_As_unsigned_long(PyObject *);

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);

static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);

static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *);

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_unsigned_long(unsigned long value);

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_unsigned_int(unsigned int value);

static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);

#include "descrobject.h"
static PyObject* __Pyx_Method_ClassMethod(PyObject *method); /*proto*/

static PyObject* __Pyx_PyObject_CallMethodTuple(PyObject* obj, PyObject* method_name, PyObject* args) {
    PyObject *method, *result = NULL;
    if (unlikely(!args)) return NULL;
    method = __Pyx_PyObject_GetAttrStr(obj, method_name);
    if (unlikely(!method)) goto bad;
    result = PyObject_Call(method, args, NULL);
    Py_DECREF(method);
bad:
    Py_DECREF(args);
    return result;
}
#define __Pyx_PyObject_CallMethod3(obj, name, arg1, arg2, arg3) \
    __Pyx_PyObject_CallMethodTuple(obj, name, PyTuple_Pack(3, arg1, arg2, arg3))
#define __Pyx_PyObject_CallMethod2(obj, name, arg1, arg2) \
    __Pyx_PyObject_CallMethodTuple(obj, name, PyTuple_Pack(2, arg1, arg2))
#define __Pyx_PyObject_CallMethod1(obj, name, arg1) \
    __Pyx_PyObject_CallMethodTuple(obj, name, PyTuple_Pack(1, arg1))
#define __Pyx_PyObject_CallMethod0(obj, name) \
    __Pyx_PyObject_CallMethodTuple(obj, name, (Py_INCREF(__pyx_empty_tuple), __pyx_empty_tuple))

#define __Pyx_Generator_USED
#include <structmember.h>
#include <frameobject.h>
typedef PyObject *(*__pyx_generator_body_t)(PyObject *, PyObject *);
typedef struct {
    PyObject_HEAD
    __pyx_generator_body_t body;
    PyObject *closure;
    PyObject *exc_type;
    PyObject *exc_value;
    PyObject *exc_traceback;
    PyObject *gi_weakreflist;
    PyObject *classobj;
    PyObject *yieldfrom;
    int resume_label;
    char is_running;
} __pyx_GeneratorObject;
static __pyx_GeneratorObject *__Pyx_Generator_New(__pyx_generator_body_t body,
                                                  PyObject *closure);
static int __pyx_Generator_init(void);
static int __Pyx_Generator_clear(PyObject* self);
#if 1 || PY_VERSION_HEX < 0x030300B0
static int __Pyx_PyGen_FetchStopIterationValue(PyObject **pvalue);
#else
#define __Pyx_PyGen_FetchStopIterationValue(pvalue) PyGen_FetchStopIterationValue(pvalue)
#endif

static int __Pyx_check_binary_version(void);

static int __Pyx_ExportFunction(const char *name, void (*f)(void), const char *sig); /*proto*/

#if !defined(__Pyx_PyIdentifier_FromString)
#if PY_MAJOR_VERSION < 3
  #define __Pyx_PyIdentifier_FromString(s) PyString_FromString(s)
#else
  #define __Pyx_PyIdentifier_FromString(s) PyUnicode_FromString(s)
#endif
#endif

static PyObject *__Pyx_ImportModule(const char *name); /*proto*/

static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name, size_t size, int strict);  /*proto*/

static int __Pyx_ImportFunction(PyObject *module, const char *funcname, void (**f)(void), const char *sig); /*proto*/

typedef struct {
    int code_line;
    PyCodeObject* code_object;
} __Pyx_CodeObjectCacheEntry;
struct __Pyx_CodeObjectCache {
    int count;
    int max_count;
    __Pyx_CodeObjectCacheEntry* entries;
};
static struct __Pyx_CodeObjectCache __pyx_code_cache = {0,0,NULL};
static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line);
static PyCodeObject *__pyx_find_code_object(int code_line);
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);

static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/


/* Module declarations from 'sanpera' */

/* Module declarations from 'sanpera.c_api' */

/* Module declarations from 'cpython.version' */

/* Module declarations from 'cpython.ref' */

/* Module declarations from 'cpython.exc' */

/* Module declarations from 'cpython.module' */

/* Module declarations from 'cpython.mem' */

/* Module declarations from 'cpython.tuple' */

/* Module declarations from 'cpython.list' */

/* Module declarations from 'libc.string' */

/* Module declarations from 'libc.stdio' */

/* Module declarations from 'cpython.object' */

/* Module declarations from 'cpython.sequence' */

/* Module declarations from 'cpython.mapping' */

/* Module declarations from 'cpython.iterator' */

/* Module declarations from '__builtin__' */

/* Module declarations from 'cpython.type' */
static PyTypeObject *__pyx_ptype_7cpython_4type_type = 0;

/* Module declarations from 'cpython.number' */

/* Module declarations from 'cpython.int' */

/* Module declarations from '__builtin__' */

/* Module declarations from 'cpython.bool' */
static PyTypeObject *__pyx_ptype_7cpython_4bool_bool = 0;

/* Module declarations from 'cpython.long' */

/* Module declarations from 'cpython.float' */

/* Module declarations from '__builtin__' */

/* Module declarations from 'cpython.complex' */
static PyTypeObject *__pyx_ptype_7cpython_7complex_complex = 0;

/* Module declarations from 'cpython.string' */

/* Module declarations from 'cpython.unicode' */

/* Module declarations from 'cpython.dict' */

/* Module declarations from 'cpython.instance' */

/* Module declarations from 'cpython.function' */

/* Module declarations from 'cpython.method' */

/* Module declarations from 'cpython.weakref' */

/* Module declarations from 'cpython.getargs' */

/* Module declarations from 'cpython.pythread' */

/* Module declarations from 'cpython.pystate' */

/* Module declarations from 'cpython.cobject' */

/* Module declarations from 'cpython.oldbuffer' */

/* Module declarations from 'cpython.set' */

/* Module declarations from 'cpython.buffer' */

/* Module declarations from 'cpython.bytes' */

/* Module declarations from 'cpython.pycapsule' */

/* Module declarations from 'cpython' */

/* Module declarations from 'libc' */

/* Module declarations from 'sanpera.color' */
static PyTypeObject *__pyx_ptype_7sanpera_5color_BaseColor = 0;
static PyTypeObject *__pyx_ptype_7sanpera_5color_RGBColor = 0;
static PyTypeObject *__pyx_ptype_7sanpera_5color_HSLColor = 0;
static double (*__pyx_f_7sanpera_5color__quantum_to_double)(Quantum); /*proto*/
static Quantum (*__pyx_f_7sanpera_5color__double_to_quantum)(double); /*proto*/

/* Module declarations from 'sanpera.geometry' */
static PyTypeObject *__pyx_ptype_7sanpera_8geometry_Vector = 0;
static PyTypeObject *__pyx_ptype_7sanpera_8geometry_Size = 0;
static PyTypeObject *__pyx_ptype_7sanpera_8geometry_Rectangle = 0;

/* Module declarations from 'sanpera.exception' */
static PyTypeObject *__pyx_ptype_7sanpera_9exception_MagickException = 0;
static PyObject *(*__pyx_f_7sanpera_9exception_check_magick_exception)(ExceptionInfo *, struct __pyx_opt_args_7sanpera_9exception_check_magick_exception *__pyx_optional_args); /*proto*/

/* Module declarations from 'sanpera.image' */
static PyTypeObject *__pyx_ptype_7sanpera_5image_ImageFrame = 0;
static PyTypeObject *__pyx_ptype_7sanpera_5image___pyx_scope_struct_1___iter__ = 0;
static PyTypeObject *__pyx_ptype_7sanpera_5image_Image = 0;
static PyTypeObject *__pyx_ptype_7sanpera_5image___pyx_scope_struct____iter__ = 0;
static PyTypeObject *__pyx_ptype_7sanpera_5image_PixelViewPixel = 0;
static PyTypeObject *__pyx_ptype_7sanpera_5image_PixelView = 0;
static PyTypeObject *__pyx_ptype_7sanpera_5image___pyx_scope_struct_4_create = 0;
static PyTypeObject *__pyx_ptype_7sanpera_5image___pyx_scope_struct_2___get__ = 0;
static PyTypeObject *__pyx_ptype_7sanpera_5image___pyx_scope_struct_3_genexpr = 0;
static struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_f_7sanpera_5image__ImageFrame_factory(Image *); /*proto*/
#define __Pyx_MODULE_NAME "sanpera.image"
int __pyx_module_is_main_sanpera__image = 0;

/* Implementation of 'sanpera.image' */
static PyObject *__pyx_builtin_property;
static PyObject *__pyx_builtin_object;
static PyObject *__pyx_builtin_TypeError;
static PyObject *__pyx_builtin_ValueError;
static PyObject *__pyx_builtin_range;
static PyObject *__pyx_builtin_IOError;
static PyObject *__pyx_builtin_any;
static PyObject *__pyx_builtin_Exception;
static PyObject *__pyx_builtin_AttributeError;
static int __pyx_pf_7sanpera_5image_14PixelViewPixel___init__(CYTHON_UNUSED struct __pyx_obj_7sanpera_5image_PixelViewPixel *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_14PixelViewPixel_5color___get__(struct __pyx_obj_7sanpera_5image_PixelViewPixel *__pyx_v_self); /* proto */
static int __pyx_pf_7sanpera_5image_14PixelViewPixel_5color_2__set__(struct __pyx_obj_7sanpera_5image_PixelViewPixel *__pyx_v_self, struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_14PixelViewPixel_5point___get__(struct __pyx_obj_7sanpera_5image_PixelViewPixel *__pyx_v_self); /* proto */
static int __pyx_pf_7sanpera_5image_9PixelView___cinit__(struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self); /* proto */
static int __pyx_pf_7sanpera_5image_9PixelView_2__init__(struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self, struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_frame); /* proto */
static void __pyx_pf_7sanpera_5image_9PixelView_4__dealloc__(struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_9PixelView_6__getitem__(struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self, PyObject *__pyx_v_point); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_9PixelView_8__iter__(struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self); /* proto */
static int __pyx_pf_7sanpera_5image_10ImageFrame___cinit__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self); /* proto */
static void __pyx_pf_7sanpera_5image_10ImageFrame_2__dealloc__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self); /* proto */
static int __pyx_pf_7sanpera_5image_10ImageFrame_4__init__(CYTHON_UNUSED struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_6canvas___get__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_4size___get__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_10has_canvas___get__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_11translucent___get__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self); /* proto */
static int __pyx_pf_7sanpera_5image_10ImageFrame_11translucent_2__set__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self, PyBoolObject *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_6pixels(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_8tiled(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self, PyObject *__pyx_v_size); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_10replace_color(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self, struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_color, struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_replacement, float __pyx_v_fuzz); /* proto */
static int __pyx_pf_7sanpera_5image_5Image___cinit__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static void __pyx_pf_7sanpera_5image_5Image_2__dealloc__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static int __pyx_pf_7sanpera_5image_5Image_4__init__(CYTHON_UNUSED struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_6new(PyObject *__pyx_v_cls, PyObject *__pyx_v_size, struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_fill); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_8read(PyObject *__pyx_v_cls, PyObject *__pyx_v_filename); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_10from_buffer(PyObject *__pyx_v_cls, PyObject *__pyx_v_buf); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_12from_magick(PyObject *__pyx_v_cls, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_14write(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, PyObject *__pyx_v_filename, PyObject *__pyx_v_format); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_16to_buffer(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, PyObject *__pyx_v_format); /* proto */
static Py_ssize_t __pyx_pf_7sanpera_5image_5Image_18__len__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static int __pyx_pf_7sanpera_5image_5Image_20__nonzero__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_22__iter__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_25__getitem__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, PyObject *__pyx_v_key); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_27append(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_29extend(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, struct __pyx_obj_7sanpera_5image_Image *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_31consume(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, struct __pyx_obj_7sanpera_5image_Image *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_33original_format(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_4size___get__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_10has_canvas_7__get___genexpr(PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_10has_canvas___get__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_9bit_depth___get__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static int __pyx_pf_7sanpera_5image_5Image_9bit_depth_2__set__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, unsigned long __pyx_v_depth); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_35raw_properties(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_37resized(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, PyObject *__pyx_v_size, PyObject *__pyx_v_filter); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_39cropped(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, struct __pyx_obj_7sanpera_8geometry_Rectangle *__pyx_v_rect, PyBoolObject *__pyx_v_preserve_canvas); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_41coalesced(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_5Image_43optimized_for_animated_gif(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_15BuiltinRegistry_6create_decorator(PyObject *__pyx_self, PyObject *__pyx_v_f); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_15BuiltinRegistry_create(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_cls, PyObject *__pyx_v_names); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_15BuiltinRegistry_2__init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_factory, PyObject *__pyx_v_names); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_15BuiltinRegistry_4__getattr__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_key); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_15BuiltinRegistry_6__iter__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_builtins(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_7sanpera_5image_2patterns(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_tp_new_7sanpera_5image_ImageFrame(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_7sanpera_5image___pyx_scope_struct_1___iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_7sanpera_5image_Image(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_7sanpera_5image___pyx_scope_struct____iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_7sanpera_5image_PixelViewPixel(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_7sanpera_5image_PixelView(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_7sanpera_5image___pyx_scope_struct_4_create(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_7sanpera_5image___pyx_scope_struct_2___get__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_7sanpera_5image___pyx_scope_struct_3_genexpr(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static char __pyx_k_f[] = "f";
static char __pyx_k_x[] = "x";
static char __pyx_k_y[] = "y";
static char __pyx_k_rb[] = "rb";
static char __pyx_k_wb[] = "wb";
static char __pyx_k_any[] = "any";
static char __pyx_k_box[] = "box";
static char __pyx_k_cls[] = "cls";
static char __pyx_k_doc[] = "__doc__";
static char __pyx_k_key[] = "key";
static char __pyx_k_new[] = "new";
static char __pyx_k_obj[] = "obj";
static char __pyx_k_top[] = "top";
static char __pyx_k_args[] = "args";
static char __pyx_k_exif[] = "exif:*";
static char __pyx_k_fill[] = "fill";
static char __pyx_k_fuzz[] = "fuzz";
static char __pyx_k_init[] = "__init__";
static char __pyx_k_iter[] = "__iter__";
static char __pyx_k_left[] = "left";
static char __pyx_k_logo[] = "logo";
static char __pyx_k_main[] = "__main__";
static char __pyx_k_name[] = "name";
static char __pyx_k_read[] = "read";
static char __pyx_k_rect[] = "rect";
static char __pyx_k_rgba[] = "rgba";
static char __pyx_k_rose[] = "rose";
static char __pyx_k_self[] = "self";
static char __pyx_k_send[] = "send";
static char __pyx_k_size[] = "size";
static char __pyx_k_test[] = "__test__";
static char __pyx_k_check[] = "check";
static char __pyx_k_class[] = "__class__";
static char __pyx_k_close[] = "close";
static char __pyx_k_color[] = "color";
static char __pyx_k_frame[] = "frame";
static char __pyx_k_gray0[] = "gray0";
static char __pyx_k_gray5[] = "gray5";
static char __pyx_k_names[] = "names";
static char __pyx_k_range[] = "range";
static char __pyx_k_right[] = "right";
static char __pyx_k_throw[] = "throw";
static char __pyx_k_width[] = "width";
static char __pyx_k_bottom[] = "bottom";
static char __pyx_k_bricks[] = "bricks";
static char __pyx_k_canvas[] = "canvas";
static char __pyx_k_coerce[] = "coerce";
static char __pyx_k_create[] = "create";
static char __pyx_k_filter[] = "filter";
static char __pyx_k_format[] = "format";
static char __pyx_k_gray10[] = "gray10";
static char __pyx_k_gray15[] = "gray15";
static char __pyx_k_gray20[] = "gray20";
static char __pyx_k_gray25[] = "gray25";
static char __pyx_k_gray30[] = "gray30";
static char __pyx_k_gray35[] = "gray35";
static char __pyx_k_gray40[] = "gray40";
static char __pyx_k_gray45[] = "gray45";
static char __pyx_k_gray50[] = "gray50";
static char __pyx_k_gray55[] = "gray55";
static char __pyx_k_gray60[] = "gray60";
static char __pyx_k_gray65[] = "gray65";
static char __pyx_k_gray70[] = "gray70";
static char __pyx_k_gray75[] = "gray75";
static char __pyx_k_gray80[] = "gray80";
static char __pyx_k_gray85[] = "gray85";
static char __pyx_k_gray90[] = "gray90";
static char __pyx_k_gray95[] = "gray95";
static char __pyx_k_height[] = "height";
static char __pyx_k_import[] = "__import__";
static char __pyx_k_left30[] = "left30";
static char __pyx_k_left45[] = "left45";
static char __pyx_k_magick[] = "magick:";
static char __pyx_k_module[] = "__module__";
static char __pyx_k_object[] = "object";
static char __pyx_k_pixels[] = "pixels";
static char __pyx_k_wizard[] = "wizard";
static char __pyx_k_IOError[] = "IOError";
static char __pyx_k_circles[] = "circles";
static char __pyx_k_factory[] = "factory";
static char __pyx_k_getattr[] = "__getattr__";
static char __pyx_k_granite[] = "granite";
static char __pyx_k_gray100[] = "gray100";
static char __pyx_k_names_2[] = "_names";
static char __pyx_k_pattern[] = "pattern:";
static char __pyx_k_prepare[] = "__prepare__";
static char __pyx_k_right30[] = "right30";
static char __pyx_k_right45[] = "right45";
static char __pyx_k_builtins[] = "builtins";
static char __pyx_k_filename[] = "filename";
static char __pyx_k_hexagons[] = "hexagons";
static char __pyx_k_hs_cross[] = "hs_cross";
static char __pyx_k_netscape[] = "netscape";
static char __pyx_k_octagons[] = "octagons";
static char __pyx_k_patterns[] = "patterns";
static char __pyx_k_property[] = "property";
static char __pyx_k_qualname[] = "__qualname__";
static char __pyx_k_vertical[] = "vertical";
static char __pyx_k_Exception[] = "Exception";
static char __pyx_k_TypeError[] = "TypeError";
static char __pyx_k_decorator[] = "decorator";
static char __pyx_k_factory_2[] = "_factory";
static char __pyx_k_metaclass[] = "__metaclass__";
static char __pyx_k_vertical2[] = "vertical2";
static char __pyx_k_vertical3[] = "vertical3";
static char __pyx_k_ValueError[] = "ValueError";
static char __pyx_k_crosshatch[] = "crosshatch";
static char __pyx_k_fishscales[] = "fishscales";
static char __pyx_k_has_canvas[] = "has_canvas";
static char __pyx_k_horizontal[] = "horizontal";
static char __pyx_k_namedtuple[] = "namedtuple";
static char __pyx_k_pyx_vtable[] = "__pyx_vtable__";
static char __pyx_k_collections[] = "collections";
static char __pyx_k_from_buffer[] = "from_buffer";
static char __pyx_k_from_magick[] = "from_magick";
static char __pyx_k_horizontal2[] = "horizontal2";
static char __pyx_k_horizontal3[] = "horizontal3";
static char __pyx_k_hs_vertical[] = "hs_vertical";
static char __pyx_k_leftshingle[] = "leftshingle";
static char __pyx_k_replacement[] = "replacement";
static char __pyx_k_translucent[] = "translucent";
static char __pyx_k_verticalsaw[] = "verticalsaw";
static char __pyx_k_checkerboard[] = "checkerboard";
static char __pyx_k_crosshatch30[] = "crosshatch30";
static char __pyx_k_crosshatch45[] = "crosshatch45";
static char __pyx_k_hs_bdiagonal[] = "hs_bdiagonal";
static char __pyx_k_hs_diagcross[] = "hs_diagcross";
static char __pyx_k_hs_fdiagonal[] = "hs_fdiagonal";
static char __pyx_k_rightshingle[] = "rightshingle";
static char __pyx_k_horizontalsaw[] = "horizontalsaw";
static char __pyx_k_hs_horizontal[] = "hs_horizontal";
static char __pyx_k_sanpera_image[] = "sanpera.image";
static char __pyx_k_AttributeError[] = "AttributeError";
static char __pyx_k_raw_properties[] = "raw_properties";
static char __pyx_k_verticalbricks[] = "verticalbricks";
static char __pyx_k_BuiltinRegistry[] = "BuiltinRegistry";
static char __pyx_k_EmptyImageError[] = "EmptyImageError";
static char __pyx_k_original_format[] = "original_format";
static char __pyx_k_preserve_canvas[] = "preserve_canvas";
static char __pyx_k_smallfishscales[] = "smallfishscales";
static char __pyx_k_Pixel_has_expired[] = "Pixel has expired";
static char __pyx_k_sanpera_exception[] = "sanpera.exception";
static char __pyx_k_MissingFormatError[] = "MissingFormatError";
static char __pyx_k_verticalleftshingle[] = "verticalleftshingle";
static char __pyx_k_verticalrightshingle[] = "verticalrightshingle";
static char __pyx_k_BuiltinRegistry___init[] = "BuiltinRegistry.__init__";
static char __pyx_k_BuiltinRegistry___iter[] = "BuiltinRegistry.__iter__";
static char __pyx_k_BuiltinRegistry_create[] = "BuiltinRegistry.create";
static char __pyx_k_BuiltinRegistry___getattr[] = "BuiltinRegistry.__getattr__";
static char __pyx_k_Image_class_and_assorted_helper[] = "Image class and assorted helper classes.  This is where the magick happens.\n";
static char __pyx_k_True_if_this_frame_has_an_alpha[] = "`True` if this frame has an alpha channel.\n\n        You can assign to this attribute to toggle the alpha channel; note that\n        if you set this to `True` and the frame did not previously have an\n        alpha channel, an all-opaque one will be created.\n        ";
static char __pyx_k_Users_habnabit_src_weasyl_sanpe[] = "/Users/habnabit/src/weasyl/sanpera/sanpera/image.pyx";
static char __pyx_k_BuiltinRegistry_create_locals_de[] = "BuiltinRegistry.create.<locals>.decorator";
static char __pyx_k_Dimensions_and_offset_of_the_dra[] = "Dimensions and offset of the drawable area of this frame, relative\n        to the image's full size.\n        ";
static char __pyx_k_PixelViewPixel_cannot_be_instant[] = "PixelViewPixel cannot be instantiated directly";
static char __pyx_k_RawFrames_cannot_be_instantiated[] = "RawFrames cannot be instantiated directly";
static char __pyx_k_Returns_True_if_this_frame_has_a[] = "Returns `True` if this frame has a non-trivial virtual canvas; i.e.,\n        returns `False` if the virtual canvas is the same size as the image and\n        anchored at the origin.\n        ";
static char __pyx_k_Returns_True_iff_any_frame_has_a[] = "Returns `True` iff any frame has a canvas.";
static char __pyx_k_Size_of_the_frame_as_a_Size_Shor[] = "Size of the frame, as a `Size`.  Shortcut for `frame.canvas.size`.\n        ";
static char __pyx_k_The_image_dimensions_as_a_Size_E[] = "The image dimensions, as a `Size`.  Empty images have zero size.\n\n        Note that multi-frame images don't have a notion of intrinsic size for\n        the entire image, though particular formats may enforce that every\n        frame be the same size.  If the image has multiple frames, this returns\n        the size of the first frame, which is in line with most image-handling\n        software.\n        ";
static PyObject *__pyx_n_s_AttributeError;
static PyObject *__pyx_n_s_BuiltinRegistry;
static PyObject *__pyx_n_s_BuiltinRegistry___getattr;
static PyObject *__pyx_n_s_BuiltinRegistry___init;
static PyObject *__pyx_n_s_BuiltinRegistry___iter;
static PyObject *__pyx_n_s_BuiltinRegistry_create;
static PyObject *__pyx_n_s_BuiltinRegistry_create_locals_de;
static PyObject *__pyx_n_s_EmptyImageError;
static PyObject *__pyx_n_s_Exception;
static PyObject *__pyx_n_s_IOError;
static PyObject *__pyx_n_s_MissingFormatError;
static PyObject *__pyx_kp_s_PixelViewPixel_cannot_be_instant;
static PyObject *__pyx_kp_s_Pixel_has_expired;
static PyObject *__pyx_kp_s_RawFrames_cannot_be_instantiated;
static PyObject *__pyx_n_s_TypeError;
static PyObject *__pyx_kp_s_Users_habnabit_src_weasyl_sanpe;
static PyObject *__pyx_n_s_ValueError;
static PyObject *__pyx_n_s_any;
static PyObject *__pyx_n_s_args;
static PyObject *__pyx_n_s_bottom;
static PyObject *__pyx_n_s_box;
static PyObject *__pyx_n_s_bricks;
static PyObject *__pyx_n_s_builtins;
static PyObject *__pyx_n_s_canvas;
static PyObject *__pyx_n_s_check;
static PyObject *__pyx_n_s_checkerboard;
static PyObject *__pyx_n_s_circles;
static PyObject *__pyx_n_s_class;
static PyObject *__pyx_n_s_close;
static PyObject *__pyx_n_s_cls;
static PyObject *__pyx_n_s_coerce;
static PyObject *__pyx_n_s_collections;
static PyObject *__pyx_n_s_color;
static PyObject *__pyx_n_s_create;
static PyObject *__pyx_n_s_crosshatch;
static PyObject *__pyx_n_s_crosshatch30;
static PyObject *__pyx_n_s_crosshatch45;
static PyObject *__pyx_n_s_decorator;
static PyObject *__pyx_n_s_doc;
static PyObject *__pyx_n_s_f;
static PyObject *__pyx_n_s_factory;
static PyObject *__pyx_n_s_factory_2;
static PyObject *__pyx_n_s_filename;
static PyObject *__pyx_n_s_fill;
static PyObject *__pyx_n_s_filter;
static PyObject *__pyx_n_s_fishscales;
static PyObject *__pyx_n_s_format;
static PyObject *__pyx_n_s_frame;
static PyObject *__pyx_n_s_from_buffer;
static PyObject *__pyx_n_s_from_magick;
static PyObject *__pyx_n_s_fuzz;
static PyObject *__pyx_n_s_getattr;
static PyObject *__pyx_n_s_granite;
static PyObject *__pyx_n_s_gray0;
static PyObject *__pyx_n_s_gray10;
static PyObject *__pyx_n_s_gray100;
static PyObject *__pyx_n_s_gray15;
static PyObject *__pyx_n_s_gray20;
static PyObject *__pyx_n_s_gray25;
static PyObject *__pyx_n_s_gray30;
static PyObject *__pyx_n_s_gray35;
static PyObject *__pyx_n_s_gray40;
static PyObject *__pyx_n_s_gray45;
static PyObject *__pyx_n_s_gray5;
static PyObject *__pyx_n_s_gray50;
static PyObject *__pyx_n_s_gray55;
static PyObject *__pyx_n_s_gray60;
static PyObject *__pyx_n_s_gray65;
static PyObject *__pyx_n_s_gray70;
static PyObject *__pyx_n_s_gray75;
static PyObject *__pyx_n_s_gray80;
static PyObject *__pyx_n_s_gray85;
static PyObject *__pyx_n_s_gray90;
static PyObject *__pyx_n_s_gray95;
static PyObject *__pyx_n_s_has_canvas;
static PyObject *__pyx_n_s_height;
static PyObject *__pyx_n_s_hexagons;
static PyObject *__pyx_n_s_horizontal;
static PyObject *__pyx_n_s_horizontal2;
static PyObject *__pyx_n_s_horizontal3;
static PyObject *__pyx_n_s_horizontalsaw;
static PyObject *__pyx_n_s_hs_bdiagonal;
static PyObject *__pyx_n_s_hs_cross;
static PyObject *__pyx_n_s_hs_diagcross;
static PyObject *__pyx_n_s_hs_fdiagonal;
static PyObject *__pyx_n_s_hs_horizontal;
static PyObject *__pyx_n_s_hs_vertical;
static PyObject *__pyx_n_s_import;
static PyObject *__pyx_n_s_init;
static PyObject *__pyx_n_s_iter;
static PyObject *__pyx_n_s_key;
static PyObject *__pyx_n_s_left;
static PyObject *__pyx_n_s_left30;
static PyObject *__pyx_n_s_left45;
static PyObject *__pyx_n_s_leftshingle;
static PyObject *__pyx_n_s_logo;
static PyObject *__pyx_kp_s_magick;
static PyObject *__pyx_n_s_main;
static PyObject *__pyx_n_s_metaclass;
static PyObject *__pyx_n_s_module;
static PyObject *__pyx_n_s_name;
static PyObject *__pyx_n_s_namedtuple;
static PyObject *__pyx_n_s_names;
static PyObject *__pyx_n_s_names_2;
static PyObject *__pyx_n_s_netscape;
static PyObject *__pyx_n_s_new;
static PyObject *__pyx_n_s_obj;
static PyObject *__pyx_n_s_object;
static PyObject *__pyx_n_s_octagons;
static PyObject *__pyx_n_s_original_format;
static PyObject *__pyx_kp_s_pattern;
static PyObject *__pyx_n_s_patterns;
static PyObject *__pyx_n_s_pixels;
static PyObject *__pyx_n_s_prepare;
static PyObject *__pyx_n_s_preserve_canvas;
static PyObject *__pyx_n_s_property;
static PyObject *__pyx_n_s_pyx_vtable;
static PyObject *__pyx_n_s_qualname;
static PyObject *__pyx_n_s_range;
static PyObject *__pyx_n_s_raw_properties;
static PyObject *__pyx_n_s_read;
static PyObject *__pyx_n_s_rect;
static PyObject *__pyx_n_s_replacement;
static PyObject *__pyx_n_s_rgba;
static PyObject *__pyx_n_s_right;
static PyObject *__pyx_n_s_right30;
static PyObject *__pyx_n_s_right45;
static PyObject *__pyx_n_s_rightshingle;
static PyObject *__pyx_n_s_rose;
static PyObject *__pyx_n_s_sanpera_exception;
static PyObject *__pyx_n_s_sanpera_image;
static PyObject *__pyx_n_s_self;
static PyObject *__pyx_n_s_send;
static PyObject *__pyx_n_s_size;
static PyObject *__pyx_n_s_smallfishscales;
static PyObject *__pyx_n_s_test;
static PyObject *__pyx_n_s_throw;
static PyObject *__pyx_n_s_top;
static PyObject *__pyx_n_s_translucent;
static PyObject *__pyx_n_s_vertical;
static PyObject *__pyx_n_s_vertical2;
static PyObject *__pyx_n_s_vertical3;
static PyObject *__pyx_n_s_verticalbricks;
static PyObject *__pyx_n_s_verticalleftshingle;
static PyObject *__pyx_n_s_verticalrightshingle;
static PyObject *__pyx_n_s_verticalsaw;
static PyObject *__pyx_n_s_width;
static PyObject *__pyx_n_s_wizard;
static PyObject *__pyx_n_s_x;
static PyObject *__pyx_n_s_y;
static PyObject *__pyx_float_0_;
static PyObject *__pyx_int_0;
static PyObject *__pyx_tuple_;
static PyObject *__pyx_tuple__2;
static PyObject *__pyx_tuple__3;
static PyObject *__pyx_tuple__4;
static PyObject *__pyx_tuple__5;
static PyObject *__pyx_tuple__6;
static PyObject *__pyx_tuple__7;
static PyObject *__pyx_tuple__9;
static PyObject *__pyx_tuple__11;
static PyObject *__pyx_tuple__13;
static PyObject *__pyx_tuple__15;
static PyObject *__pyx_tuple__17;
static PyObject *__pyx_tuple__18;
static PyObject *__pyx_tuple__20;
static PyObject *__pyx_tuple__21;
static PyObject *__pyx_codeobj__8;
static PyObject *__pyx_codeobj__10;
static PyObject *__pyx_codeobj__12;
static PyObject *__pyx_codeobj__14;
static PyObject *__pyx_codeobj__16;
static PyObject *__pyx_codeobj__19;
static PyObject *__pyx_codeobj__22;

/* "sanpera/image.pyx":42
 *     cdef int _y
 * 
 *     def __init__(self):             # <<<<<<<<<<<<<<
 *         raise TypeError("PixelViewPixel cannot be instantiated directly")
 * 
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_14PixelViewPixel_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_7sanpera_5image_14PixelViewPixel_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  if (unlikely(PyTuple_GET_SIZE(__pyx_args) > 0)) {
    __Pyx_RaiseArgtupleInvalid("__init__", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_7sanpera_5image_14PixelViewPixel___init__(((struct __pyx_obj_7sanpera_5image_PixelViewPixel *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_14PixelViewPixel___init__(CYTHON_UNUSED struct __pyx_obj_7sanpera_5image_PixelViewPixel *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "sanpera/image.pyx":43
 * 
 *     def __init__(self):
 *         raise TypeError("PixelViewPixel cannot be instantiated directly")             # <<<<<<<<<<<<<<
 * 
 *     property color:
 */
  __pyx_t_1 = PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_Raise(__pyx_t_1, 0, 0, 0);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":42
 *     cdef int _y
 * 
 *     def __init__(self):             # <<<<<<<<<<<<<<
 *         raise TypeError("PixelViewPixel cannot be instantiated directly")
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.PixelViewPixel.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":47
 *     property color:
 *         # XXX this needs to do something special to handle non-rgba images
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_14PixelViewPixel_5color_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_14PixelViewPixel_5color_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_14PixelViewPixel_5color___get__(((struct __pyx_obj_7sanpera_5image_PixelViewPixel *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_14PixelViewPixel_5color___get__(struct __pyx_obj_7sanpera_5image_PixelViewPixel *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);

  /* "sanpera/image.pyx":48
 *         # XXX this needs to do something special to handle non-rgba images
 *         def __get__(self):
 *             if self._pixel == NULL:             # <<<<<<<<<<<<<<
 *                 raise ValueError("Pixel has expired")
 *             return RGBColor(
 */
  __pyx_t_1 = ((__pyx_v_self->_pixel == NULL) != 0);
  if (__pyx_t_1) {

    /* "sanpera/image.pyx":49
 *         def __get__(self):
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")             # <<<<<<<<<<<<<<
 *             return RGBColor(
 *                 _quantum_to_double(self._pixel.red),
 */
    __pyx_t_2 = PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "sanpera/image.pyx":50
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")
 *             return RGBColor(             # <<<<<<<<<<<<<<
 *                 _quantum_to_double(self._pixel.red),
 *                 _quantum_to_double(self._pixel.green),
 */
  __Pyx_XDECREF(__pyx_r);

  /* "sanpera/image.pyx":51
 *                 raise ValueError("Pixel has expired")
 *             return RGBColor(
 *                 _quantum_to_double(self._pixel.red),             # <<<<<<<<<<<<<<
 *                 _quantum_to_double(self._pixel.green),
 *                 _quantum_to_double(self._pixel.blue),
 */
  __pyx_t_2 = PyFloat_FromDouble(__pyx_f_7sanpera_5color__quantum_to_double(((Quantum)__pyx_v_self->_pixel->red))); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);

  /* "sanpera/image.pyx":52
 *             return RGBColor(
 *                 _quantum_to_double(self._pixel.red),
 *                 _quantum_to_double(self._pixel.green),             # <<<<<<<<<<<<<<
 *                 _quantum_to_double(self._pixel.blue),
 *                 # ImageMagick thinks opacity is transparency
 */
  __pyx_t_3 = PyFloat_FromDouble(__pyx_f_7sanpera_5color__quantum_to_double(((Quantum)__pyx_v_self->_pixel->green))); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);

  /* "sanpera/image.pyx":53
 *                 _quantum_to_double(self._pixel.red),
 *                 _quantum_to_double(self._pixel.green),
 *                 _quantum_to_double(self._pixel.blue),             # <<<<<<<<<<<<<<
 *                 # ImageMagick thinks opacity is transparency
 *                 1.0 - _quantum_to_double(self._pixel.opacity))
 */
  __pyx_t_4 = PyFloat_FromDouble(__pyx_f_7sanpera_5color__quantum_to_double(((Quantum)__pyx_v_self->_pixel->blue))); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);

  /* "sanpera/image.pyx":55
 *                 _quantum_to_double(self._pixel.blue),
 *                 # ImageMagick thinks opacity is transparency
 *                 1.0 - _quantum_to_double(self._pixel.opacity))             # <<<<<<<<<<<<<<
 * 
 *         def __set__(self, RGBColor value):
 */
  __pyx_t_5 = PyFloat_FromDouble((1.0 - __pyx_f_7sanpera_5color__quantum_to_double(((Quantum)__pyx_v_self->_pixel->opacity)))); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);

  /* "sanpera/image.pyx":50
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")
 *             return RGBColor(             # <<<<<<<<<<<<<<
 *                 _quantum_to_double(self._pixel.red),
 *                 _quantum_to_double(self._pixel.green),
 */
  __pyx_t_6 = PyTuple_New(4); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_6, 3, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_5);
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_5color_RGBColor)), __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":47
 *     property color:
 *         # XXX this needs to do something special to handle non-rgba images
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("sanpera.image.PixelViewPixel.color.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":57
 *                 1.0 - _quantum_to_double(self._pixel.opacity))
 * 
 *         def __set__(self, RGBColor value):             # <<<<<<<<<<<<<<
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_14PixelViewPixel_5color_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pw_7sanpera_5image_14PixelViewPixel_5color_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), __pyx_ptype_7sanpera_5color_RGBColor, 1, "value", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_14PixelViewPixel_5color_2__set__(((struct __pyx_obj_7sanpera_5image_PixelViewPixel *)__pyx_v_self), ((struct __pyx_obj_7sanpera_5color_RGBColor *)__pyx_v_value));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_14PixelViewPixel_5color_2__set__(struct __pyx_obj_7sanpera_5image_PixelViewPixel *__pyx_v_self, struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__set__", 0);

  /* "sanpera/image.pyx":58
 * 
 *         def __set__(self, RGBColor value):
 *             if self._pixel == NULL:             # <<<<<<<<<<<<<<
 *                 raise ValueError("Pixel has expired")
 *             self._pixel.red = _double_to_quantum(value._red)
 */
  __pyx_t_1 = ((__pyx_v_self->_pixel == NULL) != 0);
  if (__pyx_t_1) {

    /* "sanpera/image.pyx":59
 *         def __set__(self, RGBColor value):
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")             # <<<<<<<<<<<<<<
 *             self._pixel.red = _double_to_quantum(value._red)
 *             self._pixel.green = _double_to_quantum(value._green)
 */
    __pyx_t_2 = PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "sanpera/image.pyx":60
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")
 *             self._pixel.red = _double_to_quantum(value._red)             # <<<<<<<<<<<<<<
 *             self._pixel.green = _double_to_quantum(value._green)
 *             self._pixel.blue = _double_to_quantum(value._blue)
 */
  __pyx_v_self->_pixel->red = __pyx_f_7sanpera_5color__double_to_quantum(__pyx_v_value->_red);

  /* "sanpera/image.pyx":61
 *                 raise ValueError("Pixel has expired")
 *             self._pixel.red = _double_to_quantum(value._red)
 *             self._pixel.green = _double_to_quantum(value._green)             # <<<<<<<<<<<<<<
 *             self._pixel.blue = _double_to_quantum(value._blue)
 *             # ImageMagick thinks opacity is transparency
 */
  __pyx_v_self->_pixel->green = __pyx_f_7sanpera_5color__double_to_quantum(__pyx_v_value->_green);

  /* "sanpera/image.pyx":62
 *             self._pixel.red = _double_to_quantum(value._red)
 *             self._pixel.green = _double_to_quantum(value._green)
 *             self._pixel.blue = _double_to_quantum(value._blue)             # <<<<<<<<<<<<<<
 *             # ImageMagick thinks opacity is transparency
 *             self._pixel.opacity = _double_to_quantum(1.0 - value._opacity)
 */
  __pyx_v_self->_pixel->blue = __pyx_f_7sanpera_5color__double_to_quantum(__pyx_v_value->_blue);

  /* "sanpera/image.pyx":64
 *             self._pixel.blue = _double_to_quantum(value._blue)
 *             # ImageMagick thinks opacity is transparency
 *             self._pixel.opacity = _double_to_quantum(1.0 - value._opacity)             # <<<<<<<<<<<<<<
 * 
 *     property point:
 */
  __pyx_v_self->_pixel->opacity = __pyx_f_7sanpera_5color__double_to_quantum((1.0 - __pyx_v_value->__pyx_base._opacity));

  /* "sanpera/image.pyx":57
 *                 1.0 - _quantum_to_double(self._pixel.opacity))
 * 
 *         def __set__(self, RGBColor value):             # <<<<<<<<<<<<<<
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.PixelViewPixel.color.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":67
 * 
 *     property point:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return Vector(self._x, self._y)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_14PixelViewPixel_5point_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_14PixelViewPixel_5point_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_14PixelViewPixel_5point___get__(((struct __pyx_obj_7sanpera_5image_PixelViewPixel *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_14PixelViewPixel_5point___get__(struct __pyx_obj_7sanpera_5image_PixelViewPixel *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);

  /* "sanpera/image.pyx":68
 *     property point:
 *         def __get__(self):
 *             return Vector(self._x, self._y)             # <<<<<<<<<<<<<<
 * 
 * cdef class PixelView:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->_x); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->_y); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_8geometry_Vector)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":67
 * 
 *     property point:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return Vector(self._x, self._y)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.PixelViewPixel.point.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":76
 *     cdef ImageFrame _frame
 * 
 *     def __cinit__(self):             # <<<<<<<<<<<<<<
 *         self._frame = None
 *         self._ptr = NULL
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_9PixelView_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_7sanpera_5image_9PixelView_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__cinit__ (wrapper)", 0);
  if (unlikely(PyTuple_GET_SIZE(__pyx_args) > 0)) {
    __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_7sanpera_5image_9PixelView___cinit__(((struct __pyx_obj_7sanpera_5image_PixelView *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_9PixelView___cinit__(struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__cinit__", 0);

  /* "sanpera/image.pyx":77
 * 
 *     def __cinit__(self):
 *         self._frame = None             # <<<<<<<<<<<<<<
 *         self._ptr = NULL
 * 
 */
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  __Pyx_GOTREF(__pyx_v_self->_frame);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->_frame));
  __pyx_v_self->_frame = ((struct __pyx_obj_7sanpera_5image_ImageFrame *)Py_None);

  /* "sanpera/image.pyx":78
 *     def __cinit__(self):
 *         self._frame = None
 *         self._ptr = NULL             # <<<<<<<<<<<<<<
 * 
 *     def __init__(self, ImageFrame frame not None):
 */
  __pyx_v_self->_ptr = NULL;

  /* "sanpera/image.pyx":76
 *     cdef ImageFrame _frame
 * 
 *     def __cinit__(self):             # <<<<<<<<<<<<<<
 *         self._frame = None
 *         self._ptr = NULL
 */

  /* function exit code */
  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":80
 *         self._ptr = NULL
 * 
 *     def __init__(self, ImageFrame frame not None):             # <<<<<<<<<<<<<<
 *         self._frame = frame
 *         self._ptr = c_api.AcquireCacheView(frame._frame)
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_9PixelView_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_7sanpera_5image_9PixelView_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_frame = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_frame,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_frame)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_frame = ((struct __pyx_obj_7sanpera_5image_ImageFrame *)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("sanpera.image.PixelView.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_frame), __pyx_ptype_7sanpera_5image_ImageFrame, 0, "frame", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_9PixelView_2__init__(((struct __pyx_obj_7sanpera_5image_PixelView *)__pyx_v_self), __pyx_v_frame);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_9PixelView_2__init__(struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self, struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_frame) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "sanpera/image.pyx":81
 * 
 *     def __init__(self, ImageFrame frame not None):
 *         self._frame = frame             # <<<<<<<<<<<<<<
 *         self._ptr = c_api.AcquireCacheView(frame._frame)
 * 
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_frame));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_frame));
  __Pyx_GOTREF(__pyx_v_self->_frame);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->_frame));
  __pyx_v_self->_frame = __pyx_v_frame;

  /* "sanpera/image.pyx":82
 *     def __init__(self, ImageFrame frame not None):
 *         self._frame = frame
 *         self._ptr = c_api.AcquireCacheView(frame._frame)             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__(self):
 */
  __pyx_v_self->_ptr = AcquireCacheView(__pyx_v_frame->_frame);

  /* "sanpera/image.pyx":80
 *         self._ptr = NULL
 * 
 *     def __init__(self, ImageFrame frame not None):             # <<<<<<<<<<<<<<
 *         self._frame = frame
 *         self._ptr = c_api.AcquireCacheView(frame._frame)
 */

  /* function exit code */
  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":84
 *         self._ptr = c_api.AcquireCacheView(frame._frame)
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         cdef MagickException exc = MagickException()
 * 
 */

/* Python wrapper */
static void __pyx_pw_7sanpera_5image_9PixelView_5__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_7sanpera_5image_9PixelView_5__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_7sanpera_5image_9PixelView_4__dealloc__(((struct __pyx_obj_7sanpera_5image_PixelView *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
}

static void __pyx_pf_7sanpera_5image_9PixelView_4__dealloc__(struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self) {
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "sanpera/image.pyx":85
 * 
 *     def __dealloc__(self):
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 * 
 *         if self._ptr:
 */
  __pyx_t_1 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":87
 *         cdef MagickException exc = MagickException()
 * 
 *         if self._ptr:             # <<<<<<<<<<<<<<
 *             c_api.SyncCacheViewAuthenticPixels(self._ptr, exc.ptr)
 *             c_api.DestroyCacheView(self._ptr)
 */
  __pyx_t_2 = (__pyx_v_self->_ptr != 0);
  if (__pyx_t_2) {

    /* "sanpera/image.pyx":88
 * 
 *         if self._ptr:
 *             c_api.SyncCacheViewAuthenticPixels(self._ptr, exc.ptr)             # <<<<<<<<<<<<<<
 *             c_api.DestroyCacheView(self._ptr)
 *         self._ptr = NULL
 */
    SyncCacheViewAuthenticPixels(__pyx_v_self->_ptr, __pyx_v_exc->ptr);

    /* "sanpera/image.pyx":89
 *         if self._ptr:
 *             c_api.SyncCacheViewAuthenticPixels(self._ptr, exc.ptr)
 *             c_api.DestroyCacheView(self._ptr)             # <<<<<<<<<<<<<<
 *         self._ptr = NULL
 * 
 */
    DestroyCacheView(__pyx_v_self->_ptr);
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "sanpera/image.pyx":90
 *             c_api.SyncCacheViewAuthenticPixels(self._ptr, exc.ptr)
 *             c_api.DestroyCacheView(self._ptr)
 *         self._ptr = NULL             # <<<<<<<<<<<<<<
 * 
 *         # Only risk raising an exception AFTER clearing the pointer!
 */
  __pyx_v_self->_ptr = NULL;

  /* "sanpera/image.pyx":93
 * 
 *         # Only risk raising an exception AFTER clearing the pointer!
 *         exc.check()             # <<<<<<<<<<<<<<
 * 
 *     def __getitem__(self, point):
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "sanpera/image.pyx":84
 *         self._ptr = c_api.AcquireCacheView(frame._frame)
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         cdef MagickException exc = MagickException()
 * 
 */

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_WriteUnraisable("sanpera.image.PixelView.__dealloc__", __pyx_clineno, __pyx_lineno, __pyx_filename, 0);
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_RefNannyFinishContext();
}

/* "sanpera/image.pyx":95
 *         exc.check()
 * 
 *     def __getitem__(self, point):             # <<<<<<<<<<<<<<
 *         point = Vector.coerce(point)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_9PixelView_7__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_point); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_9PixelView_7__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_point) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__getitem__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_9PixelView_6__getitem__(((struct __pyx_obj_7sanpera_5image_PixelView *)__pyx_v_self), ((PyObject *)__pyx_v_point));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_9PixelView_6__getitem__(struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self, PyObject *__pyx_v_point) {
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  PixelPacket __pyx_v_px;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  Py_ssize_t __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__getitem__", 0);
  __Pyx_INCREF(__pyx_v_point);

  /* "sanpera/image.pyx":96
 * 
 *     def __getitem__(self, point):
 *         point = Vector.coerce(point)             # <<<<<<<<<<<<<<
 * 
 *         cdef MagickException exc = MagickException()
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_8geometry_Vector)), __pyx_n_s_coerce); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_point);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_point);
  __Pyx_GIVEREF(__pyx_v_point);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_point, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "sanpera/image.pyx":98
 *         point = Vector.coerce(point)
 * 
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 *         cdef c_api.PixelPacket px
 * 
 */
  __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "sanpera/image.pyx":102
 * 
 *         # TODO retval is t/f
 *         c_api.GetOneCacheViewAuthenticPixel(self._ptr, point.x, point.y, &px, exc.ptr)             # <<<<<<<<<<<<<<
 *         exc.check()
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_point, __pyx_n_s_x); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyInt_AsSsize_t(__pyx_t_3); if (unlikely((__pyx_t_4 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_point, __pyx_n_s_y); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = PyInt_AsSsize_t(__pyx_t_3); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  GetOneCacheViewAuthenticPixel(__pyx_v_self->_ptr, __pyx_t_4, __pyx_t_5, (&__pyx_v_px), __pyx_v_exc->ptr);

  /* "sanpera/image.pyx":103
 *         # TODO retval is t/f
 *         c_api.GetOneCacheViewAuthenticPixel(self._ptr, point.x, point.y, &px, exc.ptr)
 *         exc.check()             # <<<<<<<<<<<<<<
 * 
 *         return RGBColor(
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyObject_Call(__pyx_t_3, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "sanpera/image.pyx":105
 *         exc.check()
 * 
 *         return RGBColor(             # <<<<<<<<<<<<<<
 *             _quantum_to_double(px.red),
 *             _quantum_to_double(px.green),
 */
  __Pyx_XDECREF(__pyx_r);

  /* "sanpera/image.pyx":106
 * 
 *         return RGBColor(
 *             _quantum_to_double(px.red),             # <<<<<<<<<<<<<<
 *             _quantum_to_double(px.green),
 *             _quantum_to_double(px.blue),
 */
  __pyx_t_2 = PyFloat_FromDouble(__pyx_f_7sanpera_5color__quantum_to_double(((Quantum)__pyx_v_px.red))); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);

  /* "sanpera/image.pyx":107
 *         return RGBColor(
 *             _quantum_to_double(px.red),
 *             _quantum_to_double(px.green),             # <<<<<<<<<<<<<<
 *             _quantum_to_double(px.blue),
 *             # ImageMagick thinks opacity is transparency
 */
  __pyx_t_3 = PyFloat_FromDouble(__pyx_f_7sanpera_5color__quantum_to_double(((Quantum)__pyx_v_px.green))); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);

  /* "sanpera/image.pyx":108
 *             _quantum_to_double(px.red),
 *             _quantum_to_double(px.green),
 *             _quantum_to_double(px.blue),             # <<<<<<<<<<<<<<
 *             # ImageMagick thinks opacity is transparency
 *             1.0 - _quantum_to_double(px.opacity))
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_f_7sanpera_5color__quantum_to_double(((Quantum)__pyx_v_px.blue))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);

  /* "sanpera/image.pyx":110
 *             _quantum_to_double(px.blue),
 *             # ImageMagick thinks opacity is transparency
 *             1.0 - _quantum_to_double(px.opacity))             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_6 = PyFloat_FromDouble((1.0 - __pyx_f_7sanpera_5color__quantum_to_double(((Quantum)__pyx_v_px.opacity)))); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);

  /* "sanpera/image.pyx":105
 *         exc.check()
 * 
 *         return RGBColor(             # <<<<<<<<<<<<<<
 *             _quantum_to_double(px.red),
 *             _quantum_to_double(px.green),
 */
  __pyx_t_7 = PyTuple_New(4); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_7, 2, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_7, 3, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_6);
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_1 = 0;
  __pyx_t_6 = 0;
  __pyx_t_6 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_5color_RGBColor)), __pyx_t_7, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":95
 *         exc.check()
 * 
 *     def __getitem__(self, point):             # <<<<<<<<<<<<<<
 *         point = Vector.coerce(point)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("sanpera.image.PixelView.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XDECREF(__pyx_v_point);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_7sanpera_5image_9PixelView_10generator(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* "sanpera/image.pyx":116
 * 
 *     #def iter(self, Rectangle rect = None):
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         rect = self._frame.canvas
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_9PixelView_9__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_9PixelView_9__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_9PixelView_8__iter__(((struct __pyx_obj_7sanpera_5image_PixelView *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_9PixelView_8__iter__(struct __pyx_obj_7sanpera_5image_PixelView *__pyx_v_self) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__iter__", 0);
  __pyx_cur_scope = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *)__pyx_tp_new_7sanpera_5image___pyx_scope_struct____iter__(__pyx_ptype_7sanpera_5image___pyx_scope_struct____iter__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  {
    __pyx_GeneratorObject *gen = __Pyx_Generator_New((__pyx_generator_body_t) __pyx_gb_7sanpera_5image_9PixelView_10generator, (PyObject *) __pyx_cur_scope); if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("sanpera.image.PixelView.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_7sanpera_5image_9PixelView_10generator(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *__pyx_cur_scope = ((struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  unsigned long __pyx_t_2;
  long __pyx_t_3;
  long __pyx_t_4;
  int __pyx_t_5;
  Py_ssize_t __pyx_t_6;
  size_t __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  long __pyx_t_9;
  long __pyx_t_10;
  int __pyx_t_11;
  int __pyx_t_12;
  int __pyx_t_13;
  char const *__pyx_t_14;
  PyObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  PyObject *__pyx_t_17 = NULL;
  PyObject *__pyx_t_18 = NULL;
  PyObject *__pyx_t_19 = NULL;
  PyObject *__pyx_t_20 = NULL;
  char const *__pyx_t_21;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("None", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L18_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":117
 *     #def iter(self, Rectangle rect = None):
 *     def __iter__(self):
 *         rect = self._frame.canvas             # <<<<<<<<<<<<<<
 * 
 *         cdef int rows = self._frame._frame.rows
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self->_frame), __pyx_n_s_canvas); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_cur_scope->__pyx_v_rect = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":119
 *         rect = self._frame.canvas
 * 
 *         cdef int rows = self._frame._frame.rows             # <<<<<<<<<<<<<<
 *         cdef int columns = self._frame._frame.columns
 * 
 */
  __pyx_t_2 = __pyx_cur_scope->__pyx_v_self->_frame->_frame->rows;
  __pyx_cur_scope->__pyx_v_rows = __pyx_t_2;

  /* "sanpera/image.pyx":120
 * 
 *         cdef int rows = self._frame._frame.rows
 *         cdef int columns = self._frame._frame.columns             # <<<<<<<<<<<<<<
 * 
 *         cdef int x
 */
  __pyx_t_2 = __pyx_cur_scope->__pyx_v_self->_frame->_frame->columns;
  __pyx_cur_scope->__pyx_v_columns = __pyx_t_2;

  /* "sanpera/image.pyx":125
 *         cdef int y
 * 
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 * 
 *         cdef c_api.PixelPacket* q
 */
  __pyx_t_1 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_cur_scope->__pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":129
 *         cdef c_api.PixelPacket* q
 * 
 *         cdef PixelViewPixel pixel = PixelViewPixel.__new__(PixelViewPixel)             # <<<<<<<<<<<<<<
 *         pixel.owner = self
 * 
 */
  __pyx_t_1 = __pyx_tp_new_7sanpera_5image_PixelViewPixel(((PyTypeObject *)((PyObject*)__pyx_ptype_7sanpera_5image_PixelViewPixel)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7sanpera_5image_PixelViewPixel)))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_cur_scope->__pyx_v_pixel = ((struct __pyx_obj_7sanpera_5image_PixelViewPixel *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":130
 * 
 *         cdef PixelViewPixel pixel = PixelViewPixel.__new__(PixelViewPixel)
 *         pixel.owner = self             # <<<<<<<<<<<<<<
 * 
 *         for y in range(rect.top, rect.bottom):
 */
  __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_cur_scope->__pyx_v_self));
  __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_pixel->owner);
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope->__pyx_v_pixel->owner));
  __pyx_cur_scope->__pyx_v_pixel->owner = __pyx_cur_scope->__pyx_v_self;

  /* "sanpera/image.pyx":132
 *         pixel.owner = self
 * 
 *         for y in range(rect.top, rect.bottom):             # <<<<<<<<<<<<<<
 *             q = c_api.GetCacheViewAuthenticPixels(self._ptr, rect.left, y, rect.width, 1, exc.ptr)
 *             # TODO check q for NULL
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_rect, __pyx_n_s_bottom); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyInt_As_long(__pyx_t_1); if (unlikely((__pyx_t_3 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_rect, __pyx_n_s_top); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_As_long(__pyx_t_1); if (unlikely((__pyx_t_4 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_5 = __pyx_t_4; __pyx_t_5 < __pyx_t_3; __pyx_t_5+=1) {
    __pyx_cur_scope->__pyx_v_y = __pyx_t_5;

    /* "sanpera/image.pyx":133
 * 
 *         for y in range(rect.top, rect.bottom):
 *             q = c_api.GetCacheViewAuthenticPixels(self._ptr, rect.left, y, rect.width, 1, exc.ptr)             # <<<<<<<<<<<<<<
 *             # TODO check q for NULL
 *             exc.check()
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_rect, __pyx_n_s_left); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = PyInt_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_6 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_rect, __pyx_n_s_width); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = __Pyx_PyInt_As_size_t(__pyx_t_1); if (unlikely((__pyx_t_7 == (size_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_cur_scope->__pyx_v_q = GetCacheViewAuthenticPixels(__pyx_cur_scope->__pyx_v_self->_ptr, __pyx_t_6, __pyx_cur_scope->__pyx_v_y, __pyx_t_7, 1, __pyx_cur_scope->__pyx_v_exc->ptr);

    /* "sanpera/image.pyx":135
 *             q = c_api.GetCacheViewAuthenticPixels(self._ptr, rect.left, y, rect.width, 1, exc.ptr)
 *             # TODO check q for NULL
 *             exc.check()             # <<<<<<<<<<<<<<
 * 
 *             # TODO is this useful who knows
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "sanpera/image.pyx":140
 *             #fx_indexes=GetCacheViewAuthenticIndexQueue(fx_view);
 * 
 *             try:             # <<<<<<<<<<<<<<
 *                 for x in range(rect.left, rect.right):
 *                     # TODO this probably needs to do something else for indexed
 */
    /*try:*/ {

      /* "sanpera/image.pyx":141
 * 
 *             try:
 *                 for x in range(rect.left, rect.right):             # <<<<<<<<<<<<<<
 *                     # TODO this probably needs to do something else for indexed
 *                     try:
 */
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_rect, __pyx_n_s_right); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = __Pyx_PyInt_As_long(__pyx_t_8); if (unlikely((__pyx_t_9 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_rect, __pyx_n_s_left); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_10 = __Pyx_PyInt_As_long(__pyx_t_8); if (unlikely((__pyx_t_10 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      for (__pyx_t_11 = __pyx_t_10; __pyx_t_11 < __pyx_t_9; __pyx_t_11+=1) {
        __pyx_cur_scope->__pyx_v_x = __pyx_t_11;

        /* "sanpera/image.pyx":143
 *                 for x in range(rect.left, rect.right):
 *                     # TODO this probably needs to do something else for indexed
 *                     try:             # <<<<<<<<<<<<<<
 *                         # TODO rather than /always/ reusing the same pixel
 *                         # object, only reuse it if it's detected as only having
 */
        /*try:*/ {

          /* "sanpera/image.pyx":147
 *                         # object, only reuse it if it's detected as only having
 *                         # one refcnt left  :)
 *                         pixel._pixel = q             # <<<<<<<<<<<<<<
 *                         pixel._x = x
 *                         pixel._y = y
 */
          __pyx_cur_scope->__pyx_v_pixel->_pixel = __pyx_cur_scope->__pyx_v_q;

          /* "sanpera/image.pyx":148
 *                         # one refcnt left  :)
 *                         pixel._pixel = q
 *                         pixel._x = x             # <<<<<<<<<<<<<<
 *                         pixel._y = y
 *                         yield pixel
 */
          __pyx_cur_scope->__pyx_v_pixel->_x = __pyx_cur_scope->__pyx_v_x;

          /* "sanpera/image.pyx":149
 *                         pixel._pixel = q
 *                         pixel._x = x
 *                         pixel._y = y             # <<<<<<<<<<<<<<
 *                         yield pixel
 *                     finally:
 */
          __pyx_cur_scope->__pyx_v_pixel->_y = __pyx_cur_scope->__pyx_v_y;

          /* "sanpera/image.pyx":150
 *                         pixel._x = x
 *                         pixel._y = y
 *                         yield pixel             # <<<<<<<<<<<<<<
 *                     finally:
 *                         pixel._pixel = NULL
 */
          __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_pixel));
          __pyx_r = ((PyObject *)__pyx_cur_scope->__pyx_v_pixel);
          __pyx_cur_scope->__pyx_t_0 = __pyx_t_3;
          __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
          __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
          __pyx_cur_scope->__pyx_t_3 = __pyx_t_9;
          __pyx_cur_scope->__pyx_t_4 = __pyx_t_10;
          __pyx_cur_scope->__pyx_t_5 = __pyx_t_11;
          __Pyx_XGIVEREF(__pyx_r);
          __Pyx_RefNannyFinishContext();
          /* return from generator, yielding value */
          __pyx_generator->resume_label = 1;
          return __pyx_r;
          __pyx_L18_resume_from_yield:;
          __pyx_t_3 = __pyx_cur_scope->__pyx_t_0;
          __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
          __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
          __pyx_t_9 = __pyx_cur_scope->__pyx_t_3;
          __pyx_t_10 = __pyx_cur_scope->__pyx_t_4;
          __pyx_t_11 = __pyx_cur_scope->__pyx_t_5;
          if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L16_error;}
        }

        /* "sanpera/image.pyx":152
 *                         yield pixel
 *                     finally:
 *                         pixel._pixel = NULL             # <<<<<<<<<<<<<<
 * 
 *                     #ret = RoundToQuantum((MagickRealType) QuantumRange * ret)
 */
        /*finally:*/ {
          /*normal exit:*/{
            __pyx_cur_scope->__pyx_v_pixel->_pixel = NULL;
            goto __pyx_L17;
          }
          /*exception exit:*/{
            __pyx_L16_error:;
            __pyx_t_15 = 0; __pyx_t_16 = 0; __pyx_t_17 = 0; __pyx_t_18 = 0; __pyx_t_19 = 0; __pyx_t_20 = 0;
            __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
            __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
            if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
            if ((PY_MAJOR_VERSION < 3) || unlikely(__Pyx_GetException(&__pyx_t_15, &__pyx_t_16, &__pyx_t_17) < 0)) __Pyx_ErrFetch(&__pyx_t_15, &__pyx_t_16, &__pyx_t_17);
            __Pyx_XGOTREF(__pyx_t_15);
            __Pyx_XGOTREF(__pyx_t_16);
            __Pyx_XGOTREF(__pyx_t_17);
            __Pyx_XGOTREF(__pyx_t_18);
            __Pyx_XGOTREF(__pyx_t_19);
            __Pyx_XGOTREF(__pyx_t_20);
            __pyx_t_12 = __pyx_lineno; __pyx_t_13 = __pyx_clineno; __pyx_t_14 = __pyx_filename;
            {
              __pyx_cur_scope->__pyx_v_pixel->_pixel = NULL;
            }
            if (PY_MAJOR_VERSION >= 3) {
              __Pyx_XGIVEREF(__pyx_t_18);
              __Pyx_XGIVEREF(__pyx_t_19);
              __Pyx_XGIVEREF(__pyx_t_20);
              __Pyx_ExceptionReset(__pyx_t_18, __pyx_t_19, __pyx_t_20);
            }
            __Pyx_XGIVEREF(__pyx_t_15);
            __Pyx_XGIVEREF(__pyx_t_16);
            __Pyx_XGIVEREF(__pyx_t_17);
            __Pyx_ErrRestore(__pyx_t_15, __pyx_t_16, __pyx_t_17);
            __pyx_t_15 = 0; __pyx_t_16 = 0; __pyx_t_17 = 0; __pyx_t_18 = 0; __pyx_t_19 = 0; __pyx_t_20 = 0;
            __pyx_lineno = __pyx_t_12; __pyx_clineno = __pyx_t_13; __pyx_filename = __pyx_t_14;
            goto __pyx_L9_error;
          }
          __pyx_L17:;
        }

        /* "sanpera/image.pyx":162
 *                     #    }
 * 
 *                     inc(q)             # <<<<<<<<<<<<<<
 *             finally:
 *                 # TODO check return value
 */
        (++__pyx_cur_scope->__pyx_v_q);
      }
    }

    /* "sanpera/image.pyx":165
 *             finally:
 *                 # TODO check return value
 *                 c_api.SyncCacheViewAuthenticPixels(self._ptr, exc.ptr)             # <<<<<<<<<<<<<<
 *                 exc.check()
 * 
 */
    /*finally:*/ {
      /*normal exit:*/{
        SyncCacheViewAuthenticPixels(__pyx_cur_scope->__pyx_v_self->_ptr, __pyx_cur_scope->__pyx_v_exc->ptr);

        /* "sanpera/image.pyx":166
 *                 # TODO check return value
 *                 c_api.SyncCacheViewAuthenticPixels(self._ptr, exc.ptr)
 *                 exc.check()             # <<<<<<<<<<<<<<
 * 
 * 
 */
        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_1 = PyObject_Call(__pyx_t_8, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L10;
      }
      /*exception exit:*/{
        __pyx_L9_error:;
        __pyx_t_20 = 0; __pyx_t_19 = 0; __pyx_t_18 = 0; __pyx_t_17 = 0; __pyx_t_16 = 0; __pyx_t_15 = 0;
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_17, &__pyx_t_16, &__pyx_t_15);
        if ((PY_MAJOR_VERSION < 3) || unlikely(__Pyx_GetException(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18) < 0)) __Pyx_ErrFetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
        __Pyx_XGOTREF(__pyx_t_20);
        __Pyx_XGOTREF(__pyx_t_19);
        __Pyx_XGOTREF(__pyx_t_18);
        __Pyx_XGOTREF(__pyx_t_17);
        __Pyx_XGOTREF(__pyx_t_16);
        __Pyx_XGOTREF(__pyx_t_15);
        __pyx_t_11 = __pyx_lineno; __pyx_t_13 = __pyx_clineno; __pyx_t_21 = __pyx_filename;
        {

          /* "sanpera/image.pyx":165
 *             finally:
 *                 # TODO check return value
 *                 c_api.SyncCacheViewAuthenticPixels(self._ptr, exc.ptr)             # <<<<<<<<<<<<<<
 *                 exc.check()
 * 
 */
          SyncCacheViewAuthenticPixels(__pyx_cur_scope->__pyx_v_self->_ptr, __pyx_cur_scope->__pyx_v_exc->ptr);

          /* "sanpera/image.pyx":166
 *                 # TODO check return value
 *                 c_api.SyncCacheViewAuthenticPixels(self._ptr, exc.ptr)
 *                 exc.check()             # <<<<<<<<<<<<<<
 * 
 * 
 */
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L26_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_8 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L26_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        if (PY_MAJOR_VERSION >= 3) {
          __Pyx_XGIVEREF(__pyx_t_17);
          __Pyx_XGIVEREF(__pyx_t_16);
          __Pyx_XGIVEREF(__pyx_t_15);
          __Pyx_ExceptionReset(__pyx_t_17, __pyx_t_16, __pyx_t_15);
        }
        __Pyx_XGIVEREF(__pyx_t_20);
        __Pyx_XGIVEREF(__pyx_t_19);
        __Pyx_XGIVEREF(__pyx_t_18);
        __Pyx_ErrRestore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
        __pyx_t_20 = 0; __pyx_t_19 = 0; __pyx_t_18 = 0; __pyx_t_17 = 0; __pyx_t_16 = 0; __pyx_t_15 = 0;
        __pyx_lineno = __pyx_t_11; __pyx_clineno = __pyx_t_13; __pyx_filename = __pyx_t_21;
        goto __pyx_L1_error;
        __pyx_L26_error:;
        if (PY_MAJOR_VERSION >= 3) {
          __Pyx_XGIVEREF(__pyx_t_17);
          __Pyx_XGIVEREF(__pyx_t_16);
          __Pyx_XGIVEREF(__pyx_t_15);
          __Pyx_ExceptionReset(__pyx_t_17, __pyx_t_16, __pyx_t_15);
        }
        __Pyx_XDECREF(__pyx_t_20); __pyx_t_20 = 0;
        __Pyx_XDECREF(__pyx_t_19); __pyx_t_19 = 0;
        __Pyx_XDECREF(__pyx_t_18); __pyx_t_18 = 0;
        __pyx_t_17 = 0; __pyx_t_16 = 0; __pyx_t_15 = 0;
        goto __pyx_L1_error;
      }
      __pyx_L10:;
    }
  }

  /* "sanpera/image.pyx":116
 * 
 *     #def iter(self, Rectangle rect = None):
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         rect = self._frame.canvas
 * 
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_generator->resume_label = -1;
  __Pyx_Generator_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return NULL;
}

/* "sanpera/image.pyx":179
 *     # we need to use refcounting
 * 
 *     def __cinit__(self):             # <<<<<<<<<<<<<<
 *         self._frame = NULL
 * 
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_10ImageFrame_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_7sanpera_5image_10ImageFrame_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__cinit__ (wrapper)", 0);
  if (unlikely(PyTuple_GET_SIZE(__pyx_args) > 0)) {
    __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_7sanpera_5image_10ImageFrame___cinit__(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_10ImageFrame___cinit__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__cinit__", 0);

  /* "sanpera/image.pyx":180
 * 
 *     def __cinit__(self):
 *         self._frame = NULL             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__(self):
 */
  __pyx_v_self->_frame = NULL;

  /* "sanpera/image.pyx":179
 *     # we need to use refcounting
 * 
 *     def __cinit__(self):             # <<<<<<<<<<<<<<
 *         self._frame = NULL
 * 
 */

  /* function exit code */
  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":182
 *         self._frame = NULL
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         if self._frame:
 *             c_api.DestroyImage(self._frame)
 */

/* Python wrapper */
static void __pyx_pw_7sanpera_5image_10ImageFrame_3__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_7sanpera_5image_10ImageFrame_3__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_7sanpera_5image_10ImageFrame_2__dealloc__(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
}

static void __pyx_pf_7sanpera_5image_10ImageFrame_2__dealloc__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "sanpera/image.pyx":183
 * 
 *     def __dealloc__(self):
 *         if self._frame:             # <<<<<<<<<<<<<<
 *             c_api.DestroyImage(self._frame)
 *         self._frame = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_frame != 0);
  if (__pyx_t_1) {

    /* "sanpera/image.pyx":184
 *     def __dealloc__(self):
 *         if self._frame:
 *             c_api.DestroyImage(self._frame)             # <<<<<<<<<<<<<<
 *         self._frame = NULL
 * 
 */
    DestroyImage(__pyx_v_self->_frame);
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "sanpera/image.pyx":185
 *         if self._frame:
 *             c_api.DestroyImage(self._frame)
 *         self._frame = NULL             # <<<<<<<<<<<<<<
 * 
 *     cdef _set_frame(self, c_api.Image* other):
 */
  __pyx_v_self->_frame = NULL;

  /* "sanpera/image.pyx":182
 *         self._frame = NULL
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         if self._frame:
 *             c_api.DestroyImage(self._frame)
 */

  /* function exit code */
  __Pyx_RefNannyFinishContext();
}

/* "sanpera/image.pyx":187
 *         self._frame = NULL
 * 
 *     cdef _set_frame(self, c_api.Image* other):             # <<<<<<<<<<<<<<
 *         # Sets the wrapped frame, discarding the old one if necessary.
 *         # Only feed me a newly-created frame!  NEVER pass in another
 */

static PyObject *__pyx_f_7sanpera_5image_10ImageFrame__set_frame(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self, Image *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("_set_frame", 0);

  /* "sanpera/image.pyx":191
 *         # Only feed me a newly-created frame!  NEVER pass in another
 *         # ImageFrame's frame!
 *         if self._frame:             # <<<<<<<<<<<<<<
 *             c_api.DestroyImage(self._frame)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_frame != 0);
  if (__pyx_t_1) {

    /* "sanpera/image.pyx":192
 *         # ImageFrame's frame!
 *         if self._frame:
 *             c_api.DestroyImage(self._frame)             # <<<<<<<<<<<<<<
 * 
 *         self._frame = other
 */
    DestroyImage(__pyx_v_self->_frame);
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "sanpera/image.pyx":194
 *             c_api.DestroyImage(self._frame)
 * 
 *         self._frame = other             # <<<<<<<<<<<<<<
 *         c_api.ReferenceImage(self._frame)
 * 
 */
  __pyx_v_self->_frame = __pyx_v_other;

  /* "sanpera/image.pyx":195
 * 
 *         self._frame = other
 *         c_api.ReferenceImage(self._frame)             # <<<<<<<<<<<<<<
 * 
 *     def __init__(self):
 */
  ReferenceImage(__pyx_v_self->_frame);

  /* "sanpera/image.pyx":187
 *         self._frame = NULL
 * 
 *     cdef _set_frame(self, c_api.Image* other):             # <<<<<<<<<<<<<<
 *         # Sets the wrapped frame, discarding the old one if necessary.
 *         # Only feed me a newly-created frame!  NEVER pass in another
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":197
 *         c_api.ReferenceImage(self._frame)
 * 
 *     def __init__(self):             # <<<<<<<<<<<<<<
 *         raise TypeError("RawFrames cannot be instantiated directly")
 * 
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_10ImageFrame_5__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_7sanpera_5image_10ImageFrame_5__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  if (unlikely(PyTuple_GET_SIZE(__pyx_args) > 0)) {
    __Pyx_RaiseArgtupleInvalid("__init__", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_7sanpera_5image_10ImageFrame_4__init__(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_10ImageFrame_4__init__(CYTHON_UNUSED struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "sanpera/image.pyx":198
 * 
 *     def __init__(self):
 *         raise TypeError("RawFrames cannot be instantiated directly")             # <<<<<<<<<<<<<<
 * 
 *     property canvas:
 */
  __pyx_t_1 = PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_Raise(__pyx_t_1, 0, 0, 0);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":197
 *         c_api.ReferenceImage(self._frame)
 * 
 *     def __init__(self):             # <<<<<<<<<<<<<<
 *         raise TypeError("RawFrames cannot be instantiated directly")
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.ImageFrame.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":204
 *         to the image's full size.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return Rectangle(
 *                 self._frame.page.x,
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_6canvas_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_6canvas_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_10ImageFrame_6canvas___get__(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_6canvas___get__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);

  /* "sanpera/image.pyx":205
 *         """
 *         def __get__(self):
 *             return Rectangle(             # <<<<<<<<<<<<<<
 *                 self._frame.page.x,
 *                 self._frame.page.y,
 */
  __Pyx_XDECREF(__pyx_r);

  /* "sanpera/image.pyx":206
 *         def __get__(self):
 *             return Rectangle(
 *                 self._frame.page.x,             # <<<<<<<<<<<<<<
 *                 self._frame.page.y,
 *                 self._frame.page.x + self._frame.columns,
 */
  __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v_self->_frame->page.x); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);

  /* "sanpera/image.pyx":207
 *             return Rectangle(
 *                 self._frame.page.x,
 *                 self._frame.page.y,             # <<<<<<<<<<<<<<
 *                 self._frame.page.x + self._frame.columns,
 *                 self._frame.page.y + self._frame.rows,
 */
  __pyx_t_2 = __Pyx_PyInt_From_long(__pyx_v_self->_frame->page.y); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);

  /* "sanpera/image.pyx":208
 *                 self._frame.page.x,
 *                 self._frame.page.y,
 *                 self._frame.page.x + self._frame.columns,             # <<<<<<<<<<<<<<
 *                 self._frame.page.y + self._frame.rows,
 *             )
 */
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_long((__pyx_v_self->_frame->page.x + __pyx_v_self->_frame->columns)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);

  /* "sanpera/image.pyx":209
 *                 self._frame.page.y,
 *                 self._frame.page.x + self._frame.columns,
 *                 self._frame.page.y + self._frame.rows,             # <<<<<<<<<<<<<<
 *             )
 * 
 */
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_long((__pyx_v_self->_frame->page.y + __pyx_v_self->_frame->rows)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);

  /* "sanpera/image.pyx":205
 *         """
 *         def __get__(self):
 *             return Rectangle(             # <<<<<<<<<<<<<<
 *                 self._frame.page.x,
 *                 self._frame.page.y,
 */
  __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_8geometry_Rectangle)), __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":204
 *         to the image's full size.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return Rectangle(
 *                 self._frame.page.x,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("sanpera.image.ImageFrame.canvas.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":215
 *         """Size of the frame, as a `Size`.  Shortcut for `frame.canvas.size`.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return Size(self._frame.columns, self._frame.rows)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_4size_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_4size_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_10ImageFrame_4size___get__(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_4size___get__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);

  /* "sanpera/image.pyx":216
 *         """
 *         def __get__(self):
 *             return Size(self._frame.columns, self._frame.rows)             # <<<<<<<<<<<<<<
 * 
 *     property has_canvas:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->_frame->columns); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->_frame->rows); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_8geometry_Size)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":215
 *         """Size of the frame, as a `Size`.  Shortcut for `frame.canvas.size`.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return Size(self._frame.columns, self._frame.rows)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.ImageFrame.size.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":223
 *         anchored at the origin.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return (
 *                 self._frame.page.x != 0 or
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_10has_canvas_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_10has_canvas_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_10ImageFrame_10has_canvas___get__(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_10has_canvas___get__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);

  /* "sanpera/image.pyx":224
 *         """
 *         def __get__(self):
 *             return (             # <<<<<<<<<<<<<<
 *                 self._frame.page.x != 0 or
 *                 self._frame.page.y != 0 or
 */
  __Pyx_XDECREF(__pyx_r);

  /* "sanpera/image.pyx":225
 *         def __get__(self):
 *             return (
 *                 self._frame.page.x != 0 or             # <<<<<<<<<<<<<<
 *                 self._frame.page.y != 0 or
 *                 self._frame.page.width != self._frame.columns or
 */
  __pyx_t_1 = (__pyx_v_self->_frame->page.x != 0);
  if (!__pyx_t_1) {

    /* "sanpera/image.pyx":226
 *             return (
 *                 self._frame.page.x != 0 or
 *                 self._frame.page.y != 0 or             # <<<<<<<<<<<<<<
 *                 self._frame.page.width != self._frame.columns or
 *                 self._frame.page.height != self._frame.rows
 */
    __pyx_t_2 = (__pyx_v_self->_frame->page.y != 0);
    if (!__pyx_t_2) {

      /* "sanpera/image.pyx":227
 *                 self._frame.page.x != 0 or
 *                 self._frame.page.y != 0 or
 *                 self._frame.page.width != self._frame.columns or             # <<<<<<<<<<<<<<
 *                 self._frame.page.height != self._frame.rows
 *             )
 */
      __pyx_t_3 = (__pyx_v_self->_frame->page.width != __pyx_v_self->_frame->columns);
      if (!__pyx_t_3) {

        /* "sanpera/image.pyx":228
 *                 self._frame.page.y != 0 or
 *                 self._frame.page.width != self._frame.columns or
 *                 self._frame.page.height != self._frame.rows             # <<<<<<<<<<<<<<
 *             )
 * 
 */
        __pyx_t_4 = (__pyx_v_self->_frame->page.height != __pyx_v_self->_frame->rows);
        __pyx_t_5 = __pyx_t_4;
      } else {
        __pyx_t_5 = __pyx_t_3;
      }
      __pyx_t_3 = __pyx_t_5;
    } else {
      __pyx_t_3 = __pyx_t_2;
    }
    __pyx_t_2 = __pyx_t_3;
  } else {
    __pyx_t_2 = __pyx_t_1;
  }

  /* "sanpera/image.pyx":225
 *         def __get__(self):
 *             return (
 *                 self._frame.page.x != 0 or             # <<<<<<<<<<<<<<
 *                 self._frame.page.y != 0 or
 *                 self._frame.page.width != self._frame.columns or
 */
  __pyx_t_6 = __Pyx_PyBool_FromLong(__pyx_t_2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":223
 *         anchored at the origin.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return (
 *                 self._frame.page.x != 0 or
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("sanpera.image.ImageFrame.has_canvas.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":238
 *         alpha channel, an all-opaque one will be created.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._frame.matte == c_api.MagickTrue
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_11translucent_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_11translucent_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_10ImageFrame_11translucent___get__(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_11translucent___get__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);

  /* "sanpera/image.pyx":239
 *         """
 *         def __get__(self):
 *             return self._frame.matte == c_api.MagickTrue             # <<<<<<<<<<<<<<
 * 
 *         def __set__(self, bool value not None):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyBool_FromLong((__pyx_v_self->_frame->matte == MagickTrue)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 239; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":238
 *         alpha channel, an all-opaque one will be created.
 *         """
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._frame.matte == c_api.MagickTrue
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.ImageFrame.translucent.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":241
 *             return self._frame.matte == c_api.MagickTrue
 * 
 *         def __set__(self, bool value not None):             # <<<<<<<<<<<<<<
 *             if value == self.translucent:
 *                 return
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_10ImageFrame_11translucent_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pw_7sanpera_5image_10ImageFrame_11translucent_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_value), __pyx_ptype_7cpython_4bool_bool, 0, "value", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_10ImageFrame_11translucent_2__set__(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self), ((PyBoolObject *)__pyx_v_value));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_10ImageFrame_11translucent_2__set__(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self, PyBoolObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__set__", 0);

  /* "sanpera/image.pyx":242
 * 
 *         def __set__(self, bool value not None):
 *             if value == self.translucent:             # <<<<<<<<<<<<<<
 *                 return
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_translucent); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_RichCompare(((PyObject *)__pyx_v_value), __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "sanpera/image.pyx":243
 *         def __set__(self, bool value not None):
 *             if value == self.translucent:
 *                 return             # <<<<<<<<<<<<<<
 * 
 *             if value:
 */
    __pyx_r = 0;
    goto __pyx_L0;
  }

  /* "sanpera/image.pyx":245
 *                 return
 * 
 *             if value:             # <<<<<<<<<<<<<<
 *                 # Set the alpha channel
 *                 c_api.SetImageAlphaChannel(self._frame, c_api.SetAlphaChannel)
 */
  __pyx_t_3 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_value)); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_3) {

    /* "sanpera/image.pyx":247
 *             if value:
 *                 # Set the alpha channel
 *                 c_api.SetImageAlphaChannel(self._frame, c_api.SetAlphaChannel)             # <<<<<<<<<<<<<<
 *             else:
 *                 # Disable it
 */
    SetImageAlphaChannel(__pyx_v_self->_frame, SetAlphaChannel);
    goto __pyx_L4;
  }
  /*else*/ {

    /* "sanpera/image.pyx":250
 *             else:
 *                 # Disable it
 *                 c_api.SetImageAlphaChannel(self._frame, c_api.DeactivateAlphaChannel)             # <<<<<<<<<<<<<<
 * 
 *             check_magick_exception(&self._frame.exception)
 */
    SetImageAlphaChannel(__pyx_v_self->_frame, DeactivateAlphaChannel);
  }
  __pyx_L4:;

  /* "sanpera/image.pyx":252
 *                 c_api.SetImageAlphaChannel(self._frame, c_api.DeactivateAlphaChannel)
 * 
 *             check_magick_exception(&self._frame.exception)             # <<<<<<<<<<<<<<
 * 
 *     ### Pixel access
 */
  __pyx_t_2 = __pyx_f_7sanpera_9exception_check_magick_exception((&__pyx_v_self->_frame->exception), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "sanpera/image.pyx":241
 *             return self._frame.matte == c_api.MagickTrue
 * 
 *         def __set__(self, bool value not None):             # <<<<<<<<<<<<<<
 *             if value == self.translucent:
 *                 return
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.ImageFrame.translucent.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":257
 * 
 *     @property
 *     def pixels(self):             # <<<<<<<<<<<<<<
 *         return PixelView(self)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_7pixels(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_7pixels(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("pixels (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_10ImageFrame_6pixels(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_6pixels(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("pixels", 0);

  /* "sanpera/image.pyx":258
 *     @property
 *     def pixels(self):
 *         return PixelView(self)             # <<<<<<<<<<<<<<
 * 
 *     ### Whole-frame manipulation
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_5image_PixelView)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":257
 * 
 *     @property
 *     def pixels(self):             # <<<<<<<<<<<<<<
 *         return PixelView(self)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.ImageFrame.pixels", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":263
 * 
 *     # TODO perhaps a mutating version of this would be useful for painting
 *     def tiled(self, size):             # <<<<<<<<<<<<<<
 *         size = Size.coerce(size)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_9tiled(PyObject *__pyx_v_self, PyObject *__pyx_v_size); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_9tiled(PyObject *__pyx_v_self, PyObject *__pyx_v_size) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("tiled (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_10ImageFrame_8tiled(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self), ((PyObject *)__pyx_v_size));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_8tiled(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self, PyObject *__pyx_v_size) {
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_new = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("tiled", 0);
  __Pyx_INCREF(__pyx_v_size);

  /* "sanpera/image.pyx":264
 *     # TODO perhaps a mutating version of this would be useful for painting
 *     def tiled(self, size):
 *         size = Size.coerce(size)             # <<<<<<<<<<<<<<
 * 
 *         cdef Image new = Image.new(size)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_8geometry_Size)), __pyx_n_s_coerce); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_size);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_size);
  __Pyx_GIVEREF(__pyx_v_size);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_size, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "sanpera/image.pyx":266
 *         size = Size.coerce(size)
 * 
 *         cdef Image new = Image.new(size)             # <<<<<<<<<<<<<<
 * 
 *         # TODO this returns a bool?
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_5image_Image)), __pyx_n_s_new); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_size);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_size);
  __Pyx_GIVEREF(__pyx_v_size);
  __pyx_t_1 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7sanpera_5image_Image))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_new = ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":269
 * 
 *         # TODO this returns a bool?
 *         c_api.TextureImage(new._stack, self._frame)             # <<<<<<<<<<<<<<
 *         check_magick_exception(&self._frame.exception)
 * 
 */
  TextureImage(__pyx_v_new->_stack, __pyx_v_self->_frame);

  /* "sanpera/image.pyx":270
 *         # TODO this returns a bool?
 *         c_api.TextureImage(new._stack, self._frame)
 *         check_magick_exception(&self._frame.exception)             # <<<<<<<<<<<<<<
 * 
 *         return new
 */
  __pyx_t_1 = __pyx_f_7sanpera_9exception_check_magick_exception((&__pyx_v_self->_frame->exception), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":272
 *         check_magick_exception(&self._frame.exception)
 * 
 *         return new             # <<<<<<<<<<<<<<
 * 
 *     ### Color
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_new));
  __pyx_r = ((PyObject *)__pyx_v_new);
  goto __pyx_L0;

  /* "sanpera/image.pyx":263
 * 
 *     # TODO perhaps a mutating version of this would be useful for painting
 *     def tiled(self, size):             # <<<<<<<<<<<<<<
 *         size = Size.coerce(size)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.ImageFrame.tiled", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_new);
  __Pyx_XDECREF(__pyx_v_size);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":276
 *     ### Color
 * 
 *     def replace_color(self, RGBColor color, RGBColor replacement,             # <<<<<<<<<<<<<<
 *             *, float fuzz = 0.0):
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_11replace_color(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_10ImageFrame_11replace_color(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_color = 0;
  struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_replacement = 0;
  float __pyx_v_fuzz;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("replace_color (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_color,&__pyx_n_s_replacement,&__pyx_n_s_fuzz,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_replacement)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("replace_color", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 276; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (kw_args == 1) {
        const Py_ssize_t index = 2;
        PyObject* value = PyDict_GetItem(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "replace_color") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 276; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_color = ((struct __pyx_obj_7sanpera_5color_RGBColor *)values[0]);
    __pyx_v_replacement = ((struct __pyx_obj_7sanpera_5color_RGBColor *)values[1]);
    if (values[2]) {
      __pyx_v_fuzz = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_fuzz == (float)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_fuzz = ((float)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("replace_color", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 276; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("sanpera.image.ImageFrame.replace_color", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_color), __pyx_ptype_7sanpera_5color_RGBColor, 1, "color", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 276; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_replacement), __pyx_ptype_7sanpera_5color_RGBColor, 1, "replacement", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 276; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_10ImageFrame_10replace_color(((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_self), __pyx_v_color, __pyx_v_replacement, __pyx_v_fuzz);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_10ImageFrame_10replace_color(struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self, struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_color, struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_replacement, float __pyx_v_fuzz) {
  MagickPixelPacket __pyx_v_from_;
  MagickPixelPacket __pyx_v_to;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("replace_color", 0);

  /* "sanpera/image.pyx":280
 * 
 *         cdef c_api.MagickPixelPacket from_
 *         color._populate_magick_pixel(&from_)             # <<<<<<<<<<<<<<
 *         from_.fuzz = fuzz
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_7sanpera_5color_RGBColor *)__pyx_v_color->__pyx_base.__pyx_vtab)->__pyx_base._populate_magick_pixel(((struct __pyx_obj_7sanpera_5color_BaseColor *)__pyx_v_color), (&__pyx_v_from_)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":281
 *         cdef c_api.MagickPixelPacket from_
 *         color._populate_magick_pixel(&from_)
 *         from_.fuzz = fuzz             # <<<<<<<<<<<<<<
 * 
 *         cdef c_api.MagickPixelPacket to
 */
  __pyx_v_from_.fuzz = __pyx_v_fuzz;

  /* "sanpera/image.pyx":284
 * 
 *         cdef c_api.MagickPixelPacket to
 *         replacement._populate_magick_pixel(&to)             # <<<<<<<<<<<<<<
 *         to.fuzz = fuzz
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_7sanpera_5color_RGBColor *)__pyx_v_replacement->__pyx_base.__pyx_vtab)->__pyx_base._populate_magick_pixel(((struct __pyx_obj_7sanpera_5color_BaseColor *)__pyx_v_replacement), (&__pyx_v_to)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":285
 *         cdef c_api.MagickPixelPacket to
 *         replacement._populate_magick_pixel(&to)
 *         to.fuzz = fuzz             # <<<<<<<<<<<<<<
 * 
 *         c_api.OpaquePaintImage(self._frame, &from_, &to, c_api.MagickFalse)
 */
  __pyx_v_to.fuzz = __pyx_v_fuzz;

  /* "sanpera/image.pyx":287
 *         to.fuzz = fuzz
 * 
 *         c_api.OpaquePaintImage(self._frame, &from_, &to, c_api.MagickFalse)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  OpaquePaintImage(__pyx_v_self->_frame, (&__pyx_v_from_), (&__pyx_v_to), MagickFalse);

  /* "sanpera/image.pyx":276
 *     ### Color
 * 
 *     def replace_color(self, RGBColor color, RGBColor replacement,             # <<<<<<<<<<<<<<
 *             *, float fuzz = 0.0):
 * 
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.ImageFrame.replace_color", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":290
 * 
 * 
 * cdef ImageFrame _ImageFrame_factory(c_api.Image* frame):             # <<<<<<<<<<<<<<
 *     cdef ImageFrame self = ImageFrame.__new__(ImageFrame)
 *     self._set_frame(frame)
 */

static struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_f_7sanpera_5image__ImageFrame_factory(Image *__pyx_v_frame) {
  struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_self = 0;
  struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("_ImageFrame_factory", 0);

  /* "sanpera/image.pyx":291
 * 
 * cdef ImageFrame _ImageFrame_factory(c_api.Image* frame):
 *     cdef ImageFrame self = ImageFrame.__new__(ImageFrame)             # <<<<<<<<<<<<<<
 *     self._set_frame(frame)
 *     return self
 */
  __pyx_t_1 = __pyx_tp_new_7sanpera_5image_ImageFrame(((PyTypeObject *)((PyObject*)__pyx_ptype_7sanpera_5image_ImageFrame)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7sanpera_5image_ImageFrame)))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_self = ((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":292
 * cdef ImageFrame _ImageFrame_factory(c_api.Image* frame):
 *     cdef ImageFrame self = ImageFrame.__new__(ImageFrame)
 *     self._set_frame(frame)             # <<<<<<<<<<<<<<
 *     return self
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_7sanpera_5image_ImageFrame *)__pyx_v_self->__pyx_vtab)->_set_frame(__pyx_v_self, __pyx_v_frame); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":293
 *     cdef ImageFrame self = ImageFrame.__new__(ImageFrame)
 *     self._set_frame(frame)
 *     return self             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  /* "sanpera/image.pyx":290
 * 
 * 
 * cdef ImageFrame _ImageFrame_factory(c_api.Image* frame):             # <<<<<<<<<<<<<<
 *     cdef ImageFrame self = ImageFrame.__new__(ImageFrame)
 *     self._set_frame(frame)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image._ImageFrame_factory", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF((PyObject *)__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":303
 *     """
 * 
 *     def __cinit__(self):             # <<<<<<<<<<<<<<
 *         self._stack = NULL
 *         self._frames = []
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_5Image_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_7sanpera_5image_5Image_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__cinit__ (wrapper)", 0);
  if (unlikely(PyTuple_GET_SIZE(__pyx_args) > 0)) {
    __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_7sanpera_5image_5Image___cinit__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_5Image___cinit__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__cinit__", 0);

  /* "sanpera/image.pyx":304
 * 
 *     def __cinit__(self):
 *         self._stack = NULL             # <<<<<<<<<<<<<<
 *         self._frames = []
 * 
 */
  __pyx_v_self->_stack = NULL;

  /* "sanpera/image.pyx":305
 *     def __cinit__(self):
 *         self._stack = NULL
 *         self._frames = []             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__(self):
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->_frames);
  __Pyx_DECREF(__pyx_v_self->_frames);
  __pyx_v_self->_frames = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":303
 *     """
 * 
 *     def __cinit__(self):             # <<<<<<<<<<<<<<
 *         self._stack = NULL
 *         self._frames = []
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.Image.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":307
 *         self._frames = []
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         if self._stack:
 *             c_api.DestroyImageList(self._stack)
 */

/* Python wrapper */
static void __pyx_pw_7sanpera_5image_5Image_3__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_7sanpera_5image_5Image_3__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_7sanpera_5image_5Image_2__dealloc__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
}

static void __pyx_pf_7sanpera_5image_5Image_2__dealloc__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "sanpera/image.pyx":308
 * 
 *     def __dealloc__(self):
 *         if self._stack:             # <<<<<<<<<<<<<<
 *             c_api.DestroyImageList(self._stack)
 *         self._stack = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_stack != 0);
  if (__pyx_t_1) {

    /* "sanpera/image.pyx":309
 *     def __dealloc__(self):
 *         if self._stack:
 *             c_api.DestroyImageList(self._stack)             # <<<<<<<<<<<<<<
 *         self._stack = NULL
 * 
 */
    DestroyImageList(__pyx_v_self->_stack);
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "sanpera/image.pyx":310
 *         if self._stack:
 *             c_api.DestroyImageList(self._stack)
 *         self._stack = NULL             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_v_self->_stack = NULL;

  /* "sanpera/image.pyx":307
 *         self._frames = []
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         if self._stack:
 *             c_api.DestroyImageList(self._stack)
 */

  /* function exit code */
  __Pyx_RefNannyFinishContext();
}

/* "sanpera/image.pyx":315
 *     ### Constructors (input)
 * 
 *     def __init__(self):             # <<<<<<<<<<<<<<
 *         """Create a new image with zero frames.  This is /probably/ not what
 *         you want; consider using `Image.new()` instead.
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_5Image_5__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7sanpera_5image_5Image_4__init__[] = "Create a new image with zero frames.  This is /probably/ not what\n        you want; consider using `Image.new()` instead.\n        ";
#if CYTHON_COMPILING_IN_CPYTHON
struct wrapperbase __pyx_wrapperbase_7sanpera_5image_5Image_4__init__;
#endif
static int __pyx_pw_7sanpera_5image_5Image_5__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  if (unlikely(PyTuple_GET_SIZE(__pyx_args) > 0)) {
    __Pyx_RaiseArgtupleInvalid("__init__", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_4__init__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_5Image_4__init__(CYTHON_UNUSED struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__", 0);

  /* function exit code */
  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":322
 * 
 *     @classmethod
 *     def new(type cls, size not None, *, RGBColor fill=None):             # <<<<<<<<<<<<<<
 *         """Create a new image (with one frame) of the given size."""
 *         size = Size.coerce(size)
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_7new(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7sanpera_5image_5Image_6new[] = "Create a new image (with one frame) of the given size.";
static PyObject *__pyx_pw_7sanpera_5image_5Image_7new(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_size = 0;
  struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_fill = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("new (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_size,&__pyx_n_s_fill,0};
    PyObject* values[2] = {0,0};
    values[1] = (PyObject *)((struct __pyx_obj_7sanpera_5color_RGBColor *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_size)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (kw_args == 1) {
        const Py_ssize_t index = 1;
        PyObject* value = PyDict_GetItem(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "new") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_size = values[0];
    __pyx_v_fill = ((struct __pyx_obj_7sanpera_5color_RGBColor *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("new", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("sanpera.image.Image.new", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(((PyObject *)__pyx_v_size) == Py_None)) {
    PyErr_Format(PyExc_TypeError, "Argument '%.200s' must not be None", "size"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_fill), __pyx_ptype_7sanpera_5color_RGBColor, 1, "fill", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_6new(((PyObject*)__pyx_v_cls), __pyx_v_size, __pyx_v_fill);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_6new(PyObject *__pyx_v_cls, PyObject *__pyx_v_size, struct __pyx_obj_7sanpera_5color_RGBColor *__pyx_v_fill) {
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self = 0;
  ImageInfo *__pyx_v_image_info;
  MagickPixelPacket __pyx_v_magick_pixel;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  size_t __pyx_t_6;
  size_t __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  char const *__pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("new", 0);
  __Pyx_INCREF(__pyx_v_size);
  __Pyx_INCREF((PyObject *)__pyx_v_fill);

  /* "sanpera/image.pyx":324
 *     def new(type cls, size not None, *, RGBColor fill=None):
 *         """Create a new image (with one frame) of the given size."""
 *         size = Size.coerce(size)             # <<<<<<<<<<<<<<
 * 
 *         cdef Image self = cls()
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_8geometry_Size)), __pyx_n_s_coerce); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_size);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_size);
  __Pyx_GIVEREF(__pyx_v_size);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_size, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "sanpera/image.pyx":326
 *         size = Size.coerce(size)
 * 
 *         cdef Image self = cls()             # <<<<<<<<<<<<<<
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 *         cdef c_api.MagickPixelPacket magick_pixel
 */
  __pyx_t_3 = PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7sanpera_5image_Image))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_self = ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "sanpera/image.pyx":327
 * 
 *         cdef Image self = cls()
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)             # <<<<<<<<<<<<<<
 *         cdef c_api.MagickPixelPacket magick_pixel
 *         c_api.GetMagickPixelPacket(NULL, &magick_pixel)
 */
  __pyx_v_image_info = CloneImageInfo(NULL);

  /* "sanpera/image.pyx":329
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 *         cdef c_api.MagickPixelPacket magick_pixel
 *         c_api.GetMagickPixelPacket(NULL, &magick_pixel)             # <<<<<<<<<<<<<<
 * 
 *         try:
 */
  GetMagickPixelPacket(NULL, (&__pyx_v_magick_pixel));

  /* "sanpera/image.pyx":331
 *         c_api.GetMagickPixelPacket(NULL, &magick_pixel)
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             if fill is None:
 *                 # TODO need a way to explicitly create a certain color
 */
  /*try:*/ {

    /* "sanpera/image.pyx":332
 * 
 *         try:
 *             if fill is None:             # <<<<<<<<<<<<<<
 *                 # TODO need a way to explicitly create a certain color
 *                 fill = RGBColor(0., 0., 0., 0.)
 */
    __pyx_t_4 = (((PyObject *)__pyx_v_fill) == Py_None);
    __pyx_t_5 = (__pyx_t_4 != 0);
    if (__pyx_t_5) {

      /* "sanpera/image.pyx":334
 *             if fill is None:
 *                 # TODO need a way to explicitly create a certain color
 *                 fill = RGBColor(0., 0., 0., 0.)             # <<<<<<<<<<<<<<
 * 
 *             fill._populate_magick_pixel(&magick_pixel)
 */
      __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_5color_RGBColor)), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF_SET(__pyx_v_fill, ((struct __pyx_obj_7sanpera_5color_RGBColor *)__pyx_t_3));
      __pyx_t_3 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "sanpera/image.pyx":336
 *                 fill = RGBColor(0., 0., 0., 0.)
 * 
 *             fill._populate_magick_pixel(&magick_pixel)             # <<<<<<<<<<<<<<
 * 
 *             self._stack = c_api.NewMagickImage(image_info, size.width, size.height, &magick_pixel)
 */
    __pyx_t_3 = ((struct __pyx_vtabstruct_7sanpera_5color_RGBColor *)__pyx_v_fill->__pyx_base.__pyx_vtab)->__pyx_base._populate_magick_pixel(((struct __pyx_obj_7sanpera_5color_BaseColor *)__pyx_v_fill), (&__pyx_v_magick_pixel)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "sanpera/image.pyx":338
 *             fill._populate_magick_pixel(&magick_pixel)
 * 
 *             self._stack = c_api.NewMagickImage(image_info, size.width, size.height, &magick_pixel)             # <<<<<<<<<<<<<<
 *             check_magick_exception(&self._stack.exception)
 *         finally:
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_size, __pyx_n_s_width); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 338; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_t_3); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 338; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_size, __pyx_n_s_height); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 338; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyInt_As_size_t(__pyx_t_3); if (unlikely((__pyx_t_7 == (size_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 338; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_self->_stack = NewMagickImage(__pyx_v_image_info, __pyx_t_6, __pyx_t_7, (&__pyx_v_magick_pixel));

    /* "sanpera/image.pyx":339
 * 
 *             self._stack = c_api.NewMagickImage(image_info, size.width, size.height, &magick_pixel)
 *             check_magick_exception(&self._stack.exception)             # <<<<<<<<<<<<<<
 *         finally:
 *             c_api.DestroyImageInfo(image_info)
 */
    __pyx_t_3 = __pyx_f_7sanpera_9exception_check_magick_exception((&__pyx_v_self->_stack->exception), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 339; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }

  /* "sanpera/image.pyx":341
 *             check_magick_exception(&self._stack.exception)
 *         finally:
 *             c_api.DestroyImageInfo(image_info)             # <<<<<<<<<<<<<<
 * 
 *         self._post_init()
 */
  /*finally:*/ {
    /*normal exit:*/{
      DestroyImageInfo(__pyx_v_image_info);
      goto __pyx_L5;
    }
    /*exception exit:*/{
      __pyx_L4_error:;
      __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0; __pyx_t_14 = 0; __pyx_t_15 = 0; __pyx_t_16 = 0;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_14, &__pyx_t_15, &__pyx_t_16);
      if ((PY_MAJOR_VERSION < 3) || unlikely(__Pyx_GetException(&__pyx_t_11, &__pyx_t_12, &__pyx_t_13) < 0)) __Pyx_ErrFetch(&__pyx_t_11, &__pyx_t_12, &__pyx_t_13);
      __Pyx_XGOTREF(__pyx_t_11);
      __Pyx_XGOTREF(__pyx_t_12);
      __Pyx_XGOTREF(__pyx_t_13);
      __Pyx_XGOTREF(__pyx_t_14);
      __Pyx_XGOTREF(__pyx_t_15);
      __Pyx_XGOTREF(__pyx_t_16);
      __pyx_t_8 = __pyx_lineno; __pyx_t_9 = __pyx_clineno; __pyx_t_10 = __pyx_filename;
      {
        DestroyImageInfo(__pyx_v_image_info);
      }
      if (PY_MAJOR_VERSION >= 3) {
        __Pyx_XGIVEREF(__pyx_t_14);
        __Pyx_XGIVEREF(__pyx_t_15);
        __Pyx_XGIVEREF(__pyx_t_16);
        __Pyx_ExceptionReset(__pyx_t_14, __pyx_t_15, __pyx_t_16);
      }
      __Pyx_XGIVEREF(__pyx_t_11);
      __Pyx_XGIVEREF(__pyx_t_12);
      __Pyx_XGIVEREF(__pyx_t_13);
      __Pyx_ErrRestore(__pyx_t_11, __pyx_t_12, __pyx_t_13);
      __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0; __pyx_t_14 = 0; __pyx_t_15 = 0; __pyx_t_16 = 0;
      __pyx_lineno = __pyx_t_8; __pyx_clineno = __pyx_t_9; __pyx_filename = __pyx_t_10;
      goto __pyx_L1_error;
    }
    __pyx_L5:;
  }

  /* "sanpera/image.pyx":343
 *             c_api.DestroyImageInfo(image_info)
 * 
 *         self._post_init()             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_3 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_self->__pyx_vtab)->_post_init(__pyx_v_self); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "sanpera/image.pyx":344
 * 
 *         self._post_init()
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __pyx_r = ((PyObject *)__pyx_v_self);
  goto __pyx_L0;

  /* "sanpera/image.pyx":322
 * 
 *     @classmethod
 *     def new(type cls, size not None, *, RGBColor fill=None):             # <<<<<<<<<<<<<<
 *         """Create a new image (with one frame) of the given size."""
 *         size = Size.coerce(size)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.Image.new", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_self);
  __Pyx_XDECREF(__pyx_v_size);
  __Pyx_XDECREF((PyObject *)__pyx_v_fill);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":347
 * 
 *     @classmethod
 *     def read(type cls, bytes filename not None):             # <<<<<<<<<<<<<<
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "rb")
 *         if fh == NULL:
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_9read(PyObject *__pyx_v_cls, PyObject *__pyx_v_filename); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_9read(PyObject *__pyx_v_cls, PyObject *__pyx_v_filename) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("read (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_filename), (&PyBytes_Type), 0, "filename", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_8read(((PyObject*)__pyx_v_cls), ((PyObject*)__pyx_v_filename));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_8read(PyObject *__pyx_v_cls, PyObject *__pyx_v_filename) {
  FILE *__pyx_v_fh;
  ImageInfo *__pyx_v_image_info;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  int __pyx_v_ret;
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  char *__pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  char const *__pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("read", 0);

  /* "sanpera/image.pyx":348
 *     @classmethod
 *     def read(type cls, bytes filename not None):
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "rb")             # <<<<<<<<<<<<<<
 *         if fh == NULL:
 *             cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 */
  __pyx_t_1 = __Pyx_PyObject_AsString(__pyx_v_filename); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_fh = fopen(((char *)__pyx_t_1), __pyx_k_rb);

  /* "sanpera/image.pyx":349
 *     def read(type cls, bytes filename not None):
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "rb")
 *         if fh == NULL:             # <<<<<<<<<<<<<<
 *             cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 */
  __pyx_t_2 = ((__pyx_v_fh == NULL) != 0);
  if (__pyx_t_2) {

    /* "sanpera/image.pyx":350
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "rb")
 *         if fh == NULL:
 *             cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)             # <<<<<<<<<<<<<<
 * 
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 */
    __pyx_t_1 = __Pyx_PyObject_AsString(__pyx_v_filename); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 350; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_3 = PyErr_SetFromErrnoWithFilename(__pyx_builtin_IOError, __pyx_t_1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 350; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "sanpera/image.pyx":352
 *             cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)             # <<<<<<<<<<<<<<
 *         cdef MagickException exc = MagickException()
 *         cdef int ret
 */
  __pyx_v_image_info = CloneImageInfo(NULL);

  /* "sanpera/image.pyx":353
 * 
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 *         cdef int ret
 * 
 */
  __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "sanpera/image.pyx":356
 *         cdef int ret
 * 
 *         cdef Image self = cls()             # <<<<<<<<<<<<<<
 * 
 *         try:
 */
  __pyx_t_4 = PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_7sanpera_5image_Image))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_self = ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "sanpera/image.pyx":358
 *         cdef Image self = cls()
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             # Force reading from this file descriptor
 *             image_info.file = fh
 */
  /*try:*/ {

    /* "sanpera/image.pyx":360
 *         try:
 *             # Force reading from this file descriptor
 *             image_info.file = fh             # <<<<<<<<<<<<<<
 * 
 *             self._stack = c_api.ReadImage(image_info, exc.ptr)
 */
    __pyx_v_image_info->file = __pyx_v_fh;

    /* "sanpera/image.pyx":362
 *             image_info.file = fh
 * 
 *             self._stack = c_api.ReadImage(image_info, exc.ptr)             # <<<<<<<<<<<<<<
 *             exc.check()
 * 
 */
    __pyx_v_self->_stack = ReadImage(__pyx_v_image_info, __pyx_v_exc->ptr);

    /* "sanpera/image.pyx":363
 * 
 *             self._stack = c_api.ReadImage(image_info, exc.ptr)
 *             exc.check()             # <<<<<<<<<<<<<<
 * 
 *             # Blank out the filename so IM doesn't try to write to it later
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 363; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 363; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "sanpera/image.pyx":366
 * 
 *             # Blank out the filename so IM doesn't try to write to it later
 *             self._stack.filename[0] = <char>0             # <<<<<<<<<<<<<<
 *         finally:
 *             c_api.DestroyImageInfo(image_info)
 */
    (__pyx_v_self->_stack->filename[0]) = ((char)0);
  }

  /* "sanpera/image.pyx":368
 *             self._stack.filename[0] = <char>0
 *         finally:
 *             c_api.DestroyImageInfo(image_info)             # <<<<<<<<<<<<<<
 * 
 *             ret = libc.stdio.fclose(fh)
 */
  /*finally:*/ {
    /*normal exit:*/{
      DestroyImageInfo(__pyx_v_image_info);

      /* "sanpera/image.pyx":370
 *             c_api.DestroyImageInfo(image_info)
 * 
 *             ret = libc.stdio.fclose(fh)             # <<<<<<<<<<<<<<
 *             if ret != 0:
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 */
      __pyx_v_ret = fclose(__pyx_v_fh);

      /* "sanpera/image.pyx":371
 * 
 *             ret = libc.stdio.fclose(fh)
 *             if ret != 0:             # <<<<<<<<<<<<<<
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 */
      __pyx_t_2 = ((__pyx_v_ret != 0) != 0);
      if (__pyx_t_2) {

        /* "sanpera/image.pyx":372
 *             ret = libc.stdio.fclose(fh)
 *             if ret != 0:
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)             # <<<<<<<<<<<<<<
 * 
 *         self._post_init()
 */
        __pyx_t_1 = __Pyx_PyObject_AsString(__pyx_v_filename); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_3 = PyErr_SetFromErrnoWithFilename(__pyx_builtin_IOError, __pyx_t_1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L7;
      }
      __pyx_L7:;
      goto __pyx_L6;
    }
    /*exception exit:*/{
      __pyx_L5_error:;
      __pyx_t_9 = 0; __pyx_t_10 = 0; __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0; __pyx_t_14 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_12, &__pyx_t_13, &__pyx_t_14);
      if ((PY_MAJOR_VERSION < 3) || unlikely(__Pyx_GetException(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11) < 0)) __Pyx_ErrFetch(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
      __Pyx_XGOTREF(__pyx_t_9);
      __Pyx_XGOTREF(__pyx_t_10);
      __Pyx_XGOTREF(__pyx_t_11);
      __Pyx_XGOTREF(__pyx_t_12);
      __Pyx_XGOTREF(__pyx_t_13);
      __Pyx_XGOTREF(__pyx_t_14);
      __pyx_t_6 = __pyx_lineno; __pyx_t_7 = __pyx_clineno; __pyx_t_8 = __pyx_filename;
      {

        /* "sanpera/image.pyx":368
 *             self._stack.filename[0] = <char>0
 *         finally:
 *             c_api.DestroyImageInfo(image_info)             # <<<<<<<<<<<<<<
 * 
 *             ret = libc.stdio.fclose(fh)
 */
        DestroyImageInfo(__pyx_v_image_info);

        /* "sanpera/image.pyx":370
 *             c_api.DestroyImageInfo(image_info)
 * 
 *             ret = libc.stdio.fclose(fh)             # <<<<<<<<<<<<<<
 *             if ret != 0:
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 */
        __pyx_v_ret = fclose(__pyx_v_fh);

        /* "sanpera/image.pyx":371
 * 
 *             ret = libc.stdio.fclose(fh)
 *             if ret != 0:             # <<<<<<<<<<<<<<
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 */
        __pyx_t_2 = ((__pyx_v_ret != 0) != 0);
        if (__pyx_t_2) {

          /* "sanpera/image.pyx":372
 *             ret = libc.stdio.fclose(fh)
 *             if ret != 0:
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)             # <<<<<<<<<<<<<<
 * 
 *         self._post_init()
 */
          __pyx_t_1 = __Pyx_PyObject_AsString(__pyx_v_filename); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
          __pyx_t_3 = PyErr_SetFromErrnoWithFilename(__pyx_builtin_IOError, __pyx_t_1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
          goto __pyx_L10;
        }
        __pyx_L10:;
      }
      if (PY_MAJOR_VERSION >= 3) {
        __Pyx_XGIVEREF(__pyx_t_12);
        __Pyx_XGIVEREF(__pyx_t_13);
        __Pyx_XGIVEREF(__pyx_t_14);
        __Pyx_ExceptionReset(__pyx_t_12, __pyx_t_13, __pyx_t_14);
      }
      __Pyx_XGIVEREF(__pyx_t_9);
      __Pyx_XGIVEREF(__pyx_t_10);
      __Pyx_XGIVEREF(__pyx_t_11);
      __Pyx_ErrRestore(__pyx_t_9, __pyx_t_10, __pyx_t_11);
      __pyx_t_9 = 0; __pyx_t_10 = 0; __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0; __pyx_t_14 = 0;
      __pyx_lineno = __pyx_t_6; __pyx_clineno = __pyx_t_7; __pyx_filename = __pyx_t_8;
      goto __pyx_L1_error;
      __pyx_L9_error:;
      if (PY_MAJOR_VERSION >= 3) {
        __Pyx_XGIVEREF(__pyx_t_12);
        __Pyx_XGIVEREF(__pyx_t_13);
        __Pyx_XGIVEREF(__pyx_t_14);
        __Pyx_ExceptionReset(__pyx_t_12, __pyx_t_13, __pyx_t_14);
      }
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_12 = 0; __pyx_t_13 = 0; __pyx_t_14 = 0;
      goto __pyx_L1_error;
    }
    __pyx_L6:;
  }

  /* "sanpera/image.pyx":374
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 *         self._post_init()             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_5 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_self->__pyx_vtab)->_post_init(__pyx_v_self); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "sanpera/image.pyx":375
 * 
 *         self._post_init()
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __pyx_r = ((PyObject *)__pyx_v_self);
  goto __pyx_L0;

  /* "sanpera/image.pyx":347
 * 
 *     @classmethod
 *     def read(type cls, bytes filename not None):             # <<<<<<<<<<<<<<
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "rb")
 *         if fh == NULL:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("sanpera.image.Image.read", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XDECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":378
 * 
 *     @classmethod
 *     def from_buffer(type cls, bytes buf not None):             # <<<<<<<<<<<<<<
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 *         cdef MagickException exc = MagickException()
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_11from_buffer(PyObject *__pyx_v_cls, PyObject *__pyx_v_buf); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_11from_buffer(PyObject *__pyx_v_cls, PyObject *__pyx_v_buf) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("from_buffer (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_buf), (&PyBytes_Type), 0, "buf", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_10from_buffer(((PyObject*)__pyx_v_cls), ((PyObject*)__pyx_v_buf));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_10from_buffer(PyObject *__pyx_v_cls, PyObject *__pyx_v_buf) {
  ImageInfo *__pyx_v_image_info;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  char *__pyx_t_2;
  Py_ssize_t __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  char const *__pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("from_buffer", 0);

  /* "sanpera/image.pyx":379
 *     @classmethod
 *     def from_buffer(type cls, bytes buf not None):
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)             # <<<<<<<<<<<<<<
 *         cdef MagickException exc = MagickException()
 * 
 */
  __pyx_v_image_info = CloneImageInfo(NULL);

  /* "sanpera/image.pyx":380
 *     def from_buffer(type cls, bytes buf not None):
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 * 
 *         cdef Image self = cls()
 */
  __pyx_t_1 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":382
 *         cdef MagickException exc = MagickException()
 * 
 *         cdef Image self = cls()             # <<<<<<<<<<<<<<
 * 
 *         try:
 */
  __pyx_t_1 = PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7sanpera_5image_Image))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_self = ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":384
 *         cdef Image self = cls()
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             self._stack = c_api.BlobToImage(image_info, <void*><char*>buf, len(buf), exc.ptr)
 *             exc.check()
 */
  /*try:*/ {

    /* "sanpera/image.pyx":385
 * 
 *         try:
 *             self._stack = c_api.BlobToImage(image_info, <void*><char*>buf, len(buf), exc.ptr)             # <<<<<<<<<<<<<<
 *             exc.check()
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_buf); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __pyx_t_3 = PyBytes_GET_SIZE(__pyx_v_buf); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __pyx_v_self->_stack = BlobToImage(__pyx_v_image_info, ((void *)((char *)__pyx_t_2)), __pyx_t_3, __pyx_v_exc->ptr);

    /* "sanpera/image.pyx":386
 *         try:
 *             self._stack = c_api.BlobToImage(image_info, <void*><char*>buf, len(buf), exc.ptr)
 *             exc.check()             # <<<<<<<<<<<<<<
 * 
 *             # Blank out the filename so IM doesn't try to write to it later --
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "sanpera/image.pyx":391
 *             # yes, this is from an in-memory buffer, but sometimes IM will
 *             # write it to a tempfile to read it
 *             self._stack.filename[0] = <char>0             # <<<<<<<<<<<<<<
 *         finally:
 *             c_api.DestroyImageInfo(image_info)
 */
    (__pyx_v_self->_stack->filename[0]) = ((char)0);
  }

  /* "sanpera/image.pyx":393
 *             self._stack.filename[0] = <char>0
 *         finally:
 *             c_api.DestroyImageInfo(image_info)             # <<<<<<<<<<<<<<
 * 
 *         self._post_init()
 */
  /*finally:*/ {
    /*normal exit:*/{
      DestroyImageInfo(__pyx_v_image_info);
      goto __pyx_L5;
    }
    /*exception exit:*/{
      __pyx_L4_error:;
      __pyx_t_8 = 0; __pyx_t_9 = 0; __pyx_t_10 = 0; __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_11, &__pyx_t_12, &__pyx_t_13);
      if ((PY_MAJOR_VERSION < 3) || unlikely(__Pyx_GetException(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10) < 0)) __Pyx_ErrFetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
      __Pyx_XGOTREF(__pyx_t_8);
      __Pyx_XGOTREF(__pyx_t_9);
      __Pyx_XGOTREF(__pyx_t_10);
      __Pyx_XGOTREF(__pyx_t_11);
      __Pyx_XGOTREF(__pyx_t_12);
      __Pyx_XGOTREF(__pyx_t_13);
      __pyx_t_5 = __pyx_lineno; __pyx_t_6 = __pyx_clineno; __pyx_t_7 = __pyx_filename;
      {
        DestroyImageInfo(__pyx_v_image_info);
      }
      if (PY_MAJOR_VERSION >= 3) {
        __Pyx_XGIVEREF(__pyx_t_11);
        __Pyx_XGIVEREF(__pyx_t_12);
        __Pyx_XGIVEREF(__pyx_t_13);
        __Pyx_ExceptionReset(__pyx_t_11, __pyx_t_12, __pyx_t_13);
      }
      __Pyx_XGIVEREF(__pyx_t_8);
      __Pyx_XGIVEREF(__pyx_t_9);
      __Pyx_XGIVEREF(__pyx_t_10);
      __Pyx_ErrRestore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
      __pyx_t_8 = 0; __pyx_t_9 = 0; __pyx_t_10 = 0; __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0;
      __pyx_lineno = __pyx_t_5; __pyx_clineno = __pyx_t_6; __pyx_filename = __pyx_t_7;
      goto __pyx_L1_error;
    }
    __pyx_L5:;
  }

  /* "sanpera/image.pyx":395
 *             c_api.DestroyImageInfo(image_info)
 * 
 *         self._post_init()             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_4 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_self->__pyx_vtab)->_post_init(__pyx_v_self); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "sanpera/image.pyx":396
 * 
 *         self._post_init()
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __pyx_r = ((PyObject *)__pyx_v_self);
  goto __pyx_L0;

  /* "sanpera/image.pyx":378
 * 
 *     @classmethod
 *     def from_buffer(type cls, bytes buf not None):             # <<<<<<<<<<<<<<
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 *         cdef MagickException exc = MagickException()
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("sanpera.image.Image.from_buffer", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XDECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":399
 * 
 *     @classmethod
 *     def from_magick(type cls, bytes name not None):             # <<<<<<<<<<<<<<
 *         """Passes a filename specifier directly to ImageMagick.
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_13from_magick(PyObject *__pyx_v_cls, PyObject *__pyx_v_name); /*proto*/
static char __pyx_doc_7sanpera_5image_5Image_12from_magick[] = "Passes a filename specifier directly to ImageMagick.\n\n        This allows reading from any of the magic pseudo-formats, like\n        `clipboard` and `null`.  Use with care with user input!\n        ";
static PyObject *__pyx_pw_7sanpera_5image_5Image_13from_magick(PyObject *__pyx_v_cls, PyObject *__pyx_v_name) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("from_magick (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_name), (&PyBytes_Type), 0, "name", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 399; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_12from_magick(((PyObject*)__pyx_v_cls), ((PyObject*)__pyx_v_name));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_12from_magick(PyObject *__pyx_v_cls, PyObject *__pyx_v_name) {
  ImageInfo *__pyx_v_image_info;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  char *__pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  char const *__pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("from_magick", 0);

  /* "sanpera/image.pyx":405
 *         `clipboard` and `null`.  Use with care with user input!
 *         """
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)             # <<<<<<<<<<<<<<
 *         cdef MagickException exc = MagickException()
 * 
 */
  __pyx_v_image_info = CloneImageInfo(NULL);

  /* "sanpera/image.pyx":406
 *         """
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 * 
 *         cdef Image self = cls()
 */
  __pyx_t_1 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":408
 *         cdef MagickException exc = MagickException()
 * 
 *         cdef Image self = cls()             # <<<<<<<<<<<<<<
 * 
 *         try:
 */
  __pyx_t_1 = PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7sanpera_5image_Image))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_self = ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":410
 *         cdef Image self = cls()
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             libc_string.strncpy(image_info.filename, <char*>name, c_api.MaxTextExtent)
 * 
 */
  /*try:*/ {

    /* "sanpera/image.pyx":411
 * 
 *         try:
 *             libc_string.strncpy(image_info.filename, <char*>name, c_api.MaxTextExtent)             # <<<<<<<<<<<<<<
 * 
 *             self._stack = c_api.ReadImage(image_info, exc.ptr)
 */
    __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 411; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    strncpy(__pyx_v_image_info->filename, ((char *)__pyx_t_2), MaxTextExtent);

    /* "sanpera/image.pyx":413
 *             libc_string.strncpy(image_info.filename, <char*>name, c_api.MaxTextExtent)
 * 
 *             self._stack = c_api.ReadImage(image_info, exc.ptr)             # <<<<<<<<<<<<<<
 *             exc.check()
 * 
 */
    __pyx_v_self->_stack = ReadImage(__pyx_v_image_info, __pyx_v_exc->ptr);

    /* "sanpera/image.pyx":414
 * 
 *             self._stack = c_api.ReadImage(image_info, exc.ptr)
 *             exc.check()             # <<<<<<<<<<<<<<
 * 
 *             # Blank out the filename and format so IM doesn't try to write them
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 414; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 414; __pyx_clineno = __LINE__; goto __pyx_L4_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "sanpera/image.pyx":418
 *             # Blank out the filename and format so IM doesn't try to write them
 *             # later
 *             self._stack.filename[0] = <char>0             # <<<<<<<<<<<<<<
 *             self._stack.magick[0] = <char>0
 *         finally:
 */
    (__pyx_v_self->_stack->filename[0]) = ((char)0);

    /* "sanpera/image.pyx":419
 *             # later
 *             self._stack.filename[0] = <char>0
 *             self._stack.magick[0] = <char>0             # <<<<<<<<<<<<<<
 *         finally:
 *             c_api.DestroyImageInfo(image_info)
 */
    (__pyx_v_self->_stack->magick[0]) = ((char)0);
  }

  /* "sanpera/image.pyx":421
 *             self._stack.magick[0] = <char>0
 *         finally:
 *             c_api.DestroyImageInfo(image_info)             # <<<<<<<<<<<<<<
 * 
 *         self._post_init()
 */
  /*finally:*/ {
    /*normal exit:*/{
      DestroyImageInfo(__pyx_v_image_info);
      goto __pyx_L5;
    }
    /*exception exit:*/{
      __pyx_L4_error:;
      __pyx_t_7 = 0; __pyx_t_8 = 0; __pyx_t_9 = 0; __pyx_t_10 = 0; __pyx_t_11 = 0; __pyx_t_12 = 0;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
      if ((PY_MAJOR_VERSION < 3) || unlikely(__Pyx_GetException(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9) < 0)) __Pyx_ErrFetch(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
      __Pyx_XGOTREF(__pyx_t_7);
      __Pyx_XGOTREF(__pyx_t_8);
      __Pyx_XGOTREF(__pyx_t_9);
      __Pyx_XGOTREF(__pyx_t_10);
      __Pyx_XGOTREF(__pyx_t_11);
      __Pyx_XGOTREF(__pyx_t_12);
      __pyx_t_4 = __pyx_lineno; __pyx_t_5 = __pyx_clineno; __pyx_t_6 = __pyx_filename;
      {
        DestroyImageInfo(__pyx_v_image_info);
      }
      if (PY_MAJOR_VERSION >= 3) {
        __Pyx_XGIVEREF(__pyx_t_10);
        __Pyx_XGIVEREF(__pyx_t_11);
        __Pyx_XGIVEREF(__pyx_t_12);
        __Pyx_ExceptionReset(__pyx_t_10, __pyx_t_11, __pyx_t_12);
      }
      __Pyx_XGIVEREF(__pyx_t_7);
      __Pyx_XGIVEREF(__pyx_t_8);
      __Pyx_XGIVEREF(__pyx_t_9);
      __Pyx_ErrRestore(__pyx_t_7, __pyx_t_8, __pyx_t_9);
      __pyx_t_7 = 0; __pyx_t_8 = 0; __pyx_t_9 = 0; __pyx_t_10 = 0; __pyx_t_11 = 0; __pyx_t_12 = 0;
      __pyx_lineno = __pyx_t_4; __pyx_clineno = __pyx_t_5; __pyx_filename = __pyx_t_6;
      goto __pyx_L1_error;
    }
    __pyx_L5:;
  }

  /* "sanpera/image.pyx":423
 *             c_api.DestroyImageInfo(image_info)
 * 
 *         self._post_init()             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_3 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_self->__pyx_vtab)->_post_init(__pyx_v_self); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "sanpera/image.pyx":424
 * 
 *         self._post_init()
 *         return self             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __pyx_r = ((PyObject *)__pyx_v_self);
  goto __pyx_L0;

  /* "sanpera/image.pyx":399
 * 
 *     @classmethod
 *     def from_magick(type cls, bytes name not None):             # <<<<<<<<<<<<<<
 *         """Passes a filename specifier directly to ImageMagick.
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.Image.from_magick", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XDECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":431
 *     # TODO support the wacky sprintf style of dumping images out i guess
 * 
 *     def write(self, bytes filename not None, bytes format=None):             # <<<<<<<<<<<<<<
 *         if self._stack == NULL:
 *             raise EmptyImageError
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_15write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_15write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_filename = 0;
  PyObject *__pyx_v_format = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("write (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_filename,&__pyx_n_s_format,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject*)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_filename)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_format);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "write") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_filename = ((PyObject*)values[0]);
    __pyx_v_format = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("write", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("sanpera.image.Image.write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_filename), (&PyBytes_Type), 0, "filename", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_format), (&PyBytes_Type), 1, "format", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_14write(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self), __pyx_v_filename, __pyx_v_format);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_14write(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, PyObject *__pyx_v_filename, PyObject *__pyx_v_format) {
  FILE *__pyx_v_fh;
  ImageInfo *__pyx_v_image_info;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  char *__pyx_t_3;
  PyObject *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  char const *__pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("write", 0);

  /* "sanpera/image.pyx":432
 * 
 *     def write(self, bytes filename not None, bytes format=None):
 *         if self._stack == NULL:             # <<<<<<<<<<<<<<
 *             raise EmptyImageError
 * 
 */
  __pyx_t_1 = ((__pyx_v_self->_stack == NULL) != 0);
  if (__pyx_t_1) {

    /* "sanpera/image.pyx":433
 *     def write(self, bytes filename not None, bytes format=None):
 *         if self._stack == NULL:
 *             raise EmptyImageError             # <<<<<<<<<<<<<<
 * 
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "wb")
 */
    __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_EmptyImageError); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "sanpera/image.pyx":435
 *             raise EmptyImageError
 * 
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "wb")             # <<<<<<<<<<<<<<
 *         if fh == NULL:
 *             cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 */
  __pyx_t_3 = __Pyx_PyObject_AsString(__pyx_v_filename); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_fh = fopen(((char *)__pyx_t_3), __pyx_k_wb);

  /* "sanpera/image.pyx":436
 * 
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "wb")
 *         if fh == NULL:             # <<<<<<<<<<<<<<
 *             cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 */
  __pyx_t_1 = ((__pyx_v_fh == NULL) != 0);
  if (__pyx_t_1) {

    /* "sanpera/image.pyx":437
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "wb")
 *         if fh == NULL:
 *             cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)             # <<<<<<<<<<<<<<
 * 
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 */
    __pyx_t_3 = __Pyx_PyObject_AsString(__pyx_v_filename); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 437; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_4 = PyErr_SetFromErrnoWithFilename(__pyx_builtin_IOError, __pyx_t_3); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 437; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "sanpera/image.pyx":439
 *             cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)             # <<<<<<<<<<<<<<
 *         cdef int ret
 * 
 */
  __pyx_v_image_info = CloneImageInfo(NULL);

  /* "sanpera/image.pyx":442
 *         cdef int ret
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             # Force writing to this file descriptor
 *             image_info.file = fh
 */
  /*try:*/ {

    /* "sanpera/image.pyx":444
 *         try:
 *             # Force writing to this file descriptor
 *             image_info.file = fh             # <<<<<<<<<<<<<<
 * 
 *             # Force writing to a single file
 */
    __pyx_v_image_info->file = __pyx_v_fh;

    /* "sanpera/image.pyx":447
 * 
 *             # Force writing to a single file
 *             image_info.adjoin = c_api.MagickTrue             # <<<<<<<<<<<<<<
 * 
 *             if format:
 */
    __pyx_v_image_info->adjoin = MagickTrue;

    /* "sanpera/image.pyx":449
 *             image_info.adjoin = c_api.MagickTrue
 * 
 *             if format:             # <<<<<<<<<<<<<<
 *                 # If the caller provided an explicit format, pass it along
 *                 libc_string.strncpy(image_info.magick, <char*>format, c_api.MaxTextExtent)
 */
    __pyx_t_1 = (__pyx_v_format != Py_None) && (PyBytes_GET_SIZE(__pyx_v_format) != 0);
    if (__pyx_t_1) {

      /* "sanpera/image.pyx":451
 *             if format:
 *                 # If the caller provided an explicit format, pass it along
 *                 libc_string.strncpy(image_info.magick, <char*>format, c_api.MaxTextExtent)             # <<<<<<<<<<<<<<
 *             elif self._stack.magick[0] == <char>0:
 *                 # Uhoh; no format provided and nothing given by caller
 */
      __pyx_t_3 = __Pyx_PyObject_AsString(__pyx_v_format); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 451; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
      strncpy(__pyx_v_image_info->magick, ((char *)__pyx_t_3), MaxTextExtent);
      goto __pyx_L8;
    }

    /* "sanpera/image.pyx":452
 *                 # If the caller provided an explicit format, pass it along
 *                 libc_string.strncpy(image_info.magick, <char*>format, c_api.MaxTextExtent)
 *             elif self._stack.magick[0] == <char>0:             # <<<<<<<<<<<<<<
 *                 # Uhoh; no format provided and nothing given by caller
 *                 raise MissingFormatError
 */
    __pyx_t_1 = (((__pyx_v_self->_stack->magick[0]) == ((char)0)) != 0);
    if (__pyx_t_1) {

      /* "sanpera/image.pyx":454
 *             elif self._stack.magick[0] == <char>0:
 *                 # Uhoh; no format provided and nothing given by caller
 *                 raise MissingFormatError             # <<<<<<<<<<<<<<
 *             # TODO detect format from filename if explicitly asked to do so
 * 
 */
      __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_MissingFormatError); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
    }
    __pyx_L8:;

    /* "sanpera/image.pyx":457
 *             # TODO detect format from filename if explicitly asked to do so
 * 
 *             c_api.WriteImage(image_info, self._stack)             # <<<<<<<<<<<<<<
 *             check_magick_exception(&self._stack.exception)
 *         finally:
 */
    WriteImage(__pyx_v_image_info, __pyx_v_self->_stack);

    /* "sanpera/image.pyx":458
 * 
 *             c_api.WriteImage(image_info, self._stack)
 *             check_magick_exception(&self._stack.exception)             # <<<<<<<<<<<<<<
 *         finally:
 *             c_api.DestroyImageInfo(image_info)
 */
    __pyx_t_2 = __pyx_f_7sanpera_9exception_check_magick_exception((&__pyx_v_self->_stack->exception), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }

  /* "sanpera/image.pyx":460
 *             check_magick_exception(&self._stack.exception)
 *         finally:
 *             c_api.DestroyImageInfo(image_info)             # <<<<<<<<<<<<<<
 * 
 *             ret = libc.stdio.fclose(fh)
 */
  /*finally:*/ {
    /*normal exit:*/{
      DestroyImageInfo(__pyx_v_image_info);

      /* "sanpera/image.pyx":462
 *             c_api.DestroyImageInfo(image_info)
 * 
 *             ret = libc.stdio.fclose(fh)             # <<<<<<<<<<<<<<
 *             if ret != 0:
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 */
      __pyx_v_ret = fclose(__pyx_v_fh);

      /* "sanpera/image.pyx":463
 * 
 *             ret = libc.stdio.fclose(fh)
 *             if ret != 0:             # <<<<<<<<<<<<<<
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 */
      __pyx_t_1 = ((__pyx_v_ret != 0) != 0);
      if (__pyx_t_1) {

        /* "sanpera/image.pyx":464
 *             ret = libc.stdio.fclose(fh)
 *             if ret != 0:
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)             # <<<<<<<<<<<<<<
 * 
 *     def to_buffer(self, bytes format=None):
 */
        __pyx_t_3 = __Pyx_PyObject_AsString(__pyx_v_filename); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 464; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_4 = PyErr_SetFromErrnoWithFilename(__pyx_builtin_IOError, __pyx_t_3); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 464; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L9;
      }
      __pyx_L9:;
      goto __pyx_L7;
    }
    /*exception exit:*/{
      __pyx_L6_error:;
      __pyx_t_8 = 0; __pyx_t_9 = 0; __pyx_t_10 = 0; __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_11, &__pyx_t_12, &__pyx_t_13);
      if ((PY_MAJOR_VERSION < 3) || unlikely(__Pyx_GetException(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10) < 0)) __Pyx_ErrFetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
      __Pyx_XGOTREF(__pyx_t_8);
      __Pyx_XGOTREF(__pyx_t_9);
      __Pyx_XGOTREF(__pyx_t_10);
      __Pyx_XGOTREF(__pyx_t_11);
      __Pyx_XGOTREF(__pyx_t_12);
      __Pyx_XGOTREF(__pyx_t_13);
      __pyx_t_5 = __pyx_lineno; __pyx_t_6 = __pyx_clineno; __pyx_t_7 = __pyx_filename;
      {

        /* "sanpera/image.pyx":460
 *             check_magick_exception(&self._stack.exception)
 *         finally:
 *             c_api.DestroyImageInfo(image_info)             # <<<<<<<<<<<<<<
 * 
 *             ret = libc.stdio.fclose(fh)
 */
        DestroyImageInfo(__pyx_v_image_info);

        /* "sanpera/image.pyx":462
 *             c_api.DestroyImageInfo(image_info)
 * 
 *             ret = libc.stdio.fclose(fh)             # <<<<<<<<<<<<<<
 *             if ret != 0:
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 */
        __pyx_v_ret = fclose(__pyx_v_fh);

        /* "sanpera/image.pyx":463
 * 
 *             ret = libc.stdio.fclose(fh)
 *             if ret != 0:             # <<<<<<<<<<<<<<
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 */
        __pyx_t_1 = ((__pyx_v_ret != 0) != 0);
        if (__pyx_t_1) {

          /* "sanpera/image.pyx":464
 *             ret = libc.stdio.fclose(fh)
 *             if ret != 0:
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)             # <<<<<<<<<<<<<<
 * 
 *     def to_buffer(self, bytes format=None):
 */
          __pyx_t_3 = __Pyx_PyObject_AsString(__pyx_v_filename); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 464; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          __pyx_t_4 = PyErr_SetFromErrnoWithFilename(__pyx_builtin_IOError, __pyx_t_3); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 464; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          goto __pyx_L12;
        }
        __pyx_L12:;
      }
      if (PY_MAJOR_VERSION >= 3) {
        __Pyx_XGIVEREF(__pyx_t_11);
        __Pyx_XGIVEREF(__pyx_t_12);
        __Pyx_XGIVEREF(__pyx_t_13);
        __Pyx_ExceptionReset(__pyx_t_11, __pyx_t_12, __pyx_t_13);
      }
      __Pyx_XGIVEREF(__pyx_t_8);
      __Pyx_XGIVEREF(__pyx_t_9);
      __Pyx_XGIVEREF(__pyx_t_10);
      __Pyx_ErrRestore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
      __pyx_t_8 = 0; __pyx_t_9 = 0; __pyx_t_10 = 0; __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0;
      __pyx_lineno = __pyx_t_5; __pyx_clineno = __pyx_t_6; __pyx_filename = __pyx_t_7;
      goto __pyx_L1_error;
      __pyx_L11_error:;
      if (PY_MAJOR_VERSION >= 3) {
        __Pyx_XGIVEREF(__pyx_t_11);
        __Pyx_XGIVEREF(__pyx_t_12);
        __Pyx_XGIVEREF(__pyx_t_13);
        __Pyx_ExceptionReset(__pyx_t_11, __pyx_t_12, __pyx_t_13);
      }
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0;
      goto __pyx_L1_error;
    }
    __pyx_L7:;
  }

  /* "sanpera/image.pyx":431
 *     # TODO support the wacky sprintf style of dumping images out i guess
 * 
 *     def write(self, bytes filename not None, bytes format=None):             # <<<<<<<<<<<<<<
 *         if self._stack == NULL:
 *             raise EmptyImageError
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.Image.write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":466
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 *     def to_buffer(self, bytes format=None):             # <<<<<<<<<<<<<<
 *         if self._stack == NULL:
 *             raise EmptyImageError
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_17to_buffer(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_17to_buffer(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_format = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("to_buffer (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_format,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject*)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_format);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "to_buffer") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_format = ((PyObject*)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("to_buffer", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("sanpera.image.Image.to_buffer", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_format), (&PyBytes_Type), 1, "format", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_16to_buffer(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self), __pyx_v_format);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_16to_buffer(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, PyObject *__pyx_v_format) {
  ImageInfo *__pyx_v_image_info;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  size_t __pyx_v_length;
  unsigned char *__pyx_v_cbuf;
  PyObject *__pyx_v_buf = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_t_4;
  char *__pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  char const *__pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("to_buffer", 0);

  /* "sanpera/image.pyx":467
 * 
 *     def to_buffer(self, bytes format=None):
 *         if self._stack == NULL:             # <<<<<<<<<<<<<<
 *             raise EmptyImageError
 * 
 */
  __pyx_t_1 = ((__pyx_v_self->_stack == NULL) != 0);
  if (__pyx_t_1) {

    /* "sanpera/image.pyx":468
 *     def to_buffer(self, bytes format=None):
 *         if self._stack == NULL:
 *             raise EmptyImageError             # <<<<<<<<<<<<<<
 * 
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 */
    __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_EmptyImageError); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "sanpera/image.pyx":470
 *             raise EmptyImageError
 * 
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)             # <<<<<<<<<<<<<<
 *         cdef MagickException exc = MagickException()
 *         cdef size_t length = 0
 */
  __pyx_v_image_info = CloneImageInfo(NULL);

  /* "sanpera/image.pyx":471
 * 
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 *         cdef size_t length = 0
 *         cdef unsigned char* cbuf = NULL
 */
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "sanpera/image.pyx":472
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 *         cdef MagickException exc = MagickException()
 *         cdef size_t length = 0             # <<<<<<<<<<<<<<
 *         cdef unsigned char* cbuf = NULL
 *         cdef bytes buf
 */
  __pyx_v_length = 0;

  /* "sanpera/image.pyx":473
 *         cdef MagickException exc = MagickException()
 *         cdef size_t length = 0
 *         cdef unsigned char* cbuf = NULL             # <<<<<<<<<<<<<<
 *         cdef bytes buf
 * 
 */
  __pyx_v_cbuf = NULL;

  /* "sanpera/image.pyx":476
 *         cdef bytes buf
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             # Force writing to a single file
 *             image_info.adjoin = c_api.MagickTrue
 */
  /*try:*/ {

    /* "sanpera/image.pyx":478
 *         try:
 *             # Force writing to a single file
 *             image_info.adjoin = c_api.MagickTrue             # <<<<<<<<<<<<<<
 * 
 *             # Stupid hack to fix a bug in the rgb codec
 */
    __pyx_v_image_info->adjoin = MagickTrue;

    /* "sanpera/image.pyx":481
 * 
 *             # Stupid hack to fix a bug in the rgb codec
 *             if format == 'rgba' and not self._stack.matte:             # <<<<<<<<<<<<<<
 *                 c_api.SetImageAlphaChannel(self._stack, c_api.OpaqueAlphaChannel)
 *                 check_magick_exception(&self._stack.exception)
 */
    __pyx_t_1 = (__Pyx_PyBytes_Equals(__pyx_v_format, __pyx_n_s_rgba, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 481; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
    if ((__pyx_t_1 != 0)) {
      __pyx_t_3 = ((!__pyx_v_self->_stack->matte) != 0);
      __pyx_t_4 = __pyx_t_3;
    } else {
      __pyx_t_4 = (__pyx_t_1 != 0);
    }
    if (__pyx_t_4) {

      /* "sanpera/image.pyx":482
 *             # Stupid hack to fix a bug in the rgb codec
 *             if format == 'rgba' and not self._stack.matte:
 *                 c_api.SetImageAlphaChannel(self._stack, c_api.OpaqueAlphaChannel)             # <<<<<<<<<<<<<<
 *                 check_magick_exception(&self._stack.exception)
 * 
 */
      SetImageAlphaChannel(__pyx_v_self->_stack, OpaqueAlphaChannel);

      /* "sanpera/image.pyx":483
 *             if format == 'rgba' and not self._stack.matte:
 *                 c_api.SetImageAlphaChannel(self._stack, c_api.OpaqueAlphaChannel)
 *                 check_magick_exception(&self._stack.exception)             # <<<<<<<<<<<<<<
 * 
 *             if format:
 */
      __pyx_t_2 = __pyx_f_7sanpera_9exception_check_magick_exception((&__pyx_v_self->_stack->exception), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 483; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "sanpera/image.pyx":485
 *                 check_magick_exception(&self._stack.exception)
 * 
 *             if format:             # <<<<<<<<<<<<<<
 *                 # If the caller provided an explicit format, pass it along
 *                 libc_string.strncpy(image_info.magick, <char*>format, c_api.MaxTextExtent)
 */
    __pyx_t_4 = (__pyx_v_format != Py_None) && (PyBytes_GET_SIZE(__pyx_v_format) != 0);
    if (__pyx_t_4) {

      /* "sanpera/image.pyx":487
 *             if format:
 *                 # If the caller provided an explicit format, pass it along
 *                 libc_string.strncpy(image_info.magick, <char*>format, c_api.MaxTextExtent)             # <<<<<<<<<<<<<<
 *             elif self._stack.magick[0] == <char>0:
 *                 # Uhoh; no format provided and nothing given by caller
 */
      __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_format); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      strncpy(__pyx_v_image_info->magick, ((char *)__pyx_t_5), MaxTextExtent);
      goto __pyx_L8;
    }

    /* "sanpera/image.pyx":488
 *                 # If the caller provided an explicit format, pass it along
 *                 libc_string.strncpy(image_info.magick, <char*>format, c_api.MaxTextExtent)
 *             elif self._stack.magick[0] == <char>0:             # <<<<<<<<<<<<<<
 *                 # Uhoh; no format provided and nothing given by caller
 *                 raise MissingFormatError
 */
    __pyx_t_4 = (((__pyx_v_self->_stack->magick[0]) == ((char)0)) != 0);
    if (__pyx_t_4) {

      /* "sanpera/image.pyx":490
 *             elif self._stack.magick[0] == <char>0:
 *                 # Uhoh; no format provided and nothing given by caller
 *                 raise MissingFormatError             # <<<<<<<<<<<<<<
 * 
 *             cbuf = c_api.ImagesToBlob(image_info, self._stack, &length, exc.ptr)
 */
      __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_MissingFormatError); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
    }
    __pyx_L8:;

    /* "sanpera/image.pyx":492
 *                 raise MissingFormatError
 * 
 *             cbuf = c_api.ImagesToBlob(image_info, self._stack, &length, exc.ptr)             # <<<<<<<<<<<<<<
 *             exc.check()
 * 
 */
    __pyx_v_cbuf = ImagesToBlob(__pyx_v_image_info, __pyx_v_self->_stack, (&__pyx_v_length), __pyx_v_exc->ptr);

    /* "sanpera/image.pyx":493
 * 
 *             cbuf = c_api.ImagesToBlob(image_info, self._stack, &length, exc.ptr)
 *             exc.check()             # <<<<<<<<<<<<<<
 * 
 *             buf = cbuf[:length]
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 493; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = PyObject_Call(__pyx_t_2, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 493; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "sanpera/image.pyx":495
 *             exc.check()
 * 
 *             buf = cbuf[:length]             # <<<<<<<<<<<<<<
 *             c_api.RelinquishMagickMemory(cbuf)
 *             return buf
 */
    __pyx_t_6 = __Pyx_PyBytes_FromStringAndSize(((const char*)__pyx_v_cbuf) + 0, __pyx_v_length - 0); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_v_buf = ((PyObject*)__pyx_t_6);
    __pyx_t_6 = 0;

    /* "sanpera/image.pyx":496
 * 
 *             buf = cbuf[:length]
 *             c_api.RelinquishMagickMemory(cbuf)             # <<<<<<<<<<<<<<
 *             return buf
 *         finally:
 */
    RelinquishMagickMemory(__pyx_v_cbuf);

    /* "sanpera/image.pyx":497
 *             buf = cbuf[:length]
 *             c_api.RelinquishMagickMemory(cbuf)
 *             return buf             # <<<<<<<<<<<<<<
 *         finally:
 *             c_api.DestroyImageInfo(image_info)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_buf);
    __pyx_r = __pyx_v_buf;
    goto __pyx_L4_return;
  }

  /* "sanpera/image.pyx":499
 *             return buf
 *         finally:
 *             c_api.DestroyImageInfo(image_info)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  /*finally:*/ {
    /*exception exit:*/{
      __pyx_L5_error:;
      __pyx_t_10 = 0; __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0; __pyx_t_14 = 0; __pyx_t_15 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
      if ((PY_MAJOR_VERSION < 3) || unlikely(__Pyx_GetException(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12) < 0)) __Pyx_ErrFetch(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
      __Pyx_XGOTREF(__pyx_t_10);
      __Pyx_XGOTREF(__pyx_t_11);
      __Pyx_XGOTREF(__pyx_t_12);
      __Pyx_XGOTREF(__pyx_t_13);
      __Pyx_XGOTREF(__pyx_t_14);
      __Pyx_XGOTREF(__pyx_t_15);
      __pyx_t_7 = __pyx_lineno; __pyx_t_8 = __pyx_clineno; __pyx_t_9 = __pyx_filename;
      {
        DestroyImageInfo(__pyx_v_image_info);
      }
      if (PY_MAJOR_VERSION >= 3) {
        __Pyx_XGIVEREF(__pyx_t_13);
        __Pyx_XGIVEREF(__pyx_t_14);
        __Pyx_XGIVEREF(__pyx_t_15);
        __Pyx_ExceptionReset(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __Pyx_XGIVEREF(__pyx_t_10);
      __Pyx_XGIVEREF(__pyx_t_11);
      __Pyx_XGIVEREF(__pyx_t_12);
      __Pyx_ErrRestore(__pyx_t_10, __pyx_t_11, __pyx_t_12);
      __pyx_t_10 = 0; __pyx_t_11 = 0; __pyx_t_12 = 0; __pyx_t_13 = 0; __pyx_t_14 = 0; __pyx_t_15 = 0;
      __pyx_lineno = __pyx_t_7; __pyx_clineno = __pyx_t_8; __pyx_filename = __pyx_t_9;
      goto __pyx_L1_error;
    }
    __pyx_L4_return: {
      __pyx_t_15 = __pyx_r;
      __pyx_r = 0;
      DestroyImageInfo(__pyx_v_image_info);
      __pyx_r = __pyx_t_15;
      __pyx_t_15 = 0;
      goto __pyx_L0;
    }
  }

  /* "sanpera/image.pyx":466
 *                 cpython.exc.PyErr_SetFromErrnoWithFilename(IOError, filename)
 * 
 *     def to_buffer(self, bytes format=None):             # <<<<<<<<<<<<<<
 *         if self._stack == NULL:
 *             raise EmptyImageError
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("sanpera.image.Image.to_buffer", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XDECREF(__pyx_v_buf);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":504
 *     ### cdef utilities
 * 
 *     cdef _post_init(self):             # <<<<<<<<<<<<<<
 *         """Do some setup that only needs doing after a stack of images has been
 *         loaded.
 */

static PyObject *__pyx_f_7sanpera_5image_5Image__post_init(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("_post_init", 0);

  /* "sanpera/image.pyx":510
 *         Please don't forget to call me.  :)
 *         """
 *         self._setup_frames()             # <<<<<<<<<<<<<<
 *         self._fix_page()
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_self->__pyx_vtab)->_setup_frames(__pyx_v_self, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 510; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":511
 *         """
 *         self._setup_frames()
 *         self._fix_page()             # <<<<<<<<<<<<<<
 * 
 *     cdef _setup_frames(self, c_api.Image* start = NULL):
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_self->__pyx_vtab)->_fix_page(__pyx_v_self); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":504
 *     ### cdef utilities
 * 
 *     cdef _post_init(self):             # <<<<<<<<<<<<<<
 *         """Do some setup that only needs doing after a stack of images has been
 *         loaded.
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.Image._post_init", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":513
 *         self._fix_page()
 * 
 *     cdef _setup_frames(self, c_api.Image* start = NULL):             # <<<<<<<<<<<<<<
 *         # Shared by constructors to read the frame list out of the new image
 *         assert not self._frames
 */

static PyObject *__pyx_f_7sanpera_5image_5Image__setup_frames(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, struct __pyx_opt_args_7sanpera_5image_5Image__setup_frames *__pyx_optional_args) {
  Image *__pyx_v_start = ((Image *)NULL);
  Image *__pyx_v_p;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  Image *__pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("_setup_frames", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_start = __pyx_optional_args->start;
    }
  }

  /* "sanpera/image.pyx":515
 *     cdef _setup_frames(self, c_api.Image* start = NULL):
 *         # Shared by constructors to read the frame list out of the new image
 *         assert not self._frames             # <<<<<<<<<<<<<<
 * 
 *         cdef c_api.Image* p
 */
  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(!Py_OptimizeFlag)) {
    __pyx_t_1 = (__pyx_v_self->_frames != Py_None) && (PyList_GET_SIZE(__pyx_v_self->_frames) != 0);
    if (unlikely(!((!__pyx_t_1) != 0))) {
      PyErr_SetNone(PyExc_AssertionError);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 515; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
  }
  #endif

  /* "sanpera/image.pyx":519
 *         cdef c_api.Image* p
 * 
 *         if start:             # <<<<<<<<<<<<<<
 *             p = start
 *         else:
 */
  __pyx_t_1 = (__pyx_v_start != 0);
  if (__pyx_t_1) {

    /* "sanpera/image.pyx":520
 * 
 *         if start:
 *             p = start             # <<<<<<<<<<<<<<
 *         else:
 *             p = self._stack
 */
    __pyx_v_p = __pyx_v_start;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "sanpera/image.pyx":522
 *             p = start
 *         else:
 *             p = self._stack             # <<<<<<<<<<<<<<
 * 
 *         while p:
 */
    __pyx_t_2 = __pyx_v_self->_stack;
    __pyx_v_p = __pyx_t_2;
  }
  __pyx_L3:;

  /* "sanpera/image.pyx":524
 *             p = self._stack
 * 
 *         while p:             # <<<<<<<<<<<<<<
 *             self._frames.append(_ImageFrame_factory(p))
 *             p = c_api.GetNextImageInList(p)
 */
  while (1) {
    __pyx_t_1 = (__pyx_v_p != 0);
    if (!__pyx_t_1) break;

    /* "sanpera/image.pyx":525
 * 
 *         while p:
 *             self._frames.append(_ImageFrame_factory(p))             # <<<<<<<<<<<<<<
 *             p = c_api.GetNextImageInList(p)
 * 
 */
    if (unlikely(__pyx_v_self->_frames == Py_None)) {
      PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "append");
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __pyx_t_3 = ((PyObject *)__pyx_f_7sanpera_5image__ImageFrame_factory(__pyx_v_p)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_self->_frames, __pyx_t_3); if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "sanpera/image.pyx":526
 *         while p:
 *             self._frames.append(_ImageFrame_factory(p))
 *             p = c_api.GetNextImageInList(p)             # <<<<<<<<<<<<<<
 * 
 *     cdef _fix_page(self):
 */
    __pyx_v_p = GetNextImageInList(__pyx_v_p);
  }

  /* "sanpera/image.pyx":513
 *         self._fix_page()
 * 
 *     cdef _setup_frames(self, c_api.Image* start = NULL):             # <<<<<<<<<<<<<<
 *         # Shared by constructors to read the frame list out of the new image
 *         assert not self._frames
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.Image._setup_frames", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":528
 *             p = c_api.GetNextImageInList(p)
 * 
 *     cdef _fix_page(self):             # <<<<<<<<<<<<<<
 *         """Sometimes, the page is 0x0.  This is totally bogus.  Fix it."""
 *         cdef ImageFrame frame
 */

static PyObject *__pyx_f_7sanpera_5image_5Image__fix_page(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_frame = 0;
  Image *__pyx_v_c_frame;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  Image *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  unsigned long __pyx_t_8;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("_fix_page", 0);

  /* "sanpera/image.pyx":533
 *         cdef c_api.Image* c_frame
 * 
 *         for frame in self._frames:             # <<<<<<<<<<<<<<
 *             c_frame = frame._frame
 *             if c_frame.page.width == 0 or c_frame.page.height == 0:
 */
  if (unlikely(__pyx_v_self->_frames == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_t_1 = __pyx_v_self->_frames; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
  for (;;) {
    if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #else
    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #endif
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7sanpera_5image_ImageFrame))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_frame, ((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "sanpera/image.pyx":534
 * 
 *         for frame in self._frames:
 *             c_frame = frame._frame             # <<<<<<<<<<<<<<
 *             if c_frame.page.width == 0 or c_frame.page.height == 0:
 *                 c_frame.page.width = c_frame.columns
 */
    __pyx_t_4 = __pyx_v_frame->_frame;
    __pyx_v_c_frame = __pyx_t_4;

    /* "sanpera/image.pyx":535
 *         for frame in self._frames:
 *             c_frame = frame._frame
 *             if c_frame.page.width == 0 or c_frame.page.height == 0:             # <<<<<<<<<<<<<<
 *                 c_frame.page.width = c_frame.columns
 *                 c_frame.page.height = c_frame.rows
 */
    __pyx_t_5 = ((__pyx_v_c_frame->page.width == 0) != 0);
    if (!__pyx_t_5) {
      __pyx_t_6 = ((__pyx_v_c_frame->page.height == 0) != 0);
      __pyx_t_7 = __pyx_t_6;
    } else {
      __pyx_t_7 = __pyx_t_5;
    }
    if (__pyx_t_7) {

      /* "sanpera/image.pyx":536
 *             c_frame = frame._frame
 *             if c_frame.page.width == 0 or c_frame.page.height == 0:
 *                 c_frame.page.width = c_frame.columns             # <<<<<<<<<<<<<<
 *                 c_frame.page.height = c_frame.rows
 * 
 */
      __pyx_t_8 = __pyx_v_c_frame->columns;
      __pyx_v_c_frame->page.width = __pyx_t_8;

      /* "sanpera/image.pyx":537
 *             if c_frame.page.width == 0 or c_frame.page.height == 0:
 *                 c_frame.page.width = c_frame.columns
 *                 c_frame.page.height = c_frame.rows             # <<<<<<<<<<<<<<
 * 
 *         # TODO other page problems are possible, especially when adopting new frames
 */
      __pyx_t_8 = __pyx_v_c_frame->rows;
      __pyx_v_c_frame->page.height = __pyx_t_8;
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":528
 *             p = c_api.GetNextImageInList(p)
 * 
 *     cdef _fix_page(self):             # <<<<<<<<<<<<<<
 *         """Sometimes, the page is 0x0.  This is totally bogus.  Fix it."""
 *         cdef ImageFrame frame
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.Image._fix_page", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_frame);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":547
 *     ### Sequence operations
 * 
 *     def __len__(self):             # <<<<<<<<<<<<<<
 *         # TODO optimize/cache?
 *         return c_api.GetImageListLength(self._stack)
 */

/* Python wrapper */
static Py_ssize_t __pyx_pw_7sanpera_5image_5Image_19__len__(PyObject *__pyx_v_self); /*proto*/
static Py_ssize_t __pyx_pw_7sanpera_5image_5Image_19__len__(PyObject *__pyx_v_self) {
  Py_ssize_t __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__len__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_18__len__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static Py_ssize_t __pyx_pf_7sanpera_5image_5Image_18__len__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  Py_ssize_t __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__len__", 0);

  /* "sanpera/image.pyx":549
 *     def __len__(self):
 *         # TODO optimize/cache?
 *         return c_api.GetImageListLength(self._stack)             # <<<<<<<<<<<<<<
 * 
 *     def __nonzero__(self):
 */
  __pyx_r = GetImageListLength(__pyx_v_self->_stack);
  goto __pyx_L0;

  /* "sanpera/image.pyx":547
 *     ### Sequence operations
 * 
 *     def __len__(self):             # <<<<<<<<<<<<<<
 *         # TODO optimize/cache?
 *         return c_api.GetImageListLength(self._stack)
 */

  /* function exit code */
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":551
 *         return c_api.GetImageListLength(self._stack)
 * 
 *     def __nonzero__(self):             # <<<<<<<<<<<<<<
 *         return self._stack != NULL
 * 
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_5Image_21__nonzero__(PyObject *__pyx_v_self); /*proto*/
static int __pyx_pw_7sanpera_5image_5Image_21__nonzero__(PyObject *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__nonzero__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_20__nonzero__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_5Image_20__nonzero__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__nonzero__", 0);

  /* "sanpera/image.pyx":552
 * 
 *     def __nonzero__(self):
 *         return self._stack != NULL             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
  __pyx_r = (__pyx_v_self->_stack != NULL);
  goto __pyx_L0;

  /* "sanpera/image.pyx":551
 *         return c_api.GetImageListLength(self._stack)
 * 
 *     def __nonzero__(self):             # <<<<<<<<<<<<<<
 *         return self._stack != NULL
 * 
 */

  /* function exit code */
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_7sanpera_5image_5Image_24generator1(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* "sanpera/image.pyx":554
 *         return self._stack != NULL
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         cdef ImageFrame frame
 *         for frame in self._frames:
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_23__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_23__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_22__iter__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_22__iter__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__iter__", 0);
  __pyx_cur_scope = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *)__pyx_tp_new_7sanpera_5image___pyx_scope_struct_1___iter__(__pyx_ptype_7sanpera_5image___pyx_scope_struct_1___iter__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  {
    __pyx_GeneratorObject *gen = __Pyx_Generator_New((__pyx_generator_body_t) __pyx_gb_7sanpera_5image_5Image_24generator1, (PyObject *) __pyx_cur_scope); if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("sanpera.image.Image.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_7sanpera_5image_5Image_24generator1(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *__pyx_cur_scope = ((struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("None", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L6_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":556
 *     def __iter__(self):
 *         cdef ImageFrame frame
 *         for frame in self._frames:             # <<<<<<<<<<<<<<
 *             yield frame
 * 
 */
  if (unlikely(__pyx_cur_scope->__pyx_v_self->_frames == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->_frames; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
  for (;;) {
    if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #else
    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #endif
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7sanpera_5image_ImageFrame))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XGOTREF(((PyObject *)__pyx_cur_scope->__pyx_v_frame));
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_frame, ((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_t_3));
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;

    /* "sanpera/image.pyx":557
 *         cdef ImageFrame frame
 *         for frame in self._frames:
 *             yield frame             # <<<<<<<<<<<<<<
 * 
 *     def __getitem__(self, key):
 */
    __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_frame));
    __pyx_r = ((PyObject *)__pyx_cur_scope->__pyx_v_frame);
    __Pyx_XGIVEREF(__pyx_t_1);
    __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
    __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
    __pyx_cur_scope->__pyx_t_0 = 0;
    __Pyx_XGOTREF(__pyx_t_1);
    __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
    if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":554
 *         return self._stack != NULL
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         cdef ImageFrame frame
 *         for frame in self._frames:
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_generator->resume_label = -1;
  __Pyx_Generator_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return NULL;
}

/* "sanpera/image.pyx":559
 *             yield frame
 * 
 *     def __getitem__(self, key):             # <<<<<<<<<<<<<<
 *         return self._frames[key]
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_26__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_key); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_26__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__getitem__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_25__getitem__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self), ((PyObject *)__pyx_v_key));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_25__getitem__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, PyObject *__pyx_v_key) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__getitem__", 0);

  /* "sanpera/image.pyx":560
 * 
 *     def __getitem__(self, key):
 *         return self._frames[key]             # <<<<<<<<<<<<<<
 * 
 *     # TODO
 */
  __Pyx_XDECREF(__pyx_r);
  if (unlikely(__pyx_v_self->_frames == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_t_1 = PyObject_GetItem(__pyx_v_self->_frames, __pyx_v_key); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 560; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":559
 *             yield frame
 * 
 *     def __getitem__(self, key):             # <<<<<<<<<<<<<<
 *         return self._frames[key]
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.Image.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":567
 * 
 *     # TODO turn all this stuff into a single get/set slice interface?
 *     def append(self, ImageFrame other):             # <<<<<<<<<<<<<<
 *         """Appends a copy of the given frame to this image."""
 *         cdef c_api.Image* cloned_frame
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_28append(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
static char __pyx_doc_7sanpera_5image_5Image_27append[] = "Appends a copy of the given frame to this image.";
static PyObject *__pyx_pw_7sanpera_5image_5Image_28append(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("append (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_other), __pyx_ptype_7sanpera_5image_ImageFrame, 1, "other", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_27append(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self), ((struct __pyx_obj_7sanpera_5image_ImageFrame *)__pyx_v_other));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_27append(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, struct __pyx_obj_7sanpera_5image_ImageFrame *__pyx_v_other) {
  Image *__pyx_v_cloned_frame;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("append", 0);

  /* "sanpera/image.pyx":570
 *         """Appends a copy of the given frame to this image."""
 *         cdef c_api.Image* cloned_frame
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 * 
 *         # 0, 0 => size; 0x0 means to reuse the same pixel cache
 */
  __pyx_t_1 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":574
 *         # 0, 0 => size; 0x0 means to reuse the same pixel cache
 *         # 1 => orphan; clear the previous/next pointers
 *         cloned_frame = c_api.CloneImage(other._frame, 0, 0, 1, exc.ptr)             # <<<<<<<<<<<<<<
 *         exc.check()
 * 
 */
  __pyx_v_cloned_frame = CloneImage(__pyx_v_other->_frame, 0, 0, 1, __pyx_v_exc->ptr);

  /* "sanpera/image.pyx":575
 *         # 1 => orphan; clear the previous/next pointers
 *         cloned_frame = c_api.CloneImage(other._frame, 0, 0, 1, exc.ptr)
 *         exc.check()             # <<<<<<<<<<<<<<
 * 
 *         c_api.AppendImageToList(&self._stack, cloned_frame)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "sanpera/image.pyx":577
 *         exc.check()
 * 
 *         c_api.AppendImageToList(&self._stack, cloned_frame)             # <<<<<<<<<<<<<<
 *         self._frames.append(_ImageFrame_factory(cloned_frame))
 * 
 */
  AppendImageToList((&__pyx_v_self->_stack), __pyx_v_cloned_frame);

  /* "sanpera/image.pyx":578
 * 
 *         c_api.AppendImageToList(&self._stack, cloned_frame)
 *         self._frames.append(_ImageFrame_factory(cloned_frame))             # <<<<<<<<<<<<<<
 * 
 *     def extend(self, Image other not None):
 */
  if (unlikely(__pyx_v_self->_frames == Py_None)) {
    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "append");
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 578; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_t_2 = ((PyObject *)__pyx_f_7sanpera_5image__ImageFrame_factory(__pyx_v_cloned_frame)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 578; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyList_Append(__pyx_v_self->_frames, __pyx_t_2); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 578; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "sanpera/image.pyx":567
 * 
 *     # TODO turn all this stuff into a single get/set slice interface?
 *     def append(self, ImageFrame other):             # <<<<<<<<<<<<<<
 *         """Appends a copy of the given frame to this image."""
 *         cdef c_api.Image* cloned_frame
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.Image.append", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":580
 *         self._frames.append(_ImageFrame_factory(cloned_frame))
 * 
 *     def extend(self, Image other not None):             # <<<<<<<<<<<<<<
 *         """Appends a copy of each of the given image's frames to this image."""
 *         cdef c_api.Image* cloned_stack
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_30extend(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
static char __pyx_doc_7sanpera_5image_5Image_29extend[] = "Appends a copy of each of the given image's frames to this image.";
static PyObject *__pyx_pw_7sanpera_5image_5Image_30extend(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("extend (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_other), __pyx_ptype_7sanpera_5image_Image, 0, "other", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_29extend(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self), ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_other));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_29extend(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, struct __pyx_obj_7sanpera_5image_Image *__pyx_v_other) {
  Image *__pyx_v_cloned_stack;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  struct __pyx_opt_args_7sanpera_5image_5Image__setup_frames __pyx_t_3;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("extend", 0);

  /* "sanpera/image.pyx":583
 *         """Appends a copy of each of the given image's frames to this image."""
 *         cdef c_api.Image* cloned_stack
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 * 
 *         cloned_stack = c_api.CloneImageList(other._stack, exc.ptr)
 */
  __pyx_t_1 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":585
 *         cdef MagickException exc = MagickException()
 * 
 *         cloned_stack = c_api.CloneImageList(other._stack, exc.ptr)             # <<<<<<<<<<<<<<
 *         exc.check()
 * 
 */
  __pyx_v_cloned_stack = CloneImageList(__pyx_v_other->_stack, __pyx_v_exc->ptr);

  /* "sanpera/image.pyx":586
 * 
 *         cloned_stack = c_api.CloneImageList(other._stack, exc.ptr)
 *         exc.check()             # <<<<<<<<<<<<<<
 * 
 *         c_api.AppendImageToList(&self._stack, cloned_stack)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 586; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 586; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "sanpera/image.pyx":588
 *         exc.check()
 * 
 *         c_api.AppendImageToList(&self._stack, cloned_stack)             # <<<<<<<<<<<<<<
 *         self._setup_frames(cloned_stack)
 * 
 */
  AppendImageToList((&__pyx_v_self->_stack), __pyx_v_cloned_stack);

  /* "sanpera/image.pyx":589
 * 
 *         c_api.AppendImageToList(&self._stack, cloned_stack)
 *         self._setup_frames(cloned_stack)             # <<<<<<<<<<<<<<
 * 
 *     def consume(self, Image other not None):
 */
  __pyx_t_3.__pyx_n = 1;
  __pyx_t_3.start = __pyx_v_cloned_stack;
  __pyx_t_2 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_self->__pyx_vtab)->_setup_frames(__pyx_v_self, &__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "sanpera/image.pyx":580
 *         self._frames.append(_ImageFrame_factory(cloned_frame))
 * 
 *     def extend(self, Image other not None):             # <<<<<<<<<<<<<<
 *         """Appends a copy of each of the given image's frames to this image."""
 *         cdef c_api.Image* cloned_stack
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.Image.extend", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":591
 *         self._setup_frames(cloned_stack)
 * 
 *     def consume(self, Image other not None):             # <<<<<<<<<<<<<<
 *         """Similar to `extend`, but also removes the frames from the other
 *         image, leaving it empty.  The advantage is that the frames don't need
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_32consume(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
static char __pyx_doc_7sanpera_5image_5Image_31consume[] = "Similar to `extend`, but also removes the frames from the other\n        image, leaving it empty.  The advantage is that the frames don't need\n        to be copied, so this is a little more efficient when loading many\n        separate images and operating on them as a whole, as with `convert`.\n        ";
static PyObject *__pyx_pw_7sanpera_5image_5Image_32consume(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("consume (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_other), __pyx_ptype_7sanpera_5image_Image, 0, "other", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 591; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_31consume(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self), ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_other));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_31consume(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, struct __pyx_obj_7sanpera_5image_Image *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("consume", 0);

  /* "sanpera/image.pyx":597
 *         separate images and operating on them as a whole, as with `convert`.
 *         """
 *         c_api.AppendImageToList(&self._stack, other._stack)             # <<<<<<<<<<<<<<
 *         self._frames.extend(other._frames)
 * 
 */
  AppendImageToList((&__pyx_v_self->_stack), __pyx_v_other->_stack);

  /* "sanpera/image.pyx":598
 *         """
 *         c_api.AppendImageToList(&self._stack, other._stack)
 *         self._frames.extend(other._frames)             # <<<<<<<<<<<<<<
 * 
 *         other._stack = NULL
 */
  if (unlikely(__pyx_v_self->_frames == Py_None)) {
    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "extend");
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_t_1 = __pyx_v_other->_frames;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyList_Extend(__pyx_v_self->_frames, __pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":600
 *         self._frames.extend(other._frames)
 * 
 *         other._stack = NULL             # <<<<<<<<<<<<<<
 *         other._frames = []
 * 
 */
  __pyx_v_other->_stack = NULL;

  /* "sanpera/image.pyx":601
 * 
 *         other._stack = NULL
 *         other._frames = []             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 601; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_other->_frames);
  __Pyx_DECREF(__pyx_v_other->_frames);
  __pyx_v_other->_frames = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":591
 *         self._setup_frames(cloned_stack)
 * 
 *     def consume(self, Image other not None):             # <<<<<<<<<<<<<<
 *         """Similar to `extend`, but also removes the frames from the other
 *         image, leaving it empty.  The advantage is that the frames don't need
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.Image.consume", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":610
 *     # TODO anyway, conclusion of that thought was that sticking frames onto other images should do more than just diddle pointers
 *     @property
 *     def original_format(self):             # <<<<<<<<<<<<<<
 *         return self._stack.magick
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_34original_format(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_34original_format(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("original_format (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_33original_format(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_33original_format(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("original_format", 0);

  /* "sanpera/image.pyx":611
 *     @property
 *     def original_format(self):
 *         return self._stack.magick             # <<<<<<<<<<<<<<
 * 
 *     property size:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_self->_stack->magick); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 611; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":610
 *     # TODO anyway, conclusion of that thought was that sticking frames onto other images should do more than just diddle pointers
 *     @property
 *     def original_format(self):             # <<<<<<<<<<<<<<
 *         return self._stack.magick
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.Image.original_format", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":623
 *         """
 * 
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             # Note that this doesn't use the rows+columns; the size of the
 *             # ENTIRE IMAGE is the size of the virtual canvas.
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_4size_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_4size_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_4size___get__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_4size___get__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);

  /* "sanpera/image.pyx":628
 *             # TODO the canvas might be different between different frames!  see
 *             # if this happens on load, try to preserve it with operations
 *             if self._stack == NULL:             # <<<<<<<<<<<<<<
 *                 return Size(0, 0)
 * 
 */
  __pyx_t_1 = ((__pyx_v_self->_stack == NULL) != 0);
  if (__pyx_t_1) {

    /* "sanpera/image.pyx":629
 *             # if this happens on load, try to preserve it with operations
 *             if self._stack == NULL:
 *                 return Size(0, 0)             # <<<<<<<<<<<<<<
 * 
 *             return Size(self._stack.page.width, self._stack.page.height)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_8geometry_Size)), __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 629; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }

  /* "sanpera/image.pyx":631
 *                 return Size(0, 0)
 * 
 *             return Size(self._stack.page.width, self._stack.page.height)             # <<<<<<<<<<<<<<
 * 
 *     property has_canvas:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->_stack->page.width); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->_stack->page.height); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_8geometry_Size)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":623
 *         """
 * 
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             # Note that this doesn't use the rows+columns; the size of the
 *             # ENTIRE IMAGE is the size of the virtual canvas.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("sanpera.image.Image.size.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":635
 *     property has_canvas:
 *         """Returns `True` iff any frame has a canvas."""
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return any(f.has_canvas for f in self)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_10has_canvas_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_10has_canvas_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_10has_canvas___get__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_7sanpera_5image_5Image_10has_canvas_7__get___2generator2(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* "sanpera/image.pyx":636
 *         """Returns `True` iff any frame has a canvas."""
 *         def __get__(self):
 *             return any(f.has_canvas for f in self)             # <<<<<<<<<<<<<<
 * 
 *     property bit_depth:
 */

static PyObject *__pyx_pf_7sanpera_5image_5Image_10has_canvas_7__get___genexpr(PyObject *__pyx_self) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("genexpr", 0);
  __pyx_cur_scope = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *)__pyx_tp_new_7sanpera_5image___pyx_scope_struct_3_genexpr(__pyx_ptype_7sanpera_5image___pyx_scope_struct_3_genexpr, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *) __pyx_self;
  __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_outer_scope));
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope);
  {
    __pyx_GeneratorObject *gen = __Pyx_Generator_New((__pyx_generator_body_t) __pyx_gb_7sanpera_5image_5Image_10has_canvas_7__get___2generator2, (PyObject *) __pyx_cur_scope); if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("sanpera.image.Image.has_canvas.__get__.genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_7sanpera_5image_5Image_10has_canvas_7__get___2generator2(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *__pyx_cur_scope = ((struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("None", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L6_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;} }
  if (PyList_CheckExact(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) || PyTuple_CheckExact(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self))) {
    __pyx_t_1 = ((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_3 && PyList_CheckExact(__pyx_t_1)) {
      if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      #else
      __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      #endif
    } else if (!__pyx_t_3 && PyTuple_CheckExact(__pyx_t_1)) {
      if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      #else
      __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      #endif
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_f);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_f, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_f, __pyx_n_s_has_canvas); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    __Pyx_XGIVEREF(__pyx_t_1);
    __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
    __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
    __pyx_cur_scope->__pyx_t_2 = __pyx_t_3;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
    __pyx_cur_scope->__pyx_t_0 = 0;
    __Pyx_XGOTREF(__pyx_t_1);
    __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
    __pyx_t_3 = __pyx_cur_scope->__pyx_t_2;
    if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_generator->resume_label = -1;
  __Pyx_Generator_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return NULL;
}

/* "sanpera/image.pyx":635
 *     property has_canvas:
 *         """Returns `True` iff any frame has a canvas."""
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return any(f.has_canvas for f in self)
 * 
 */

static PyObject *__pyx_pf_7sanpera_5image_5Image_10has_canvas___get__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);
  __pyx_cur_scope = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *)__pyx_tp_new_7sanpera_5image___pyx_scope_struct_2___get__(__pyx_ptype_7sanpera_5image___pyx_scope_struct_2___get__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);

  /* "sanpera/image.pyx":636
 *         """Returns `True` iff any frame has a canvas."""
 *         def __get__(self):
 *             return any(f.has_canvas for f in self)             # <<<<<<<<<<<<<<
 * 
 *     property bit_depth:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_pf_7sanpera_5image_5Image_10has_canvas_7__get___genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_builtin_any, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":635
 *     property has_canvas:
 *         """Returns `True` iff any frame has a canvas."""
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return any(f.has_canvas for f in self)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.Image.has_canvas.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":639
 * 
 *     property bit_depth:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._stack.depth
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_9bit_depth_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_9bit_depth_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_9bit_depth___get__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_9bit_depth___get__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);

  /* "sanpera/image.pyx":640
 *     property bit_depth:
 *         def __get__(self):
 *             return self._stack.depth             # <<<<<<<<<<<<<<
 * 
 *         def __set__(self, unsigned long depth):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_int(__pyx_v_self->_stack->depth); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":639
 * 
 *     property bit_depth:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._stack.depth
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.Image.bit_depth.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":642
 *             return self._stack.depth
 * 
 *         def __set__(self, unsigned long depth):             # <<<<<<<<<<<<<<
 *             self._stack.depth = depth
 * 
 */

/* Python wrapper */
static int __pyx_pw_7sanpera_5image_5Image_9bit_depth_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_depth); /*proto*/
static int __pyx_pw_7sanpera_5image_5Image_9bit_depth_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_depth) {
  unsigned long __pyx_v_depth;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  assert(__pyx_arg_depth); {
    __pyx_v_depth = __Pyx_PyInt_As_unsigned_long(__pyx_arg_depth); if (unlikely((__pyx_v_depth == (unsigned long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("sanpera.image.Image.bit_depth.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_9bit_depth_2__set__(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self), ((unsigned long)__pyx_v_depth));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_7sanpera_5image_5Image_9bit_depth_2__set__(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, unsigned long __pyx_v_depth) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__", 0);

  /* "sanpera/image.pyx":643
 * 
 *         def __set__(self, unsigned long depth):
 *             self._stack.depth = depth             # <<<<<<<<<<<<<<
 * 
 *     # TODO this will have to become a proxy thing for it to support assignment
 */
  __pyx_v_self->_stack->depth = __pyx_v_depth;

  /* "sanpera/image.pyx":642
 *             return self._stack.depth
 * 
 *         def __set__(self, unsigned long depth):             # <<<<<<<<<<<<<<
 *             self._stack.depth = depth
 * 
 */

  /* function exit code */
  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":650
 *     # TODO this prefixing thing sucks as UI, and stuff like dates should be parsed
 *     @property
 *     def raw_properties(self):             # <<<<<<<<<<<<<<
 *         cdef char* prop = NULL
 *         cdef dict ret = {}
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_36raw_properties(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_36raw_properties(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("raw_properties (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_35raw_properties(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_35raw_properties(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  char *__pyx_v_prop;
  PyObject *__pyx_v_ret = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("raw_properties", 0);

  /* "sanpera/image.pyx":651
 *     @property
 *     def raw_properties(self):
 *         cdef char* prop = NULL             # <<<<<<<<<<<<<<
 *         cdef dict ret = {}
 * 
 */
  __pyx_v_prop = NULL;

  /* "sanpera/image.pyx":652
 *     def raw_properties(self):
 *         cdef char* prop = NULL
 *         cdef dict ret = {}             # <<<<<<<<<<<<<<
 * 
 *         # TODO may need SyncImageProfiles() somewhere?  it updates EXIF res and
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_ret = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":658
 * 
 *         # This tricks IM into actually reading the EXIF properties...
 *         c_api.GetImageProperty(self._stack, "exif:*")             # <<<<<<<<<<<<<<
 * 
 *         c_api.ResetImagePropertyIterator(self._stack)
 */
  GetImageProperty(__pyx_v_self->_stack, __pyx_k_exif);

  /* "sanpera/image.pyx":660
 *         c_api.GetImageProperty(self._stack, "exif:*")
 * 
 *         c_api.ResetImagePropertyIterator(self._stack)             # <<<<<<<<<<<<<<
 *         while True:
 *             # XXX this only examines the top image uhoh.  do we care?  what
 */
  ResetImagePropertyIterator(__pyx_v_self->_stack);

  /* "sanpera/image.pyx":661
 * 
 *         c_api.ResetImagePropertyIterator(self._stack)
 *         while True:             # <<<<<<<<<<<<<<
 *             # XXX this only examines the top image uhoh.  do we care?  what
 *             # happens if i load a GIF; what does each frame say?  what happens
 */
  while (1) {

    /* "sanpera/image.pyx":666
 *             # if i have multiple images with different props and save as one
 *             # image?
 *             prop = c_api.GetNextImageProperty(self._stack)             # <<<<<<<<<<<<<<
 *             if prop == NULL:
 *                 break
 */
    __pyx_v_prop = GetNextImageProperty(__pyx_v_self->_stack);

    /* "sanpera/image.pyx":667
 *             # image?
 *             prop = c_api.GetNextImageProperty(self._stack)
 *             if prop == NULL:             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
    __pyx_t_2 = ((__pyx_v_prop == NULL) != 0);
    if (__pyx_t_2) {

      /* "sanpera/image.pyx":668
 *             prop = c_api.GetNextImageProperty(self._stack)
 *             if prop == NULL:
 *                 break             # <<<<<<<<<<<<<<
 * 
 *             ret[<bytes>prop] = <bytes>c_api.GetImageProperty(self._stack, prop)
 */
      goto __pyx_L4_break;
    }

    /* "sanpera/image.pyx":670
 *                 break
 * 
 *             ret[<bytes>prop] = <bytes>c_api.GetImageProperty(self._stack, prop)             # <<<<<<<<<<<<<<
 * 
 *         return ret
 */
    __pyx_t_1 = __Pyx_PyBytes_FromString(GetImageProperty(__pyx_v_self->_stack, __pyx_v_prop)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __pyx_t_1;
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_prop); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (unlikely(PyDict_SetItem(__pyx_v_ret, __pyx_t_1, __pyx_t_3) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_L4_break:;

  /* "sanpera/image.pyx":672
 *             ret[<bytes>prop] = <bytes>c_api.GetImageProperty(self._stack, prop)
 * 
 *         return ret             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ret);
  __pyx_r = __pyx_v_ret;
  goto __pyx_L0;

  /* "sanpera/image.pyx":650
 *     # TODO this prefixing thing sucks as UI, and stuff like dates should be parsed
 *     @property
 *     def raw_properties(self):             # <<<<<<<<<<<<<<
 *         cdef char* prop = NULL
 *         cdef dict ret = {}
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.Image.raw_properties", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ret);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":682
 *     # ...or does IM do this already?  what's the diff between the resize functions?
 * 
 *     def resized(self, size, filter=None):             # <<<<<<<<<<<<<<
 *         size = Size.coerce(size)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_38resized(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_38resized(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_size = 0;
  PyObject *__pyx_v_filter = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("resized (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_size,&__pyx_n_s_filter,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_size)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_filter);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "resized") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 682; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_size = values[0];
    __pyx_v_filter = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("resized", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 682; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("sanpera.image.Image.resized", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_37resized(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self), __pyx_v_size, __pyx_v_filter);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_37resized(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, PyObject *__pyx_v_size, PyObject *__pyx_v_filter) {
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_new = 0;
  Image *__pyx_v_p;
  Image *__pyx_v_new_frame;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  FilterTypes __pyx_v_c_filter;
  int __pyx_v_target_width;
  int __pyx_v_target_height;
  double __pyx_v_ratio_width;
  double __pyx_v_ratio_height;
  int __pyx_v_frame_width;
  int __pyx_v_frame_height;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Image *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  unsigned long __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("resized", 0);
  __Pyx_INCREF(__pyx_v_size);

  /* "sanpera/image.pyx":683
 * 
 *     def resized(self, size, filter=None):
 *         size = Size.coerce(size)             # <<<<<<<<<<<<<<
 * 
 *         # TODO allow picking a filter
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_8geometry_Size)), __pyx_n_s_coerce); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_size);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_size);
  __Pyx_GIVEREF(__pyx_v_size);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_size, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "sanpera/image.pyx":688
 *         # TODO allow messing with blur?
 * 
 *         cdef Image new = self.__class__()             # <<<<<<<<<<<<<<
 *         cdef c_api.Image* p = self._stack
 *         cdef c_api.Image* new_frame
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyObject_Call(__pyx_t_3, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7sanpera_5image_Image))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_new = ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "sanpera/image.pyx":689
 * 
 *         cdef Image new = self.__class__()
 *         cdef c_api.Image* p = self._stack             # <<<<<<<<<<<<<<
 *         cdef c_api.Image* new_frame
 *         cdef MagickException exc = MagickException()
 */
  __pyx_t_4 = __pyx_v_self->_stack;
  __pyx_v_p = __pyx_t_4;

  /* "sanpera/image.pyx":691
 *         cdef c_api.Image* p = self._stack
 *         cdef c_api.Image* new_frame
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 * 
 *         cdef c_api.FilterTypes c_filter = c_api.UndefinedFilter
 */
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "sanpera/image.pyx":693
 *         cdef MagickException exc = MagickException()
 * 
 *         cdef c_api.FilterTypes c_filter = c_api.UndefinedFilter             # <<<<<<<<<<<<<<
 *         if filter == 'box':
 *             c_filter = c_api.BoxFilter
 */
  __pyx_v_c_filter = UndefinedFilter;

  /* "sanpera/image.pyx":694
 * 
 *         cdef c_api.FilterTypes c_filter = c_api.UndefinedFilter
 *         if filter == 'box':             # <<<<<<<<<<<<<<
 *             c_filter = c_api.BoxFilter
 * 
 */
  __pyx_t_5 = (__Pyx_PyString_Equals(__pyx_v_filter, __pyx_n_s_box, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_5) {

    /* "sanpera/image.pyx":695
 *         cdef c_api.FilterTypes c_filter = c_api.UndefinedFilter
 *         if filter == 'box':
 *             c_filter = c_api.BoxFilter             # <<<<<<<<<<<<<<
 * 
 *         cdef int target_width = size.width
 */
    __pyx_v_c_filter = BoxFilter;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "sanpera/image.pyx":697
 *             c_filter = c_api.BoxFilter
 * 
 *         cdef int target_width = size.width             # <<<<<<<<<<<<<<
 *         cdef int target_height = size.height
 *         cdef double ratio_width = target_width / (self._stack.page.width or self._stack.columns)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_size, __pyx_n_s_width); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_target_width = __pyx_t_6;

  /* "sanpera/image.pyx":698
 * 
 *         cdef int target_width = size.width
 *         cdef int target_height = size.height             # <<<<<<<<<<<<<<
 *         cdef double ratio_width = target_width / (self._stack.page.width or self._stack.columns)
 *         cdef double ratio_height = target_height / (self._stack.page.height or self._stack.rows)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_size, __pyx_n_s_height); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 698; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 698; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_target_height = __pyx_t_6;

  /* "sanpera/image.pyx":699
 *         cdef int target_width = size.width
 *         cdef int target_height = size.height
 *         cdef double ratio_width = target_width / (self._stack.page.width or self._stack.columns)             # <<<<<<<<<<<<<<
 *         cdef double ratio_height = target_height / (self._stack.page.height or self._stack.rows)
 *         cdef int frame_width
 */
  if (!__pyx_v_self->_stack->page.width) {
    __pyx_t_7 = __pyx_v_self->_stack->columns;
  } else {
    __pyx_t_7 = __pyx_v_self->_stack->page.width;
  }
  if (unlikely(__pyx_t_7 == 0)) {
    #ifdef WITH_THREAD
    PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
    #endif
    PyErr_SetString(PyExc_ZeroDivisionError, "float division");
    #ifdef WITH_THREAD
    PyGILState_Release(__pyx_gilstate_save);
    #endif
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_v_ratio_width = (((double)__pyx_v_target_width) / ((double)__pyx_t_7));

  /* "sanpera/image.pyx":700
 *         cdef int target_height = size.height
 *         cdef double ratio_width = target_width / (self._stack.page.width or self._stack.columns)
 *         cdef double ratio_height = target_height / (self._stack.page.height or self._stack.rows)             # <<<<<<<<<<<<<<
 *         cdef int frame_width
 *         cdef int frame_height
 */
  if (!__pyx_v_self->_stack->page.height) {
    __pyx_t_7 = __pyx_v_self->_stack->rows;
  } else {
    __pyx_t_7 = __pyx_v_self->_stack->page.height;
  }
  if (unlikely(__pyx_t_7 == 0)) {
    #ifdef WITH_THREAD
    PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
    #endif
    PyErr_SetString(PyExc_ZeroDivisionError, "float division");
    #ifdef WITH_THREAD
    PyGILState_Release(__pyx_gilstate_save);
    #endif
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 700; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_v_ratio_height = (((double)__pyx_v_target_height) / ((double)__pyx_t_7));

  /* "sanpera/image.pyx":704
 *         cdef int frame_height
 * 
 *         while p:             # <<<<<<<<<<<<<<
 *             # Alrighty, so.  ResizeImage takes the given size as the new size
 *             # of the FRAME, rather than the CANVAS, which is almost certainly
 */
  while (1) {
    __pyx_t_5 = (__pyx_v_p != 0);
    if (!__pyx_t_5) break;

    /* "sanpera/image.pyx":709
 *             # not what anyone expects.  So do the math to fix this manually,
 *             # converting from canvas size to frame size.
 *             frame_width = <int>(p.columns * ratio_width + 0.5)             # <<<<<<<<<<<<<<
 *             frame_height = <int>(p.rows * ratio_height + 0.5)
 * 
 */
    __pyx_v_frame_width = ((int)((__pyx_v_p->columns * __pyx_v_ratio_width) + 0.5));

    /* "sanpera/image.pyx":710
 *             # converting from canvas size to frame size.
 *             frame_width = <int>(p.columns * ratio_width + 0.5)
 *             frame_height = <int>(p.rows * ratio_height + 0.5)             # <<<<<<<<<<<<<<
 * 
 *             try:
 */
    __pyx_v_frame_height = ((int)((__pyx_v_p->rows * __pyx_v_ratio_height) + 0.5));

    /* "sanpera/image.pyx":712
 *             frame_height = <int>(p.rows * ratio_height + 0.5)
 * 
 *             try:             # <<<<<<<<<<<<<<
 *                 if c_filter == c_api.BoxFilter:
 *                     # Use the faster ScaleImage in this special case
 */
    {
      __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
      __Pyx_XGOTREF(__pyx_t_8);
      __Pyx_XGOTREF(__pyx_t_9);
      __Pyx_XGOTREF(__pyx_t_10);
      /*try:*/ {

        /* "sanpera/image.pyx":713
 * 
 *             try:
 *                 if c_filter == c_api.BoxFilter:             # <<<<<<<<<<<<<<
 *                     # Use the faster ScaleImage in this special case
 *                     new_frame = c_api.ScaleImage(
 */
        __pyx_t_5 = ((__pyx_v_c_filter == BoxFilter) != 0);
        if (__pyx_t_5) {

          /* "sanpera/image.pyx":715
 *                 if c_filter == c_api.BoxFilter:
 *                     # Use the faster ScaleImage in this special case
 *                     new_frame = c_api.ScaleImage(             # <<<<<<<<<<<<<<
 *                         p, frame_width, frame_height, exc.ptr)
 *                 else:
 */
          __pyx_v_new_frame = ScaleImage(__pyx_v_p, __pyx_v_frame_width, __pyx_v_frame_height, __pyx_v_exc->ptr);
          goto __pyx_L14;
        }
        /*else*/ {

          /* "sanpera/image.pyx":718
 *                         p, frame_width, frame_height, exc.ptr)
 *                 else:
 *                     new_frame = c_api.ResizeImage(             # <<<<<<<<<<<<<<
 *                         p, frame_width, frame_height,
 *                         c_filter, 1.0, exc.ptr)
 */
          __pyx_v_new_frame = ResizeImage(__pyx_v_p, __pyx_v_frame_width, __pyx_v_frame_height, __pyx_v_c_filter, 1.0, __pyx_v_exc->ptr);
        }
        __pyx_L14:;

        /* "sanpera/image.pyx":722
 *                         c_filter, 1.0, exc.ptr)
 * 
 *                 exc.check()             # <<<<<<<<<<<<<<
 *             except Exception:
 *                 c_api.DestroyImage(new_frame)
 */
        __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PyObject_Call(__pyx_t_2, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L6_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      goto __pyx_L13_try_end;
      __pyx_L6_error:;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "sanpera/image.pyx":723
 * 
 *                 exc.check()
 *             except Exception:             # <<<<<<<<<<<<<<
 *                 c_api.DestroyImage(new_frame)
 *                 raise
 */
      __pyx_t_6 = PyErr_ExceptionMatches(__pyx_builtin_Exception);
      if (__pyx_t_6) {
        __Pyx_AddTraceback("sanpera.image.Image.resized", __pyx_clineno, __pyx_lineno, __pyx_filename);
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_2, &__pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 723; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_GOTREF(__pyx_t_1);

        /* "sanpera/image.pyx":724
 *                 exc.check()
 *             except Exception:
 *                 c_api.DestroyImage(new_frame)             # <<<<<<<<<<<<<<
 *                 raise
 * 
 */
        DestroyImage(__pyx_v_new_frame);

        /* "sanpera/image.pyx":725
 *             except Exception:
 *                 c_api.DestroyImage(new_frame)
 *                 raise             # <<<<<<<<<<<<<<
 * 
 *             # ImageMagick uses new_size/old_size to compute the resized frame's
 */
        __Pyx_GIVEREF(__pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_2);
        __Pyx_XGIVEREF(__pyx_t_1);
        __Pyx_ErrRestore(__pyx_t_3, __pyx_t_2, __pyx_t_1);
        __pyx_t_3 = 0; __pyx_t_2 = 0; __pyx_t_1 = 0; 
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L8_except_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L7_exception_handled;
      }
      goto __pyx_L8_except_error;
      __pyx_L8_except_error:;
      __Pyx_XGIVEREF(__pyx_t_8);
      __Pyx_XGIVEREF(__pyx_t_9);
      __Pyx_XGIVEREF(__pyx_t_10);
      __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
      goto __pyx_L1_error;
      __pyx_L7_exception_handled:;
      __Pyx_XGIVEREF(__pyx_t_8);
      __Pyx_XGIVEREF(__pyx_t_9);
      __Pyx_XGIVEREF(__pyx_t_10);
      __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
      __pyx_L13_try_end:;
    }

    /* "sanpera/image.pyx":732
 *             # new frame a noticable distance from where one might expect.  Fix
 *             # the canvas manually, too.
 *             new_frame.page.width = target_width             # <<<<<<<<<<<<<<
 *             new_frame.page.height = target_height
 *             new_frame.page.x = <int>(p.page.x * ratio_width + 0.5)
 */
    __pyx_v_new_frame->page.width = __pyx_v_target_width;

    /* "sanpera/image.pyx":733
 *             # the canvas manually, too.
 *             new_frame.page.width = target_width
 *             new_frame.page.height = target_height             # <<<<<<<<<<<<<<
 *             new_frame.page.x = <int>(p.page.x * ratio_width + 0.5)
 *             new_frame.page.y = <int>(p.page.y * ratio_height + 0.5)
 */
    __pyx_v_new_frame->page.height = __pyx_v_target_height;

    /* "sanpera/image.pyx":734
 *             new_frame.page.width = target_width
 *             new_frame.page.height = target_height
 *             new_frame.page.x = <int>(p.page.x * ratio_width + 0.5)             # <<<<<<<<<<<<<<
 *             new_frame.page.y = <int>(p.page.y * ratio_height + 0.5)
 * 
 */
    __pyx_v_new_frame->page.x = ((int)((__pyx_v_p->page.x * __pyx_v_ratio_width) + 0.5));

    /* "sanpera/image.pyx":735
 *             new_frame.page.height = target_height
 *             new_frame.page.x = <int>(p.page.x * ratio_width + 0.5)
 *             new_frame.page.y = <int>(p.page.y * ratio_height + 0.5)             # <<<<<<<<<<<<<<
 * 
 *             c_api.AppendImageToList(&new._stack, new_frame)
 */
    __pyx_v_new_frame->page.y = ((int)((__pyx_v_p->page.y * __pyx_v_ratio_height) + 0.5));

    /* "sanpera/image.pyx":737
 *             new_frame.page.y = <int>(p.page.y * ratio_height + 0.5)
 * 
 *             c_api.AppendImageToList(&new._stack, new_frame)             # <<<<<<<<<<<<<<
 *             p = c_api.GetNextImageInList(p)
 * 
 */
    AppendImageToList((&__pyx_v_new->_stack), __pyx_v_new_frame);

    /* "sanpera/image.pyx":738
 * 
 *             c_api.AppendImageToList(&new._stack, new_frame)
 *             p = c_api.GetNextImageInList(p)             # <<<<<<<<<<<<<<
 * 
 *         new._post_init()
 */
    __pyx_v_p = GetNextImageInList(__pyx_v_p);
  }

  /* "sanpera/image.pyx":740
 *             p = c_api.GetNextImageInList(p)
 * 
 *         new._post_init()             # <<<<<<<<<<<<<<
 *         return new
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_new->__pyx_vtab)->_post_init(__pyx_v_new); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 740; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":741
 * 
 *         new._post_init()
 *         return new             # <<<<<<<<<<<<<<
 * 
 *     def cropped(self, Rectangle rect, *, bool preserve_canvas not None=False):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_new));
  __pyx_r = ((PyObject *)__pyx_v_new);
  goto __pyx_L0;

  /* "sanpera/image.pyx":682
 *     # ...or does IM do this already?  what's the diff between the resize functions?
 * 
 *     def resized(self, size, filter=None):             # <<<<<<<<<<<<<<
 *         size = Size.coerce(size)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.Image.resized", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XDECREF(__pyx_v_size);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":743
 *         return new
 * 
 *     def cropped(self, Rectangle rect, *, bool preserve_canvas not None=False):             # <<<<<<<<<<<<<<
 *         cdef Image new = self.__class__()
 *         cdef c_api.Image* p = self._stack
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_40cropped(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7sanpera_5image_5Image_40cropped(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_7sanpera_8geometry_Rectangle *__pyx_v_rect = 0;
  PyBoolObject *__pyx_v_preserve_canvas = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("cropped (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_rect,&__pyx_n_s_preserve_canvas,0};
    PyObject* values[2] = {0,0};
    values[1] = (PyObject *)((PyBoolObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_rect)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (kw_args == 1) {
        const Py_ssize_t index = 1;
        PyObject* value = PyDict_GetItem(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cropped") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_rect = ((struct __pyx_obj_7sanpera_8geometry_Rectangle *)values[0]);
    __pyx_v_preserve_canvas = ((PyBoolObject *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("cropped", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("sanpera.image.Image.cropped", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_rect), __pyx_ptype_7sanpera_8geometry_Rectangle, 1, "rect", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_preserve_canvas), __pyx_ptype_7cpython_4bool_bool, 0, "preserve_canvas", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_39cropped(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self), __pyx_v_rect, __pyx_v_preserve_canvas);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_39cropped(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self, struct __pyx_obj_7sanpera_8geometry_Rectangle *__pyx_v_rect, PyBoolObject *__pyx_v_preserve_canvas) {
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_new = 0;
  Image *__pyx_v_p;
  Image *__pyx_v_new_frame;
  RectangleInfo __pyx_v_rectinfo;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Image *__pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("cropped", 0);

  /* "sanpera/image.pyx":744
 * 
 *     def cropped(self, Rectangle rect, *, bool preserve_canvas not None=False):
 *         cdef Image new = self.__class__()             # <<<<<<<<<<<<<<
 *         cdef c_api.Image* p = self._stack
 *         cdef c_api.Image* new_frame
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7sanpera_5image_Image))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_new = ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "sanpera/image.pyx":745
 *     def cropped(self, Rectangle rect, *, bool preserve_canvas not None=False):
 *         cdef Image new = self.__class__()
 *         cdef c_api.Image* p = self._stack             # <<<<<<<<<<<<<<
 *         cdef c_api.Image* new_frame
 *         cdef c_api.RectangleInfo rectinfo = rect.to_rect_info()
 */
  __pyx_t_3 = __pyx_v_self->_stack;
  __pyx_v_p = __pyx_t_3;

  /* "sanpera/image.pyx":747
 *         cdef c_api.Image* p = self._stack
 *         cdef c_api.Image* new_frame
 *         cdef c_api.RectangleInfo rectinfo = rect.to_rect_info()             # <<<<<<<<<<<<<<
 *         cdef MagickException exc = MagickException()
 * 
 */
  __pyx_v_rectinfo = ((struct __pyx_vtabstruct_7sanpera_8geometry_Rectangle *)__pyx_v_rect->__pyx_vtab)->to_rect_info(__pyx_v_rect);

  /* "sanpera/image.pyx":748
 *         cdef c_api.Image* new_frame
 *         cdef c_api.RectangleInfo rectinfo = rect.to_rect_info()
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 * 
 *         while p:
 */
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 748; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "sanpera/image.pyx":750
 *         cdef MagickException exc = MagickException()
 * 
 *         while p:             # <<<<<<<<<<<<<<
 *             try:
 *                 new_frame = c_api.CropImage(p, &rectinfo, exc.ptr)
 */
  while (1) {
    __pyx_t_4 = (__pyx_v_p != 0);
    if (!__pyx_t_4) break;

    /* "sanpera/image.pyx":751
 * 
 *         while p:
 *             try:             # <<<<<<<<<<<<<<
 *                 new_frame = c_api.CropImage(p, &rectinfo, exc.ptr)
 *                 exc.check()
 */
    {
      __Pyx_ExceptionSave(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7);
      __Pyx_XGOTREF(__pyx_t_5);
      __Pyx_XGOTREF(__pyx_t_6);
      __Pyx_XGOTREF(__pyx_t_7);
      /*try:*/ {

        /* "sanpera/image.pyx":752
 *         while p:
 *             try:
 *                 new_frame = c_api.CropImage(p, &rectinfo, exc.ptr)             # <<<<<<<<<<<<<<
 *                 exc.check()
 *             except Exception:
 */
        __pyx_v_new_frame = CropImage(__pyx_v_p, (&__pyx_v_rectinfo), __pyx_v_exc->ptr);

        /* "sanpera/image.pyx":753
 *             try:
 *                 new_frame = c_api.CropImage(p, &rectinfo, exc.ptr)
 *                 exc.check()             # <<<<<<<<<<<<<<
 *             except Exception:
 *                 c_api.DestroyImage(new_frame)
 */
        __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_1 = PyObject_Call(__pyx_t_2, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L12_try_end;
      __pyx_L5_error:;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "sanpera/image.pyx":754
 *                 new_frame = c_api.CropImage(p, &rectinfo, exc.ptr)
 *                 exc.check()
 *             except Exception:             # <<<<<<<<<<<<<<
 *                 c_api.DestroyImage(new_frame)
 *                 raise
 */
      __pyx_t_8 = PyErr_ExceptionMatches(__pyx_builtin_Exception);
      if (__pyx_t_8) {
        __Pyx_AddTraceback("sanpera.image.Image.cropped", __pyx_clineno, __pyx_lineno, __pyx_filename);
        if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_9) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_GOTREF(__pyx_t_9);

        /* "sanpera/image.pyx":755
 *                 exc.check()
 *             except Exception:
 *                 c_api.DestroyImage(new_frame)             # <<<<<<<<<<<<<<
 *                 raise
 * 
 */
        DestroyImage(__pyx_v_new_frame);

        /* "sanpera/image.pyx":756
 *             except Exception:
 *                 c_api.DestroyImage(new_frame)
 *                 raise             # <<<<<<<<<<<<<<
 * 
 *             # Repage by default after a crop; not doing this is unexpected and
 */
        __Pyx_GIVEREF(__pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_2);
        __Pyx_XGIVEREF(__pyx_t_9);
        __Pyx_ErrRestore(__pyx_t_1, __pyx_t_2, __pyx_t_9);
        __pyx_t_1 = 0; __pyx_t_2 = 0; __pyx_t_9 = 0; 
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 756; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        goto __pyx_L6_exception_handled;
      }
      goto __pyx_L7_except_error;
      __pyx_L7_except_error:;
      __Pyx_XGIVEREF(__pyx_t_5);
      __Pyx_XGIVEREF(__pyx_t_6);
      __Pyx_XGIVEREF(__pyx_t_7);
      __Pyx_ExceptionReset(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      goto __pyx_L1_error;
      __pyx_L6_exception_handled:;
      __Pyx_XGIVEREF(__pyx_t_5);
      __Pyx_XGIVEREF(__pyx_t_6);
      __Pyx_XGIVEREF(__pyx_t_7);
      __Pyx_ExceptionReset(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      __pyx_L12_try_end:;
    }

    /* "sanpera/image.pyx":761
 *             # frankly insane
 *             # TODO how necessary is this?  should it be done for frames?
 *             if not preserve_canvas:             # <<<<<<<<<<<<<<
 *                 new_frame.page.x = 0
 *                 new_frame.page.y = 0
 */
    __pyx_t_4 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_preserve_canvas)); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_10 = ((!__pyx_t_4) != 0);
    if (__pyx_t_10) {

      /* "sanpera/image.pyx":762
 *             # TODO how necessary is this?  should it be done for frames?
 *             if not preserve_canvas:
 *                 new_frame.page.x = 0             # <<<<<<<<<<<<<<
 *                 new_frame.page.y = 0
 *                 new_frame.page.width = 0
 */
      __pyx_v_new_frame->page.x = 0;

      /* "sanpera/image.pyx":763
 *             if not preserve_canvas:
 *                 new_frame.page.x = 0
 *                 new_frame.page.y = 0             # <<<<<<<<<<<<<<
 *                 new_frame.page.width = 0
 *                 new_frame.page.height = 0
 */
      __pyx_v_new_frame->page.y = 0;

      /* "sanpera/image.pyx":764
 *                 new_frame.page.x = 0
 *                 new_frame.page.y = 0
 *                 new_frame.page.width = 0             # <<<<<<<<<<<<<<
 *                 new_frame.page.height = 0
 * 
 */
      __pyx_v_new_frame->page.width = 0;

      /* "sanpera/image.pyx":765
 *                 new_frame.page.y = 0
 *                 new_frame.page.width = 0
 *                 new_frame.page.height = 0             # <<<<<<<<<<<<<<
 * 
 *             c_api.AppendImageToList(&new._stack, new_frame)
 */
      __pyx_v_new_frame->page.height = 0;
      goto __pyx_L15;
    }
    __pyx_L15:;

    /* "sanpera/image.pyx":767
 *                 new_frame.page.height = 0
 * 
 *             c_api.AppendImageToList(&new._stack, new_frame)             # <<<<<<<<<<<<<<
 *             p = c_api.GetNextImageInList(p)
 * 
 */
    AppendImageToList((&__pyx_v_new->_stack), __pyx_v_new_frame);

    /* "sanpera/image.pyx":768
 * 
 *             c_api.AppendImageToList(&new._stack, new_frame)
 *             p = c_api.GetNextImageInList(p)             # <<<<<<<<<<<<<<
 * 
 *         new._post_init()
 */
    __pyx_v_p = GetNextImageInList(__pyx_v_p);
  }

  /* "sanpera/image.pyx":770
 *             p = c_api.GetNextImageInList(p)
 * 
 *         new._post_init()             # <<<<<<<<<<<<<<
 *         return new
 * 
 */
  __pyx_t_9 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_new->__pyx_vtab)->_post_init(__pyx_v_new); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "sanpera/image.pyx":771
 * 
 *         new._post_init()
 *         return new             # <<<<<<<<<<<<<<
 * 
 *     def coalesced(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_new));
  __pyx_r = ((PyObject *)__pyx_v_new);
  goto __pyx_L0;

  /* "sanpera/image.pyx":743
 *         return new
 * 
 *     def cropped(self, Rectangle rect, *, bool preserve_canvas not None=False):             # <<<<<<<<<<<<<<
 *         cdef Image new = self.__class__()
 *         cdef c_api.Image* p = self._stack
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("sanpera.image.Image.cropped", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":773
 *         return new
 * 
 *     def coalesced(self):             # <<<<<<<<<<<<<<
 *         """Returns an image with each frame composited over previous frames."""
 *         cdef Image new = self.__class__()
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_42coalesced(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_7sanpera_5image_5Image_41coalesced[] = "Returns an image with each frame composited over previous frames.";
static PyObject *__pyx_pw_7sanpera_5image_5Image_42coalesced(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("coalesced (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_41coalesced(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_41coalesced(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_new = 0;
  Image *__pyx_v_new_image;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("coalesced", 0);

  /* "sanpera/image.pyx":775
 *     def coalesced(self):
 *         """Returns an image with each frame composited over previous frames."""
 *         cdef Image new = self.__class__()             # <<<<<<<<<<<<<<
 *         cdef c_api.Image* new_image
 *         cdef MagickException exc = MagickException()
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7sanpera_5image_Image))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_new = ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "sanpera/image.pyx":777
 *         cdef Image new = self.__class__()
 *         cdef c_api.Image* new_image
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 * 
 *         new_image = c_api.CoalesceImages(self._stack, exc.ptr)
 */
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "sanpera/image.pyx":779
 *         cdef MagickException exc = MagickException()
 * 
 *         new_image = c_api.CoalesceImages(self._stack, exc.ptr)             # <<<<<<<<<<<<<<
 *         exc.check()
 * 
 */
  __pyx_v_new_image = CoalesceImages(__pyx_v_self->_stack, __pyx_v_exc->ptr);

  /* "sanpera/image.pyx":780
 * 
 *         new_image = c_api.CoalesceImages(self._stack, exc.ptr)
 *         exc.check()             # <<<<<<<<<<<<<<
 * 
 *         new._stack = new_image
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":782
 *         exc.check()
 * 
 *         new._stack = new_image             # <<<<<<<<<<<<<<
 *         new._post_init()
 *         return new
 */
  __pyx_v_new->_stack = __pyx_v_new_image;

  /* "sanpera/image.pyx":783
 * 
 *         new._stack = new_image
 *         new._post_init()             # <<<<<<<<<<<<<<
 *         return new
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_new->__pyx_vtab)->_post_init(__pyx_v_new); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":784
 *         new._stack = new_image
 *         new._post_init()
 *         return new             # <<<<<<<<<<<<<<
 * 
 *     def optimized_for_animated_gif(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_new));
  __pyx_r = ((PyObject *)__pyx_v_new);
  goto __pyx_L0;

  /* "sanpera/image.pyx":773
 *         return new
 * 
 *     def coalesced(self):             # <<<<<<<<<<<<<<
 *         """Returns an image with each frame composited over previous frames."""
 *         cdef Image new = self.__class__()
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.Image.coalesced", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":786
 *         return new
 * 
 *     def optimized_for_animated_gif(self):             # <<<<<<<<<<<<<<
 *         """Returns an image with frames optimized for animated GIFs.
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_5Image_44optimized_for_animated_gif(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_7sanpera_5image_5Image_43optimized_for_animated_gif[] = "Returns an image with frames optimized for animated GIFs.\n\n        Each frame will be compared with previous frames to shrink each frame\n        as much as possible while preserving the results of the animation.\n        ";
static PyObject *__pyx_pw_7sanpera_5image_5Image_44optimized_for_animated_gif(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("optimized_for_animated_gif (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_5Image_43optimized_for_animated_gif(((struct __pyx_obj_7sanpera_5image_Image *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_5Image_43optimized_for_animated_gif(struct __pyx_obj_7sanpera_5image_Image *__pyx_v_self) {
  struct __pyx_obj_7sanpera_5image_Image *__pyx_v_new = 0;
  Image *__pyx_v_new_image;
  struct __pyx_obj_7sanpera_9exception_MagickException *__pyx_v_exc = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("optimized_for_animated_gif", 0);

  /* "sanpera/image.pyx":792
 *         as much as possible while preserving the results of the animation.
 *         """
 *         cdef Image new = self.__class__()             # <<<<<<<<<<<<<<
 *         cdef c_api.Image* new_image
 *         cdef MagickException exc = MagickException()
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7sanpera_5image_Image))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_new = ((struct __pyx_obj_7sanpera_5image_Image *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "sanpera/image.pyx":794
 *         cdef Image new = self.__class__()
 *         cdef c_api.Image* new_image
 *         cdef MagickException exc = MagickException()             # <<<<<<<<<<<<<<
 * 
 *         new_image = c_api.OptimizeImageLayers(self._stack, exc.ptr)
 */
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_9exception_MagickException)), __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 794; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "sanpera/image.pyx":796
 *         cdef MagickException exc = MagickException()
 * 
 *         new_image = c_api.OptimizeImageLayers(self._stack, exc.ptr)             # <<<<<<<<<<<<<<
 *         exc.check()
 *         c_api.OptimizeImageTransparency(new_image, exc.ptr)
 */
  __pyx_v_new_image = OptimizeImageLayers(__pyx_v_self->_stack, __pyx_v_exc->ptr);

  /* "sanpera/image.pyx":797
 * 
 *         new_image = c_api.OptimizeImageLayers(self._stack, exc.ptr)
 *         exc.check()             # <<<<<<<<<<<<<<
 *         c_api.OptimizeImageTransparency(new_image, exc.ptr)
 *         exc.check()
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "sanpera/image.pyx":798
 *         new_image = c_api.OptimizeImageLayers(self._stack, exc.ptr)
 *         exc.check()
 *         c_api.OptimizeImageTransparency(new_image, exc.ptr)             # <<<<<<<<<<<<<<
 *         exc.check()
 * 
 */
  OptimizeImageTransparency(__pyx_v_new_image, __pyx_v_exc->ptr);

  /* "sanpera/image.pyx":799
 *         exc.check()
 *         c_api.OptimizeImageTransparency(new_image, exc.ptr)
 *         exc.check()             # <<<<<<<<<<<<<<
 * 
 *         new._stack = new_image
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_exc), __pyx_n_s_check); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 799; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_empty_tuple, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 799; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "sanpera/image.pyx":801
 *         exc.check()
 * 
 *         new._stack = new_image             # <<<<<<<<<<<<<<
 *         new._post_init()
 *         return new
 */
  __pyx_v_new->_stack = __pyx_v_new_image;

  /* "sanpera/image.pyx":802
 * 
 *         new._stack = new_image
 *         new._post_init()             # <<<<<<<<<<<<<<
 *         return new
 * 
 */
  __pyx_t_2 = ((struct __pyx_vtabstruct_7sanpera_5image_Image *)__pyx_v_new->__pyx_vtab)->_post_init(__pyx_v_new); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 802; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "sanpera/image.pyx":803
 *         new._stack = new_image
 *         new._post_init()
 *         return new             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_new));
  __pyx_r = ((PyObject *)__pyx_v_new);
  goto __pyx_L0;

  /* "sanpera/image.pyx":786
 *         return new
 * 
 *     def optimized_for_animated_gif(self):             # <<<<<<<<<<<<<<
 *         """Returns an image with frames optimized for animated GIFs.
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.Image.optimized_for_animated_gif", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_exc);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":812
 * 
 *     @classmethod
 *     def create(cls, *names):             # <<<<<<<<<<<<<<
 *         def decorator(f):
 *             obj = cls(f, names)
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_15BuiltinRegistry_1create(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_7sanpera_5image_15BuiltinRegistry_1create = {__Pyx_NAMESTR("create"), (PyCFunction)__pyx_pw_7sanpera_5image_15BuiltinRegistry_1create, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
static PyObject *__pyx_pw_7sanpera_5image_15BuiltinRegistry_1create(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_cls = 0;
  PyObject *__pyx_v_names = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("create (wrapper)", 0);
  if (PyTuple_GET_SIZE(__pyx_args) > 1) {
    __pyx_v_names = PyTuple_GetSlice(__pyx_args, 1, PyTuple_GET_SIZE(__pyx_args));
    if (unlikely(!__pyx_v_names)) {
      __Pyx_RefNannyFinishContext();
      return NULL;
    }
    __Pyx_GOTREF(__pyx_v_names);
  } else {
    __pyx_v_names = __pyx_empty_tuple; __Pyx_INCREF(__pyx_empty_tuple);
  }
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_cls,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        default:
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_cls)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t used_pos_args = (pos_args < 1) ? pos_args : 1;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, used_pos_args, "create") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 812; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) < 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_cls = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("create", 0, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 812; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_CLEAR(__pyx_v_names);
  __Pyx_AddTraceback("sanpera.image.BuiltinRegistry.create", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7sanpera_5image_15BuiltinRegistry_create(__pyx_self, __pyx_v_cls, __pyx_v_names);

  /* function exit code */
  __Pyx_XDECREF(__pyx_v_names);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":813
 *     @classmethod
 *     def create(cls, *names):
 *         def decorator(f):             # <<<<<<<<<<<<<<
 *             obj = cls(f, names)
 *             obj.__doc__ = f.__doc__
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_15BuiltinRegistry_6create_1decorator(PyObject *__pyx_self, PyObject *__pyx_v_f); /*proto*/
static PyMethodDef __pyx_mdef_7sanpera_5image_15BuiltinRegistry_6create_1decorator = {__Pyx_NAMESTR("decorator"), (PyCFunction)__pyx_pw_7sanpera_5image_15BuiltinRegistry_6create_1decorator, METH_O, __Pyx_DOCSTR(0)};
static PyObject *__pyx_pw_7sanpera_5image_15BuiltinRegistry_6create_1decorator(PyObject *__pyx_self, PyObject *__pyx_v_f) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("decorator (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_15BuiltinRegistry_6create_decorator(__pyx_self, ((PyObject *)__pyx_v_f));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_15BuiltinRegistry_6create_decorator(PyObject *__pyx_self, PyObject *__pyx_v_f) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *__pyx_cur_scope;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *__pyx_outer_scope;
  PyObject *__pyx_v_obj = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("decorator", 0);
  __pyx_outer_scope = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *) __Pyx_CyFunction_GetClosure(__pyx_self);
  __pyx_cur_scope = __pyx_outer_scope;

  /* "sanpera/image.pyx":814
 *     def create(cls, *names):
 *         def decorator(f):
 *             obj = cls(f, names)             # <<<<<<<<<<<<<<
 *             obj.__doc__ = f.__doc__
 *             return obj
 */
  if (unlikely(!__pyx_cur_scope->__pyx_v_cls)) { __Pyx_RaiseClosureNameError("cls"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;} }
  if (unlikely(!__pyx_cur_scope->__pyx_v_names)) { __Pyx_RaiseClosureNameError("names"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;} }
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_f);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_f);
  __Pyx_GIVEREF(__pyx_v_f);
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_names);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_cur_scope->__pyx_v_names);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_names);
  __pyx_t_2 = PyObject_Call(__pyx_cur_scope->__pyx_v_cls, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_obj = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "sanpera/image.pyx":815
 *         def decorator(f):
 *             obj = cls(f, names)
 *             obj.__doc__ = f.__doc__             # <<<<<<<<<<<<<<
 *             return obj
 *         return decorator
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_doc); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_obj, __pyx_n_s_doc, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "sanpera/image.pyx":816
 *             obj = cls(f, names)
 *             obj.__doc__ = f.__doc__
 *             return obj             # <<<<<<<<<<<<<<
 *         return decorator
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_obj);
  __pyx_r = __pyx_v_obj;
  goto __pyx_L0;

  /* "sanpera/image.pyx":813
 *     @classmethod
 *     def create(cls, *names):
 *         def decorator(f):             # <<<<<<<<<<<<<<
 *             obj = cls(f, names)
 *             obj.__doc__ = f.__doc__
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.BuiltinRegistry.create.decorator", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_obj);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":812
 * 
 *     @classmethod
 *     def create(cls, *names):             # <<<<<<<<<<<<<<
 *         def decorator(f):
 *             obj = cls(f, names)
 */

static PyObject *__pyx_pf_7sanpera_5image_15BuiltinRegistry_create(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_cls, PyObject *__pyx_v_names) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *__pyx_cur_scope;
  PyObject *__pyx_v_decorator = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("create", 0);
  __pyx_cur_scope = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *)__pyx_tp_new_7sanpera_5image___pyx_scope_struct_4_create(__pyx_ptype_7sanpera_5image___pyx_scope_struct_4_create, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_cls = __pyx_v_cls;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_cls);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_cls);
  __pyx_cur_scope->__pyx_v_names = __pyx_v_names;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_names);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_names);

  /* "sanpera/image.pyx":813
 *     @classmethod
 *     def create(cls, *names):
 *         def decorator(f):             # <<<<<<<<<<<<<<
 *             obj = cls(f, names)
 *             obj.__doc__ = f.__doc__
 */
  __pyx_t_1 = __Pyx_CyFunction_NewEx(&__pyx_mdef_7sanpera_5image_15BuiltinRegistry_6create_1decorator, 0, __pyx_n_s_BuiltinRegistry_create_locals_de, ((PyObject*)__pyx_cur_scope), __pyx_n_s_sanpera_image, PyModule_GetDict(__pyx_m), ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 813; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_decorator = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "sanpera/image.pyx":817
 *             obj.__doc__ = f.__doc__
 *             return obj
 *         return decorator             # <<<<<<<<<<<<<<
 * 
 *     def __init__(self, factory, names):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_decorator);
  __pyx_r = __pyx_v_decorator;
  goto __pyx_L0;

  /* "sanpera/image.pyx":812
 * 
 *     @classmethod
 *     def create(cls, *names):             # <<<<<<<<<<<<<<
 *         def decorator(f):
 *             obj = cls(f, names)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.BuiltinRegistry.create", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_decorator);
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":819
 *         return decorator
 * 
 *     def __init__(self, factory, names):             # <<<<<<<<<<<<<<
 *         self._factory = factory
 *         self._names = frozenset(names)
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_15BuiltinRegistry_3__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_7sanpera_5image_15BuiltinRegistry_3__init__ = {__Pyx_NAMESTR("__init__"), (PyCFunction)__pyx_pw_7sanpera_5image_15BuiltinRegistry_3__init__, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
static PyObject *__pyx_pw_7sanpera_5image_15BuiltinRegistry_3__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_factory = 0;
  PyObject *__pyx_v_names = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_factory,&__pyx_n_s_names,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_factory)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_names)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_self = values[0];
    __pyx_v_factory = values[1];
    __pyx_v_names = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("sanpera.image.BuiltinRegistry.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7sanpera_5image_15BuiltinRegistry_2__init__(__pyx_self, __pyx_v_self, __pyx_v_factory, __pyx_v_names);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_15BuiltinRegistry_2__init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_factory, PyObject *__pyx_v_names) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "sanpera/image.pyx":820
 * 
 *     def __init__(self, factory, names):
 *         self._factory = factory             # <<<<<<<<<<<<<<
 *         self._names = frozenset(names)
 * 
 */
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_factory_2, __pyx_v_factory) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":821
 *     def __init__(self, factory, names):
 *         self._factory = factory
 *         self._names = frozenset(names)             # <<<<<<<<<<<<<<
 * 
 *     def __getattr__(self, key):
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_names);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_names);
  __Pyx_GIVEREF(__pyx_v_names);
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)(&PyFrozenSet_Type))), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_names_2, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "sanpera/image.pyx":819
 *         return decorator
 * 
 *     def __init__(self, factory, names):             # <<<<<<<<<<<<<<
 *         self._factory = factory
 *         self._names = frozenset(names)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("sanpera.image.BuiltinRegistry.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":823
 *         self._names = frozenset(names)
 * 
 *     def __getattr__(self, key):             # <<<<<<<<<<<<<<
 *         if key not in self._names:
 *             raise AttributeError
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_15BuiltinRegistry_5__getattr__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_7sanpera_5image_15BuiltinRegistry_5__getattr__ = {__Pyx_NAMESTR("__getattr__"), (PyCFunction)__pyx_pw_7sanpera_5image_15BuiltinRegistry_5__getattr__, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
static PyObject *__pyx_pw_7sanpera_5image_15BuiltinRegistry_5__getattr__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_key = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__getattr__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_key,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_key)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__getattr__", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__getattr__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_key = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__getattr__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("sanpera.image.BuiltinRegistry.__getattr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7sanpera_5image_15BuiltinRegistry_4__getattr__(__pyx_self, __pyx_v_self, __pyx_v_key);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_15BuiltinRegistry_4__getattr__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__getattr__", 0);

  /* "sanpera/image.pyx":824
 * 
 *     def __getattr__(self, key):
 *         if key not in self._names:             # <<<<<<<<<<<<<<
 *             raise AttributeError
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_names_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = (__Pyx_PySequence_Contains(__pyx_v_key, __pyx_t_1, Py_NE)); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {

    /* "sanpera/image.pyx":825
 *     def __getattr__(self, key):
 *         if key not in self._names:
 *             raise AttributeError             # <<<<<<<<<<<<<<
 * 
 *         return self._factory(key)
 */
    __Pyx_Raise(__pyx_builtin_AttributeError, 0, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "sanpera/image.pyx":827
 *             raise AttributeError
 * 
 *         return self._factory(key)             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_factory_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_v_key);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_key);
  __Pyx_GIVEREF(__pyx_v_key);
  __pyx_t_5 = PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":823
 *         self._names = frozenset(names)
 * 
 *     def __getattr__(self, key):             # <<<<<<<<<<<<<<
 *         if key not in self._names:
 *             raise AttributeError
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("sanpera.image.BuiltinRegistry.__getattr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":829
 *         return self._factory(key)
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return self._names
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_15BuiltinRegistry_7__iter__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_7sanpera_5image_15BuiltinRegistry_7__iter__ = {__Pyx_NAMESTR("__iter__"), (PyCFunction)__pyx_pw_7sanpera_5image_15BuiltinRegistry_7__iter__, METH_O, __Pyx_DOCSTR(0)};
static PyObject *__pyx_pw_7sanpera_5image_15BuiltinRegistry_7__iter__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_15BuiltinRegistry_6__iter__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_15BuiltinRegistry_6__iter__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__iter__", 0);

  /* "sanpera/image.pyx":830
 * 
 *     def __iter__(self):
 *         return self._names             # <<<<<<<<<<<<<<
 * 
 * # There is, conveniently, no way to get a list of built-in images or patterns
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_names_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":829
 *         return self._factory(key)
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return self._names
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("sanpera.image.BuiltinRegistry.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":835
 * # out of ImageMagick.  So, er, here are manual lists.
 * @BuiltinRegistry.create('granite', 'logo', 'netscape', 'rose', 'wizard')
 * def builtins(name):             # <<<<<<<<<<<<<<
 *     return Image.from_magick('magick:' + name)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_1builtins(PyObject *__pyx_self, PyObject *__pyx_v_name); /*proto*/
static PyMethodDef __pyx_mdef_7sanpera_5image_1builtins = {__Pyx_NAMESTR("builtins"), (PyCFunction)__pyx_pw_7sanpera_5image_1builtins, METH_O, __Pyx_DOCSTR(0)};
static PyObject *__pyx_pw_7sanpera_5image_1builtins(PyObject *__pyx_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("builtins (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_builtins(__pyx_self, ((PyObject *)__pyx_v_name));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_builtins(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("builtins", 0);

  /* "sanpera/image.pyx":836
 * @BuiltinRegistry.create('granite', 'logo', 'netscape', 'rose', 'wizard')
 * def builtins(name):
 *     return Image.from_magick('magick:' + name)             # <<<<<<<<<<<<<<
 * 
 * @BuiltinRegistry.create(
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_5image_Image)), __pyx_n_s_from_magick); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 836; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Add(__pyx_kp_s_magick, __pyx_v_name); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 836; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 836; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 836; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":835
 * # out of ImageMagick.  So, er, here are manual lists.
 * @BuiltinRegistry.create('granite', 'logo', 'netscape', 'rose', 'wizard')
 * def builtins(name):             # <<<<<<<<<<<<<<
 *     return Image.from_magick('magick:' + name)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.builtins", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "sanpera/image.pyx":851
 *     'verticalleftshingle', 'verticalrightshingle', 'verticalsaw',
 * )
 * def patterns(name):             # <<<<<<<<<<<<<<
 *     return Image.from_magick('pattern:' + name)
 */

/* Python wrapper */
static PyObject *__pyx_pw_7sanpera_5image_3patterns(PyObject *__pyx_self, PyObject *__pyx_v_name); /*proto*/
static PyMethodDef __pyx_mdef_7sanpera_5image_3patterns = {__Pyx_NAMESTR("patterns"), (PyCFunction)__pyx_pw_7sanpera_5image_3patterns, METH_O, __Pyx_DOCSTR(0)};
static PyObject *__pyx_pw_7sanpera_5image_3patterns(PyObject *__pyx_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("patterns (wrapper)", 0);
  __pyx_r = __pyx_pf_7sanpera_5image_2patterns(__pyx_self, ((PyObject *)__pyx_v_name));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_7sanpera_5image_2patterns(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("patterns", 0);

  /* "sanpera/image.pyx":852
 * )
 * def patterns(name):
 *     return Image.from_magick('pattern:' + name)             # <<<<<<<<<<<<<<
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)((PyObject*)__pyx_ptype_7sanpera_5image_Image)), __pyx_n_s_from_magick); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Add(__pyx_kp_s_pattern, __pyx_v_name); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "sanpera/image.pyx":851
 *     'verticalleftshingle', 'verticalrightshingle', 'verticalsaw',
 * )
 * def patterns(name):             # <<<<<<<<<<<<<<
 *     return Image.from_magick('pattern:' + name)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("sanpera.image.patterns", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static struct __pyx_vtabstruct_7sanpera_5image_ImageFrame __pyx_vtable_7sanpera_5image_ImageFrame;

static PyObject *__pyx_tp_new_7sanpera_5image_ImageFrame(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_7sanpera_5image_ImageFrame *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_7sanpera_5image_ImageFrame *)o);
  p->__pyx_vtab = __pyx_vtabptr_7sanpera_5image_ImageFrame;
  if (unlikely(__pyx_pw_7sanpera_5image_10ImageFrame_1__cinit__(o, __pyx_empty_tuple, NULL) < 0)) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_7sanpera_5image_ImageFrame(PyObject *o) {
  #if PY_VERSION_HEX >= 0x030400a1
  if (unlikely(Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !_PyGC_FINALIZED(o))) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_7sanpera_5image_10ImageFrame_3__dealloc__(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  (*Py_TYPE(o)->tp_free)(o);
}

static PyObject *__pyx_getprop_7sanpera_5image_10ImageFrame_canvas(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_7sanpera_5image_10ImageFrame_6canvas_1__get__(o);
}

static PyObject *__pyx_getprop_7sanpera_5image_10ImageFrame_size(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_7sanpera_5image_10ImageFrame_4size_1__get__(o);
}

static PyObject *__pyx_getprop_7sanpera_5image_10ImageFrame_has_canvas(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_7sanpera_5image_10ImageFrame_10has_canvas_1__get__(o);
}

static PyObject *__pyx_getprop_7sanpera_5image_10ImageFrame_translucent(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_7sanpera_5image_10ImageFrame_11translucent_1__get__(o);
}

static int __pyx_setprop_7sanpera_5image_10ImageFrame_translucent(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_7sanpera_5image_10ImageFrame_11translucent_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyMethodDef __pyx_methods_7sanpera_5image_ImageFrame[] = {
  {__Pyx_NAMESTR("pixels"), (PyCFunction)__pyx_pw_7sanpera_5image_10ImageFrame_7pixels, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("tiled"), (PyCFunction)__pyx_pw_7sanpera_5image_10ImageFrame_9tiled, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("replace_color"), (PyCFunction)__pyx_pw_7sanpera_5image_10ImageFrame_11replace_color, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_7sanpera_5image_ImageFrame[] = {
  {(char *)"canvas", __pyx_getprop_7sanpera_5image_10ImageFrame_canvas, 0, __Pyx_DOCSTR(__pyx_k_Dimensions_and_offset_of_the_dra), 0},
  {(char *)"size", __pyx_getprop_7sanpera_5image_10ImageFrame_size, 0, __Pyx_DOCSTR(__pyx_k_Size_of_the_frame_as_a_Size_Shor), 0},
  {(char *)"has_canvas", __pyx_getprop_7sanpera_5image_10ImageFrame_has_canvas, 0, __Pyx_DOCSTR(__pyx_k_Returns_True_if_this_frame_has_a), 0},
  {(char *)"translucent", __pyx_getprop_7sanpera_5image_10ImageFrame_translucent, __pyx_setprop_7sanpera_5image_10ImageFrame_translucent, __Pyx_DOCSTR(__pyx_k_True_if_this_frame_has_an_alpha), 0},
  {0, 0, 0, 0, 0}
};

static PyTypeObject __pyx_type_7sanpera_5image_ImageFrame = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("sanpera.image.ImageFrame"), /*tp_name*/
  sizeof(struct __pyx_obj_7sanpera_5image_ImageFrame), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_7sanpera_5image_ImageFrame, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  __Pyx_DOCSTR("Represents a single frame, and knows how to perform most operations on\n    it.\n    "), /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_7sanpera_5image_ImageFrame, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_7sanpera_5image_ImageFrame, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_7sanpera_5image_10ImageFrame_5__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_7sanpera_5image_ImageFrame, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *__pyx_freelist_7sanpera_5image___pyx_scope_struct_1___iter__[8];
static int __pyx_freecount_7sanpera_5image___pyx_scope_struct_1___iter__ = 0;

static PyObject *__pyx_tp_new_7sanpera_5image___pyx_scope_struct_1___iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (likely((__pyx_freecount_7sanpera_5image___pyx_scope_struct_1___iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__)))) {
    o = (PyObject*)__pyx_freelist_7sanpera_5image___pyx_scope_struct_1___iter__[--__pyx_freecount_7sanpera_5image___pyx_scope_struct_1___iter__];
    memset(o, 0, sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_7sanpera_5image___pyx_scope_struct_1___iter__(PyObject *o) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_frame);
  Py_CLEAR(p->__pyx_v_self);
  Py_CLEAR(p->__pyx_t_0);
  if ((__pyx_freecount_7sanpera_5image___pyx_scope_struct_1___iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__))) {
    __pyx_freelist_7sanpera_5image___pyx_scope_struct_1___iter__[__pyx_freecount_7sanpera_5image___pyx_scope_struct_1___iter__++] = ((struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_7sanpera_5image___pyx_scope_struct_1___iter__(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *)o;
  if (p->__pyx_v_frame) {
    e = (*v)(((PyObject*)p->__pyx_v_frame), a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject*)p->__pyx_v_self), a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_7sanpera_5image___pyx_scope_struct_1___iter__(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__ *)o;
  tmp = ((PyObject*)p->__pyx_v_frame);
  p->__pyx_v_frame = ((struct __pyx_obj_7sanpera_5image_ImageFrame *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_7sanpera_5image_Image *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_t_0);
  p->__pyx_t_0 = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyTypeObject __pyx_type_7sanpera_5image___pyx_scope_struct_1___iter__ = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("sanpera.image.__pyx_scope_struct_1___iter__"), /*tp_name*/
  sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_1___iter__), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_7sanpera_5image___pyx_scope_struct_1___iter__, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_7sanpera_5image___pyx_scope_struct_1___iter__, /*tp_traverse*/
  __pyx_tp_clear_7sanpera_5image___pyx_scope_struct_1___iter__, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_7sanpera_5image___pyx_scope_struct_1___iter__, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};
static struct __pyx_vtabstruct_7sanpera_5image_Image __pyx_vtable_7sanpera_5image_Image;

static PyObject *__pyx_tp_new_7sanpera_5image_Image(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_7sanpera_5image_Image *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_7sanpera_5image_Image *)o);
  p->__pyx_vtab = __pyx_vtabptr_7sanpera_5image_Image;
  p->_frames = ((PyObject*)Py_None); Py_INCREF(Py_None);
  if (unlikely(__pyx_pw_7sanpera_5image_5Image_1__cinit__(o, __pyx_empty_tuple, NULL) < 0)) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_7sanpera_5image_Image(PyObject *o) {
  struct __pyx_obj_7sanpera_5image_Image *p = (struct __pyx_obj_7sanpera_5image_Image *)o;
  #if PY_VERSION_HEX >= 0x030400a1
  if (unlikely(Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  PyObject_GC_UnTrack(o);
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_7sanpera_5image_5Image_3__dealloc__(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  Py_CLEAR(p->_frames);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_7sanpera_5image_Image(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_7sanpera_5image_Image *p = (struct __pyx_obj_7sanpera_5image_Image *)o;
  if (p->_frames) {
    e = (*v)(p->_frames, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_7sanpera_5image_Image(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_7sanpera_5image_Image *p = (struct __pyx_obj_7sanpera_5image_Image *)o;
  tmp = ((PyObject*)p->_frames);
  p->_frames = ((PyObject*)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}
static PyObject *__pyx_sq_item_7sanpera_5image_Image(PyObject *o, Py_ssize_t i) {
  PyObject *r;
  PyObject *x = PyInt_FromSsize_t(i); if(!x) return 0;
  r = Py_TYPE(o)->tp_as_mapping->mp_subscript(o, x);
  Py_DECREF(x);
  return r;
}

static PyObject *__pyx_getprop_7sanpera_5image_5Image_size(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_7sanpera_5image_5Image_4size_1__get__(o);
}

static PyObject *__pyx_getprop_7sanpera_5image_5Image_has_canvas(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_7sanpera_5image_5Image_10has_canvas_1__get__(o);
}

static PyObject *__pyx_getprop_7sanpera_5image_5Image_bit_depth(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_7sanpera_5image_5Image_9bit_depth_1__get__(o);
}

static int __pyx_setprop_7sanpera_5image_5Image_bit_depth(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_7sanpera_5image_5Image_9bit_depth_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyMethodDef __pyx_methods_7sanpera_5image_Image[] = {
  {__Pyx_NAMESTR("new"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_7new, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7sanpera_5image_5Image_6new)},
  {__Pyx_NAMESTR("read"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_9read, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("from_buffer"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_11from_buffer, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("from_magick"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_13from_magick, METH_O, __Pyx_DOCSTR(__pyx_doc_7sanpera_5image_5Image_12from_magick)},
  {__Pyx_NAMESTR("write"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_15write, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("to_buffer"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_17to_buffer, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("append"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_28append, METH_O, __Pyx_DOCSTR(__pyx_doc_7sanpera_5image_5Image_27append)},
  {__Pyx_NAMESTR("extend"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_30extend, METH_O, __Pyx_DOCSTR(__pyx_doc_7sanpera_5image_5Image_29extend)},
  {__Pyx_NAMESTR("consume"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_32consume, METH_O, __Pyx_DOCSTR(__pyx_doc_7sanpera_5image_5Image_31consume)},
  {__Pyx_NAMESTR("original_format"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_34original_format, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("raw_properties"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_36raw_properties, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("resized"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_38resized, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("cropped"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_40cropped, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("coalesced"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_42coalesced, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_7sanpera_5image_5Image_41coalesced)},
  {__Pyx_NAMESTR("optimized_for_animated_gif"), (PyCFunction)__pyx_pw_7sanpera_5image_5Image_44optimized_for_animated_gif, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_7sanpera_5image_5Image_43optimized_for_animated_gif)},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_7sanpera_5image_Image[] = {
  {(char *)"size", __pyx_getprop_7sanpera_5image_5Image_size, 0, __Pyx_DOCSTR(__pyx_k_The_image_dimensions_as_a_Size_E), 0},
  {(char *)"has_canvas", __pyx_getprop_7sanpera_5image_5Image_has_canvas, 0, __Pyx_DOCSTR(__pyx_k_Returns_True_iff_any_frame_has_a), 0},
  {(char *)"bit_depth", __pyx_getprop_7sanpera_5image_5Image_bit_depth, __pyx_setprop_7sanpera_5image_5Image_bit_depth, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_Image = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  __pyx_pw_7sanpera_5image_5Image_21__nonzero__, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_Image = {
  __pyx_pw_7sanpera_5image_5Image_19__len__, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  __pyx_sq_item_7sanpera_5image_Image, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_Image = {
  __pyx_pw_7sanpera_5image_5Image_19__len__, /*mp_length*/
  __pyx_pw_7sanpera_5image_5Image_26__getitem__, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyTypeObject __pyx_type_7sanpera_5image_Image = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("sanpera.image.Image"), /*tp_name*/
  sizeof(struct __pyx_obj_7sanpera_5image_Image), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_7sanpera_5image_Image, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number_Image, /*tp_as_number*/
  &__pyx_tp_as_sequence_Image, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_Image, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("An image.  If you don't know what this is, you may be using the wrong\n    library.\n    "), /*tp_doc*/
  __pyx_tp_traverse_7sanpera_5image_Image, /*tp_traverse*/
  __pyx_tp_clear_7sanpera_5image_Image, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_7sanpera_5image_5Image_23__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_7sanpera_5image_Image, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_7sanpera_5image_Image, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_7sanpera_5image_5Image_5__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_7sanpera_5image_Image, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *__pyx_freelist_7sanpera_5image___pyx_scope_struct____iter__[8];
static int __pyx_freecount_7sanpera_5image___pyx_scope_struct____iter__ = 0;

static PyObject *__pyx_tp_new_7sanpera_5image___pyx_scope_struct____iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (likely((__pyx_freecount_7sanpera_5image___pyx_scope_struct____iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__)))) {
    o = (PyObject*)__pyx_freelist_7sanpera_5image___pyx_scope_struct____iter__[--__pyx_freecount_7sanpera_5image___pyx_scope_struct____iter__];
    memset(o, 0, sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_7sanpera_5image___pyx_scope_struct____iter__(PyObject *o) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_exc);
  Py_CLEAR(p->__pyx_v_pixel);
  Py_CLEAR(p->__pyx_v_rect);
  Py_CLEAR(p->__pyx_v_self);
  if ((__pyx_freecount_7sanpera_5image___pyx_scope_struct____iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__))) {
    __pyx_freelist_7sanpera_5image___pyx_scope_struct____iter__[__pyx_freecount_7sanpera_5image___pyx_scope_struct____iter__++] = ((struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_7sanpera_5image___pyx_scope_struct____iter__(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *)o;
  if (p->__pyx_v_exc) {
    e = (*v)(((PyObject*)p->__pyx_v_exc), a); if (e) return e;
  }
  if (p->__pyx_v_pixel) {
    e = (*v)(((PyObject*)p->__pyx_v_pixel), a); if (e) return e;
  }
  if (p->__pyx_v_rect) {
    e = (*v)(p->__pyx_v_rect, a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject*)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_7sanpera_5image___pyx_scope_struct____iter__(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__ *)o;
  tmp = ((PyObject*)p->__pyx_v_exc);
  p->__pyx_v_exc = ((struct __pyx_obj_7sanpera_9exception_MagickException *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_pixel);
  p->__pyx_v_pixel = ((struct __pyx_obj_7sanpera_5image_PixelViewPixel *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_rect);
  p->__pyx_v_rect = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_7sanpera_5image_PixelView *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyTypeObject __pyx_type_7sanpera_5image___pyx_scope_struct____iter__ = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("sanpera.image.__pyx_scope_struct____iter__"), /*tp_name*/
  sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct____iter__), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_7sanpera_5image___pyx_scope_struct____iter__, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_7sanpera_5image___pyx_scope_struct____iter__, /*tp_traverse*/
  __pyx_tp_clear_7sanpera_5image___pyx_scope_struct____iter__, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_7sanpera_5image___pyx_scope_struct____iter__, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyObject *__pyx_tp_new_7sanpera_5image_PixelViewPixel(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_7sanpera_5image_PixelViewPixel *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_7sanpera_5image_PixelViewPixel *)o);
  p->owner = ((struct __pyx_obj_7sanpera_5image_PixelView *)Py_None); Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_7sanpera_5image_PixelViewPixel(PyObject *o) {
  struct __pyx_obj_7sanpera_5image_PixelViewPixel *p = (struct __pyx_obj_7sanpera_5image_PixelViewPixel *)o;
  #if PY_VERSION_HEX >= 0x030400a1
  if (unlikely(Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->owner);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_7sanpera_5image_PixelViewPixel(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_7sanpera_5image_PixelViewPixel *p = (struct __pyx_obj_7sanpera_5image_PixelViewPixel *)o;
  if (p->owner) {
    e = (*v)(((PyObject*)p->owner), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_7sanpera_5image_PixelViewPixel(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_7sanpera_5image_PixelViewPixel *p = (struct __pyx_obj_7sanpera_5image_PixelViewPixel *)o;
  tmp = ((PyObject*)p->owner);
  p->owner = ((struct __pyx_obj_7sanpera_5image_PixelView *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_getprop_7sanpera_5image_14PixelViewPixel_color(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_7sanpera_5image_14PixelViewPixel_5color_1__get__(o);
}

static int __pyx_setprop_7sanpera_5image_14PixelViewPixel_color(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_7sanpera_5image_14PixelViewPixel_5color_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_7sanpera_5image_14PixelViewPixel_point(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_7sanpera_5image_14PixelViewPixel_5point_1__get__(o);
}

static PyMethodDef __pyx_methods_7sanpera_5image_PixelViewPixel[] = {
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_7sanpera_5image_PixelViewPixel[] = {
  {(char *)"color", __pyx_getprop_7sanpera_5image_14PixelViewPixel_color, __pyx_setprop_7sanpera_5image_14PixelViewPixel_color, 0, 0},
  {(char *)"point", __pyx_getprop_7sanpera_5image_14PixelViewPixel_point, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyTypeObject __pyx_type_7sanpera_5image_PixelViewPixel = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("sanpera.image.PixelViewPixel"), /*tp_name*/
  sizeof(struct __pyx_obj_7sanpera_5image_PixelViewPixel), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_7sanpera_5image_PixelViewPixel, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("Transient pixel access object.  Can be used to examine and set a single\n    pixel's color.\n    "), /*tp_doc*/
  __pyx_tp_traverse_7sanpera_5image_PixelViewPixel, /*tp_traverse*/
  __pyx_tp_clear_7sanpera_5image_PixelViewPixel, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_7sanpera_5image_PixelViewPixel, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_7sanpera_5image_PixelViewPixel, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_7sanpera_5image_14PixelViewPixel_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_7sanpera_5image_PixelViewPixel, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyObject *__pyx_tp_new_7sanpera_5image_PixelView(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_7sanpera_5image_PixelView *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_7sanpera_5image_PixelView *)o);
  p->_frame = ((struct __pyx_obj_7sanpera_5image_ImageFrame *)Py_None); Py_INCREF(Py_None);
  if (unlikely(__pyx_pw_7sanpera_5image_9PixelView_1__cinit__(o, __pyx_empty_tuple, NULL) < 0)) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_7sanpera_5image_PixelView(PyObject *o) {
  struct __pyx_obj_7sanpera_5image_PixelView *p = (struct __pyx_obj_7sanpera_5image_PixelView *)o;
  #if PY_VERSION_HEX >= 0x030400a1
  if (unlikely(Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  PyObject_GC_UnTrack(o);
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_7sanpera_5image_9PixelView_5__dealloc__(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  Py_CLEAR(p->_frame);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_7sanpera_5image_PixelView(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_7sanpera_5image_PixelView *p = (struct __pyx_obj_7sanpera_5image_PixelView *)o;
  if (p->_frame) {
    e = (*v)(((PyObject*)p->_frame), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_7sanpera_5image_PixelView(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_7sanpera_5image_PixelView *p = (struct __pyx_obj_7sanpera_5image_PixelView *)o;
  tmp = ((PyObject*)p->_frame);
  p->_frame = ((struct __pyx_obj_7sanpera_5image_ImageFrame *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}
static PyObject *__pyx_sq_item_7sanpera_5image_PixelView(PyObject *o, Py_ssize_t i) {
  PyObject *r;
  PyObject *x = PyInt_FromSsize_t(i); if(!x) return 0;
  r = Py_TYPE(o)->tp_as_mapping->mp_subscript(o, x);
  Py_DECREF(x);
  return r;
}

static PyMethodDef __pyx_methods_7sanpera_5image_PixelView[] = {
  {0, 0, 0, 0}
};

static PySequenceMethods __pyx_tp_as_sequence_PixelView = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  __pyx_sq_item_7sanpera_5image_PixelView, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_PixelView = {
  0, /*mp_length*/
  __pyx_pw_7sanpera_5image_9PixelView_7__getitem__, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyTypeObject __pyx_type_7sanpera_5image_PixelView = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("sanpera.image.PixelView"), /*tp_name*/
  sizeof(struct __pyx_obj_7sanpera_5image_PixelView), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_7sanpera_5image_PixelView, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  &__pyx_tp_as_sequence_PixelView, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_PixelView, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("Can view and manipulate individual pixels of a frame."), /*tp_doc*/
  __pyx_tp_traverse_7sanpera_5image_PixelView, /*tp_traverse*/
  __pyx_tp_clear_7sanpera_5image_PixelView, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_7sanpera_5image_9PixelView_9__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_7sanpera_5image_PixelView, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_7sanpera_5image_9PixelView_3__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_7sanpera_5image_PixelView, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *__pyx_freelist_7sanpera_5image___pyx_scope_struct_4_create[8];
static int __pyx_freecount_7sanpera_5image___pyx_scope_struct_4_create = 0;

static PyObject *__pyx_tp_new_7sanpera_5image___pyx_scope_struct_4_create(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (likely((__pyx_freecount_7sanpera_5image___pyx_scope_struct_4_create > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create)))) {
    o = (PyObject*)__pyx_freelist_7sanpera_5image___pyx_scope_struct_4_create[--__pyx_freecount_7sanpera_5image___pyx_scope_struct_4_create];
    memset(o, 0, sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_7sanpera_5image___pyx_scope_struct_4_create(PyObject *o) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_cls);
  Py_CLEAR(p->__pyx_v_names);
  if ((__pyx_freecount_7sanpera_5image___pyx_scope_struct_4_create < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create))) {
    __pyx_freelist_7sanpera_5image___pyx_scope_struct_4_create[__pyx_freecount_7sanpera_5image___pyx_scope_struct_4_create++] = ((struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_7sanpera_5image___pyx_scope_struct_4_create(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *)o;
  if (p->__pyx_v_cls) {
    e = (*v)(p->__pyx_v_cls, a); if (e) return e;
  }
  if (p->__pyx_v_names) {
    e = (*v)(p->__pyx_v_names, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_7sanpera_5image___pyx_scope_struct_4_create(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create *)o;
  tmp = ((PyObject*)p->__pyx_v_cls);
  p->__pyx_v_cls = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_names);
  p->__pyx_v_names = ((PyObject*)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyTypeObject __pyx_type_7sanpera_5image___pyx_scope_struct_4_create = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("sanpera.image.__pyx_scope_struct_4_create"), /*tp_name*/
  sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_4_create), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_7sanpera_5image___pyx_scope_struct_4_create, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_7sanpera_5image___pyx_scope_struct_4_create, /*tp_traverse*/
  __pyx_tp_clear_7sanpera_5image___pyx_scope_struct_4_create, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_7sanpera_5image___pyx_scope_struct_4_create, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *__pyx_freelist_7sanpera_5image___pyx_scope_struct_2___get__[8];
static int __pyx_freecount_7sanpera_5image___pyx_scope_struct_2___get__ = 0;

static PyObject *__pyx_tp_new_7sanpera_5image___pyx_scope_struct_2___get__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (likely((__pyx_freecount_7sanpera_5image___pyx_scope_struct_2___get__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__)))) {
    o = (PyObject*)__pyx_freelist_7sanpera_5image___pyx_scope_struct_2___get__[--__pyx_freecount_7sanpera_5image___pyx_scope_struct_2___get__];
    memset(o, 0, sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_7sanpera_5image___pyx_scope_struct_2___get__(PyObject *o) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_self);
  if ((__pyx_freecount_7sanpera_5image___pyx_scope_struct_2___get__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__))) {
    __pyx_freelist_7sanpera_5image___pyx_scope_struct_2___get__[__pyx_freecount_7sanpera_5image___pyx_scope_struct_2___get__++] = ((struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_7sanpera_5image___pyx_scope_struct_2___get__(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *)o;
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject*)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_7sanpera_5image___pyx_scope_struct_2___get__(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *)o;
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_7sanpera_5image_Image *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyTypeObject __pyx_type_7sanpera_5image___pyx_scope_struct_2___get__ = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("sanpera.image.__pyx_scope_struct_2___get__"), /*tp_name*/
  sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_7sanpera_5image___pyx_scope_struct_2___get__, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_7sanpera_5image___pyx_scope_struct_2___get__, /*tp_traverse*/
  __pyx_tp_clear_7sanpera_5image___pyx_scope_struct_2___get__, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_7sanpera_5image___pyx_scope_struct_2___get__, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *__pyx_freelist_7sanpera_5image___pyx_scope_struct_3_genexpr[8];
static int __pyx_freecount_7sanpera_5image___pyx_scope_struct_3_genexpr = 0;

static PyObject *__pyx_tp_new_7sanpera_5image___pyx_scope_struct_3_genexpr(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (likely((__pyx_freecount_7sanpera_5image___pyx_scope_struct_3_genexpr > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr)))) {
    o = (PyObject*)__pyx_freelist_7sanpera_5image___pyx_scope_struct_3_genexpr[--__pyx_freecount_7sanpera_5image___pyx_scope_struct_3_genexpr];
    memset(o, 0, sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_7sanpera_5image___pyx_scope_struct_3_genexpr(PyObject *o) {
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_outer_scope);
  Py_CLEAR(p->__pyx_v_f);
  Py_CLEAR(p->__pyx_t_0);
  if ((__pyx_freecount_7sanpera_5image___pyx_scope_struct_3_genexpr < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr))) {
    __pyx_freelist_7sanpera_5image___pyx_scope_struct_3_genexpr[__pyx_freecount_7sanpera_5image___pyx_scope_struct_3_genexpr++] = ((struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_7sanpera_5image___pyx_scope_struct_3_genexpr(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *)o;
  if (p->__pyx_outer_scope) {
    e = (*v)(((PyObject*)p->__pyx_outer_scope), a); if (e) return e;
  }
  if (p->__pyx_v_f) {
    e = (*v)(p->__pyx_v_f, a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_7sanpera_5image___pyx_scope_struct_3_genexpr(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *p = (struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr *)o;
  tmp = ((PyObject*)p->__pyx_outer_scope);
  p->__pyx_outer_scope = ((struct __pyx_obj_7sanpera_5image___pyx_scope_struct_2___get__ *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_f);
  p->__pyx_v_f = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_t_0);
  p->__pyx_t_0 = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyTypeObject __pyx_type_7sanpera_5image___pyx_scope_struct_3_genexpr = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("sanpera.image.__pyx_scope_struct_3_genexpr"), /*tp_name*/
  sizeof(struct __pyx_obj_7sanpera_5image___pyx_scope_struct_3_genexpr), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_7sanpera_5image___pyx_scope_struct_3_genexpr, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_7sanpera_5image___pyx_scope_struct_3_genexpr, /*tp_traverse*/
  __pyx_tp_clear_7sanpera_5image___pyx_scope_struct_3_genexpr, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_7sanpera_5image___pyx_scope_struct_3_genexpr, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyMethodDef __pyx_methods[] = {
  {0, 0, 0, 0}
};

#if PY_MAJOR_VERSION >= 3
static struct PyModuleDef __pyx_moduledef = {
  #if PY_VERSION_HEX < 0x03020000
    { PyObject_HEAD_INIT(NULL) NULL, 0, NULL },
  #else
    PyModuleDef_HEAD_INIT,
  #endif
    __Pyx_NAMESTR("image"),
    __Pyx_DOCSTR(__pyx_k_Image_class_and_assorted_helper), /* m_doc */
    -1, /* m_size */
    __pyx_methods /* m_methods */,
    NULL, /* m_reload */
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_n_s_AttributeError, __pyx_k_AttributeError, sizeof(__pyx_k_AttributeError), 0, 0, 1, 1},
  {&__pyx_n_s_BuiltinRegistry, __pyx_k_BuiltinRegistry, sizeof(__pyx_k_BuiltinRegistry), 0, 0, 1, 1},
  {&__pyx_n_s_BuiltinRegistry___getattr, __pyx_k_BuiltinRegistry___getattr, sizeof(__pyx_k_BuiltinRegistry___getattr), 0, 0, 1, 1},
  {&__pyx_n_s_BuiltinRegistry___init, __pyx_k_BuiltinRegistry___init, sizeof(__pyx_k_BuiltinRegistry___init), 0, 0, 1, 1},
  {&__pyx_n_s_BuiltinRegistry___iter, __pyx_k_BuiltinRegistry___iter, sizeof(__pyx_k_BuiltinRegistry___iter), 0, 0, 1, 1},
  {&__pyx_n_s_BuiltinRegistry_create, __pyx_k_BuiltinRegistry_create, sizeof(__pyx_k_BuiltinRegistry_create), 0, 0, 1, 1},
  {&__pyx_n_s_BuiltinRegistry_create_locals_de, __pyx_k_BuiltinRegistry_create_locals_de, sizeof(__pyx_k_BuiltinRegistry_create_locals_de), 0, 0, 1, 1},
  {&__pyx_n_s_EmptyImageError, __pyx_k_EmptyImageError, sizeof(__pyx_k_EmptyImageError), 0, 0, 1, 1},
  {&__pyx_n_s_Exception, __pyx_k_Exception, sizeof(__pyx_k_Exception), 0, 0, 1, 1},
  {&__pyx_n_s_IOError, __pyx_k_IOError, sizeof(__pyx_k_IOError), 0, 0, 1, 1},
  {&__pyx_n_s_MissingFormatError, __pyx_k_MissingFormatError, sizeof(__pyx_k_MissingFormatError), 0, 0, 1, 1},
  {&__pyx_kp_s_PixelViewPixel_cannot_be_instant, __pyx_k_PixelViewPixel_cannot_be_instant, sizeof(__pyx_k_PixelViewPixel_cannot_be_instant), 0, 0, 1, 0},
  {&__pyx_kp_s_Pixel_has_expired, __pyx_k_Pixel_has_expired, sizeof(__pyx_k_Pixel_has_expired), 0, 0, 1, 0},
  {&__pyx_kp_s_RawFrames_cannot_be_instantiated, __pyx_k_RawFrames_cannot_be_instantiated, sizeof(__pyx_k_RawFrames_cannot_be_instantiated), 0, 0, 1, 0},
  {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
  {&__pyx_kp_s_Users_habnabit_src_weasyl_sanpe, __pyx_k_Users_habnabit_src_weasyl_sanpe, sizeof(__pyx_k_Users_habnabit_src_weasyl_sanpe), 0, 0, 1, 0},
  {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
  {&__pyx_n_s_any, __pyx_k_any, sizeof(__pyx_k_any), 0, 0, 1, 1},
  {&__pyx_n_s_args, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
  {&__pyx_n_s_bottom, __pyx_k_bottom, sizeof(__pyx_k_bottom), 0, 0, 1, 1},
  {&__pyx_n_s_box, __pyx_k_box, sizeof(__pyx_k_box), 0, 0, 1, 1},
  {&__pyx_n_s_bricks, __pyx_k_bricks, sizeof(__pyx_k_bricks), 0, 0, 1, 1},
  {&__pyx_n_s_builtins, __pyx_k_builtins, sizeof(__pyx_k_builtins), 0, 0, 1, 1},
  {&__pyx_n_s_canvas, __pyx_k_canvas, sizeof(__pyx_k_canvas), 0, 0, 1, 1},
  {&__pyx_n_s_check, __pyx_k_check, sizeof(__pyx_k_check), 0, 0, 1, 1},
  {&__pyx_n_s_checkerboard, __pyx_k_checkerboard, sizeof(__pyx_k_checkerboard), 0, 0, 1, 1},
  {&__pyx_n_s_circles, __pyx_k_circles, sizeof(__pyx_k_circles), 0, 0, 1, 1},
  {&__pyx_n_s_class, __pyx_k_class, sizeof(__pyx_k_class), 0, 0, 1, 1},
  {&__pyx_n_s_close, __pyx_k_close, sizeof(__pyx_k_close), 0, 0, 1, 1},
  {&__pyx_n_s_cls, __pyx_k_cls, sizeof(__pyx_k_cls), 0, 0, 1, 1},
  {&__pyx_n_s_coerce, __pyx_k_coerce, sizeof(__pyx_k_coerce), 0, 0, 1, 1},
  {&__pyx_n_s_collections, __pyx_k_collections, sizeof(__pyx_k_collections), 0, 0, 1, 1},
  {&__pyx_n_s_color, __pyx_k_color, sizeof(__pyx_k_color), 0, 0, 1, 1},
  {&__pyx_n_s_create, __pyx_k_create, sizeof(__pyx_k_create), 0, 0, 1, 1},
  {&__pyx_n_s_crosshatch, __pyx_k_crosshatch, sizeof(__pyx_k_crosshatch), 0, 0, 1, 1},
  {&__pyx_n_s_crosshatch30, __pyx_k_crosshatch30, sizeof(__pyx_k_crosshatch30), 0, 0, 1, 1},
  {&__pyx_n_s_crosshatch45, __pyx_k_crosshatch45, sizeof(__pyx_k_crosshatch45), 0, 0, 1, 1},
  {&__pyx_n_s_decorator, __pyx_k_decorator, sizeof(__pyx_k_decorator), 0, 0, 1, 1},
  {&__pyx_n_s_doc, __pyx_k_doc, sizeof(__pyx_k_doc), 0, 0, 1, 1},
  {&__pyx_n_s_f, __pyx_k_f, sizeof(__pyx_k_f), 0, 0, 1, 1},
  {&__pyx_n_s_factory, __pyx_k_factory, sizeof(__pyx_k_factory), 0, 0, 1, 1},
  {&__pyx_n_s_factory_2, __pyx_k_factory_2, sizeof(__pyx_k_factory_2), 0, 0, 1, 1},
  {&__pyx_n_s_filename, __pyx_k_filename, sizeof(__pyx_k_filename), 0, 0, 1, 1},
  {&__pyx_n_s_fill, __pyx_k_fill, sizeof(__pyx_k_fill), 0, 0, 1, 1},
  {&__pyx_n_s_filter, __pyx_k_filter, sizeof(__pyx_k_filter), 0, 0, 1, 1},
  {&__pyx_n_s_fishscales, __pyx_k_fishscales, sizeof(__pyx_k_fishscales), 0, 0, 1, 1},
  {&__pyx_n_s_format, __pyx_k_format, sizeof(__pyx_k_format), 0, 0, 1, 1},
  {&__pyx_n_s_frame, __pyx_k_frame, sizeof(__pyx_k_frame), 0, 0, 1, 1},
  {&__pyx_n_s_from_buffer, __pyx_k_from_buffer, sizeof(__pyx_k_from_buffer), 0, 0, 1, 1},
  {&__pyx_n_s_from_magick, __pyx_k_from_magick, sizeof(__pyx_k_from_magick), 0, 0, 1, 1},
  {&__pyx_n_s_fuzz, __pyx_k_fuzz, sizeof(__pyx_k_fuzz), 0, 0, 1, 1},
  {&__pyx_n_s_getattr, __pyx_k_getattr, sizeof(__pyx_k_getattr), 0, 0, 1, 1},
  {&__pyx_n_s_granite, __pyx_k_granite, sizeof(__pyx_k_granite), 0, 0, 1, 1},
  {&__pyx_n_s_gray0, __pyx_k_gray0, sizeof(__pyx_k_gray0), 0, 0, 1, 1},
  {&__pyx_n_s_gray10, __pyx_k_gray10, sizeof(__pyx_k_gray10), 0, 0, 1, 1},
  {&__pyx_n_s_gray100, __pyx_k_gray100, sizeof(__pyx_k_gray100), 0, 0, 1, 1},
  {&__pyx_n_s_gray15, __pyx_k_gray15, sizeof(__pyx_k_gray15), 0, 0, 1, 1},
  {&__pyx_n_s_gray20, __pyx_k_gray20, sizeof(__pyx_k_gray20), 0, 0, 1, 1},
  {&__pyx_n_s_gray25, __pyx_k_gray25, sizeof(__pyx_k_gray25), 0, 0, 1, 1},
  {&__pyx_n_s_gray30, __pyx_k_gray30, sizeof(__pyx_k_gray30), 0, 0, 1, 1},
  {&__pyx_n_s_gray35, __pyx_k_gray35, sizeof(__pyx_k_gray35), 0, 0, 1, 1},
  {&__pyx_n_s_gray40, __pyx_k_gray40, sizeof(__pyx_k_gray40), 0, 0, 1, 1},
  {&__pyx_n_s_gray45, __pyx_k_gray45, sizeof(__pyx_k_gray45), 0, 0, 1, 1},
  {&__pyx_n_s_gray5, __pyx_k_gray5, sizeof(__pyx_k_gray5), 0, 0, 1, 1},
  {&__pyx_n_s_gray50, __pyx_k_gray50, sizeof(__pyx_k_gray50), 0, 0, 1, 1},
  {&__pyx_n_s_gray55, __pyx_k_gray55, sizeof(__pyx_k_gray55), 0, 0, 1, 1},
  {&__pyx_n_s_gray60, __pyx_k_gray60, sizeof(__pyx_k_gray60), 0, 0, 1, 1},
  {&__pyx_n_s_gray65, __pyx_k_gray65, sizeof(__pyx_k_gray65), 0, 0, 1, 1},
  {&__pyx_n_s_gray70, __pyx_k_gray70, sizeof(__pyx_k_gray70), 0, 0, 1, 1},
  {&__pyx_n_s_gray75, __pyx_k_gray75, sizeof(__pyx_k_gray75), 0, 0, 1, 1},
  {&__pyx_n_s_gray80, __pyx_k_gray80, sizeof(__pyx_k_gray80), 0, 0, 1, 1},
  {&__pyx_n_s_gray85, __pyx_k_gray85, sizeof(__pyx_k_gray85), 0, 0, 1, 1},
  {&__pyx_n_s_gray90, __pyx_k_gray90, sizeof(__pyx_k_gray90), 0, 0, 1, 1},
  {&__pyx_n_s_gray95, __pyx_k_gray95, sizeof(__pyx_k_gray95), 0, 0, 1, 1},
  {&__pyx_n_s_has_canvas, __pyx_k_has_canvas, sizeof(__pyx_k_has_canvas), 0, 0, 1, 1},
  {&__pyx_n_s_height, __pyx_k_height, sizeof(__pyx_k_height), 0, 0, 1, 1},
  {&__pyx_n_s_hexagons, __pyx_k_hexagons, sizeof(__pyx_k_hexagons), 0, 0, 1, 1},
  {&__pyx_n_s_horizontal, __pyx_k_horizontal, sizeof(__pyx_k_horizontal), 0, 0, 1, 1},
  {&__pyx_n_s_horizontal2, __pyx_k_horizontal2, sizeof(__pyx_k_horizontal2), 0, 0, 1, 1},
  {&__pyx_n_s_horizontal3, __pyx_k_horizontal3, sizeof(__pyx_k_horizontal3), 0, 0, 1, 1},
  {&__pyx_n_s_horizontalsaw, __pyx_k_horizontalsaw, sizeof(__pyx_k_horizontalsaw), 0, 0, 1, 1},
  {&__pyx_n_s_hs_bdiagonal, __pyx_k_hs_bdiagonal, sizeof(__pyx_k_hs_bdiagonal), 0, 0, 1, 1},
  {&__pyx_n_s_hs_cross, __pyx_k_hs_cross, sizeof(__pyx_k_hs_cross), 0, 0, 1, 1},
  {&__pyx_n_s_hs_diagcross, __pyx_k_hs_diagcross, sizeof(__pyx_k_hs_diagcross), 0, 0, 1, 1},
  {&__pyx_n_s_hs_fdiagonal, __pyx_k_hs_fdiagonal, sizeof(__pyx_k_hs_fdiagonal), 0, 0, 1, 1},
  {&__pyx_n_s_hs_horizontal, __pyx_k_hs_horizontal, sizeof(__pyx_k_hs_horizontal), 0, 0, 1, 1},
  {&__pyx_n_s_hs_vertical, __pyx_k_hs_vertical, sizeof(__pyx_k_hs_vertical), 0, 0, 1, 1},
  {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
  {&__pyx_n_s_init, __pyx_k_init, sizeof(__pyx_k_init), 0, 0, 1, 1},
  {&__pyx_n_s_iter, __pyx_k_iter, sizeof(__pyx_k_iter), 0, 0, 1, 1},
  {&__pyx_n_s_key, __pyx_k_key, sizeof(__pyx_k_key), 0, 0, 1, 1},
  {&__pyx_n_s_left, __pyx_k_left, sizeof(__pyx_k_left), 0, 0, 1, 1},
  {&__pyx_n_s_left30, __pyx_k_left30, sizeof(__pyx_k_left30), 0, 0, 1, 1},
  {&__pyx_n_s_left45, __pyx_k_left45, sizeof(__pyx_k_left45), 0, 0, 1, 1},
  {&__pyx_n_s_leftshingle, __pyx_k_leftshingle, sizeof(__pyx_k_leftshingle), 0, 0, 1, 1},
  {&__pyx_n_s_logo, __pyx_k_logo, sizeof(__pyx_k_logo), 0, 0, 1, 1},
  {&__pyx_kp_s_magick, __pyx_k_magick, sizeof(__pyx_k_magick), 0, 0, 1, 0},
  {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
  {&__pyx_n_s_metaclass, __pyx_k_metaclass, sizeof(__pyx_k_metaclass), 0, 0, 1, 1},
  {&__pyx_n_s_module, __pyx_k_module, sizeof(__pyx_k_module), 0, 0, 1, 1},
  {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
  {&__pyx_n_s_namedtuple, __pyx_k_namedtuple, sizeof(__pyx_k_namedtuple), 0, 0, 1, 1},
  {&__pyx_n_s_names, __pyx_k_names, sizeof(__pyx_k_names), 0, 0, 1, 1},
  {&__pyx_n_s_names_2, __pyx_k_names_2, sizeof(__pyx_k_names_2), 0, 0, 1, 1},
  {&__pyx_n_s_netscape, __pyx_k_netscape, sizeof(__pyx_k_netscape), 0, 0, 1, 1},
  {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
  {&__pyx_n_s_obj, __pyx_k_obj, sizeof(__pyx_k_obj), 0, 0, 1, 1},
  {&__pyx_n_s_object, __pyx_k_object, sizeof(__pyx_k_object), 0, 0, 1, 1},
  {&__pyx_n_s_octagons, __pyx_k_octagons, sizeof(__pyx_k_octagons), 0, 0, 1, 1},
  {&__pyx_n_s_original_format, __pyx_k_original_format, sizeof(__pyx_k_original_format), 0, 0, 1, 1},
  {&__pyx_kp_s_pattern, __pyx_k_pattern, sizeof(__pyx_k_pattern), 0, 0, 1, 0},
  {&__pyx_n_s_patterns, __pyx_k_patterns, sizeof(__pyx_k_patterns), 0, 0, 1, 1},
  {&__pyx_n_s_pixels, __pyx_k_pixels, sizeof(__pyx_k_pixels), 0, 0, 1, 1},
  {&__pyx_n_s_prepare, __pyx_k_prepare, sizeof(__pyx_k_prepare), 0, 0, 1, 1},
  {&__pyx_n_s_preserve_canvas, __pyx_k_preserve_canvas, sizeof(__pyx_k_preserve_canvas), 0, 0, 1, 1},
  {&__pyx_n_s_property, __pyx_k_property, sizeof(__pyx_k_property), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_vtable, __pyx_k_pyx_vtable, sizeof(__pyx_k_pyx_vtable), 0, 0, 1, 1},
  {&__pyx_n_s_qualname, __pyx_k_qualname, sizeof(__pyx_k_qualname), 0, 0, 1, 1},
  {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
  {&__pyx_n_s_raw_properties, __pyx_k_raw_properties, sizeof(__pyx_k_raw_properties), 0, 0, 1, 1},
  {&__pyx_n_s_read, __pyx_k_read, sizeof(__pyx_k_read), 0, 0, 1, 1},
  {&__pyx_n_s_rect, __pyx_k_rect, sizeof(__pyx_k_rect), 0, 0, 1, 1},
  {&__pyx_n_s_replacement, __pyx_k_replacement, sizeof(__pyx_k_replacement), 0, 0, 1, 1},
  {&__pyx_n_s_rgba, __pyx_k_rgba, sizeof(__pyx_k_rgba), 0, 0, 1, 1},
  {&__pyx_n_s_right, __pyx_k_right, sizeof(__pyx_k_right), 0, 0, 1, 1},
  {&__pyx_n_s_right30, __pyx_k_right30, sizeof(__pyx_k_right30), 0, 0, 1, 1},
  {&__pyx_n_s_right45, __pyx_k_right45, sizeof(__pyx_k_right45), 0, 0, 1, 1},
  {&__pyx_n_s_rightshingle, __pyx_k_rightshingle, sizeof(__pyx_k_rightshingle), 0, 0, 1, 1},
  {&__pyx_n_s_rose, __pyx_k_rose, sizeof(__pyx_k_rose), 0, 0, 1, 1},
  {&__pyx_n_s_sanpera_exception, __pyx_k_sanpera_exception, sizeof(__pyx_k_sanpera_exception), 0, 0, 1, 1},
  {&__pyx_n_s_sanpera_image, __pyx_k_sanpera_image, sizeof(__pyx_k_sanpera_image), 0, 0, 1, 1},
  {&__pyx_n_s_self, __pyx_k_self, sizeof(__pyx_k_self), 0, 0, 1, 1},
  {&__pyx_n_s_send, __pyx_k_send, sizeof(__pyx_k_send), 0, 0, 1, 1},
  {&__pyx_n_s_size, __pyx_k_size, sizeof(__pyx_k_size), 0, 0, 1, 1},
  {&__pyx_n_s_smallfishscales, __pyx_k_smallfishscales, sizeof(__pyx_k_smallfishscales), 0, 0, 1, 1},
  {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
  {&__pyx_n_s_throw, __pyx_k_throw, sizeof(__pyx_k_throw), 0, 0, 1, 1},
  {&__pyx_n_s_top, __pyx_k_top, sizeof(__pyx_k_top), 0, 0, 1, 1},
  {&__pyx_n_s_translucent, __pyx_k_translucent, sizeof(__pyx_k_translucent), 0, 0, 1, 1},
  {&__pyx_n_s_vertical, __pyx_k_vertical, sizeof(__pyx_k_vertical), 0, 0, 1, 1},
  {&__pyx_n_s_vertical2, __pyx_k_vertical2, sizeof(__pyx_k_vertical2), 0, 0, 1, 1},
  {&__pyx_n_s_vertical3, __pyx_k_vertical3, sizeof(__pyx_k_vertical3), 0, 0, 1, 1},
  {&__pyx_n_s_verticalbricks, __pyx_k_verticalbricks, sizeof(__pyx_k_verticalbricks), 0, 0, 1, 1},
  {&__pyx_n_s_verticalleftshingle, __pyx_k_verticalleftshingle, sizeof(__pyx_k_verticalleftshingle), 0, 0, 1, 1},
  {&__pyx_n_s_verticalrightshingle, __pyx_k_verticalrightshingle, sizeof(__pyx_k_verticalrightshingle), 0, 0, 1, 1},
  {&__pyx_n_s_verticalsaw, __pyx_k_verticalsaw, sizeof(__pyx_k_verticalsaw), 0, 0, 1, 1},
  {&__pyx_n_s_width, __pyx_k_width, sizeof(__pyx_k_width), 0, 0, 1, 1},
  {&__pyx_n_s_wizard, __pyx_k_wizard, sizeof(__pyx_k_wizard), 0, 0, 1, 1},
  {&__pyx_n_s_x, __pyx_k_x, sizeof(__pyx_k_x), 0, 0, 1, 1},
  {&__pyx_n_s_y, __pyx_k_y, sizeof(__pyx_k_y), 0, 0, 1, 1},
  {0, 0, 0, 0, 0, 0, 0}
};
static int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_property = __Pyx_GetBuiltinName(__pyx_n_s_property); if (!__pyx_builtin_property) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_object = __Pyx_GetBuiltinName(__pyx_n_s_object); if (!__pyx_builtin_object) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_IOError = __Pyx_GetBuiltinName(__pyx_n_s_IOError); if (!__pyx_builtin_IOError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 350; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_any = __Pyx_GetBuiltinName(__pyx_n_s_any); if (!__pyx_builtin_any) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_Exception = __Pyx_GetBuiltinName(__pyx_n_s_Exception); if (!__pyx_builtin_Exception) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_AttributeError = __Pyx_GetBuiltinName(__pyx_n_s_AttributeError); if (!__pyx_builtin_AttributeError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

static int __Pyx_InitCachedConstants(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);

  /* "sanpera/image.pyx":43
 * 
 *     def __init__(self):
 *         raise TypeError("PixelViewPixel cannot be instantiated directly")             # <<<<<<<<<<<<<<
 * 
 *     property color:
 */
  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_s_PixelViewPixel_cannot_be_instant); if (unlikely(!__pyx_tuple_)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple_);
  __Pyx_GIVEREF(__pyx_tuple_);

  /* "sanpera/image.pyx":49
 *         def __get__(self):
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")             # <<<<<<<<<<<<<<
 *             return RGBColor(
 *                 _quantum_to_double(self._pixel.red),
 */
  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_s_Pixel_has_expired); if (unlikely(!__pyx_tuple__2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__2);
  __Pyx_GIVEREF(__pyx_tuple__2);

  /* "sanpera/image.pyx":59
 *         def __set__(self, RGBColor value):
 *             if self._pixel == NULL:
 *                 raise ValueError("Pixel has expired")             # <<<<<<<<<<<<<<
 *             self._pixel.red = _double_to_quantum(value._red)
 *             self._pixel.green = _double_to_quantum(value._green)
 */
  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_Pixel_has_expired); if (unlikely(!__pyx_tuple__3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__3);
  __Pyx_GIVEREF(__pyx_tuple__3);

  /* "sanpera/image.pyx":198
 * 
 *     def __init__(self):
 *         raise TypeError("RawFrames cannot be instantiated directly")             # <<<<<<<<<<<<<<
 * 
 *     property canvas:
 */
  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_RawFrames_cannot_be_instantiated); if (unlikely(!__pyx_tuple__4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__4);
  __Pyx_GIVEREF(__pyx_tuple__4);

  /* "sanpera/image.pyx":334
 *             if fill is None:
 *                 # TODO need a way to explicitly create a certain color
 *                 fill = RGBColor(0., 0., 0., 0.)             # <<<<<<<<<<<<<<
 * 
 *             fill._populate_magick_pixel(&magick_pixel)
 */
  __pyx_tuple__5 = PyTuple_Pack(4, __pyx_float_0_, __pyx_float_0_, __pyx_float_0_, __pyx_float_0_); if (unlikely(!__pyx_tuple__5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__5);
  __Pyx_GIVEREF(__pyx_tuple__5);

  /* "sanpera/image.pyx":629
 *             # if this happens on load, try to preserve it with operations
 *             if self._stack == NULL:
 *                 return Size(0, 0)             # <<<<<<<<<<<<<<
 * 
 *             return Size(self._stack.page.width, self._stack.page.height)
 */
  __pyx_tuple__6 = PyTuple_Pack(2, __pyx_int_0, __pyx_int_0); if (unlikely(!__pyx_tuple__6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 629; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__6);
  __Pyx_GIVEREF(__pyx_tuple__6);

  /* "sanpera/image.pyx":813
 *     @classmethod
 *     def create(cls, *names):
 *         def decorator(f):             # <<<<<<<<<<<<<<
 *             obj = cls(f, names)
 *             obj.__doc__ = f.__doc__
 */
  __pyx_tuple__7 = PyTuple_Pack(2, __pyx_n_s_f, __pyx_n_s_obj); if (unlikely(!__pyx_tuple__7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 813; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__7);
  __Pyx_GIVEREF(__pyx_tuple__7);
  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__7, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_habnabit_src_weasyl_sanpe, __pyx_n_s_decorator, 813, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 813; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":812
 * 
 *     @classmethod
 *     def create(cls, *names):             # <<<<<<<<<<<<<<
 *         def decorator(f):
 *             obj = cls(f, names)
 */
  __pyx_tuple__9 = PyTuple_Pack(5, __pyx_n_s_cls, __pyx_n_s_names, __pyx_n_s_names, __pyx_n_s_decorator, __pyx_n_s_decorator); if (unlikely(!__pyx_tuple__9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 812; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__9);
  __Pyx_GIVEREF(__pyx_tuple__9);
  __pyx_codeobj__10 = (PyObject*)__Pyx_PyCode_New(1, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__9, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_habnabit_src_weasyl_sanpe, __pyx_n_s_create, 812, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 812; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":819
 *         return decorator
 * 
 *     def __init__(self, factory, names):             # <<<<<<<<<<<<<<
 *         self._factory = factory
 *         self._names = frozenset(names)
 */
  __pyx_tuple__11 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_factory, __pyx_n_s_names); if (unlikely(!__pyx_tuple__11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__11);
  __Pyx_GIVEREF(__pyx_tuple__11);
  __pyx_codeobj__12 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__11, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_habnabit_src_weasyl_sanpe, __pyx_n_s_init, 819, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":823
 *         self._names = frozenset(names)
 * 
 *     def __getattr__(self, key):             # <<<<<<<<<<<<<<
 *         if key not in self._names:
 *             raise AttributeError
 */
  __pyx_tuple__13 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_key); if (unlikely(!__pyx_tuple__13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__13);
  __Pyx_GIVEREF(__pyx_tuple__13);
  __pyx_codeobj__14 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__13, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_habnabit_src_weasyl_sanpe, __pyx_n_s_getattr, 823, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":829
 *         return self._factory(key)
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return self._names
 * 
 */
  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__15);
  __Pyx_GIVEREF(__pyx_tuple__15);
  __pyx_codeobj__16 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__15, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_habnabit_src_weasyl_sanpe, __pyx_n_s_iter, 829, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":834
 * # There is, conveniently, no way to get a list of built-in images or patterns
 * # out of ImageMagick.  So, er, here are manual lists.
 * @BuiltinRegistry.create('granite', 'logo', 'netscape', 'rose', 'wizard')             # <<<<<<<<<<<<<<
 * def builtins(name):
 *     return Image.from_magick('magick:' + name)
 */
  __pyx_tuple__17 = PyTuple_Pack(5, __pyx_n_s_granite, __pyx_n_s_logo, __pyx_n_s_netscape, __pyx_n_s_rose, __pyx_n_s_wizard); if (unlikely(!__pyx_tuple__17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 834; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__17);
  __Pyx_GIVEREF(__pyx_tuple__17);

  /* "sanpera/image.pyx":835
 * # out of ImageMagick.  So, er, here are manual lists.
 * @BuiltinRegistry.create('granite', 'logo', 'netscape', 'rose', 'wizard')
 * def builtins(name):             # <<<<<<<<<<<<<<
 *     return Image.from_magick('magick:' + name)
 * 
 */
  __pyx_tuple__18 = PyTuple_Pack(1, __pyx_n_s_name); if (unlikely(!__pyx_tuple__18)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__18);
  __Pyx_GIVEREF(__pyx_tuple__18);
  __pyx_codeobj__19 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__18, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_habnabit_src_weasyl_sanpe, __pyx_n_s_builtins, 835, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "sanpera/image.pyx":838
 *     return Image.from_magick('magick:' + name)
 * 
 * @BuiltinRegistry.create(             # <<<<<<<<<<<<<<
 *     'bricks', 'checkerboard', 'circles', 'crosshatch', 'crosshatch30',
 *     'crosshatch45', 'fishscales',
 */
  __pyx_tuple__20 = PyTuple_Pack(54, __pyx_n_s_bricks, __pyx_n_s_checkerboard, __pyx_n_s_circles, __pyx_n_s_crosshatch, __pyx_n_s_crosshatch30, __pyx_n_s_crosshatch45, __pyx_n_s_fishscales, __pyx_n_s_gray0, __pyx_n_s_gray5, __pyx_n_s_gray10, __pyx_n_s_gray15, __pyx_n_s_gray20, __pyx_n_s_gray25, __pyx_n_s_gray30, __pyx_n_s_gray35, __pyx_n_s_gray40, __pyx_n_s_gray45, __pyx_n_s_gray50, __pyx_n_s_gray55, __pyx_n_s_gray60, __pyx_n_s_gray65, __pyx_n_s_gray70, __pyx_n_s_gray75, __pyx_n_s_gray80, __pyx_n_s_gray85, __pyx_n_s_gray90, __pyx_n_s_gray95, __pyx_n_s_gray100, __pyx_n_s_hexagons, __pyx_n_s_horizontal, __pyx_n_s_horizontal2, __pyx_n_s_horizontal3, __pyx_n_s_horizontalsaw, __pyx_n_s_hs_bdiagonal, __pyx_n_s_hs_cross, __pyx_n_s_hs_diagcross, __pyx_n_s_hs_fdiagonal, __pyx_n_s_hs_horizontal, __pyx_n_s_hs_vertical, __pyx_n_s_left30, __pyx_n_s_left45, __pyx_n_s_leftshingle, __pyx_n_s_octagons, __pyx_n_s_right30, __pyx_n_s_right45, __pyx_n_s_rightshingle, __pyx_n_s_smallfishscales, __pyx_n_s_vertical, __pyx_n_s_vertical2, __pyx_n_s_vertical3, __pyx_n_s_verticalbricks, __pyx_n_s_verticalleftshingle, __pyx_n_s_verticalrightshingle, __pyx_n_s_verticalsaw); if (unlikely(!__pyx_tuple__20)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__20);
  __Pyx_GIVEREF(__pyx_tuple__20);

  /* "sanpera/image.pyx":851
 *     'verticalleftshingle', 'verticalrightshingle', 'verticalsaw',
 * )
 * def patterns(name):             # <<<<<<<<<<<<<<
 *     return Image.from_magick('pattern:' + name)
 */
  __pyx_tuple__21 = PyTuple_Pack(1, __pyx_n_s_name); if (unlikely(!__pyx_tuple__21)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 851; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__21);
  __Pyx_GIVEREF(__pyx_tuple__21);
  __pyx_codeobj__22 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__21, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_habnabit_src_weasyl_sanpe, __pyx_n_s_patterns, 851, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 851; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_RefNannyFinishContext();
  return -1;
}

static int __Pyx_InitGlobals(void) {
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_float_0_ = PyFloat_FromDouble(0.); if (unlikely(!__pyx_float_0_)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

#if PY_MAJOR_VERSION < 3
PyMODINIT_FUNC initimage(void); /*proto*/
PyMODINIT_FUNC initimage(void)
#else
PyMODINIT_FUNC PyInit_image(void); /*proto*/
PyMODINIT_FUNC PyInit_image(void)
#endif
{
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  #if CYTHON_REFNANNY
  __Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
  if (!__Pyx_RefNanny) {
      PyErr_Clear();
      __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
      if (!__Pyx_RefNanny)
          Py_FatalError("failed to import 'refnanny' module");
  }
  #endif
  __Pyx_RefNannySetupContext("PyMODINIT_FUNC PyInit_image(void)", 0);
  if ( __Pyx_check_binary_version() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #ifdef __Pyx_CyFunction_USED
  if (__Pyx_CyFunction_init() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  #ifdef __Pyx_FusedFunction_USED
  if (__pyx_FusedFunction_init() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  #ifdef __Pyx_Generator_USED
  if (__pyx_Generator_init() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  /*--- Library function declarations ---*/
  /*--- Threads initialization code ---*/
  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  #ifdef WITH_THREAD /* Python build with threading support? */
  PyEval_InitThreads();
  #endif
  #endif
  /*--- Module creation code ---*/
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4(__Pyx_NAMESTR("image"), __pyx_methods, __Pyx_DOCSTR(__pyx_k_Image_class_and_assorted_helper), 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (unlikely(!__pyx_m)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_d);
  __pyx_b = PyImport_AddModule(__Pyx_NAMESTR(__Pyx_BUILTIN_MODULE_NAME)); if (unlikely(!__pyx_b)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if CYTHON_COMPILING_IN_PYPY
  Py_INCREF(__pyx_b);
  #endif
  if (__Pyx_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  /*--- Initialize various global constants etc. ---*/
  if (unlikely(__Pyx_InitGlobals() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
  if (__Pyx_init_sys_getdefaultencoding_params() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  if (__pyx_module_is_main_sanpera__image) {
    if (__Pyx_SetAttrString(__pyx_m, "__name__", __pyx_n_s_main) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  }
  #if PY_MAJOR_VERSION >= 3
  {
    PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!PyDict_GetItemString(modules, "sanpera.image")) {
      if (unlikely(PyDict_SetItemString(modules, "sanpera.image", __pyx_m) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
  }
  #endif
  /*--- Builtin init code ---*/
  if (unlikely(__Pyx_InitCachedBuiltins() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Constants init code ---*/
  if (unlikely(__Pyx_InitCachedConstants() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Global init code ---*/
  /*--- Variable export code ---*/
  /*--- Function export code ---*/
  if (__Pyx_ExportFunction("_ImageFrame_factory", (void (*)(void))__pyx_f_7sanpera_5image__ImageFrame_factory, "struct __pyx_obj_7sanpera_5image_ImageFrame *(Image *)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Type init code ---*/
  __pyx_vtabptr_7sanpera_5image_ImageFrame = &__pyx_vtable_7sanpera_5image_ImageFrame;
  __pyx_vtable_7sanpera_5image_ImageFrame._set_frame = (PyObject *(*)(struct __pyx_obj_7sanpera_5image_ImageFrame *, Image *))__pyx_f_7sanpera_5image_10ImageFrame__set_frame;
  if (PyType_Ready(&__pyx_type_7sanpera_5image_ImageFrame) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_7sanpera_5image_ImageFrame.tp_print = 0;
  if (__Pyx_SetVtable(__pyx_type_7sanpera_5image_ImageFrame.tp_dict, __pyx_vtabptr_7sanpera_5image_ImageFrame) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "ImageFrame", (PyObject *)&__pyx_type_7sanpera_5image_ImageFrame) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_5image_ImageFrame = &__pyx_type_7sanpera_5image_ImageFrame;
  if (PyType_Ready(&__pyx_type_7sanpera_5image___pyx_scope_struct_1___iter__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_7sanpera_5image___pyx_scope_struct_1___iter__.tp_print = 0;
  __pyx_ptype_7sanpera_5image___pyx_scope_struct_1___iter__ = &__pyx_type_7sanpera_5image___pyx_scope_struct_1___iter__;
  __pyx_vtabptr_7sanpera_5image_Image = &__pyx_vtable_7sanpera_5image_Image;
  __pyx_vtable_7sanpera_5image_Image._post_init = (PyObject *(*)(struct __pyx_obj_7sanpera_5image_Image *))__pyx_f_7sanpera_5image_5Image__post_init;
  __pyx_vtable_7sanpera_5image_Image._setup_frames = (PyObject *(*)(struct __pyx_obj_7sanpera_5image_Image *, struct __pyx_opt_args_7sanpera_5image_5Image__setup_frames *__pyx_optional_args))__pyx_f_7sanpera_5image_5Image__setup_frames;
  __pyx_vtable_7sanpera_5image_Image._fix_page = (PyObject *(*)(struct __pyx_obj_7sanpera_5image_Image *))__pyx_f_7sanpera_5image_5Image__fix_page;
  if (PyType_Ready(&__pyx_type_7sanpera_5image_Image) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 298; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_7sanpera_5image_Image.tp_print = 0;
  #if CYTHON_COMPILING_IN_CPYTHON
  {
    PyObject *wrapper = __Pyx_GetAttrString((PyObject *)&__pyx_type_7sanpera_5image_Image, "__init__"); if (unlikely(!wrapper)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 298; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
      __pyx_wrapperbase_7sanpera_5image_5Image_4__init__ = *((PyWrapperDescrObject *)wrapper)->d_base;
      __pyx_wrapperbase_7sanpera_5image_5Image_4__init__.doc = __pyx_doc_7sanpera_5image_5Image_4__init__;
      ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_7sanpera_5image_5Image_4__init__;
    }
  }
  #endif
  if (__Pyx_SetVtable(__pyx_type_7sanpera_5image_Image.tp_dict, __pyx_vtabptr_7sanpera_5image_Image) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 298; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "Image", (PyObject *)&__pyx_type_7sanpera_5image_Image) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 298; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_5image_Image = &__pyx_type_7sanpera_5image_Image;
  if (PyType_Ready(&__pyx_type_7sanpera_5image___pyx_scope_struct____iter__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_7sanpera_5image___pyx_scope_struct____iter__.tp_print = 0;
  __pyx_ptype_7sanpera_5image___pyx_scope_struct____iter__ = &__pyx_type_7sanpera_5image___pyx_scope_struct____iter__;
  if (PyType_Ready(&__pyx_type_7sanpera_5image_PixelViewPixel) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_7sanpera_5image_PixelViewPixel.tp_print = 0;
  if (__Pyx_SetAttrString(__pyx_m, "PixelViewPixel", (PyObject *)&__pyx_type_7sanpera_5image_PixelViewPixel) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_5image_PixelViewPixel = &__pyx_type_7sanpera_5image_PixelViewPixel;
  if (PyType_Ready(&__pyx_type_7sanpera_5image_PixelView) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_7sanpera_5image_PixelView.tp_print = 0;
  if (__Pyx_SetAttrString(__pyx_m, "PixelView", (PyObject *)&__pyx_type_7sanpera_5image_PixelView) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_5image_PixelView = &__pyx_type_7sanpera_5image_PixelView;
  if (PyType_Ready(&__pyx_type_7sanpera_5image___pyx_scope_struct_4_create) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 812; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_7sanpera_5image___pyx_scope_struct_4_create.tp_print = 0;
  __pyx_ptype_7sanpera_5image___pyx_scope_struct_4_create = &__pyx_type_7sanpera_5image___pyx_scope_struct_4_create;
  if (PyType_Ready(&__pyx_type_7sanpera_5image___pyx_scope_struct_2___get__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_7sanpera_5image___pyx_scope_struct_2___get__.tp_print = 0;
  __pyx_ptype_7sanpera_5image___pyx_scope_struct_2___get__ = &__pyx_type_7sanpera_5image___pyx_scope_struct_2___get__;
  if (PyType_Ready(&__pyx_type_7sanpera_5image___pyx_scope_struct_3_genexpr) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_7sanpera_5image___pyx_scope_struct_3_genexpr.tp_print = 0;
  __pyx_ptype_7sanpera_5image___pyx_scope_struct_3_genexpr = &__pyx_type_7sanpera_5image___pyx_scope_struct_3_genexpr;
  /*--- Type import code ---*/
  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__Pyx_BUILTIN_MODULE_NAME, "type", 
  #if CYTHON_COMPILING_IN_PYPY
  sizeof(PyTypeObject),
  #else
  sizeof(PyHeapTypeObject),
  #endif
  0); if (unlikely(!__pyx_ptype_7cpython_4type_type)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7cpython_4bool_bool = __Pyx_ImportType(__Pyx_BUILTIN_MODULE_NAME, "bool", sizeof(PyBoolObject), 0); if (unlikely(!__pyx_ptype_7cpython_4bool_bool)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7cpython_7complex_complex = __Pyx_ImportType(__Pyx_BUILTIN_MODULE_NAME, "complex", sizeof(PyComplexObject), 0); if (unlikely(!__pyx_ptype_7cpython_7complex_complex)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_5color_BaseColor = __Pyx_ImportType("sanpera.color", "BaseColor", sizeof(struct __pyx_obj_7sanpera_5color_BaseColor), 1); if (unlikely(!__pyx_ptype_7sanpera_5color_BaseColor)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_7sanpera_5color_BaseColor = (struct __pyx_vtabstruct_7sanpera_5color_BaseColor*)__Pyx_GetVtable(__pyx_ptype_7sanpera_5color_BaseColor->tp_dict); if (unlikely(!__pyx_vtabptr_7sanpera_5color_BaseColor)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_5color_RGBColor = __Pyx_ImportType("sanpera.color", "RGBColor", sizeof(struct __pyx_obj_7sanpera_5color_RGBColor), 1); if (unlikely(!__pyx_ptype_7sanpera_5color_RGBColor)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_7sanpera_5color_RGBColor = (struct __pyx_vtabstruct_7sanpera_5color_RGBColor*)__Pyx_GetVtable(__pyx_ptype_7sanpera_5color_RGBColor->tp_dict); if (unlikely(!__pyx_vtabptr_7sanpera_5color_RGBColor)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_5color_HSLColor = __Pyx_ImportType("sanpera.color", "HSLColor", sizeof(struct __pyx_obj_7sanpera_5color_HSLColor), 1); if (unlikely(!__pyx_ptype_7sanpera_5color_HSLColor)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_7sanpera_5color_HSLColor = (struct __pyx_vtabstruct_7sanpera_5color_HSLColor*)__Pyx_GetVtable(__pyx_ptype_7sanpera_5color_HSLColor->tp_dict); if (unlikely(!__pyx_vtabptr_7sanpera_5color_HSLColor)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_8geometry_Vector = __Pyx_ImportType("sanpera.geometry", "Vector", sizeof(struct __pyx_obj_7sanpera_8geometry_Vector), 1); if (unlikely(!__pyx_ptype_7sanpera_8geometry_Vector)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_8geometry_Size = __Pyx_ImportType("sanpera.geometry", "Size", sizeof(struct __pyx_obj_7sanpera_8geometry_Size), 1); if (unlikely(!__pyx_ptype_7sanpera_8geometry_Size)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_7sanpera_8geometry_Size = (struct __pyx_vtabstruct_7sanpera_8geometry_Size*)__Pyx_GetVtable(__pyx_ptype_7sanpera_8geometry_Size->tp_dict); if (unlikely(!__pyx_vtabptr_7sanpera_8geometry_Size)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_8geometry_Rectangle = __Pyx_ImportType("sanpera.geometry", "Rectangle", sizeof(struct __pyx_obj_7sanpera_8geometry_Rectangle), 1); if (unlikely(!__pyx_ptype_7sanpera_8geometry_Rectangle)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_7sanpera_8geometry_Rectangle = (struct __pyx_vtabstruct_7sanpera_8geometry_Rectangle*)__Pyx_GetVtable(__pyx_ptype_7sanpera_8geometry_Rectangle->tp_dict); if (unlikely(!__pyx_vtabptr_7sanpera_8geometry_Rectangle)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7sanpera_9exception_MagickException = __Pyx_ImportType("sanpera.exception", "MagickException", sizeof(struct __pyx_obj_7sanpera_9exception_MagickException), 1); if (unlikely(!__pyx_ptype_7sanpera_9exception_MagickException)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 3; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Variable import code ---*/
  /*--- Function import code ---*/
  __pyx_t_1 = __Pyx_ImportModule("sanpera.color"); if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_1, "_quantum_to_double", (void (**)(void))&__pyx_f_7sanpera_5color__quantum_to_double, "double (Quantum)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_1, "_double_to_quantum", (void (**)(void))&__pyx_f_7sanpera_5color__double_to_quantum, "Quantum (double)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = __Pyx_ImportModule("sanpera.exception"); if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_2, "check_magick_exception", (void (**)(void))&__pyx_f_7sanpera_9exception_check_magick_exception, "PyObject *(ExceptionInfo *, struct __pyx_opt_args_7sanpera_9exception_check_magick_exception *__pyx_optional_args)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  /*--- Execution code ---*/

  /* "sanpera/image.pyx":11
 * cimport libc.stdio
 * 
 * from collections import namedtuple             # <<<<<<<<<<<<<<
 * 
 * from sanpera cimport c_api
 */
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_namedtuple);
  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_namedtuple);
  __Pyx_GIVEREF(__pyx_n_s_namedtuple);
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_collections, __pyx_t_3, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_4, __pyx_n_s_namedtuple); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_namedtuple, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "sanpera/image.pyx":18
 * from sanpera.exception cimport MagickException, check_magick_exception
 * 
 * from sanpera.exception import EmptyImageError, MissingFormatError             # <<<<<<<<<<<<<<
 * 
 * # TODO name of the wrapped c pointer is wildly inconsistent
 */
  __pyx_t_4 = PyList_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_n_s_EmptyImageError);
  PyList_SET_ITEM(__pyx_t_4, 0, __pyx_n_s_EmptyImageError);
  __Pyx_GIVEREF(__pyx_n_s_EmptyImageError);
  __Pyx_INCREF(__pyx_n_s_MissingFormatError);
  PyList_SET_ITEM(__pyx_t_4, 1, __pyx_n_s_MissingFormatError);
  __Pyx_GIVEREF(__pyx_n_s_MissingFormatError);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_sanpera_exception, __pyx_t_4, -1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_EmptyImageError); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_EmptyImageError, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_MissingFormatError); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_MissingFormatError, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "sanpera/image.pyx":257
 * 
 *     @property
 *     def pixels(self):             # <<<<<<<<<<<<<<
 *         return PixelView(self)
 * 
 */
  __pyx_t_3 = __Pyx_GetNameInClass((PyObject *)__pyx_ptype_7sanpera_5image_ImageFrame, __pyx_n_s_pixels); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);

  /* "sanpera/image.pyx":256
 *     ### Pixel access
 * 
 *     @property             # <<<<<<<<<<<<<<
 *     def pixels(self):
 *         return PixelView(self)
 */
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_builtin_property, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_7sanpera_5image_ImageFrame->tp_dict, __pyx_n_s_pixels, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  PyType_Modified(__pyx_ptype_7sanpera_5image_ImageFrame);

  /* "sanpera/image.pyx":322
 * 
 *     @classmethod
 *     def new(type cls, size not None, *, RGBColor fill=None):             # <<<<<<<<<<<<<<
 *         """Create a new image (with one frame) of the given size."""
 *         size = Size.coerce(size)
 */
  __pyx_t_3 = __Pyx_GetNameInClass((PyObject *)__pyx_ptype_7sanpera_5image_Image, __pyx_n_s_new); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);

  /* "sanpera/image.pyx":321
 *         pass
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def new(type cls, size not None, *, RGBColor fill=None):
 *         """Create a new image (with one frame) of the given size."""
 */
  __pyx_t_4 = __Pyx_Method_ClassMethod(__pyx_t_3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_7sanpera_5image_Image->tp_dict, __pyx_n_s_new, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  PyType_Modified(__pyx_ptype_7sanpera_5image_Image);

  /* "sanpera/image.pyx":347
 * 
 *     @classmethod
 *     def read(type cls, bytes filename not None):             # <<<<<<<<<<<<<<
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "rb")
 *         if fh == NULL:
 */
  __pyx_t_4 = __Pyx_GetNameInClass((PyObject *)__pyx_ptype_7sanpera_5image_Image, __pyx_n_s_read); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);

  /* "sanpera/image.pyx":346
 *         return self
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def read(type cls, bytes filename not None):
 *         cdef libc.stdio.FILE* fh = libc.stdio.fopen(<char*>filename, "rb")
 */
  __pyx_t_3 = __Pyx_Method_ClassMethod(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_7sanpera_5image_Image->tp_dict, __pyx_n_s_read, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  PyType_Modified(__pyx_ptype_7sanpera_5image_Image);

  /* "sanpera/image.pyx":378
 * 
 *     @classmethod
 *     def from_buffer(type cls, bytes buf not None):             # <<<<<<<<<<<<<<
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 *         cdef MagickException exc = MagickException()
 */
  __pyx_t_3 = __Pyx_GetNameInClass((PyObject *)__pyx_ptype_7sanpera_5image_Image, __pyx_n_s_from_buffer); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);

  /* "sanpera/image.pyx":377
 *         return self
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def from_buffer(type cls, bytes buf not None):
 *         cdef c_api.ImageInfo* image_info = c_api.CloneImageInfo(NULL)
 */
  __pyx_t_4 = __Pyx_Method_ClassMethod(__pyx_t_3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_7sanpera_5image_Image->tp_dict, __pyx_n_s_from_buffer, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  PyType_Modified(__pyx_ptype_7sanpera_5image_Image);

  /* "sanpera/image.pyx":399
 * 
 *     @classmethod
 *     def from_magick(type cls, bytes name not None):             # <<<<<<<<<<<<<<
 *         """Passes a filename specifier directly to ImageMagick.
 * 
 */
  __pyx_t_4 = __Pyx_GetNameInClass((PyObject *)__pyx_ptype_7sanpera_5image_Image, __pyx_n_s_from_magick); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 399; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);

  /* "sanpera/image.pyx":398
 *         return self
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def from_magick(type cls, bytes name not None):
 *         """Passes a filename specifier directly to ImageMagick.
 */
  __pyx_t_3 = __Pyx_Method_ClassMethod(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_7sanpera_5image_Image->tp_dict, __pyx_n_s_from_magick, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 399; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  PyType_Modified(__pyx_ptype_7sanpera_5image_Image);

  /* "sanpera/image.pyx":610
 *     # TODO anyway, conclusion of that thought was that sticking frames onto other images should do more than just diddle pointers
 *     @property
 *     def original_format(self):             # <<<<<<<<<<<<<<
 *         return self._stack.magick
 * 
 */
  __pyx_t_3 = __Pyx_GetNameInClass((PyObject *)__pyx_ptype_7sanpera_5image_Image, __pyx_n_s_original_format); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);

  /* "sanpera/image.pyx":609
 *     # TODO read the convert usage a bit more carefully; there seems to be some deliberate difference in behavior between "bunch of images" and "bunch of frames".  for that matter, how DOES convert treat stuff like this?
 *     # TODO anyway, conclusion of that thought was that sticking frames onto other images should do more than just diddle pointers
 *     @property             # <<<<<<<<<<<<<<
 *     def original_format(self):
 *         return self._stack.magick
 */
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 609; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_builtin_property, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 609; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_7sanpera_5image_Image->tp_dict, __pyx_n_s_original_format, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  PyType_Modified(__pyx_ptype_7sanpera_5image_Image);

  /* "sanpera/image.pyx":650
 *     # TODO this prefixing thing sucks as UI, and stuff like dates should be parsed
 *     @property
 *     def raw_properties(self):             # <<<<<<<<<<<<<<
 *         cdef char* prop = NULL
 *         cdef dict ret = {}
 */
  __pyx_t_3 = __Pyx_GetNameInClass((PyObject *)__pyx_ptype_7sanpera_5image_Image, __pyx_n_s_raw_properties); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 650; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);

  /* "sanpera/image.pyx":649
 *     # TODO can the same property appear multiple times?  cf PNG text chunks
 *     # TODO this prefixing thing sucks as UI, and stuff like dates should be parsed
 *     @property             # <<<<<<<<<<<<<<
 *     def raw_properties(self):
 *         cdef char* prop = NULL
 */
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_builtin_property, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_7sanpera_5image_Image->tp_dict, __pyx_n_s_raw_properties, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 650; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  PyType_Modified(__pyx_ptype_7sanpera_5image_Image);

  /* "sanpera/image.pyx":807
 * 
 * # TODO this should probably not live in cython
 * class BuiltinRegistry(object):             # <<<<<<<<<<<<<<
 *     # XXX possibly spruce this up a bit to work better with other kinds of
 *     # builtin enumerables
 */
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_builtin_object);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_builtin_object);
  __Pyx_GIVEREF(__pyx_builtin_object);
  __pyx_t_4 = __Pyx_CalculateMetaclass(NULL, __pyx_t_3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_Py3MetaclassPrepare(__pyx_t_4, __pyx_t_3, __pyx_n_s_BuiltinRegistry, __pyx_n_s_BuiltinRegistry, (PyObject *) NULL, __pyx_n_s_sanpera_image, (PyObject *) NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);

  /* "sanpera/image.pyx":812
 * 
 *     @classmethod
 *     def create(cls, *names):             # <<<<<<<<<<<<<<
 *         def decorator(f):
 *             obj = cls(f, names)
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_7sanpera_5image_15BuiltinRegistry_1create, __Pyx_CYFUNCTION_CLASSMETHOD, __pyx_n_s_BuiltinRegistry_create, NULL, __pyx_n_s_sanpera_image, PyModule_GetDict(__pyx_m), ((PyObject *)__pyx_codeobj__10)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 812; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);

  /* "sanpera/image.pyx":811
 *     # builtin enumerables
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def create(cls, *names):
 *         def decorator(f):
 */
  __pyx_t_7 = __Pyx_Method_ClassMethod(__pyx_t_6); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyObject_SetItem(__pyx_t_5, __pyx_n_s_create, __pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 812; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "sanpera/image.pyx":819
 *         return decorator
 * 
 *     def __init__(self, factory, names):             # <<<<<<<<<<<<<<
 *         self._factory = factory
 *         self._names = frozenset(names)
 */
  __pyx_t_7 = __Pyx_CyFunction_NewEx(&__pyx_mdef_7sanpera_5image_15BuiltinRegistry_3__init__, 0, __pyx_n_s_BuiltinRegistry___init, NULL, __pyx_n_s_sanpera_image, PyModule_GetDict(__pyx_m), ((PyObject *)__pyx_codeobj__12)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  if (PyObject_SetItem(__pyx_t_5, __pyx_n_s_init, __pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "sanpera/image.pyx":823
 *         self._names = frozenset(names)
 * 
 *     def __getattr__(self, key):             # <<<<<<<<<<<<<<
 *         if key not in self._names:
 *             raise AttributeError
 */
  __pyx_t_7 = __Pyx_CyFunction_NewEx(&__pyx_mdef_7sanpera_5image_15BuiltinRegistry_5__getattr__, 0, __pyx_n_s_BuiltinRegistry___getattr, NULL, __pyx_n_s_sanpera_image, PyModule_GetDict(__pyx_m), ((PyObject *)__pyx_codeobj__14)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  if (PyObject_SetItem(__pyx_t_5, __pyx_n_s_getattr, __pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "sanpera/image.pyx":829
 *         return self._factory(key)
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return self._names
 * 
 */
  __pyx_t_7 = __Pyx_CyFunction_NewEx(&__pyx_mdef_7sanpera_5image_15BuiltinRegistry_7__iter__, 0, __pyx_n_s_BuiltinRegistry___iter, NULL, __pyx_n_s_sanpera_image, PyModule_GetDict(__pyx_m), ((PyObject *)__pyx_codeobj__16)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  if (PyObject_SetItem(__pyx_t_5, __pyx_n_s_iter, __pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "sanpera/image.pyx":807
 * 
 * # TODO this should probably not live in cython
 * class BuiltinRegistry(object):             # <<<<<<<<<<<<<<
 *     # XXX possibly spruce this up a bit to work better with other kinds of
 *     # builtin enumerables
 */
  __pyx_t_7 = __Pyx_Py3ClassCreate(__pyx_t_4, __pyx_n_s_BuiltinRegistry, __pyx_t_3, __pyx_t_5, NULL, 0, 1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BuiltinRegistry, __pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "sanpera/image.pyx":834
 * # There is, conveniently, no way to get a list of built-in images or patterns
 * # out of ImageMagick.  So, er, here are manual lists.
 * @BuiltinRegistry.create('granite', 'logo', 'netscape', 'rose', 'wizard')             # <<<<<<<<<<<<<<
 * def builtins(name):
 *     return Image.from_magick('magick:' + name)
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_BuiltinRegistry); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 834; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_create); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 834; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_tuple__17, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 834; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "sanpera/image.pyx":835
 * # out of ImageMagick.  So, er, here are manual lists.
 * @BuiltinRegistry.create('granite', 'logo', 'netscape', 'rose', 'wizard')
 * def builtins(name):             # <<<<<<<<<<<<<<
 *     return Image.from_magick('magick:' + name)
 * 
 */
  __pyx_t_4 = PyCFunction_NewEx(&__pyx_mdef_7sanpera_5image_1builtins, NULL, __pyx_n_s_sanpera_image); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);

  /* "sanpera/image.pyx":834
 * # There is, conveniently, no way to get a list of built-in images or patterns
 * # out of ImageMagick.  So, er, here are manual lists.
 * @BuiltinRegistry.create('granite', 'logo', 'netscape', 'rose', 'wizard')             # <<<<<<<<<<<<<<
 * def builtins(name):
 *     return Image.from_magick('magick:' + name)
 */
  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 834; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 834; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_builtins, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "sanpera/image.pyx":838
 *     return Image.from_magick('magick:' + name)
 * 
 * @BuiltinRegistry.create(             # <<<<<<<<<<<<<<
 *     'bricks', 'checkerboard', 'circles', 'crosshatch', 'crosshatch30',
 *     'crosshatch45', 'fishscales',
 */
  __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_BuiltinRegistry); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_create); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_5, __pyx_tuple__20, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "sanpera/image.pyx":851
 *     'verticalleftshingle', 'verticalrightshingle', 'verticalsaw',
 * )
 * def patterns(name):             # <<<<<<<<<<<<<<
 *     return Image.from_magick('pattern:' + name)
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7sanpera_5image_3patterns, NULL, __pyx_n_s_sanpera_image); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 851; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);

  /* "sanpera/image.pyx":838
 *     return Image.from_magick('magick:' + name)
 * 
 * @BuiltinRegistry.create(             # <<<<<<<<<<<<<<
 *     'bricks', 'checkerboard', 'circles', 'crosshatch', 'crosshatch30',
 *     'crosshatch45', 'fishscales',
 */
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_patterns, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 851; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "sanpera/image.pyx":1
 * """Image class and assorted helper classes.  This is where the magick happens.             # <<<<<<<<<<<<<<
 * """
 * from __future__ import division
 */
  __pyx_t_5 = PyDict_New(); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  if (__pyx_m) {
    __Pyx_AddTraceback("init sanpera.image", __pyx_clineno, __pyx_lineno, __pyx_filename);
    Py_DECREF(__pyx_m); __pyx_m = 0;
  } else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_ImportError, "init sanpera.image");
  }
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  #if PY_MAJOR_VERSION < 3
  return;
  #else
  return __pyx_m;
  #endif
}

/* Runtime support code */
#if CYTHON_REFNANNY
static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname) {
    PyObject *m = NULL, *p = NULL;
    void *r = NULL;
    m = PyImport_ImportModule((char *)modname);
    if (!m) goto end;
    p = PyObject_GetAttrString(m, (char *)"RefNannyAPI");
    if (!p) goto end;
    r = PyLong_AsVoidPtr(p);
end:
    Py_XDECREF(p);
    Py_XDECREF(m);
    return (__Pyx_RefNannyAPIStruct *)r;
}
#endif /* CYTHON_REFNANNY */

static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
    if (unlikely(!result)) {
        PyErr_Format(PyExc_NameError,
#if PY_MAJOR_VERSION >= 3
            "name '%U' is not defined", name);
#else
            "name '%.200s' is not defined", PyString_AS_STRING(name));
#endif
    }
    return result;
}

static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *more_or_less;
    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    PyErr_Format(PyExc_TypeError,
                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
                 func_name, more_or_less, num_expected,
                 (num_expected == 1) ? "" : "s", num_found);
}

static CYTHON_INLINE int __Pyx_CheckKeywordStrings(
    PyObject *kwdict,
    const char* function_name,
    int kw_allowed)
{
    PyObject* key = 0;
    Py_ssize_t pos = 0;
#if CPYTHON_COMPILING_IN_PYPY
    if (!kw_allowed && PyDict_Next(kwdict, &pos, &key, 0))
        goto invalid_keyword;
    return 1;
#else
    while (PyDict_Next(kwdict, &pos, &key, 0)) {
        #if PY_MAJOR_VERSION < 3
        if (unlikely(!PyString_CheckExact(key)) && unlikely(!PyString_Check(key)))
        #endif
            if (unlikely(!PyUnicode_Check(key)))
                goto invalid_keyword_type;
    }
    if ((!kw_allowed) && unlikely(key))
        goto invalid_keyword;
    return 1;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%.200s() keywords must be strings", function_name);
    return 0;
#endif
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%.200s() got an unexpected keyword argument '%.200s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
    return 0;
}

static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->curexc_type;
    tmp_value = tstate->curexc_value;
    tmp_tb = tstate->curexc_traceback;
    tstate->curexc_type = type;
    tstate->curexc_value = value;
    tstate->curexc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_Restore(type, value, tb);
#endif
}
static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
#else
    PyErr_Fetch(type, value, tb);
#endif
}

#if PY_MAJOR_VERSION < 3
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
                        CYTHON_UNUSED PyObject *cause) {
    Py_XINCREF(type);
    if (!value || value == Py_None)
        value = NULL;
    else
        Py_INCREF(value);
    if (!tb || tb == Py_None)
        tb = NULL;
    else {
        Py_INCREF(tb);
        if (!PyTraceBack_Check(tb)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: arg 3 must be a traceback or None");
            goto raise_error;
        }
    }
    #if PY_VERSION_HEX < 0x02050000
    if (PyClass_Check(type)) {
    #else
    if (PyType_Check(type)) {
    #endif
#if CYTHON_COMPILING_IN_PYPY
        if (!value) {
            Py_INCREF(Py_None);
            value = Py_None;
        }
#endif
        PyErr_NormalizeException(&type, &value, &tb);
    } else {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        value = type;
        #if PY_VERSION_HEX < 0x02050000
        if (PyInstance_Check(type)) {
            type = (PyObject*) ((PyInstanceObject*)type)->in_class;
            Py_INCREF(type);
        } else {
            type = 0;
            PyErr_SetString(PyExc_TypeError,
                "raise: exception must be an old-style class or instance");
            goto raise_error;
        }
        #else
        type = (PyObject*) Py_TYPE(type);
        Py_INCREF(type);
        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: exception class must be a subclass of BaseException");
            goto raise_error;
        }
        #endif
    }
    __Pyx_ErrRestore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}
#else /* Python 3+ */
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
    PyObject* owned_instance = NULL;
    if (tb == Py_None) {
        tb = 0;
    } else if (tb && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto bad;
    }
    if (value == Py_None)
        value = 0;
    if (PyExceptionInstance_Check(type)) {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto bad;
        }
        value = type;
        type = (PyObject*) Py_TYPE(value);
    } else if (PyExceptionClass_Check(type)) {
        PyObject *instance_class = NULL;
        if (value && PyExceptionInstance_Check(value)) {
            instance_class = (PyObject*) Py_TYPE(value);
            if (instance_class != type) {
                if (PyObject_IsSubclass(instance_class, type)) {
                    type = instance_class;
                } else {
                    instance_class = NULL;
                }
            }
        }
        if (!instance_class) {
            PyObject *args;
            if (!value)
                args = PyTuple_New(0);
            else if (PyTuple_Check(value)) {
                Py_INCREF(value);
                args = value;
            } else
                args = PyTuple_Pack(1, value);
            if (!args)
                goto bad;
            owned_instance = PyObject_Call(type, args, NULL);
            Py_DECREF(args);
            if (!owned_instance)
                goto bad;
            value = owned_instance;
            if (!PyExceptionInstance_Check(value)) {
                PyErr_Format(PyExc_TypeError,
                             "calling %R should have returned an instance of "
                             "BaseException, not %R",
                             type, Py_TYPE(value));
                goto bad;
            }
        }
    } else {
        PyErr_SetString(PyExc_TypeError,
            "raise: exception class must be a subclass of BaseException");
        goto bad;
    }
#if PY_VERSION_HEX >= 0x03030000
    if (cause) {
#else
    if (cause && cause != Py_None) {
#endif
        PyObject *fixed_cause;
        if (cause == Py_None) {
            fixed_cause = NULL;
        } else if (PyExceptionClass_Check(cause)) {
            fixed_cause = PyObject_CallObject(cause, NULL);
            if (fixed_cause == NULL)
                goto bad;
        } else if (PyExceptionInstance_Check(cause)) {
            fixed_cause = cause;
            Py_INCREF(fixed_cause);
        } else {
            PyErr_SetString(PyExc_TypeError,
                            "exception causes must derive from "
                            "BaseException");
            goto bad;
        }
        PyException_SetCause(value, fixed_cause);
    }
    PyErr_SetObject(type, value);
    if (tb) {
        PyThreadState *tstate = PyThreadState_GET();
        PyObject* tmp_tb = tstate->curexc_traceback;
        if (tb != tmp_tb) {
            Py_INCREF(tb);
            tstate->curexc_traceback = tb;
            Py_XDECREF(tmp_tb);
        }
    }
bad:
    Py_XDECREF(owned_instance);
    return;
}
#endif

static void __Pyx_RaiseArgumentTypeInvalid(const char* name, PyObject *obj, PyTypeObject *type) {
    PyErr_Format(PyExc_TypeError,
        "Argument '%.200s' has incorrect type (expected %.200s, got %.200s)",
        name, type->tp_name, Py_TYPE(obj)->tp_name);
}
static CYTHON_INLINE int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact)
{
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (none_allowed && obj == Py_None) return 1;
    else if (exact) {
        if (likely(Py_TYPE(obj) == type)) return 1;
        #if PY_MAJOR_VERSION == 2
        else if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
        #endif
    }
    else {
        if (likely(PyObject_TypeCheck(obj, type))) return 1;
    }
    __Pyx_RaiseArgumentTypeInvalid(name, obj, type);
    return 0;
}

static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AsString(kw_name));
        #endif
}

static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;
    while (PyDict_Next(kwds, &pos, &key, &value)) {
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
            continue;
        }
        name = first_kw_arg;
        #if PY_MAJOR_VERSION < 3
        if (likely(PyString_CheckExact(key)) || likely(PyString_Check(key))) {
            while (*name) {
                if ((CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**name) == PyString_GET_SIZE(key))
                        && _PyString_Eq(**name, key)) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    if ((**argname == key) || (
                            (CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**argname) == PyString_GET_SIZE(key))
                             && _PyString_Eq(**argname, key))) {
                        goto arg_passed_twice;
                    }
                    argname++;
                }
            }
        } else
        #endif
        if (likely(PyUnicode_Check(key))) {
            while (*name) {
                int cmp = (**name == key) ? 0 :
                #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                    (PyUnicode_GET_SIZE(**name) != PyUnicode_GET_SIZE(key)) ? 1 :
                #endif
                    PyUnicode_Compare(**name, key);
                if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                if (cmp == 0) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    int cmp = (**argname == key) ? 0 :
                    #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                        (PyUnicode_GET_SIZE(**argname) != PyUnicode_GET_SIZE(key)) ? 1 :
                    #endif
                        PyUnicode_Compare(**argname, key);
                    if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                    if (cmp == 0) goto arg_passed_twice;
                    argname++;
                }
            }
        } else
            goto invalid_keyword_type;
        if (kwds2) {
            if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
        } else {
            goto invalid_keyword;
        }
    }
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, key);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%.200s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%.200s() got an unexpected keyword argument '%.200s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    return -1;
}

static void __Pyx_WriteUnraisable(const char *name, CYTHON_UNUSED int clineno,
                                  CYTHON_UNUSED int lineno, CYTHON_UNUSED const char *filename,
                                  int full_traceback) {
    PyObject *old_exc, *old_val, *old_tb;
    PyObject *ctx;
    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
    if (full_traceback) {
        Py_XINCREF(old_exc);
        Py_XINCREF(old_val);
        Py_XINCREF(old_tb);
        __Pyx_ErrRestore(old_exc, old_val, old_tb);
        PyErr_PrintEx(1);
    }
    #if PY_MAJOR_VERSION < 3
    ctx = PyString_FromString(name);
    #else
    ctx = PyUnicode_FromString(name);
    #endif
    __Pyx_ErrRestore(old_exc, old_val, old_tb);
    if (!ctx) {
        PyErr_WriteUnraisable(Py_None);
    } else {
        PyErr_WriteUnraisable(ctx);
        Py_DECREF(ctx);
    }
}

static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (likely(PyObject_TypeCheck(obj, type)))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                 Py_TYPE(obj)->tp_name, type->tp_name);
    return 0;
}

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *local_type, *local_value, *local_tb;
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    local_type = tstate->curexc_type;
    local_value = tstate->curexc_value;
    local_tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
#else
    PyErr_Fetch(&local_type, &local_value, &local_tb);
#endif
    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
#if CYTHON_COMPILING_IN_CPYTHON
    if (unlikely(tstate->curexc_type))
#else
    if (unlikely(PyErr_Occurred()))
#endif
        goto bad;
    #if PY_MAJOR_VERSION >= 3
    if (local_tb) {
        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
            goto bad;
    }
    #endif
    Py_XINCREF(local_tb);
    Py_XINCREF(local_type);
    Py_XINCREF(local_value);
    *type = local_type;
    *value = local_value;
    *tb = local_tb;
#if CYTHON_COMPILING_IN_CPYTHON
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = local_type;
    tstate->exc_value = local_value;
    tstate->exc_traceback = local_tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_SetExcInfo(local_type, local_value, local_tb);
#endif
    return 0;
bad:
    *type = 0;
    *value = 0;
    *tb = 0;
    Py_XDECREF(local_type);
    Py_XDECREF(local_value);
    Py_XDECREF(local_tb);
    return -1;
}

static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
#if CYTHON_COMPILING_IN_CPYTHON
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = *type;
    tstate->exc_value = *value;
    tstate->exc_traceback = *tb;
#else
    PyErr_GetExcInfo(&tmp_type, &tmp_value, &tmp_tb);
    PyErr_SetExcInfo(*type, *value, *tb);
#endif
    *type = tmp_type;
    *value = tmp_value;
    *tb = tmp_tb;
}

static CYTHON_INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
#else
    PyErr_GetExcInfo(type, value, tb);
#endif
}
static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_SetExcInfo(type, value, tb);
#endif
}

static CYTHON_INLINE PyObject *__Pyx_GetModuleGlobalName(PyObject *name) {
    PyObject *result;
#if CYTHON_COMPILING_IN_CPYTHON
    result = PyDict_GetItem(__pyx_d, name);
    if (result) {
        Py_INCREF(result);
    } else {
#else
    result = PyObject_GetItem(__pyx_d, name);
    if (!result) {
        PyErr_Clear();
#endif
        result = __Pyx_GetBuiltinName(name);
    }
    return result;
}

static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
#if CYTHON_COMPILING_IN_PYPY
    return PyObject_RichCompareBool(s1, s2, equals);
#else
    if (s1 == s2) {
        return (equals == Py_EQ);
    } else if (PyBytes_CheckExact(s1) & PyBytes_CheckExact(s2)) {
        const char *ps1, *ps2;
        Py_ssize_t length = PyBytes_GET_SIZE(s1);
        if (length != PyBytes_GET_SIZE(s2))
            return (equals == Py_NE);
        ps1 = PyBytes_AS_STRING(s1);
        ps2 = PyBytes_AS_STRING(s2);
        if (ps1[0] != ps2[0]) {
            return (equals == Py_NE);
        } else if (length == 1) {
            return (equals == Py_EQ);
        } else {
            int result = memcmp(ps1, ps2, (size_t)length);
            return (equals == Py_EQ) ? (result == 0) : (result != 0);
        }
    } else if ((s1 == Py_None) & PyBytes_CheckExact(s2)) {
        return (equals == Py_NE);
    } else if ((s2 == Py_None) & PyBytes_CheckExact(s1)) {
        return (equals == Py_NE);
    } else {
        int result;
        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
        if (!py_result)
            return -1;
        result = __Pyx_PyObject_IsTrue(py_result);
        Py_DECREF(py_result);
        return result;
    }
#endif
}

static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname) {
    PyErr_Format(PyExc_NameError, "free variable '%s' referenced before assignment in enclosing scope", varname);
}

static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
#if CYTHON_COMPILING_IN_PYPY
    return PyObject_RichCompareBool(s1, s2, equals);
#else
#if PY_MAJOR_VERSION < 3
    PyObject* owned_ref = NULL;
#endif
    int s1_is_unicode, s2_is_unicode;
    if (s1 == s2) {
        goto return_eq;
    }
    s1_is_unicode = PyUnicode_CheckExact(s1);
    s2_is_unicode = PyUnicode_CheckExact(s2);
#if PY_MAJOR_VERSION < 3
    if ((s1_is_unicode & (!s2_is_unicode)) && PyString_CheckExact(s2)) {
        owned_ref = PyUnicode_FromObject(s2);
        if (unlikely(!owned_ref))
            return -1;
        s2 = owned_ref;
        s2_is_unicode = 1;
    } else if ((s2_is_unicode & (!s1_is_unicode)) && PyString_CheckExact(s1)) {
        owned_ref = PyUnicode_FromObject(s1);
        if (unlikely(!owned_ref))
            return -1;
        s1 = owned_ref;
        s1_is_unicode = 1;
    } else if (((!s2_is_unicode) & (!s1_is_unicode))) {
        return __Pyx_PyBytes_Equals(s1, s2, equals);
    }
#endif
    if (s1_is_unicode & s2_is_unicode) {
        Py_ssize_t length;
        int kind;
        void *data1, *data2;
        #if CYTHON_PEP393_ENABLED
        if (unlikely(PyUnicode_READY(s1) < 0) || unlikely(PyUnicode_READY(s2) < 0))
            return -1;
        #endif
        length = __Pyx_PyUnicode_GET_LENGTH(s1);
        if (length != __Pyx_PyUnicode_GET_LENGTH(s2)) {
            goto return_ne;
        }
        kind = __Pyx_PyUnicode_KIND(s1);
        if (kind != __Pyx_PyUnicode_KIND(s2)) {
            goto return_ne;
        }
        data1 = __Pyx_PyUnicode_DATA(s1);
        data2 = __Pyx_PyUnicode_DATA(s2);
        if (__Pyx_PyUnicode_READ(kind, data1, 0) != __Pyx_PyUnicode_READ(kind, data2, 0)) {
            goto return_ne;
        } else if (length == 1) {
            goto return_eq;
        } else {
            int result = memcmp(data1, data2, length * kind);
            #if PY_MAJOR_VERSION < 3
            Py_XDECREF(owned_ref);
            #endif
            return (equals == Py_EQ) ? (result == 0) : (result != 0);
        }
    } else if ((s1 == Py_None) & s2_is_unicode) {
        goto return_ne;
    } else if ((s2 == Py_None) & s1_is_unicode) {
        goto return_ne;
    } else {
        int result;
        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
        if (!py_result)
            return -1;
        result = __Pyx_PyObject_IsTrue(py_result);
        Py_DECREF(py_result);
        return result;
    }
return_eq:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(owned_ref);
    #endif
    return (equals == Py_EQ);
return_ne:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(owned_ref);
    #endif
    return (equals == Py_NE);
#endif
}

static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
    PyObject* fake_module;
    PyTypeObject* cached_type = NULL;
    fake_module = PyImport_AddModule((char*) "_cython_" CYTHON_ABI);
    if (!fake_module) return NULL;
    Py_INCREF(fake_module);
    cached_type = (PyTypeObject*) PyObject_GetAttrString(fake_module, type->tp_name);
    if (cached_type) {
        if (!PyType_Check((PyObject*)cached_type)) {
            PyErr_Format(PyExc_TypeError,
                "Shared Cython type %.200s is not a type object",
                type->tp_name);
            goto bad;
        }
        if (cached_type->tp_basicsize != type->tp_basicsize) {
            PyErr_Format(PyExc_TypeError,
                "Shared Cython type %.200s has the wrong size, try recompiling",
                type->tp_name);
            goto bad;
        }
    } else {
        if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
        PyErr_Clear();
        if (PyType_Ready(type) < 0) goto bad;
        if (PyObject_SetAttrString(fake_module, type->tp_name, (PyObject*) type) < 0)
            goto bad;
        Py_INCREF(type);
        cached_type = type;
    }
done:
    Py_DECREF(fake_module);
    return cached_type;
bad:
    Py_XDECREF(cached_type);
    cached_type = NULL;
    goto done;
}

static PyObject *
__Pyx_CyFunction_get_doc(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *closure)
{
    if (unlikely(op->func_doc == NULL)) {
        if (op->func.m_ml->ml_doc) {
#if PY_MAJOR_VERSION >= 3
            op->func_doc = PyUnicode_FromString(op->func.m_ml->ml_doc);
#else
            op->func_doc = PyString_FromString(op->func.m_ml->ml_doc);
#endif
            if (unlikely(op->func_doc == NULL))
                return NULL;
        } else {
            Py_INCREF(Py_None);
            return Py_None;
        }
    }
    Py_INCREF(op->func_doc);
    return op->func_doc;
}
static int
__Pyx_CyFunction_set_doc(__pyx_CyFunctionObject *op, PyObject *value)
{
    PyObject *tmp = op->func_doc;
    if (value == NULL)
        value = Py_None; /* Mark as deleted */
    Py_INCREF(value);
    op->func_doc = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_name(__pyx_CyFunctionObject *op)
{
    if (unlikely(op->func_name == NULL)) {
#if PY_MAJOR_VERSION >= 3
        op->func_name = PyUnicode_InternFromString(op->func.m_ml->ml_name);
#else
        op->func_name = PyString_InternFromString(op->func.m_ml->ml_name);
#endif
        if (unlikely(op->func_name == NULL))
            return NULL;
    }
    Py_INCREF(op->func_name);
    return op->func_name;
}
static int
__Pyx_CyFunction_set_name(__pyx_CyFunctionObject *op, PyObject *value)
{
    PyObject *tmp;
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value))) {
#else
    if (unlikely(value == NULL || !PyString_Check(value))) {
#endif
        PyErr_SetString(PyExc_TypeError,
                        "__name__ must be set to a string object");
        return -1;
    }
    tmp = op->func_name;
    Py_INCREF(value);
    op->func_name = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_qualname(__pyx_CyFunctionObject *op)
{
    Py_INCREF(op->func_qualname);
    return op->func_qualname;
}
static int
__Pyx_CyFunction_set_qualname(__pyx_CyFunctionObject *op, PyObject *value)
{
    PyObject *tmp;
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value))) {
#else
    if (unlikely(value == NULL || !PyString_Check(value))) {
#endif
        PyErr_SetString(PyExc_TypeError,
                        "__qualname__ must be set to a string object");
        return -1;
    }
    tmp = op->func_qualname;
    Py_INCREF(value);
    op->func_qualname = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_self(__pyx_CyFunctionObject *m, CYTHON_UNUSED void *closure)
{
    PyObject *self;
    self = m->func_closure;
    if (self == NULL)
        self = Py_None;
    Py_INCREF(self);
    return self;
}
static PyObject *
__Pyx_CyFunction_get_dict(__pyx_CyFunctionObject *op)
{
    if (unlikely(op->func_dict == NULL)) {
        op->func_dict = PyDict_New();
        if (unlikely(op->func_dict == NULL))
            return NULL;
    }
    Py_INCREF(op->func_dict);
    return op->func_dict;
}
static int
__Pyx_CyFunction_set_dict(__pyx_CyFunctionObject *op, PyObject *value)
{
    PyObject *tmp;
    if (unlikely(value == NULL)) {
        PyErr_SetString(PyExc_TypeError,
               "function's dictionary may not be deleted");
        return -1;
    }
    if (unlikely(!PyDict_Check(value))) {
        PyErr_SetString(PyExc_TypeError,
               "setting function's dictionary to a non-dict");
        return -1;
    }
    tmp = op->func_dict;
    Py_INCREF(value);
    op->func_dict = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_globals(__pyx_CyFunctionObject *op)
{
    Py_INCREF(op->func_globals);
    return op->func_globals;
}
static PyObject *
__Pyx_CyFunction_get_closure(CYTHON_UNUSED __pyx_CyFunctionObject *op)
{
    Py_INCREF(Py_None);
    return Py_None;
}
static PyObject *
__Pyx_CyFunction_get_code(__pyx_CyFunctionObject *op)
{
    PyObject* result = (op->func_code) ? op->func_code : Py_None;
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_init_defaults(__pyx_CyFunctionObject *op) {
    PyObject *res = op->defaults_getter((PyObject *) op);
    if (unlikely(!res))
        return -1;
    op->defaults_tuple = PyTuple_GET_ITEM(res, 0);
    Py_INCREF(op->defaults_tuple);
    op->defaults_kwdict = PyTuple_GET_ITEM(res, 1);
    Py_INCREF(op->defaults_kwdict);
    Py_DECREF(res);
    return 0;
}
static int
__Pyx_CyFunction_set_defaults(__pyx_CyFunctionObject *op, PyObject* value) {
    PyObject* tmp;
    if (!value) {
        value = Py_None;
    } else if (value != Py_None && !PyTuple_Check(value)) {
        PyErr_SetString(PyExc_TypeError,
                        "__defaults__ must be set to a tuple object");
        return -1;
    }
    Py_INCREF(value);
    tmp = op->defaults_tuple;
    op->defaults_tuple = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_defaults(__pyx_CyFunctionObject *op) {
    PyObject* result = op->defaults_tuple;
    if (unlikely(!result)) {
        if (op->defaults_getter) {
            if (__Pyx_CyFunction_init_defaults(op) < 0) return NULL;
            result = op->defaults_tuple;
        } else {
            result = Py_None;
        }
    }
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_set_kwdefaults(__pyx_CyFunctionObject *op, PyObject* value) {
    PyObject* tmp;
    if (!value) {
        value = Py_None;
    } else if (value != Py_None && !PyDict_Check(value)) {
        PyErr_SetString(PyExc_TypeError,
                        "__kwdefaults__ must be set to a dict object");
        return -1;
    }
    Py_INCREF(value);
    tmp = op->defaults_kwdict;
    op->defaults_kwdict = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_kwdefaults(__pyx_CyFunctionObject *op) {
    PyObject* result = op->defaults_kwdict;
    if (unlikely(!result)) {
        if (op->defaults_getter) {
            if (__Pyx_CyFunction_init_defaults(op) < 0) return NULL;
            result = op->defaults_kwdict;
        } else {
            result = Py_None;
        }
    }
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_set_annotations(__pyx_CyFunctionObject *op, PyObject* value) {
    PyObject* tmp;
    if (!value || value == Py_None) {
        value = NULL;
    } else if (!PyDict_Check(value)) {
        PyErr_SetString(PyExc_TypeError,
                        "__annotations__ must be set to a dict object");
        return -1;
    }
    Py_XINCREF(value);
    tmp = op->func_annotations;
    op->func_annotations = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_annotations(__pyx_CyFunctionObject *op) {
    PyObject* result = op->func_annotations;
    if (unlikely(!result)) {
        result = PyDict_New();
        if (unlikely(!result)) return NULL;
        op->func_annotations = result;
    }
    Py_INCREF(result);
    return result;
}
static PyGetSetDef __pyx_CyFunction_getsets[] = {
    {(char *) "func_doc", (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
    {(char *) "__doc__",  (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
    {(char *) "func_name", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
    {(char *) "__name__", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
    {(char *) "__qualname__", (getter)__Pyx_CyFunction_get_qualname, (setter)__Pyx_CyFunction_set_qualname, 0, 0},
    {(char *) "__self__", (getter)__Pyx_CyFunction_get_self, 0, 0, 0},
    {(char *) "func_dict", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
    {(char *) "__dict__", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
    {(char *) "func_globals", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
    {(char *) "__globals__", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
    {(char *) "func_closure", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
    {(char *) "__closure__", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
    {(char *) "func_code", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
    {(char *) "__code__", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
    {(char *) "func_defaults", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
    {(char *) "__defaults__", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
    {(char *) "__kwdefaults__", (getter)__Pyx_CyFunction_get_kwdefaults, (setter)__Pyx_CyFunction_set_kwdefaults, 0, 0},
    {(char *) "__annotations__", (getter)__Pyx_CyFunction_get_annotations, (setter)__Pyx_CyFunction_set_annotations, 0, 0},
    {0, 0, 0, 0, 0}
};
#ifndef PY_WRITE_RESTRICTED /* < Py2.5 */
#define PY_WRITE_RESTRICTED WRITE_RESTRICTED
#endif
static PyMemberDef __pyx_CyFunction_members[] = {
    {(char *) "__module__", T_OBJECT, offsetof(__pyx_CyFunctionObject, func.m_module), PY_WRITE_RESTRICTED, 0},
    {0, 0, 0,  0, 0}
};
static PyObject *
__Pyx_CyFunction_reduce(__pyx_CyFunctionObject *m, CYTHON_UNUSED PyObject *args)
{
#if PY_MAJOR_VERSION >= 3
    return PyUnicode_FromString(m->func.m_ml->ml_name);
#else
    return PyString_FromString(m->func.m_ml->ml_name);
#endif
}
static PyMethodDef __pyx_CyFunction_methods[] = {
    {__Pyx_NAMESTR("__reduce__"), (PyCFunction)__Pyx_CyFunction_reduce, METH_VARARGS, 0},
    {0, 0, 0, 0}
};
static PyObject *__Pyx_CyFunction_New(PyTypeObject *type, PyMethodDef *ml, int flags, PyObject* qualname,
                                      PyObject *closure, PyObject *module, PyObject* globals, PyObject* code) {
    __pyx_CyFunctionObject *op = PyObject_GC_New(__pyx_CyFunctionObject, type);
    if (op == NULL)
        return NULL;
    op->flags = flags;
    op->func_weakreflist = NULL;
    op->func.m_ml = ml;
    op->func.m_self = (PyObject *) op;
    Py_XINCREF(closure);
    op->func_closure = closure;
    Py_XINCREF(module);
    op->func.m_module = module;
    op->func_dict = NULL;
    op->func_name = NULL;
    Py_INCREF(qualname);
    op->func_qualname = qualname;
    op->func_doc = NULL;
    op->func_classobj = NULL;
    op->func_globals = globals;
    Py_INCREF(op->func_globals);
    Py_XINCREF(code);
    op->func_code = code;
    op->defaults_pyobjects = 0;
    op->defaults = NULL;
    op->defaults_tuple = NULL;
    op->defaults_kwdict = NULL;
    op->defaults_getter = NULL;
    op->func_annotations = NULL;
    PyObject_GC_Track(op);
    return (PyObject *) op;
}
static int
__Pyx_CyFunction_clear(__pyx_CyFunctionObject *m)
{
    Py_CLEAR(m->func_closure);
    Py_CLEAR(m->func.m_module);
    Py_CLEAR(m->func_dict);
    Py_CLEAR(m->func_name);
    Py_CLEAR(m->func_qualname);
    Py_CLEAR(m->func_doc);
    Py_CLEAR(m->func_globals);
    Py_CLEAR(m->func_code);
    Py_CLEAR(m->func_classobj);
    Py_CLEAR(m->defaults_tuple);
    Py_CLEAR(m->defaults_kwdict);
    Py_CLEAR(m->func_annotations);
    if (m->defaults) {
        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
        int i;
        for (i = 0; i < m->defaults_pyobjects; i++)
            Py_XDECREF(pydefaults[i]);
        PyMem_Free(m->defaults);
        m->defaults = NULL;
    }
    return 0;
}
static void __Pyx_CyFunction_dealloc(__pyx_CyFunctionObject *m)
{
    PyObject_GC_UnTrack(m);
    if (m->func_weakreflist != NULL)
        PyObject_ClearWeakRefs((PyObject *) m);
    __Pyx_CyFunction_clear(m);
    PyObject_GC_Del(m);
}
static int __Pyx_CyFunction_traverse(__pyx_CyFunctionObject *m, visitproc visit, void *arg)
{
    Py_VISIT(m->func_closure);
    Py_VISIT(m->func.m_module);
    Py_VISIT(m->func_dict);
    Py_VISIT(m->func_name);
    Py_VISIT(m->func_qualname);
    Py_VISIT(m->func_doc);
    Py_VISIT(m->func_globals);
    Py_VISIT(m->func_code);
    Py_VISIT(m->func_classobj);
    Py_VISIT(m->defaults_tuple);
    Py_VISIT(m->defaults_kwdict);
    if (m->defaults) {
        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
        int i;
        for (i = 0; i < m->defaults_pyobjects; i++)
            Py_VISIT(pydefaults[i]);
    }
    return 0;
}
static PyObject *__Pyx_CyFunction_descr_get(PyObject *func, PyObject *obj, PyObject *type)
{
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    if (m->flags & __Pyx_CYFUNCTION_STATICMETHOD) {
        Py_INCREF(func);
        return func;
    }
    if (m->flags & __Pyx_CYFUNCTION_CLASSMETHOD) {
        if (type == NULL)
            type = (PyObject *)(Py_TYPE(obj));
        return PyMethod_New(func,
                            type, (PyObject *)(Py_TYPE(type)));
    }
    if (obj == Py_None)
        obj = NULL;
    return PyMethod_New(func, obj, type);
}
static PyObject*
__Pyx_CyFunction_repr(__pyx_CyFunctionObject *op)
{
#if PY_MAJOR_VERSION >= 3
    return PyUnicode_FromFormat("<cyfunction %U at %p>",
                                op->func_qualname, (void *)op);
#else
    return PyString_FromFormat("<cyfunction %s at %p>",
                               PyString_AsString(op->func_qualname), (void *)op);
#endif
}
#if CYTHON_COMPILING_IN_PYPY
static PyObject * __Pyx_CyFunction_Call(PyObject *func, PyObject *arg, PyObject *kw) {
    PyCFunctionObject* f = (PyCFunctionObject*)func;
    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
    PyObject *self = PyCFunction_GET_SELF(func);
    Py_ssize_t size;
    switch (PyCFunction_GET_FLAGS(func) & ~(METH_CLASS | METH_STATIC | METH_COEXIST)) {
    case METH_VARARGS:
        if (likely(kw == NULL) || PyDict_Size(kw) == 0)
            return (*meth)(self, arg);
        break;
    case METH_VARARGS | METH_KEYWORDS:
        return (*(PyCFunctionWithKeywords)meth)(self, arg, kw);
    case METH_NOARGS:
        if (likely(kw == NULL) || PyDict_Size(kw) == 0) {
            size = PyTuple_GET_SIZE(arg);
            if (size == 0)
                return (*meth)(self, NULL);
            PyErr_Format(PyExc_TypeError,
                "%.200s() takes no arguments (%zd given)",
                f->m_ml->ml_name, size);
            return NULL;
        }
        break;
    case METH_O:
        if (likely(kw == NULL) || PyDict_Size(kw) == 0) {
            size = PyTuple_GET_SIZE(arg);
            if (size == 1)
                return (*meth)(self, PyTuple_GET_ITEM(arg, 0));
            PyErr_Format(PyExc_TypeError,
                "%.200s() takes exactly one argument (%zd given)",
                f->m_ml->ml_name, size);
            return NULL;
        }
        break;
    default:
        PyErr_SetString(PyExc_SystemError, "Bad call flags in "
                        "__Pyx_CyFunction_Call. METH_OLDARGS is no "
                        "longer supported!");
        return NULL;
    }
    PyErr_Format(PyExc_TypeError, "%.200s() takes no keyword arguments",
                 f->m_ml->ml_name);
    return NULL;
}
#else
static PyObject * __Pyx_CyFunction_Call(PyObject *func, PyObject *arg, PyObject *kw) {
	return PyCFunction_Call(func, arg, kw);
}
#endif
static PyTypeObject __pyx_CyFunctionType_type = {
    PyVarObject_HEAD_INIT(0, 0)
    __Pyx_NAMESTR("cython_function_or_method"), /*tp_name*/
    sizeof(__pyx_CyFunctionObject),   /*tp_basicsize*/
    0,                                  /*tp_itemsize*/
    (destructor) __Pyx_CyFunction_dealloc, /*tp_dealloc*/
    0,                                  /*tp_print*/
    0,                                  /*tp_getattr*/
    0,                                  /*tp_setattr*/
#if PY_MAJOR_VERSION < 3
    0,                                  /*tp_compare*/
#else
    0,                                  /*reserved*/
#endif
    (reprfunc) __Pyx_CyFunction_repr,   /*tp_repr*/
    0,                                  /*tp_as_number*/
    0,                                  /*tp_as_sequence*/
    0,                                  /*tp_as_mapping*/
    0,                                  /*tp_hash*/
    __Pyx_CyFunction_Call,              /*tp_call*/
    0,                                  /*tp_str*/
    0,                                  /*tp_getattro*/
    0,                                  /*tp_setattro*/
    0,                                  /*tp_as_buffer*/
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC, /* tp_flags*/
    0,                                  /*tp_doc*/
    (traverseproc) __Pyx_CyFunction_traverse,   /*tp_traverse*/
    (inquiry) __Pyx_CyFunction_clear,   /*tp_clear*/
    0,                                  /*tp_richcompare*/
    offsetof(__pyx_CyFunctionObject, func_weakreflist), /* tp_weaklistoffse */
    0,                                  /*tp_iter*/
    0,                                  /*tp_iternext*/
    __pyx_CyFunction_methods,           /*tp_methods*/
    __pyx_CyFunction_members,           /*tp_members*/
    __pyx_CyFunction_getsets,           /*tp_getset*/
    0,                                  /*tp_base*/
    0,                                  /*tp_dict*/
    __Pyx_CyFunction_descr_get,         /*tp_descr_get*/
    0,                                  /*tp_descr_set*/
    offsetof(__pyx_CyFunctionObject, func_dict),/*tp_dictoffset*/
    0,                                  /*tp_init*/
    0,                                  /*tp_alloc*/
    0,                                  /*tp_new*/
    0,                                  /*tp_free*/
    0,                                  /*tp_is_gc*/
    0,                                  /*tp_bases*/
    0,                                  /*tp_mro*/
    0,                                  /*tp_cache*/
    0,                                  /*tp_subclasses*/
    0,                                  /*tp_weaklist*/
    0,                                  /*tp_del*/
#if PY_VERSION_HEX >= 0x02060000
    0,                                  /*tp_version_tag*/
#endif
#if PY_VERSION_HEX >= 0x030400a1
    0,                                  /*tp_finalize*/
#endif
};
static int __Pyx_CyFunction_init(void) {
#if !CYTHON_COMPILING_IN_PYPY
    __pyx_CyFunctionType_type.tp_call = PyCFunction_Call;
#endif
    __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
    if (__pyx_CyFunctionType == NULL) {
        return -1;
    }
    return 0;
}
static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *func, size_t size, int pyobjects) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults = PyMem_Malloc(size);
    if (!m->defaults)
        return PyErr_NoMemory();
    memset(m->defaults, 0, size);
    m->defaults_pyobjects = pyobjects;
    return m->defaults;
}
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *func, PyObject *tuple) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults_tuple = tuple;
    Py_INCREF(tuple);
}
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *func, PyObject *dict) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults_kwdict = dict;
    Py_INCREF(dict);
}
static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *func, PyObject *dict) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->func_annotations = dict;
    Py_INCREF(dict);
}

static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
#if PY_VERSION_HEX >= 0x02070000 && !(PY_MAJOR_VERSION==3&&PY_MINOR_VERSION==0)
    PyObject *ob = PyCapsule_New(vtable, 0, 0);
#else
    PyObject *ob = PyCObject_FromVoidPtr(vtable, 0);
#endif
    if (!ob)
        goto bad;
    if (PyDict_SetItem(dict, __pyx_n_s_pyx_vtable, ob) < 0)
        goto bad;
    Py_DECREF(ob);
    return 0;
bad:
    Py_XDECREF(ob);
    return -1;
}

static void* __Pyx_GetVtable(PyObject *dict) {
    void* ptr;
    PyObject *ob = PyObject_GetItem(dict, __pyx_n_s_pyx_vtable);
    if (!ob)
        goto bad;
#if PY_VERSION_HEX >= 0x02070000 && !(PY_MAJOR_VERSION==3&&PY_MINOR_VERSION==0)
    ptr = PyCapsule_GetPointer(ob, 0);
#else
    ptr = PyCObject_AsVoidPtr(ob);
#endif
    if (!ptr && !PyErr_Occurred())
        PyErr_SetString(PyExc_RuntimeError, "invalid vtable found for imported type");
    Py_DECREF(ob);
    return ptr;
bad:
    Py_XDECREF(ob);
    return NULL;
}

static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
    PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
    if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
        PyErr_Format(PyExc_ImportError,
        #if PY_MAJOR_VERSION < 3
            "cannot import name %.230s", PyString_AS_STRING(name));
        #else
            "cannot import name %S", name);
        #endif
    }
    return value;
}

static PyObject *__Pyx_GetNameInClass(PyObject *nmspace, PyObject *name) {
    PyObject *result;
    result = __Pyx_PyObject_GetAttrStr(nmspace, name);
    if (!result)
        result = __Pyx_GetModuleGlobalName(name);
    return result;
}

static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases) {
    Py_ssize_t i, nbases = PyTuple_GET_SIZE(bases);
    for (i=0; i < nbases; i++) {
        PyTypeObject *tmptype;
        PyObject *tmp = PyTuple_GET_ITEM(bases, i);
        tmptype = Py_TYPE(tmp);
#if PY_MAJOR_VERSION < 3
        if (tmptype == &PyClass_Type)
            continue;
#endif
        if (!metaclass) {
            metaclass = tmptype;
            continue;
        }
        if (PyType_IsSubtype(metaclass, tmptype))
            continue;
        if (PyType_IsSubtype(tmptype, metaclass)) {
            metaclass = tmptype;
            continue;
        }
        PyErr_SetString(PyExc_TypeError,
                        "metaclass conflict: "
                        "the metaclass of a derived class "
                        "must be a (non-strict) subclass "
                        "of the metaclasses of all its bases");
        return NULL;
    }
    if (!metaclass) {
#if PY_MAJOR_VERSION < 3
        metaclass = &PyClass_Type;
#else
        metaclass = &PyType_Type;
#endif
    }
    Py_INCREF((PyObject*) metaclass);
    return (PyObject*) metaclass;
}

static PyObject *__Pyx_Py3MetaclassPrepare(PyObject *metaclass, PyObject *bases, PyObject *name,
                                           PyObject *qualname, PyObject *mkw, PyObject *modname, PyObject *doc) {
    PyObject *ns;
    if (metaclass) {
        PyObject *prep = __Pyx_PyObject_GetAttrStr(metaclass, __pyx_n_s_prepare);
        if (prep) {
            PyObject *pargs = PyTuple_Pack(2, name, bases);
            if (unlikely(!pargs)) {
                Py_DECREF(prep);
                return NULL;
            }
            ns = PyObject_Call(prep, pargs, mkw);
            Py_DECREF(prep);
            Py_DECREF(pargs);
        } else {
            if (unlikely(!PyErr_ExceptionMatches(PyExc_AttributeError)))
                return NULL;
            PyErr_Clear();
            ns = PyDict_New();
        }
    } else {
        ns = PyDict_New();
    }
    if (unlikely(!ns))
        return NULL;
    if (unlikely(PyObject_SetItem(ns, __pyx_n_s_module, modname) < 0)) goto bad;
    if (unlikely(PyObject_SetItem(ns, __pyx_n_s_qualname, qualname) < 0)) goto bad;
    if (unlikely(doc && PyObject_SetItem(ns, __pyx_n_s_doc, doc) < 0)) goto bad;
    return ns;
bad:
    Py_DECREF(ns);
    return NULL;
}
static PyObject *__Pyx_Py3ClassCreate(PyObject *metaclass, PyObject *name, PyObject *bases,
                                      PyObject *dict, PyObject *mkw,
                                      int calculate_metaclass, int allow_py2_metaclass) {
    PyObject *result, *margs;
    PyObject *owned_metaclass = NULL;
    if (allow_py2_metaclass) {
        owned_metaclass = PyObject_GetItem(dict, __pyx_n_s_metaclass);
        if (owned_metaclass) {
            metaclass = owned_metaclass;
        } else if (likely(PyErr_ExceptionMatches(PyExc_KeyError))) {
            PyErr_Clear();
        } else {
            return NULL;
        }
    }
    if (calculate_metaclass && (!metaclass || PyType_Check(metaclass))) {
        metaclass = __Pyx_CalculateMetaclass((PyTypeObject*) metaclass, bases);
        Py_XDECREF(owned_metaclass);
        if (unlikely(!metaclass))
            return NULL;
        owned_metaclass = metaclass;
    }
    margs = PyTuple_Pack(3, name, bases, dict);
    if (unlikely(!margs)) {
        result = NULL;
    } else {
        result = PyObject_Call(metaclass, margs, mkw);
        Py_DECREF(margs);
    }
    Py_XDECREF(owned_metaclass);
    return result;
}

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    #if PY_VERSION_HEX < 0x03030000
    PyObject *py_import;
    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
    if (!py_import)
        goto bad;
    #endif
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    #if PY_VERSION_HEX >= 0x02050000
    {
        #if PY_MAJOR_VERSION >= 3
        if (level == -1) {
            if (strchr(__Pyx_MODULE_NAME, '.')) {
                #if PY_VERSION_HEX < 0x03030000
                PyObject *py_level = PyInt_FromLong(1);
                if (!py_level)
                    goto bad;
                module = PyObject_CallFunctionObjArgs(py_import,
                    name, global_dict, empty_dict, list, py_level, NULL);
                Py_DECREF(py_level);
                #else
                module = PyImport_ImportModuleLevelObject(
                    name, global_dict, empty_dict, list, 1);
                #endif
                if (!module) {
                    if (!PyErr_ExceptionMatches(PyExc_ImportError))
                        goto bad;
                    PyErr_Clear();
                }
            }
            level = 0; /* try absolute import on failure */
        }
        #endif
        if (!module) {
            #if PY_VERSION_HEX < 0x03030000
            PyObject *py_level = PyInt_FromLong(level);
            if (!py_level)
                goto bad;
            module = PyObject_CallFunctionObjArgs(py_import,
                name, global_dict, empty_dict, list, py_level, NULL);
            Py_DECREF(py_level);
            #else
            module = PyImport_ImportModuleLevelObject(
                name, global_dict, empty_dict, list, level);
            #endif
        }
    }
    #else
    if (level>0) {
        PyErr_SetString(PyExc_RuntimeError, "Relative import is not supported for Python <=2.4.");
        goto bad;
    }
    module = PyObject_CallFunctionObjArgs(py_import,
        name, global_dict, empty_dict, list, NULL);
    #endif
bad:
    #if PY_VERSION_HEX < 0x03030000
    Py_XDECREF(py_import);
    #endif
    Py_XDECREF(empty_list);
    Py_XDECREF(empty_dict);
    return module;
}

#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func)             \
    {                                                                     \
        func_type value = func(x);                                        \
        if (sizeof(target_type) < sizeof(func_type)) {                    \
            if (unlikely(value != (func_type) (target_type) value)) {     \
                func_type zero = 0;                                       \
                PyErr_SetString(PyExc_OverflowError,                      \
                    (is_unsigned && unlikely(value < zero)) ?             \
                    "can't convert negative value to " #target_type :     \
                    "value too large to convert to " #target_type);       \
                return (target_type) -1;                                  \
            }                                                             \
        }                                                                 \
        return (target_type) value;                                       \
    }

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
  #include "longintrepr.h"
 #endif
#endif
static CYTHON_INLINE unsigned long __Pyx_PyInt_As_unsigned_long(PyObject *x) {
    const unsigned long neg_one = (unsigned long) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(unsigned long) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(unsigned long, long, PyInt_AS_LONG)
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned long");
                return (unsigned long) -1;
            }
            return (unsigned long) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(unsigned long)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return (unsigned long) ((PyLongObject*)x)->ob_digit[0];
                }
            }
 #endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned long");
                return (unsigned long) -1;
            }
            if (sizeof(unsigned long) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT(unsigned long, unsigned long, PyLong_AsUnsignedLong)
            } else if (sizeof(unsigned long) <= sizeof(unsigned long long)) {
                __PYX_VERIFY_RETURN_INT(unsigned long, unsigned long long, PyLong_AsUnsignedLongLong)
            }
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(unsigned long)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return +(unsigned long) ((PyLongObject*)x)->ob_digit[0];
                    case -1: return -(unsigned long) ((PyLongObject*)x)->ob_digit[0];
                }
            }
 #endif
#endif
            if (sizeof(unsigned long) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT(unsigned long, long, PyLong_AsLong)
            } else if (sizeof(unsigned long) <= sizeof(long long)) {
                __PYX_VERIFY_RETURN_INT(unsigned long, long long, PyLong_AsLongLong)
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            unsigned long val;
            PyObject *v = __Pyx_PyNumber_Int(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (unsigned long) -1;
        }
    } else {
        unsigned long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned long) -1;
        val = __Pyx_PyInt_As_unsigned_long(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
    const int neg_one = (int) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(int) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(int) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
        } else if (sizeof(int) <= sizeof(unsigned long long)) {
            return PyLong_FromUnsignedLongLong((unsigned long long) value);
        }
    } else {
        if (sizeof(int) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(int) <= sizeof(long long)) {
            return PyLong_FromLongLong((long long) value);
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(int),
                                     little, !is_unsigned);
    }
}

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
  #include "longintrepr.h"
 #endif
#endif
static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
    const int neg_one = (int) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(int) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG)
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to int");
                return (int) -1;
            }
            return (int) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(int)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return (int) ((PyLongObject*)x)->ob_digit[0];
                }
            }
 #endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to int");
                return (int) -1;
            }
            if (sizeof(int) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT(int, unsigned long, PyLong_AsUnsignedLong)
            } else if (sizeof(int) <= sizeof(unsigned long long)) {
                __PYX_VERIFY_RETURN_INT(int, unsigned long long, PyLong_AsUnsignedLongLong)
            }
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(int)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return +(int) ((PyLongObject*)x)->ob_digit[0];
                    case -1: return -(int) ((PyLongObject*)x)->ob_digit[0];
                }
            }
 #endif
#endif
            if (sizeof(int) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT(int, long, PyLong_AsLong)
            } else if (sizeof(int) <= sizeof(long long)) {
                __PYX_VERIFY_RETURN_INT(int, long long, PyLong_AsLongLong)
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            int val;
            PyObject *v = __Pyx_PyNumber_Int(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (int) -1;
        }
    } else {
        int val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (int) -1;
        val = __Pyx_PyInt_As_int(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
  #include "longintrepr.h"
 #endif
#endif
static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *x) {
    const size_t neg_one = (size_t) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(size_t) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(size_t, long, PyInt_AS_LONG)
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to size_t");
                return (size_t) -1;
            }
            return (size_t) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(size_t)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return (size_t) ((PyLongObject*)x)->ob_digit[0];
                }
            }
 #endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to size_t");
                return (size_t) -1;
            }
            if (sizeof(size_t) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, PyLong_AsUnsignedLong)
            } else if (sizeof(size_t) <= sizeof(unsigned long long)) {
                __PYX_VERIFY_RETURN_INT(size_t, unsigned long long, PyLong_AsUnsignedLongLong)
            }
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(size_t)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return +(size_t) ((PyLongObject*)x)->ob_digit[0];
                    case -1: return -(size_t) ((PyLongObject*)x)->ob_digit[0];
                }
            }
 #endif
#endif
            if (sizeof(size_t) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT(size_t, long, PyLong_AsLong)
            } else if (sizeof(size_t) <= sizeof(long long)) {
                __PYX_VERIFY_RETURN_INT(size_t, long long, PyLong_AsLongLong)
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            size_t val;
            PyObject *v = __Pyx_PyNumber_Int(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (size_t) -1;
        }
    } else {
        size_t val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (size_t) -1;
        val = __Pyx_PyInt_As_size_t(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
    const long neg_one = (long) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(long) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(long) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
        } else if (sizeof(long) <= sizeof(unsigned long long)) {
            return PyLong_FromUnsignedLongLong((unsigned long long) value);
        }
    } else {
        if (sizeof(long) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(long) <= sizeof(long long)) {
            return PyLong_FromLongLong((long long) value);
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(long),
                                     little, !is_unsigned);
    }
}

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_unsigned_long(unsigned long value) {
    const unsigned long neg_one = (unsigned long) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(unsigned long) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(unsigned long) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
        } else if (sizeof(unsigned long) <= sizeof(unsigned long long)) {
            return PyLong_FromUnsignedLongLong((unsigned long long) value);
        }
    } else {
        if (sizeof(unsigned long) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(unsigned long) <= sizeof(long long)) {
            return PyLong_FromLongLong((long long) value);
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(unsigned long),
                                     little, !is_unsigned);
    }
}

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_unsigned_int(unsigned int value) {
    const unsigned int neg_one = (unsigned int) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(unsigned int) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(unsigned int) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
        } else if (sizeof(unsigned int) <= sizeof(unsigned long long)) {
            return PyLong_FromUnsignedLongLong((unsigned long long) value);
        }
    } else {
        if (sizeof(unsigned int) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(unsigned int) <= sizeof(long long)) {
            return PyLong_FromLongLong((long long) value);
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(unsigned int),
                                     little, !is_unsigned);
    }
}

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
  #include "longintrepr.h"
 #endif
#endif
static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
    const long neg_one = (long) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(long) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(long, long, PyInt_AS_LONG)
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to long");
                return (long) -1;
            }
            return (long) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(long)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return (long) ((PyLongObject*)x)->ob_digit[0];
                }
            }
 #endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to long");
                return (long) -1;
            }
            if (sizeof(long) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT(long, unsigned long, PyLong_AsUnsignedLong)
            } else if (sizeof(long) <= sizeof(unsigned long long)) {
                __PYX_VERIFY_RETURN_INT(long, unsigned long long, PyLong_AsUnsignedLongLong)
            }
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(long)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return +(long) ((PyLongObject*)x)->ob_digit[0];
                    case -1: return -(long) ((PyLongObject*)x)->ob_digit[0];
                }
            }
 #endif
#endif
            if (sizeof(long) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT(long, long, PyLong_AsLong)
            } else if (sizeof(long) <= sizeof(long long)) {
                __PYX_VERIFY_RETURN_INT(long, long long, PyLong_AsLongLong)
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            long val;
            PyObject *v = __Pyx_PyNumber_Int(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (long) -1;
        }
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (long) -1;
        val = __Pyx_PyInt_As_long(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static PyObject* __Pyx_Method_ClassMethod(PyObject *method) {
#if CYTHON_COMPILING_IN_PYPY
    if (PyObject_TypeCheck(method, &PyWrapperDescr_Type)) { /* cdef classes */
        return PyClassMethod_New(method);
    }
#else
    static PyTypeObject *methoddescr_type = NULL;
    if (methoddescr_type == NULL) {
       PyObject *meth = __Pyx_GetAttrString((PyObject*)&PyList_Type, "append");
       if (!meth) return NULL;
       methoddescr_type = Py_TYPE(meth);
       Py_DECREF(meth);
    }
    if (PyObject_TypeCheck(method, methoddescr_type)) { /* cdef classes */
        PyMethodDescrObject *descr = (PyMethodDescrObject *)method;
        #if PY_VERSION_HEX < 0x03020000
        PyTypeObject *d_type = descr->d_type;
        #else
        PyTypeObject *d_type = descr->d_common.d_type;
        #endif
        return PyDescr_NewClassMethod(d_type, descr->d_method);
    }
#endif
    else if (PyMethod_Check(method)) { /* python classes */
        return PyClassMethod_New(PyMethod_GET_FUNCTION(method));
    }
    else if (PyCFunction_Check(method)) {
        return PyClassMethod_New(method);
    }
#ifdef __Pyx_CyFunction_USED
    else if (PyObject_TypeCheck(method, __pyx_CyFunctionType)) {
        return PyClassMethod_New(method);
    }
#endif
    PyErr_SetString(PyExc_TypeError,
                   "Class-level classmethod() can only be called on "
                   "a method_descriptor or instance method.");
    return NULL;
}

static PyObject *__Pyx_Generator_Next(PyObject *self);
static PyObject *__Pyx_Generator_Send(PyObject *self, PyObject *value);
static PyObject *__Pyx_Generator_Close(PyObject *self);
static PyObject *__Pyx_Generator_Throw(PyObject *gen, PyObject *args);
static PyTypeObject *__pyx_GeneratorType = 0;
#define __Pyx_Generator_CheckExact(obj) (Py_TYPE(obj) == __pyx_GeneratorType)
#define __Pyx_Generator_Undelegate(gen) Py_CLEAR((gen)->yieldfrom)
#if 1 || PY_VERSION_HEX < 0x030300B0
static int __Pyx_PyGen_FetchStopIterationValue(PyObject **pvalue) {
    PyObject *et, *ev, *tb;
    PyObject *value = NULL;
    __Pyx_ErrFetch(&et, &ev, &tb);
    if (!et) {
        Py_XDECREF(tb);
        Py_XDECREF(ev);
        Py_INCREF(Py_None);
        *pvalue = Py_None;
        return 0;
    }
    if (unlikely(et != PyExc_StopIteration) &&
            unlikely(!PyErr_GivenExceptionMatches(et, PyExc_StopIteration))) {
        __Pyx_ErrRestore(et, ev, tb);
        return -1;
    }
    if (likely(et == PyExc_StopIteration)) {
        if (likely(!ev) || !PyObject_IsInstance(ev, PyExc_StopIteration)) {
            if (!ev) {
                Py_INCREF(Py_None);
                ev = Py_None;
            }
            Py_XDECREF(tb);
            Py_DECREF(et);
            *pvalue = ev;
            return 0;
        }
    }
    PyErr_NormalizeException(&et, &ev, &tb);
    if (unlikely(!PyObject_IsInstance(ev, PyExc_StopIteration))) {
        __Pyx_ErrRestore(et, ev, tb);
        return -1;
    }
    Py_XDECREF(tb);
    Py_DECREF(et);
#if PY_VERSION_HEX >= 0x030300A0
    value = ((PyStopIterationObject *)ev)->value;
    Py_INCREF(value);
    Py_DECREF(ev);
#else
    {
        PyObject* args = PyObject_GetAttr(ev, __pyx_n_s_args);
        Py_DECREF(ev);
        if (likely(args)) {
            value = PyObject_GetItem(args, 0);
            Py_DECREF(args);
        }
        if (unlikely(!value)) {
            __Pyx_ErrRestore(NULL, NULL, NULL);
            Py_INCREF(Py_None);
            value = Py_None;
        }
    }
#endif
    *pvalue = value;
    return 0;
}
#endif
static CYTHON_INLINE
void __Pyx_Generator_ExceptionClear(__pyx_GeneratorObject *self) {
    PyObject *exc_type = self->exc_type;
    PyObject *exc_value = self->exc_value;
    PyObject *exc_traceback = self->exc_traceback;
    self->exc_type = NULL;
    self->exc_value = NULL;
    self->exc_traceback = NULL;
    Py_XDECREF(exc_type);
    Py_XDECREF(exc_value);
    Py_XDECREF(exc_traceback);
}
static CYTHON_INLINE
int __Pyx_Generator_CheckRunning(__pyx_GeneratorObject *gen) {
    if (unlikely(gen->is_running)) {
        PyErr_SetString(PyExc_ValueError,
                        "generator already executing");
        return 1;
    }
    return 0;
}
static CYTHON_INLINE
PyObject *__Pyx_Generator_SendEx(__pyx_GeneratorObject *self, PyObject *value) {
    PyObject *retval;
    assert(!self->is_running);
    if (unlikely(self->resume_label == 0)) {
        if (unlikely(value && value != Py_None)) {
            PyErr_SetString(PyExc_TypeError,
                            "can't send non-None value to a "
                            "just-started generator");
            return NULL;
        }
    }
    if (unlikely(self->resume_label == -1)) {
        PyErr_SetNone(PyExc_StopIteration);
        return NULL;
    }
    if (value) {
#if CYTHON_COMPILING_IN_PYPY
#else
        /* Generators always return to their most recent caller, not
         * necessarily their creator. */
        if (self->exc_traceback) {
            PyThreadState *tstate = PyThreadState_GET();
            PyTracebackObject *tb = (PyTracebackObject *) self->exc_traceback;
            PyFrameObject *f = tb->tb_frame;
            Py_XINCREF(tstate->frame);
            assert(f->f_back == NULL);
            f->f_back = tstate->frame;
        }
#endif
        __Pyx_ExceptionSwap(&self->exc_type, &self->exc_value,
                            &self->exc_traceback);
    } else {
        __Pyx_Generator_ExceptionClear(self);
    }
    self->is_running = 1;
    retval = self->body((PyObject *) self, value);
    self->is_running = 0;
    if (retval) {
        __Pyx_ExceptionSwap(&self->exc_type, &self->exc_value,
                            &self->exc_traceback);
#if CYTHON_COMPILING_IN_PYPY
#else
        /* Don't keep the reference to f_back any longer than necessary.  It
         * may keep a chain of frames alive or it could create a reference
         * cycle. */
        if (self->exc_traceback) {
            PyTracebackObject *tb = (PyTracebackObject *) self->exc_traceback;
            PyFrameObject *f = tb->tb_frame;
            Py_CLEAR(f->f_back);
        }
#endif
    } else {
        __Pyx_Generator_ExceptionClear(self);
    }
    return retval;
}
static CYTHON_INLINE
PyObject *__Pyx_Generator_FinishDelegation(__pyx_GeneratorObject *gen) {
    PyObject *ret;
    PyObject *val = NULL;
    __Pyx_Generator_Undelegate(gen);
    __Pyx_PyGen_FetchStopIterationValue(&val);
    ret = __Pyx_Generator_SendEx(gen, val);
    Py_XDECREF(val);
    return ret;
}
static PyObject *__Pyx_Generator_Next(PyObject *self) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject*) self;
    PyObject *yf = gen->yieldfrom;
    if (unlikely(__Pyx_Generator_CheckRunning(gen)))
        return NULL;
    if (yf) {
        PyObject *ret;
        gen->is_running = 1;
        ret = Py_TYPE(yf)->tp_iternext(yf);
        gen->is_running = 0;
        if (likely(ret)) {
            return ret;
        }
        return __Pyx_Generator_FinishDelegation(gen);
    }
    return __Pyx_Generator_SendEx(gen, Py_None);
}
static PyObject *__Pyx_Generator_Send(PyObject *self, PyObject *value) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject*) self;
    PyObject *yf = gen->yieldfrom;
    if (unlikely(__Pyx_Generator_CheckRunning(gen)))
        return NULL;
    if (yf) {
        PyObject *ret;
        gen->is_running = 1;
        if (__Pyx_Generator_CheckExact(yf)) {
            ret = __Pyx_Generator_Send(yf, value);
        } else {
            if (value == Py_None)
                ret = PyIter_Next(yf);
            else
                ret = __Pyx_PyObject_CallMethod1(yf, __pyx_n_s_send, value);
        }
        gen->is_running = 0;
        if (likely(ret)) {
            return ret;
        }
        return __Pyx_Generator_FinishDelegation(gen);
    }
    return __Pyx_Generator_SendEx(gen, value);
}
static int __Pyx_Generator_CloseIter(__pyx_GeneratorObject *gen, PyObject *yf) {
    PyObject *retval = NULL;
    int err = 0;
    if (__Pyx_Generator_CheckExact(yf)) {
        retval = __Pyx_Generator_Close(yf);
        if (!retval)
            return -1;
    } else {
        PyObject *meth;
        gen->is_running = 1;
        meth = PyObject_GetAttr(yf, __pyx_n_s_close);
        if (unlikely(!meth)) {
            if (!PyErr_ExceptionMatches(PyExc_AttributeError)) {
                PyErr_WriteUnraisable(yf);
            }
            PyErr_Clear();
        } else {
            retval = PyObject_CallFunction(meth, NULL);
            Py_DECREF(meth);
            if (!retval)
                err = -1;
        }
        gen->is_running = 0;
    }
    Py_XDECREF(retval);
    return err;
}
static PyObject *__Pyx_Generator_Close(PyObject *self) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    PyObject *retval, *raised_exception;
    PyObject *yf = gen->yieldfrom;
    int err = 0;
    if (unlikely(__Pyx_Generator_CheckRunning(gen)))
        return NULL;
    if (yf) {
        Py_INCREF(yf);
        err = __Pyx_Generator_CloseIter(gen, yf);
        __Pyx_Generator_Undelegate(gen);
        Py_DECREF(yf);
    }
    if (err == 0)
#if PY_VERSION_HEX < 0x02050000
        PyErr_SetNone(PyExc_StopIteration);
#else
        PyErr_SetNone(PyExc_GeneratorExit);
#endif
    retval = __Pyx_Generator_SendEx(gen, NULL);
    if (retval) {
        Py_DECREF(retval);
        PyErr_SetString(PyExc_RuntimeError,
                        "generator ignored GeneratorExit");
        return NULL;
    }
    raised_exception = PyErr_Occurred();
    if (!raised_exception
        || raised_exception == PyExc_StopIteration
#if PY_VERSION_HEX >= 0x02050000
        || raised_exception == PyExc_GeneratorExit
        || PyErr_GivenExceptionMatches(raised_exception, PyExc_GeneratorExit)
#endif
        || PyErr_GivenExceptionMatches(raised_exception, PyExc_StopIteration))
    {
        if (raised_exception) PyErr_Clear();      /* ignore these errors */
        Py_INCREF(Py_None);
        return Py_None;
    }
    return NULL;
}
static PyObject *__Pyx_Generator_Throw(PyObject *self, PyObject *args) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    PyObject *typ;
    PyObject *tb = NULL;
    PyObject *val = NULL;
    PyObject *yf = gen->yieldfrom;
    if (!PyArg_UnpackTuple(args, (char *)"throw", 1, 3, &typ, &val, &tb))
        return NULL;
    if (unlikely(__Pyx_Generator_CheckRunning(gen)))
        return NULL;
    if (yf) {
        PyObject *ret;
        Py_INCREF(yf);
#if PY_VERSION_HEX >= 0x02050000
        if (PyErr_GivenExceptionMatches(typ, PyExc_GeneratorExit)) {
            int err = __Pyx_Generator_CloseIter(gen, yf);
            Py_DECREF(yf);
            __Pyx_Generator_Undelegate(gen);
            if (err < 0)
                return __Pyx_Generator_SendEx(gen, NULL);
            goto throw_here;
        }
#endif
        gen->is_running = 1;
        if (__Pyx_Generator_CheckExact(yf)) {
            ret = __Pyx_Generator_Throw(yf, args);
        } else {
            PyObject *meth = PyObject_GetAttr(yf, __pyx_n_s_throw);
            if (unlikely(!meth)) {
                Py_DECREF(yf);
                if (!PyErr_ExceptionMatches(PyExc_AttributeError)) {
                    gen->is_running = 0;
                    return NULL;
                }
                PyErr_Clear();
                __Pyx_Generator_Undelegate(gen);
                gen->is_running = 0;
                goto throw_here;
            }
            ret = PyObject_CallObject(meth, args);
            Py_DECREF(meth);
        }
        gen->is_running = 0;
        Py_DECREF(yf);
        if (!ret) {
            ret = __Pyx_Generator_FinishDelegation(gen);
        }
        return ret;
    }
throw_here:
    __Pyx_Raise(typ, val, tb, NULL);
    return __Pyx_Generator_SendEx(gen, NULL);
}
static int __Pyx_Generator_traverse(PyObject *self, visitproc visit, void *arg) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    Py_VISIT(gen->closure);
    Py_VISIT(gen->classobj);
    Py_VISIT(gen->yieldfrom);
    Py_VISIT(gen->exc_type);
    Py_VISIT(gen->exc_value);
    Py_VISIT(gen->exc_traceback);
    return 0;
}
static int __Pyx_Generator_clear(PyObject *self) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    Py_CLEAR(gen->closure);
    Py_CLEAR(gen->classobj);
    Py_CLEAR(gen->yieldfrom);
    Py_CLEAR(gen->exc_type);
    Py_CLEAR(gen->exc_value);
    Py_CLEAR(gen->exc_traceback);
    return 0;
}
static void __Pyx_Generator_dealloc(PyObject *self) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    PyObject_GC_UnTrack(gen);
    if (gen->gi_weakreflist != NULL)
        PyObject_ClearWeakRefs(self);
    if (gen->resume_label > 0) {
        PyObject_GC_Track(self);
#if PY_VERSION_HEX >= 0x030400a1
        if (PyObject_CallFinalizerFromDealloc(self))
#else
        Py_TYPE(gen)->tp_del(self);
        if (self->ob_refcnt > 0)
#endif
            return;                     /* resurrected.  :( */
        PyObject_GC_UnTrack(self);
    }
    __Pyx_Generator_clear(self);
    PyObject_GC_Del(gen);
}
static void __Pyx_Generator_del(PyObject *self) {
    PyObject *res;
    PyObject *error_type, *error_value, *error_traceback;
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    if (gen->resume_label <= 0)
        return ;
#if PY_VERSION_HEX < 0x030400a1
    assert(self->ob_refcnt == 0);
    self->ob_refcnt = 1;
#endif
    __Pyx_ErrFetch(&error_type, &error_value, &error_traceback);
    res = __Pyx_Generator_Close(self);
    if (res == NULL)
        PyErr_WriteUnraisable(self);
    else
        Py_DECREF(res);
    __Pyx_ErrRestore(error_type, error_value, error_traceback);
#if PY_VERSION_HEX < 0x030400a1
    /* Undo the temporary resurrection; can't use DECREF here, it would
     * cause a recursive call.
     */
    assert(self->ob_refcnt > 0);
    if (--self->ob_refcnt == 0)
        return; /* this is the normal path out */
    /* close() resurrected it!  Make it look like the original Py_DECREF
     * never happened.
     */
    {
        Py_ssize_t refcnt = self->ob_refcnt;
        _Py_NewReference(self);
        self->ob_refcnt = refcnt;
    }
#if CYTHON_COMPILING_IN_CPYTHON
    assert(PyType_IS_GC(self->ob_type) &&
           _Py_AS_GC(self)->gc.gc_refs != _PyGC_REFS_UNTRACKED);
    /* If Py_REF_DEBUG, _Py_NewReference bumped _Py_RefTotal, so
     * we need to undo that. */
    _Py_DEC_REFTOTAL;
#endif
    /* If Py_TRACE_REFS, _Py_NewReference re-added self to the object
     * chain, so no more to do there.
     * If COUNT_ALLOCS, the original decref bumped tp_frees, and
     * _Py_NewReference bumped tp_allocs:  both of those need to be
     * undone.
     */
#ifdef COUNT_ALLOCS
    --Py_TYPE(self)->tp_frees;
    --Py_TYPE(self)->tp_allocs;
#endif
#endif
}
static PyMemberDef __pyx_Generator_memberlist[] = {
    {(char *) "gi_running",
#if PY_VERSION_HEX >= 0x02060000
     T_BOOL,
#else
     T_BYTE,
#endif
     offsetof(__pyx_GeneratorObject, is_running),
     READONLY,
     NULL},
    {0, 0, 0, 0, 0}
};
static PyMethodDef __pyx_Generator_methods[] = {
    {__Pyx_NAMESTR("send"), (PyCFunction) __Pyx_Generator_Send, METH_O, 0},
    {__Pyx_NAMESTR("throw"), (PyCFunction) __Pyx_Generator_Throw, METH_VARARGS, 0},
    {__Pyx_NAMESTR("close"), (PyCFunction) __Pyx_Generator_Close, METH_NOARGS, 0},
    {0, 0, 0, 0}
};
static PyTypeObject __pyx_GeneratorType_type = {
    PyVarObject_HEAD_INIT(0, 0)
    __Pyx_NAMESTR("generator"),         /*tp_name*/
    sizeof(__pyx_GeneratorObject),      /*tp_basicsize*/
    0,                                  /*tp_itemsize*/
    (destructor) __Pyx_Generator_dealloc,/*tp_dealloc*/
    0,                                  /*tp_print*/
    0,                                  /*tp_getattr*/
    0,                                  /*tp_setattr*/
#if PY_MAJOR_VERSION < 3
    0,                                  /*tp_compare*/
#else
    0,                                  /*reserved*/
#endif
    0,                                   /*tp_repr*/
    0,                                  /*tp_as_number*/
    0,                                  /*tp_as_sequence*/
    0,                                  /*tp_as_mapping*/
    0,                                  /*tp_hash*/
    0,                                  /*tp_call*/
    0,                                  /*tp_str*/
    0,                                  /*tp_getattro*/
    0,                                  /*tp_setattro*/
    0,                                  /*tp_as_buffer*/
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_HAVE_FINALIZE, /* tp_flags*/
    0,                                  /*tp_doc*/
    (traverseproc) __Pyx_Generator_traverse,   /*tp_traverse*/
    0,                                  /*tp_clear*/
    0,                                  /*tp_richcompare*/
    offsetof(__pyx_GeneratorObject, gi_weakreflist), /* tp_weaklistoffse */
    0,                                  /*tp_iter*/
    (iternextfunc) __Pyx_Generator_Next, /*tp_iternext*/
    __pyx_Generator_methods,            /*tp_methods*/
    __pyx_Generator_memberlist,         /*tp_members*/
    0,                                  /*tp_getset*/
    0,                                  /*tp_base*/
    0,                                  /*tp_dict*/
    0,                                  /*tp_descr_get*/
    0,                                  /*tp_descr_set*/
    0,                                  /*tp_dictoffset*/
    0,                                  /*tp_init*/
    0,                                  /*tp_alloc*/
    0,                                  /*tp_new*/
    0,                                  /*tp_free*/
    0,                                  /*tp_is_gc*/
    0,                                  /*tp_bases*/
    0,                                  /*tp_mro*/
    0,                                  /*tp_cache*/
    0,                                  /*tp_subclasses*/
    0,                                  /*tp_weaklist*/
#if PY_VERSION_HEX >= 0x030400a1
    0,                                  /*tp_del*/
#else
    __Pyx_Generator_del,                /*tp_del*/
#endif
#if PY_VERSION_HEX >= 0x02060000
    0,                                  /*tp_version_tag*/
#endif
#if PY_VERSION_HEX >= 0x030400a1
    __Pyx_Generator_del,                /*tp_finalize*/
#endif
};
static __pyx_GeneratorObject *__Pyx_Generator_New(__pyx_generator_body_t body,
                                                  PyObject *closure) {
    __pyx_GeneratorObject *gen =
        PyObject_GC_New(__pyx_GeneratorObject, &__pyx_GeneratorType_type);
    if (gen == NULL)
        return NULL;
    gen->body = body;
    gen->closure = closure;
    Py_XINCREF(closure);
    gen->is_running = 0;
    gen->resume_label = 0;
    gen->classobj = NULL;
    gen->yieldfrom = NULL;
    gen->exc_type = NULL;
    gen->exc_value = NULL;
    gen->exc_traceback = NULL;
    gen->gi_weakreflist = NULL;
    PyObject_GC_Track(gen);
    return gen;
}
static int __pyx_Generator_init(void) {
    __pyx_GeneratorType_type.tp_getattro = PyObject_GenericGetAttr;
    __pyx_GeneratorType_type.tp_iter = PyObject_SelfIter;
    __pyx_GeneratorType = __Pyx_FetchCommonType(&__pyx_GeneratorType_type);
    if (__pyx_GeneratorType == NULL) {
        return -1;
    }
    return 0;
}

static int __Pyx_check_binary_version(void) {
    char ctversion[4], rtversion[4];
    PyOS_snprintf(ctversion, 4, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
    PyOS_snprintf(rtversion, 4, "%s", Py_GetVersion());
    if (ctversion[0] != rtversion[0] || ctversion[2] != rtversion[2]) {
        char message[200];
        PyOS_snprintf(message, sizeof(message),
                      "compiletime version %s of module '%.100s' "
                      "does not match runtime version %s",
                      ctversion, __Pyx_MODULE_NAME, rtversion);
        #if PY_VERSION_HEX < 0x02050000
        return PyErr_Warn(NULL, message);
        #else
        return PyErr_WarnEx(NULL, message, 1);
        #endif
    }
    return 0;
}

static int __Pyx_ExportFunction(const char *name, void (*f)(void), const char *sig) {
    PyObject *d = 0;
    PyObject *cobj = 0;
    union {
        void (*fp)(void);
        void *p;
    } tmp;
    d = PyObject_GetAttrString(__pyx_m, (char *)"__pyx_capi__");
    if (!d) {
        PyErr_Clear();
        d = PyDict_New();
        if (!d)
            goto bad;
        Py_INCREF(d);
        if (PyModule_AddObject(__pyx_m, (char *)"__pyx_capi__", d) < 0)
            goto bad;
    }
    tmp.fp = f;
#if PY_VERSION_HEX >= 0x02070000 && !(PY_MAJOR_VERSION==3&&PY_MINOR_VERSION==0)
    cobj = PyCapsule_New(tmp.p, sig, 0);
#else
    cobj = PyCObject_FromVoidPtrAndDesc(tmp.p, (void *)sig, 0);
#endif
    if (!cobj)
        goto bad;
    if (PyDict_SetItemString(d, name, cobj) < 0)
        goto bad;
    Py_DECREF(cobj);
    Py_DECREF(d);
    return 0;
bad:
    Py_XDECREF(cobj);
    Py_XDECREF(d);
    return -1;
}

#ifndef __PYX_HAVE_RT_ImportModule
#define __PYX_HAVE_RT_ImportModule
static PyObject *__Pyx_ImportModule(const char *name) {
    PyObject *py_name = 0;
    PyObject *py_module = 0;
    py_name = __Pyx_PyIdentifier_FromString(name);
    if (!py_name)
        goto bad;
    py_module = PyImport_Import(py_name);
    Py_DECREF(py_name);
    return py_module;
bad:
    Py_XDECREF(py_name);
    return 0;
}
#endif

#ifndef __PYX_HAVE_RT_ImportType
#define __PYX_HAVE_RT_ImportType
static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name,
    size_t size, int strict)
{
    PyObject *py_module = 0;
    PyObject *result = 0;
    PyObject *py_name = 0;
    char warning[200];
    Py_ssize_t basicsize;
#ifdef Py_LIMITED_API
    PyObject *py_basicsize;
#endif
    py_module = __Pyx_ImportModule(module_name);
    if (!py_module)
        goto bad;
    py_name = __Pyx_PyIdentifier_FromString(class_name);
    if (!py_name)
        goto bad;
    result = PyObject_GetAttr(py_module, py_name);
    Py_DECREF(py_name);
    py_name = 0;
    Py_DECREF(py_module);
    py_module = 0;
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError,
            "%.200s.%.200s is not a type object",
            module_name, class_name);
        goto bad;
    }
#ifndef Py_LIMITED_API
    basicsize = ((PyTypeObject *)result)->tp_basicsize;
#else
    py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
    if (!py_basicsize)
        goto bad;
    basicsize = PyLong_AsSsize_t(py_basicsize);
    Py_DECREF(py_basicsize);
    py_basicsize = 0;
    if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
        goto bad;
#endif
    if (!strict && (size_t)basicsize > size) {
        PyOS_snprintf(warning, sizeof(warning),
            "%s.%s size changed, may indicate binary incompatibility",
            module_name, class_name);
        #if PY_VERSION_HEX < 0x02050000
        if (PyErr_Warn(NULL, warning) < 0) goto bad;
        #else
        if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
        #endif
    }
    else if ((size_t)basicsize != size) {
        PyErr_Format(PyExc_ValueError,
            "%.200s.%.200s has the wrong size, try recompiling",
            module_name, class_name);
        goto bad;
    }
    return (PyTypeObject *)result;
bad:
    Py_XDECREF(py_module);
    Py_XDECREF(result);
    return NULL;
}
#endif

#ifndef __PYX_HAVE_RT_ImportFunction
#define __PYX_HAVE_RT_ImportFunction
static int __Pyx_ImportFunction(PyObject *module, const char *funcname, void (**f)(void), const char *sig) {
    PyObject *d = 0;
    PyObject *cobj = 0;
    union {
        void (*fp)(void);
        void *p;
    } tmp;
    d = PyObject_GetAttrString(module, (char *)"__pyx_capi__");
    if (!d)
        goto bad;
    cobj = PyDict_GetItemString(d, funcname);
    if (!cobj) {
        PyErr_Format(PyExc_ImportError,
            "%.200s does not export expected C function %.200s",
                PyModule_GetName(module), funcname);
        goto bad;
    }
#if PY_VERSION_HEX >= 0x02070000 && !(PY_MAJOR_VERSION==3 && PY_MINOR_VERSION==0)
    if (!PyCapsule_IsValid(cobj, sig)) {
        PyErr_Format(PyExc_TypeError,
            "C function %.200s.%.200s has wrong signature (expected %.500s, got %.500s)",
             PyModule_GetName(module), funcname, sig, PyCapsule_GetName(cobj));
        goto bad;
    }
    tmp.p = PyCapsule_GetPointer(cobj, sig);
#else
    {const char *desc, *s1, *s2;
    desc = (const char *)PyCObject_GetDesc(cobj);
    if (!desc)
        goto bad;
    s1 = desc; s2 = sig;
    while (*s1 != '\0' && *s1 == *s2) { s1++; s2++; }
    if (*s1 != *s2) {
        PyErr_Format(PyExc_TypeError,
            "C function %.200s.%.200s has wrong signature (expected %.500s, got %.500s)",
             PyModule_GetName(module), funcname, sig, desc);
        goto bad;
    }
    tmp.p = PyCObject_AsVoidPtr(cobj);}
#endif
    *f = tmp.fp;
    if (!(*f))
        goto bad;
    Py_DECREF(d);
    return 0;
bad:
    Py_XDECREF(d);
    return -1;
}
#endif

static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
    int start = 0, mid = 0, end = count - 1;
    if (end >= 0 && code_line > entries[end].code_line) {
        return count;
    }
    while (start < end) {
        mid = (start + end) / 2;
        if (code_line < entries[mid].code_line) {
            end = mid;
        } else if (code_line > entries[mid].code_line) {
             start = mid + 1;
        } else {
            return mid;
        }
    }
    if (code_line <= entries[mid].code_line) {
        return mid;
    } else {
        return mid + 1;
    }
}
static PyCodeObject *__pyx_find_code_object(int code_line) {
    PyCodeObject* code_object;
    int pos;
    if (unlikely(!code_line) || unlikely(!__pyx_code_cache.entries)) {
        return NULL;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if (unlikely(pos >= __pyx_code_cache.count) || unlikely(__pyx_code_cache.entries[pos].code_line != code_line)) {
        return NULL;
    }
    code_object = __pyx_code_cache.entries[pos].code_object;
    Py_INCREF(code_object);
    return code_object;
}
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object) {
    int pos, i;
    __Pyx_CodeObjectCacheEntry* entries = __pyx_code_cache.entries;
    if (unlikely(!code_line)) {
        return;
    }
    if (unlikely(!entries)) {
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Malloc(64*sizeof(__Pyx_CodeObjectCacheEntry));
        if (likely(entries)) {
            __pyx_code_cache.entries = entries;
            __pyx_code_cache.max_count = 64;
            __pyx_code_cache.count = 1;
            entries[0].code_line = code_line;
            entries[0].code_object = code_object;
            Py_INCREF(code_object);
        }
        return;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if ((pos < __pyx_code_cache.count) && unlikely(__pyx_code_cache.entries[pos].code_line == code_line)) {
        PyCodeObject* tmp = entries[pos].code_object;
        entries[pos].code_object = code_object;
        Py_DECREF(tmp);
        return;
    }
    if (__pyx_code_cache.count == __pyx_code_cache.max_count) {
        int new_max = __pyx_code_cache.max_count + 64;
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Realloc(
            __pyx_code_cache.entries, new_max*sizeof(__Pyx_CodeObjectCacheEntry));
        if (unlikely(!entries)) {
            return;
        }
        __pyx_code_cache.entries = entries;
        __pyx_code_cache.max_count = new_max;
    }
    for (i=__pyx_code_cache.count; i>pos; i--) {
        entries[i] = entries[i-1];
    }
    entries[pos].code_line = code_line;
    entries[pos].code_object = code_object;
    __pyx_code_cache.count++;
    Py_INCREF(code_object);
}

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"
static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
            const char *funcname, int c_line,
            int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(filename);
    #else
    py_srcfile = PyUnicode_FromString(filename);
    #endif
    if (!py_srcfile) goto bad;
    if (c_line) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_code = __Pyx_PyCode_New(
        0,            /*int argcount,*/
        0,            /*int kwonlyargcount,*/
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        __pyx_empty_bytes, /*PyObject *code,*/
        __pyx_empty_tuple, /*PyObject *consts,*/
        __pyx_empty_tuple, /*PyObject *names,*/
        __pyx_empty_tuple, /*PyObject *varnames,*/
        __pyx_empty_tuple, /*PyObject *freevars,*/
        __pyx_empty_tuple, /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        py_line,      /*int firstlineno,*/
        __pyx_empty_bytes  /*PyObject *lnotab*/
    );
    Py_DECREF(py_srcfile);
    Py_DECREF(py_funcname);
    return py_code;
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    return NULL;
}
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyObject *py_globals = 0;
    PyFrameObject *py_frame = 0;
    py_code = __pyx_find_code_object(c_line ? c_line : py_line);
    if (!py_code) {
        py_code = __Pyx_CreateCodeObjectForTraceback(
            funcname, c_line, py_line, filename);
        if (!py_code) goto bad;
        __pyx_insert_code_object(c_line ? c_line : py_line, py_code);
    }
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_GET(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = py_line;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else  /* Python 3+ has unicode identifiers */
        if (t->is_unicode | t->is_str) {
            if (t->intern) {
                *t->p = PyUnicode_InternFromString(t->s);
            } else if (t->encoding) {
                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
            } else {
                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
            }
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(char* c_str) {
    return __Pyx_PyUnicode_FromStringAndSize(c_str, strlen(c_str));
}
static CYTHON_INLINE char* __Pyx_PyObject_AsString(PyObject* o) {
    Py_ssize_t ignore;
    return __Pyx_PyObject_AsStringAndSize(o, &ignore);
}
static CYTHON_INLINE char* __Pyx_PyObject_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
    if (
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
            __Pyx_sys_getdefaultencoding_not_ascii &&
#endif
            PyUnicode_Check(o)) {
#if PY_VERSION_HEX < 0x03030000
        char* defenc_c;
        PyObject* defenc = _PyUnicode_AsDefaultEncodedString(o, NULL);
        if (!defenc) return NULL;
        defenc_c = PyBytes_AS_STRING(defenc);
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
        {
            char* end = defenc_c + PyBytes_GET_SIZE(defenc);
            char* c;
            for (c = defenc_c; c < end; c++) {
                if ((unsigned char) (*c) >= 128) {
                    PyUnicode_AsASCIIString(o);
                    return NULL;
                }
            }
        }
#endif /*__PYX_DEFAULT_STRING_ENCODING_IS_ASCII*/
        *length = PyBytes_GET_SIZE(defenc);
        return defenc_c;
#else /* PY_VERSION_HEX < 0x03030000 */
        if (PyUnicode_READY(o) == -1) return NULL;
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
        if (PyUnicode_IS_ASCII(o)) {
            *length = PyUnicode_GET_DATA_SIZE(o);
            return PyUnicode_AsUTF8(o);
        } else {
            PyUnicode_AsASCIIString(o);
            return NULL;
        }
#else /* __PYX_DEFAULT_STRING_ENCODING_IS_ASCII */
        return PyUnicode_AsUTF8AndSize(o, length);
#endif /* __PYX_DEFAULT_STRING_ENCODING_IS_ASCII */
#endif /* PY_VERSION_HEX < 0x03030000 */
    } else
#endif /* __PYX_DEFAULT_STRING_ENCODING_IS_ASCII  || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT */
#if PY_VERSION_HEX >= 0x02060000
    if (PyByteArray_Check(o)) {
        *length = PyByteArray_GET_SIZE(o);
        return PyByteArray_AS_STRING(o);
    } else
#endif
    {
        char* result;
        int r = PyBytes_AsStringAndSize(o, &result, length);
        if (unlikely(r < 0)) {
            return NULL;
        } else {
            return result;
        }
    }
}
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   int is_true = x == Py_True;
   if (is_true | (x == Py_False) | (x == Py_None)) return is_true;
   else return PyObject_IsTrue(x);
}
static CYTHON_INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x) {
  PyNumberMethods *m;
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_MAJOR_VERSION < 3
  if (PyInt_Check(x) || PyLong_Check(x))
#else
  if (PyLong_Check(x))
#endif
    return Py_INCREF(x), x;
  m = Py_TYPE(x)->tp_as_number;
#if PY_MAJOR_VERSION < 3
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = PyNumber_Long(x);
  }
#else
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Long(x);
  }
#endif
  if (res) {
#if PY_MAJOR_VERSION < 3
    if (!PyInt_Check(res) && !PyLong_Check(res)) {
#else
    if (!PyLong_Check(res)) {
#endif
      PyErr_Format(PyExc_TypeError,
                   "__%.4s__ returned non-%.4s (type %.200s)",
                   name, name, Py_TYPE(res)->tp_name);
      Py_DECREF(res);
      return NULL;
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
  #include "longintrepr.h"
 #endif
#endif
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject *x;
#if PY_MAJOR_VERSION < 3
  if (likely(PyInt_CheckExact(b)))
      return PyInt_AS_LONG(b);
#endif
  if (likely(PyLong_CheckExact(b))) {
    #if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
     #if CYTHON_USE_PYLONG_INTERNALS
       switch (Py_SIZE(b)) {
       case -1: return -(sdigit)((PyLongObject*)b)->ob_digit[0];
       case  0: return 0;
       case  1: return ((PyLongObject*)b)->ob_digit[0];
       }
     #endif
    #endif
  #if PY_VERSION_HEX < 0x02060000
    return PyInt_AsSsize_t(b);
  #else
    return PyLong_AsSsize_t(b);
  #endif
  }
  x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
#if PY_VERSION_HEX < 0x02050000
   if (ival <= LONG_MAX)
       return PyInt_FromLong((long)ival);
   else {
       unsigned char *bytes = (unsigned char *) &ival;
       int one = 1; int little = (int)*(unsigned char*)&one;
       return _PyLong_FromByteArray(bytes, sizeof(size_t), little, 0);
   }
#else
   return PyInt_FromSize_t(ival);
#endif
}


#endif /* Py_PYTHON_H */
